/*!
 * rpg_sprites.js - v1.6.1 (community-1.4)
 * (c) 2015 KADOKAWA CORPORATION./YOJI OJIMA
 * Contributions by the RPG Maker MV CoreScript team
 * https://github.com/thinknathan/corescript/blob/master/CONTRIBUTORS.md
 *
 * Licensed under the MIT License.
 * https://github.com/thinknathan/corescript/blob/master/LICENSE
 */
"use strict"
function Sprite_Base(){this.initialize.apply(this,arguments)}function Sprite_Button(){this.initialize.apply(this,arguments)}function Sprite_Character(){this.initialize.apply(this,arguments)}function Sprite_Battler(){this.initialize.apply(this,arguments)}function Sprite_Actor(){this.initialize.apply(this,arguments)}function Sprite_Enemy(){this.initialize.apply(this,arguments)}function Sprite_Animation(){this.initialize.apply(this,arguments)}function Sprite_Damage(){this.initialize.apply(this,arguments)}function Sprite_StateIcon(){this.initialize.apply(this,arguments)}function Sprite_StateOverlay(){this.initialize.apply(this,arguments)}function Sprite_Weapon(){this.initialize.apply(this,arguments)}function Sprite_Balloon(){this.initialize.apply(this,arguments)}function Sprite_Picture(){this.initialize.apply(this,arguments)}function Sprite_Timer(){this.initialize.apply(this,arguments)}function Sprite_Destination(){this.initialize.apply(this,arguments)}function Spriteset_Base(){this.initialize.apply(this,arguments)}function Spriteset_Map(){this.initialize.apply(this,arguments)}function Spriteset_Battle(){this.initialize.apply(this,arguments)}Sprite_Base.prototype=Object.create(Sprite.prototype),Sprite_Base.prototype.constructor=Sprite_Base,Sprite_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._animationSprites=[],this._effectTarget=this,this._hiding=!1},Sprite_Base.prototype.update=function(){Sprite.prototype.update.call(this),this.updateVisibility(),this.updateAnimationSprites()},Sprite_Base.prototype.hide=function(){this._hiding=!0,this.updateVisibility()},Sprite_Base.prototype.show=function(){this._hiding=!1,this.updateVisibility()},Sprite_Base.prototype.updateVisibility=function(){this.visible=!this._hiding},Sprite_Base.prototype.updateAnimationSprites=function(){if(this._animationSprites.length>0){const t=this._animationSprites.clone()
this._animationSprites=[]
for(let e=0;e<t.length;e++){const i=t[e]
i.isPlaying()?this._animationSprites.push(i):i.remove()}}},Sprite_Base.prototype.startAnimation=function(t,e,i){const a=new Sprite_Animation
a.setup(this._effectTarget,t,e,i),this.parent.addChild(a),this._animationSprites.push(a)},Sprite_Base.prototype.isAnimationPlaying=function(){return this._animationSprites.length>0},Sprite_Button.prototype=Object.create(Sprite.prototype),Sprite_Button.prototype.constructor=Sprite_Button,Sprite_Button.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._touching=!1,this._coldFrame=null,this._hotFrame=null,this._clickHandler=null},Sprite_Button.prototype.update=function(){Sprite.prototype.update.call(this),this.updateFrame(),this.processTouch()},Sprite_Button.prototype.updateFrame=function(){let t
t=this._touching?this._hotFrame:this._coldFrame,t&&this.setFrame(t.x,t.y,t.width,t.height)},Sprite_Button.prototype.setColdFrame=function(t,e,i,a){this._coldFrame=new Rectangle(t,e,i,a)},Sprite_Button.prototype.setHotFrame=function(t,e,i,a){this._hotFrame=new Rectangle(t,e,i,a)},Sprite_Button.prototype.setClickHandler=function(t){this._clickHandler=t},Sprite_Button.prototype.callClickHandler=function(){this._clickHandler&&this._clickHandler()},Sprite_Button.prototype.processTouch=function(){this.isActive()?(TouchInput.isTriggered()&&this.isButtonTouched()&&(this._touching=!0),this._touching&&(!TouchInput.isReleased()&&this.isButtonTouched()||(this._touching=!1,TouchInput.isReleased()&&this.callClickHandler()))):this._touching=!1},Sprite_Button.prototype.isActive=function(){let t=this
for(;t;){if(!t.visible)return!1
t=t.parent}return!0},Sprite_Button.prototype.isButtonTouched=function(){const t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y)
return t>=0&&e>=0&&t<this.width&&e<this.height},Sprite_Button.prototype.canvasToLocalX=function(t){let e=this
for(;e;)t-=e.x,e=e.parent
return t},Sprite_Button.prototype.canvasToLocalY=function(t){let e=this
for(;e;)t-=e.y,e=e.parent
return t},Sprite_Character.prototype=Object.create(Sprite_Base.prototype),Sprite_Character.prototype.constructor=Sprite_Character,Sprite_Character.prototype.initialize=function(t){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.setCharacter(t)},Sprite_Character.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._character=null,this._balloonDuration=0,this._tilesetId=0,this._upperBody=null,this._lowerBody=null},Sprite_Character.prototype.setCharacter=function(t){this._character=t},Sprite_Character.prototype.update=function(){Sprite_Base.prototype.update.call(this),this.updateBitmap(),this.updateFrame(),this.updatePosition(),this.updateAnimation(),this.updateBalloon(),this.updateOther()},Sprite_Character.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this),this._character.isTransparent()&&(this.visible=!1)},Sprite_Character.prototype.isTile=function(){return this._character.tileId>0},Sprite_Character.prototype.tilesetBitmap=function(t){const e=$gameMap.tileset(),i=5+Math.floor(t/256)
return ImageManager.loadTileset(e.tilesetNames[i])},Sprite_Character.prototype.updateBitmap=function(){this.isImageChanged()&&(this._tilesetId=$gameMap.tilesetId(),this._tileId=this._character.tileId(),this._characterName=this._character.characterName(),this._characterIndex=this._character.characterIndex(),this._tileId>0?this.setTileBitmap():this.setCharacterBitmap())},Sprite_Character.prototype.isImageChanged=function(){return this._tilesetId!==$gameMap.tilesetId()||this._tileId!==this._character.tileId()||this._characterName!==this._character.characterName()||this._characterIndex!==this._character.characterIndex()},Sprite_Character.prototype.setTileBitmap=function(){this.bitmap=this.tilesetBitmap(this._tileId)},Sprite_Character.prototype.setCharacterBitmap=function(){this.bitmap=ImageManager.loadCharacter(this._characterName),this._isBigCharacter=ImageManager.isBigCharacter(this._characterName)},Sprite_Character.prototype.updateFrame=function(){this._tileId>0?this.updateTileFrame():this.updateCharacterFrame()},Sprite_Character.prototype.updateTileFrame=function(){const t=this.patternWidth(),e=this.patternHeight(),i=(Math.floor(this._tileId/128)%2*8+this._tileId%8)*t,a=Math.floor(this._tileId%256/8)%16*e
this.setFrame(i,a,t,e)},Sprite_Character.prototype.updateCharacterFrame=function(){const t=this.patternWidth(),e=this.patternHeight(),i=(this.characterBlockX()+this.characterPatternX())*t,a=(this.characterBlockY()+this.characterPatternY())*e
if(this.updateHalfBodySprites(),this._bushDepth>0){const r=this._bushDepth
this._upperBody.setFrame(i,a,t,e-r),this._lowerBody.setFrame(i,a+e-r,t,r),this.setFrame(i,a,0,e)}else this.setFrame(i,a,t,e)},Sprite_Character.prototype.characterBlockX=function(){if(this._isBigCharacter)return 0
{const t=void 0
return this._character.characterIndex()%4*3}},Sprite_Character.prototype.characterBlockY=function(){if(this._isBigCharacter)return 0
{const t=this._character.characterIndex()
return 4*Math.floor(t/4)}},Sprite_Character.prototype.characterPatternX=function(){return this._character.pattern()},Sprite_Character.prototype.characterPatternY=function(){return(this._character.direction()-2)/2},Sprite_Character.prototype.patternWidth=function(){return this._tileId>0?$gameMap.tileWidth():this._isBigCharacter?this.bitmap.width/3:this.bitmap.width/12},Sprite_Character.prototype.patternHeight=function(){return this._tileId>0?$gameMap.tileHeight():this._isBigCharacter?this.bitmap.height/4:this.bitmap.height/8},Sprite_Character.prototype.updateHalfBodySprites=function(){this._bushDepth>0?(this.createHalfBodySprites(),this._upperBody.bitmap=this.bitmap,this._upperBody.visible=!0,this._upperBody.y=-this._bushDepth,this._lowerBody.bitmap=this.bitmap,this._lowerBody.visible=!0,this._upperBody.setBlendColor(this.getBlendColor()),this._lowerBody.setBlendColor(this.getBlendColor()),this._upperBody.setColorTone(this.getColorTone()),this._lowerBody.setColorTone(this.getColorTone())):this._upperBody&&(this._upperBody.visible=!1,this._lowerBody.visible=!1)},Sprite_Character.prototype.createHalfBodySprites=function(){this._upperBody||(this._upperBody=new Sprite,this._upperBody.anchor.x=.5,this._upperBody.anchor.y=1,this.addChild(this._upperBody)),this._lowerBody||(this._lowerBody=new Sprite,this._lowerBody.anchor.x=.5,this._lowerBody.anchor.y=1,this._lowerBody.opacity=128,this.addChild(this._lowerBody))},Sprite_Character.prototype.updatePosition=function(){this.x=this._character.screenX(),this.y=this._character.screenY(),this.z=this._character.screenZ()},Sprite_Character.prototype.updateAnimation=function(){this.setupAnimation(),this.isAnimationPlaying()||this._character.endAnimation(),this.isBalloonPlaying()||this._character.endBalloon()},Sprite_Character.prototype.updateOther=function(){this.opacity=this._character.opacity(),this.blendMode=this._character.blendMode(),this._bushDepth=this._character.bushDepth()},Sprite_Character.prototype.setupAnimation=function(){if(this._character.animationId()>0){const t=$dataAnimations[this._character.animationId()]
this.startAnimation(t,!1,0),this._character.startAnimation()}},Sprite_Character.prototype.setupBalloon=function(){this._character.balloonId()>0&&(this.startBalloon(),this._character.startBalloon())},Sprite_Character.prototype.startBalloon=function(){this._balloonSprite||(this._balloonSprite=new Sprite_Balloon),this._balloonSprite.setup(this._character.balloonId()),this.parent.addChild(this._balloonSprite)},Sprite_Character.prototype.updateBalloon=function(){this.setupBalloon(),this._balloonSprite&&(this._balloonSprite.x=this.x,this._balloonSprite.y=this.y-this.height,this._balloonSprite.isPlaying()||this.endBalloon())},Sprite_Character.prototype.endBalloon=function(){this._balloonSprite&&(this.parent.removeChild(this._balloonSprite),this._balloonSprite=null)},Sprite_Character.prototype.isBalloonPlaying=function(){return!!this._balloonSprite},Sprite_Battler.prototype=Object.create(Sprite_Base.prototype),Sprite_Battler.prototype.constructor=Sprite_Battler,Sprite_Battler.prototype.initialize=function(t){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.setBattler(t)},Sprite_Battler.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._battler=null,this._damages=[],this._homeX=0,this._homeY=0,this._offsetX=0,this._offsetY=0,this._targetOffsetX=NaN,this._targetOffsetY=NaN,this._movementDuration=0,this._selectionEffectCount=0},Sprite_Battler.prototype.setBattler=function(t){this._battler=t},Sprite_Battler.prototype.setHome=function(t,e){this._homeX=t,this._homeY=e,this.updatePosition()},Sprite_Battler.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._battler?(this.updateMain(),this.updateAnimation(),this.updateDamagePopup(),this.updateSelectionEffect()):this.bitmap=null},Sprite_Battler.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this),this._battler&&this._battler.isSpriteVisible()||(this.visible=!1)},Sprite_Battler.prototype.updateMain=function(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame()),this.updateMove(),this.updatePosition()},Sprite_Battler.prototype.updateBitmap=function(){},Sprite_Battler.prototype.updateFrame=function(){},Sprite_Battler.prototype.updateMove=function(){if(this._movementDuration>0){const t=this._movementDuration
this._offsetX=(this._offsetX*(t-1)+this._targetOffsetX)/t,this._offsetY=(this._offsetY*(t-1)+this._targetOffsetY)/t,this._movementDuration--,0===this._movementDuration&&this.onMoveEnd()}},Sprite_Battler.prototype.updatePosition=function(){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY},Sprite_Battler.prototype.updateAnimation=function(){this.setupAnimation()},Sprite_Battler.prototype.updateDamagePopup=function(){if(this.setupDamagePopup(),this._damages.length>0){for(let t=0;t<this._damages.length;t++)this._damages[t].update()
this._damages[0].isPlaying()||(this.parent.removeChild(this._damages[0]),this._damages.shift())}},Sprite_Battler.prototype.updateSelectionEffect=function(){const t=this._effectTarget
this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%30<15?t.setBlendColor([255,255,255,64]):t.setBlendColor([0,0,0,0])):this._selectionEffectCount>0&&(this._selectionEffectCount=0,t.setBlendColor([0,0,0,0]))},Sprite_Battler.prototype.setupAnimation=function(){for(;this._battler.isAnimationRequested();){const t=this._battler.shiftAnimation(),e=$dataAnimations[t.animationId],i=t.mirror,a=3===e.position?0:t.delay
this.startAnimation(e,i,a)
for(let t=0;t<this._animationSprites.length;t++){const e=void 0
this._animationSprites[t].visible=this._battler.isSpriteVisible()}}},Sprite_Battler.prototype.setupDamagePopup=function(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){const t=new Sprite_Damage
t.x=this.x+this.damageOffsetX(),t.y=this.y+this.damageOffsetY(),t.setup(this._battler),this._damages.push(t),this.parent.addChild(t)}this._battler.clearDamagePopup(),this._battler.clearResult()}},Sprite_Battler.prototype.damageOffsetX=function(){return 0},Sprite_Battler.prototype.damageOffsetY=function(){return 0},Sprite_Battler.prototype.startMove=function(t,e,i){this._targetOffsetX===t&&this._targetOffsetY===e||(this._targetOffsetX=t,this._targetOffsetY=e,this._movementDuration=i,0===i&&(this._offsetX=t,this._offsetY=e))},Sprite_Battler.prototype.onMoveEnd=function(){},Sprite_Battler.prototype.isEffecting=function(){return!1},Sprite_Battler.prototype.isMoving=function(){return this._movementDuration>0},Sprite_Battler.prototype.inHomePosition=function(){return 0===this._offsetX&&0===this._offsetY},Sprite_Actor.prototype=Object.create(Sprite_Battler.prototype),Sprite_Actor.prototype.constructor=Sprite_Actor,Sprite_Actor.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}},Sprite_Actor.prototype.initialize=function(t){Sprite_Battler.prototype.initialize.call(this,t),this.moveToStartPosition()},Sprite_Actor.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._battlerName="",this._motion=null,this._motionCount=0,this._pattern=0,this.createShadowSprite(),this.createWeaponSprite(),this.createMainSprite(),this.createStateSprite()},Sprite_Actor.prototype.createMainSprite=function(){this._mainSprite=new Sprite_Base,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=1,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite},Sprite_Actor.prototype.createShadowSprite=function(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow2"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=.5,this._shadowSprite.y=-2,this.addChild(this._shadowSprite)},Sprite_Actor.prototype.createWeaponSprite=function(){this._weaponSprite=new Sprite_Weapon,this.addChild(this._weaponSprite)},Sprite_Actor.prototype.createStateSprite=function(){this._stateSprite=new Sprite_StateOverlay,this.addChild(this._stateSprite)},Sprite_Actor.prototype.setBattler=function(t){Sprite_Battler.prototype.setBattler.call(this,t)
const e=void 0
t!==this._actor&&(this._actor=t,t&&this.setActorHome(t.index()),this.startEntryMotion(),this._stateSprite.setup(t))},Sprite_Actor.prototype.moveToStartPosition=function(){this.startMove(300,0,0)},Sprite_Actor.prototype.setActorHome=function(t){this.setHome(600+32*t,280+48*t)},Sprite_Actor.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this.updateShadow(),this._actor&&this.updateMotion()},Sprite_Actor.prototype.updateShadow=function(){this._shadowSprite.visible=!!this._actor},Sprite_Actor.prototype.updateMain=function(){Sprite_Battler.prototype.updateMain.call(this),this._actor.isSpriteVisible()&&!this.isMoving()&&this.updateTargetPosition()},Sprite_Actor.prototype.setupMotion=function(){this._actor.isMotionRequested()&&(this.startMotion(this._actor.motionType()),this._actor.clearMotion())},Sprite_Actor.prototype.setupWeaponAnimation=function(){this._actor.isWeaponAnimationRequested()&&(this._weaponSprite.setup(this._actor.weaponImageId()),this._actor.clearWeaponAnimation())},Sprite_Actor.prototype.startMotion=function(t){const e=Sprite_Actor.MOTIONS[t]
this._motion!==e&&(this._motion=e,this._motionCount=0,this._pattern=0)},Sprite_Actor.prototype.updateTargetPosition=function(){this._actor.isInputting()||this._actor.isActing()?this.stepForward():this._actor.canMove()&&BattleManager.isEscaped()?this.retreat():this.inHomePosition()||this.stepBack()},Sprite_Actor.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this)
const t=this._actor.battlerName()
this._battlerName!==t&&(this._battlerName=t,this._mainSprite.bitmap=ImageManager.loadSvActor(t))},Sprite_Actor.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this)
const t=this._mainSprite.bitmap
if(t){const e=this._motion?this._motion.index:0,i=this._pattern<3?this._pattern:1,a=t.width/9,r=t.height/6,o=3*Math.floor(e/6)+i,s=e%6
this._mainSprite.setFrame(o*a,s*r,a,r)}},Sprite_Actor.prototype.updateMove=function(){const t=this._mainSprite.bitmap
t&&!t.isReady()||Sprite_Battler.prototype.updateMove.call(this)},Sprite_Actor.prototype.updateMotion=function(){this.setupMotion(),this.setupWeaponAnimation(),this._actor.isMotionRefreshRequested()&&(this.refreshMotion(),this._actor.clearMotion()),this.updateMotionCount()},Sprite_Actor.prototype.updateMotionCount=function(){this._motion&&++this._motionCount>=this.motionSpeed()&&(this._motion.loop?this._pattern=(this._pattern+1)%4:this._pattern<2?this._pattern++:this.refreshMotion(),this._motionCount=0)},Sprite_Actor.prototype.motionSpeed=function(){return 12},Sprite_Actor.prototype.refreshMotion=function(){const t=this._actor,e=Sprite_Actor.MOTIONS.guard
if(t){if(this._motion===e&&!BattleManager.isInputting())return
const i=t.stateMotionIndex()
t.isInputting()||t.isActing()?this.startMotion("walk"):3===i?this.startMotion("dead"):2===i?this.startMotion("sleep"):t.isChanting()?this.startMotion("chant"):t.isGuard()||t.isGuardWaiting()?this.startMotion("guard"):1===i?this.startMotion("abnormal"):t.isDying()?this.startMotion("dying"):t.isUndecided()?this.startMotion("walk"):this.startMotion("wait")}},Sprite_Actor.prototype.startEntryMotion=function(){this._actor&&this._actor.canMove()?(this.startMotion("walk"),this.startMove(0,0,30)):this.isMoving()||(this.refreshMotion(),this.startMove(0,0,0))},Sprite_Actor.prototype.stepForward=function(){this.startMove(-48,0,12)},Sprite_Actor.prototype.stepBack=function(){this.startMove(0,0,12)},Sprite_Actor.prototype.retreat=function(){this.startMove(300,0,30)},Sprite_Actor.prototype.onMoveEnd=function(){Sprite_Battler.prototype.onMoveEnd.call(this),BattleManager.isBattleEnd()||this.refreshMotion()},Sprite_Actor.prototype.damageOffsetX=function(){return-32},Sprite_Actor.prototype.damageOffsetY=function(){return 0},Sprite_Enemy.prototype=Object.create(Sprite_Battler.prototype),Sprite_Enemy.prototype.constructor=Sprite_Enemy,Sprite_Enemy.prototype.initialize=function(t){Sprite_Battler.prototype.initialize.call(this,t)},Sprite_Enemy.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._enemy=null,this._appeared=!1,this._battlerName="",this._battlerHue=0,this._effectType=null,this._effectDuration=0,this._shake=0,this.createStateIconSprite()},Sprite_Enemy.prototype.createStateIconSprite=function(){this._stateIconSprite=new Sprite_StateIcon,this.addChild(this._stateIconSprite)},Sprite_Enemy.prototype.setBattler=function(t){Sprite_Battler.prototype.setBattler.call(this,t),this._enemy=t,this.setHome(t.screenX(),t.screenY()),this._stateIconSprite.setup(t)},Sprite_Enemy.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this._enemy&&(this.updateEffect(),this.updateStateSprite())},Sprite_Enemy.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this)
const t=this._enemy.battlerName(),e=this._enemy.battlerHue()
this._battlerName===t&&this._battlerHue===e||(this._battlerName=t,this._battlerHue=e,this.loadBitmap(t,e),this.initVisibility())},Sprite_Enemy.prototype.loadBitmap=function(t,e){$gameSystem.isSideView()?this.bitmap=ImageManager.loadSvEnemy(t,e):this.bitmap=ImageManager.loadEnemy(t,e)},Sprite_Enemy.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this)
let t=this.bitmap.height
"bossCollapse"===this._effectType&&(t=this._effectDuration),this.setFrame(0,0,this.bitmap.width,t)},Sprite_Enemy.prototype.updatePosition=function(){Sprite_Battler.prototype.updatePosition.call(this),this.x+=this._shake},Sprite_Enemy.prototype.updateStateSprite=function(){this._stateIconSprite.y=-Math.round(.9*(this.bitmap.height+40)),this._stateIconSprite.y<20-this.y&&(this._stateIconSprite.y=20-this.y)},Sprite_Enemy.prototype.initVisibility=function(){this._appeared=this._enemy.isAlive(),this._appeared||(this.opacity=0)},Sprite_Enemy.prototype.setupEffect=function(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect()),!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")},Sprite_Enemy.prototype.startEffect=function(t){switch(this._effectType=t,this._effectType){case"appear":this.startAppear()
break
case"disappear":this.startDisappear()
break
case"whiten":this.startWhiten()
break
case"blink":this.startBlink()
break
case"collapse":this.startCollapse()
break
case"bossCollapse":this.startBossCollapse()
break
case"instantCollapse":this.startInstantCollapse()}this.revertToNormal()},Sprite_Enemy.prototype.startAppear=function(){this._effectDuration=16,this._appeared=!0},Sprite_Enemy.prototype.startDisappear=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startWhiten=function(){this._effectDuration=16},Sprite_Enemy.prototype.startBlink=function(){this._effectDuration=20},Sprite_Enemy.prototype.startCollapse=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startBossCollapse=function(){this._effectDuration=this.bitmap.height,this._appeared=!1},Sprite_Enemy.prototype.startInstantCollapse=function(){this._effectDuration=16,this._appeared=!1},Sprite_Enemy.prototype.updateEffect=function(){if(this.setupEffect(),this._effectDuration>0){switch(this._effectDuration--,this._effectType){case"whiten":this.updateWhiten()
break
case"blink":this.updateBlink()
break
case"appear":this.updateAppear()
break
case"disappear":this.updateDisappear()
break
case"collapse":this.updateCollapse()
break
case"bossCollapse":this.updateBossCollapse()
break
case"instantCollapse":this.updateInstantCollapse()}0===this._effectDuration&&(this._effectType=null)}},Sprite_Enemy.prototype.isEffecting=function(){return null!==this._effectType},Sprite_Enemy.prototype.revertToNormal=function(){this._shake=0,this.blendMode=0,this.opacity=255,this.setBlendColor([0,0,0,0])},Sprite_Enemy.prototype.updateWhiten=function(){const t=128-10*(16-this._effectDuration)
this.setBlendColor([255,255,255,t])},Sprite_Enemy.prototype.updateBlink=function(){this.opacity=this._effectDuration%10<5?255:0},Sprite_Enemy.prototype.updateAppear=function(){this.opacity=16*(16-this._effectDuration)},Sprite_Enemy.prototype.updateDisappear=function(){this.opacity=256-10*(32-this._effectDuration)},Sprite_Enemy.prototype.updateCollapse=function(){this.blendMode=Graphics.BLEND_ADD,this.setBlendColor([255,128,128,128]),this.opacity*=this._effectDuration/(this._effectDuration+1)},Sprite_Enemy.prototype.updateBossCollapse=function(){this._shake=this._effectDuration%2*4-2,this.blendMode=Graphics.BLEND_ADD,this.opacity*=this._effectDuration/(this._effectDuration+1),this.setBlendColor([255,255,255,255-this.opacity]),this._effectDuration%20==19&&SoundManager.playBossCollapse2()},Sprite_Enemy.prototype.updateInstantCollapse=function(){this.opacity=0},Sprite_Enemy.prototype.damageOffsetX=function(){return 0},Sprite_Enemy.prototype.damageOffsetY=function(){return-8},Sprite_Animation.prototype=Object.create(Sprite.prototype),Sprite_Animation.prototype.constructor=Sprite_Animation,Sprite_Animation._checker1={},Sprite_Animation._checker2={},Sprite_Animation.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._reduceArtifacts=!0,this.initMembers()},Sprite_Animation.prototype.initMembers=function(){this._target=null,this._animation=null,this._mirror=!1,this._delay=0,this._rate=4,this._duration=0,this._flashColor=[0,0,0,0],this._flashDuration=0,this._screenFlashDuration=0,this._hidingDuration=0,this._bitmap1=null,this._bitmap2=null,this._cellSprites=[],this._screenFlashSprite=null,this._duplicated=!1,this.z=8},Sprite_Animation.prototype.setup=function(t,e,i,a){this._target=t,this._animation=e,this._mirror=i,this._delay=a,this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())},Sprite_Animation.prototype.remove=function(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())},Sprite_Animation.prototype.setupRate=function(){this._rate=4},Sprite_Animation.prototype.setupDuration=function(){this._duration=this._animation.frames.length*this._rate+1},Sprite_Animation.prototype.update=function(){Sprite.prototype.update.call(this),this.updateMain(),this.updateFlash(),this.updateScreenFlash(),this.updateHiding(),Sprite_Animation._checker1={},Sprite_Animation._checker2={}},Sprite_Animation.prototype.updateFlash=function(){if(this._flashDuration>0){const t=this._flashDuration--
this._flashColor[3]*=(t-1)/t,this._target.setBlendColor(this._flashColor)}},Sprite_Animation.prototype.updateScreenFlash=function(){if(this._screenFlashDuration>0){const t=this._screenFlashDuration--
this._screenFlashSprite&&(this._screenFlashSprite.x=-this.absoluteX(),this._screenFlashSprite.y=-this.absoluteY(),this._screenFlashSprite.opacity*=(t-1)/t,this._screenFlashSprite.visible=this._screenFlashDuration>0)}},Sprite_Animation.prototype.absoluteX=function(){let t=0,e=this
for(;e;)t+=e.x,e=e.parent
return t},Sprite_Animation.prototype.absoluteY=function(){let t=0,e=this
for(;e;)t+=e.y,e=e.parent
return t},Sprite_Animation.prototype.updateHiding=function(){this._hidingDuration>0&&(this._hidingDuration--,0===this._hidingDuration&&this._target.show())},Sprite_Animation.prototype.isPlaying=function(){return this._duration>0},Sprite_Animation.prototype.loadBitmaps=function(){const t=this._animation.animation1Name,e=this._animation.animation2Name,i=this._animation.animation1Hue,a=this._animation.animation2Hue
this._bitmap1=ImageManager.loadAnimation(t,i),this._bitmap2=ImageManager.loadAnimation(e,a)},Sprite_Animation.prototype.isReady=function(){return this._bitmap1&&this._bitmap1.isReady()&&this._bitmap2&&this._bitmap2.isReady()},Sprite_Animation.prototype.createSprites=function(){Sprite_Animation._checker2[this._animation]||(this.createCellSprites(),3===this._animation.position&&(Sprite_Animation._checker2[this._animation]=!0),this.createScreenFlashSprite()),Sprite_Animation._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,3===this._animation.position&&(Sprite_Animation._checker1[this._animation]=!0))},Sprite_Animation.prototype.createCellSprites=function(){this._cellSprites=[]
for(let t=0;t<16;t++){const t=new Sprite
t.anchor.x=.5,t.anchor.y=.5,this._cellSprites.push(t),this.addChild(t)}},Sprite_Animation.prototype.createScreenFlashSprite=function(){this._screenFlashSprite=new ScreenSprite,this.addChild(this._screenFlashSprite)},Sprite_Animation.prototype.updateMain=function(){this.isPlaying()&&this.isReady()&&(this._delay>0?this._delay--:(this._duration--,this.updatePosition(),this._duration%this._rate==0&&this.updateFrame()))},Sprite_Animation.prototype.updatePosition=function(){if(3===this._animation.position)this.x=this.parent.width/2,this.y=this.parent.height/2
else{const t=this._target.parent,e=t?t.parent:null
this.x=this._target.x,this.y=this._target.y,this.parent===e&&(this.x+=t.x,this.y+=t.y),0===this._animation.position?this.y-=this._target.height:1===this._animation.position&&(this.y-=this._target.height/2)}},Sprite_Animation.prototype.updateFrame=function(){if(this._duration>0){const t=this.currentFrameIndex()
this.updateAllCellSprites(this._animation.frames[t]),this._animation.timings.forEach((function(e){e.frame===t&&this.processTimingData(e)}),this)}},Sprite_Animation.prototype.currentFrameIndex=function(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)},Sprite_Animation.prototype.updateAllCellSprites=function(t){for(let e=0;e<this._cellSprites.length;e++){const i=this._cellSprites[e]
e<t.length?this.updateCellSprite(i,t[e]):i.visible=!1}},Sprite_Animation.prototype.updateCellSprite=function(t,e){const i=e[0]
if(i>=0){const a=i%5*192,r=192*Math.floor(i%100/5),o=this._mirror
t.bitmap=i<100?this._bitmap1:this._bitmap2,t.setFrame(a,r,192,192),t.x=e[1],t.y=e[2],t.rotation=e[4]*Math.PI/180,t.scale.x=e[3]/100,e[5]&&(t.scale.x*=-1),o&&(t.x*=-1,t.rotation*=-1,t.scale.x*=-1),t.scale.y=e[3]/100,t.opacity=e[6],t.blendMode=e[7],t.visible=!0}else t.visible=!1},Sprite_Animation.prototype.processTimingData=function(t){const e=t.flashDuration*this._rate
switch(t.flashScope){case 1:this.startFlash(t.flashColor,e)
break
case 2:this.startScreenFlash(t.flashColor,e)
break
case 3:this.startHiding(e)}!this._duplicated&&t.se&&AudioManager.playSe(t.se)},Sprite_Animation.prototype.startFlash=function(t,e){this._flashColor=t.clone(),this._flashDuration=e},Sprite_Animation.prototype.startScreenFlash=function(t,e){this._screenFlashDuration=e,this._screenFlashSprite&&(this._screenFlashSprite.setColor(t[0],t[1],t[2]),this._screenFlashSprite.opacity=t[3])},Sprite_Animation.prototype.startHiding=function(t){this._hidingDuration=t,this._target.hide()},Sprite_Damage.prototype=Object.create(Sprite.prototype),Sprite_Damage.prototype.constructor=Sprite_Damage,Sprite_Damage.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._duration=90,this._flashColor=[0,0,0,0],this._flashDuration=0,this._damageBitmap=ImageManager.loadSystem("Damage")},Sprite_Damage.prototype.setup=function(t){const e=t.result()
e.missed||e.evaded?this.createMiss():e.hpAffected?this.createDigits(0,e.hpDamage):t.isAlive()&&0!==e.mpDamage&&this.createDigits(2,e.mpDamage),e.critical&&this.setupCriticalEffect()},Sprite_Damage.prototype.setupCriticalEffect=function(){this._flashColor=[255,0,0,160],this._flashDuration=60},Sprite_Damage.prototype.digitWidth=function(){return this._damageBitmap?this._damageBitmap.width/10:0},Sprite_Damage.prototype.digitHeight=function(){return this._damageBitmap?this._damageBitmap.height/5:0},Sprite_Damage.prototype.createMiss=function(){const t=this.digitWidth(),e=this.digitHeight(),i=this.createChildSprite()
i.setFrame(0,4*e,4*t,e),i.dy=0},Sprite_Damage.prototype.createDigits=function(t,e){const i=Math.abs(e).toString(),a=t+(e<0?1:0),r=this.digitWidth(),o=this.digitHeight()
for(let t=0;t<i.length;t++){const e=this.createChildSprite(),s=Number(i[t])
e.setFrame(s*r,a*o,r,o),e.x=(t-(i.length-1)/2)*r,e.dy=-t}},Sprite_Damage.prototype.createChildSprite=function(){const t=new Sprite
return t.bitmap=this._damageBitmap,t.anchor.x=.5,t.anchor.y=1,t.y=-40,t.ry=t.y,this.addChild(t),t},Sprite_Damage.prototype.update=function(){if(Sprite.prototype.update.call(this),this._duration>0){this._duration--
for(let t=0;t<this.children.length;t++)this.updateChild(this.children[t])}this.updateFlash(),this.updateOpacity()},Sprite_Damage.prototype.updateChild=function(t){t.dy+=.5,t.ry+=t.dy,t.ry>=0&&(t.ry=0,t.dy*=-.6),t.y=Math.round(t.ry),t.setBlendColor(this._flashColor)},Sprite_Damage.prototype.updateFlash=function(){if(this._flashDuration>0){const t=this._flashDuration--
this._flashColor[3]*=(t-1)/t}},Sprite_Damage.prototype.updateOpacity=function(){this._duration<10&&(this.opacity=255*this._duration/10)},Sprite_Damage.prototype.isPlaying=function(){return this._duration>0},Sprite_StateIcon.prototype=Object.create(Sprite.prototype),Sprite_StateIcon.prototype.constructor=Sprite_StateIcon,Sprite_StateIcon.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateIcon._iconWidth=32,Sprite_StateIcon._iconHeight=32,Sprite_StateIcon.prototype.initMembers=function(){this._battler=null,this._iconIndex=0,this._animationCount=0,this._animationIndex=0,this.anchor.x=.5,this.anchor.y=.5},Sprite_StateIcon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("IconSet"),this.setFrame(0,0,0,0)},Sprite_StateIcon.prototype.setup=function(t){this._battler=t},Sprite_StateIcon.prototype.update=function(){Sprite.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updateIcon(),this.updateFrame(),this._animationCount=0)},Sprite_StateIcon.prototype.animationWait=function(){return 40},Sprite_StateIcon.prototype.updateIcon=function(){let t=[]
this._battler&&this._battler.isAlive()&&(t=this._battler.allIcons()),t.length>0?(this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0),this._iconIndex=t[this._animationIndex]):(this._animationIndex=0,this._iconIndex=0)},Sprite_StateIcon.prototype.updateFrame=function(){const t=Sprite_StateIcon._iconWidth,e=Sprite_StateIcon._iconHeight,i=this._iconIndex%16*t,a=Math.floor(this._iconIndex/16)*e
this.setFrame(i,a,t,e)},Sprite_StateOverlay.prototype=Object.create(Sprite_Base.prototype),Sprite_StateOverlay.prototype.constructor=Sprite_StateOverlay,Sprite_StateOverlay.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateOverlay.prototype.initMembers=function(){this._battler=null,this._overlayIndex=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1},Sprite_StateOverlay.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("States"),this.setFrame(0,0,0,0)},Sprite_StateOverlay.prototype.setup=function(t){this._battler=t},Sprite_StateOverlay.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)},Sprite_StateOverlay.prototype.animationWait=function(){return 8},Sprite_StateOverlay.prototype.updatePattern=function(){this._pattern++,this._pattern%=8,this._battler&&(this._overlayIndex=this._battler.stateOverlayIndex())},Sprite_StateOverlay.prototype.updateFrame=function(){if(this._overlayIndex>0){const t=96,e=96,i=this._pattern*t,a=(this._overlayIndex-1)*e
this.setFrame(i,a,t,e)}else this.setFrame(0,0,0,0)},Sprite_Weapon.prototype=Object.create(Sprite_Base.prototype),Sprite_Weapon.prototype.constructor=Sprite_Weapon,Sprite_Weapon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers()},Sprite_Weapon.prototype.initMembers=function(){this._weaponImageId=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1,this.x=-16},Sprite_Weapon.prototype.setup=function(t){this._weaponImageId=t,this._animationCount=0,this._pattern=0,this.loadBitmap(),this.updateFrame()},Sprite_Weapon.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)},Sprite_Weapon.prototype.animationWait=function(){return 12},Sprite_Weapon.prototype.updatePattern=function(){this._pattern++,this._pattern>=3&&(this._weaponImageId=0)},Sprite_Weapon.prototype.loadBitmap=function(){const t=Math.floor((this._weaponImageId-1)/12)+1
this.bitmap=t>=1?ImageManager.loadSystem("Weapons"+t):ImageManager.loadSystem("")},Sprite_Weapon.prototype.updateFrame=function(){if(this._weaponImageId>0){const t=(this._weaponImageId-1)%12,e=96,i=64,a=(3*Math.floor(t/6)+this._pattern)*e,r=Math.floor(t%6)*i
this.setFrame(a,r,e,i)}else this.setFrame(0,0,0,0)},Sprite_Weapon.prototype.isPlaying=function(){return this._weaponImageId>0},Sprite_Balloon.prototype=Object.create(Sprite_Base.prototype),Sprite_Balloon.prototype.constructor=Sprite_Balloon,Sprite_Balloon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_Balloon.prototype.initMembers=function(){this._balloonId=0,this._duration=0,this.anchor.x=.5,this.anchor.y=1,this.z=7},Sprite_Balloon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("Balloon"),this.setFrame(0,0,0,0)},Sprite_Balloon.prototype.setup=function(t){this._balloonId=t,this._duration=8*this.speed()+this.waitTime()},Sprite_Balloon.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._duration>0&&(this._duration--,this._duration>0&&this.updateFrame())},Sprite_Balloon.prototype.updateFrame=function(){const t=48,e=48,i=this.frameIndex()*t,a=(this._balloonId-1)*e
this.setFrame(i,a,t,e)},Sprite_Balloon.prototype.speed=function(){return 8},Sprite_Balloon.prototype.waitTime=function(){return 12},Sprite_Balloon.prototype.frameIndex=function(){const t=(this._duration-this.waitTime())/this.speed()
return 7-Math.max(Math.floor(t),0)},Sprite_Balloon.prototype.isPlaying=function(){return this._duration>0},Sprite_Picture.prototype=Object.create(Sprite.prototype),Sprite_Picture.prototype.constructor=Sprite_Picture,Sprite_Picture.prototype.initialize=function(t){Sprite.prototype.initialize.call(this),this._pictureId=t,this._pictureName="",this.update()},Sprite_Picture.prototype.picture=function(){return $gameScreen.picture(this._pictureId)},Sprite_Picture.prototype.update=function(){Sprite.prototype.update.call(this),this.updateBitmap(),this.visible&&(this.updateOrigin(),this.updatePosition(),this.updateScale(),this.updateTone(),this.updateOther())},Sprite_Picture.prototype.updateBitmap=function(){const t=this.picture()
if(t){const e=t.name()
this._pictureName!==e&&(this._pictureName=e,this.loadBitmap()),this.visible=!0}else this._pictureName="",this.bitmap=null,this.visible=!1},Sprite_Picture.prototype.updateOrigin=function(){const t=void 0
0===this.picture().origin()?(this.anchor.x=0,this.anchor.y=0):(this.anchor.x=.5,this.anchor.y=.5)},Sprite_Picture.prototype.updatePosition=function(){const t=this.picture()
this.x=Math.floor(t.x()),this.y=Math.floor(t.y())},Sprite_Picture.prototype.updateScale=function(){const t=this.picture()
this.scale.x=t.scaleX()/100,this.scale.y=t.scaleY()/100},Sprite_Picture.prototype.updateTone=function(){const t=this.picture()
t.tone()?this.setColorTone(t.tone()):this.setColorTone([0,0,0,0])},Sprite_Picture.prototype.updateOther=function(){const t=this.picture()
this.opacity=t.opacity(),this.blendMode=t.blendMode(),this.rotation=t.angle()*Math.PI/180},Sprite_Picture.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadPicture(this._pictureName)},Sprite_Timer.prototype=Object.create(Sprite.prototype),Sprite_Timer.prototype.constructor=Sprite_Timer,Sprite_Timer.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._seconds=0,this.createBitmap(),this.update()},Sprite_Timer.prototype.createBitmap=function(){this.bitmap=new Bitmap(96,48),this.bitmap.fontSize=32},Sprite_Timer.prototype.update=function(){Sprite.prototype.update.call(this),this.updateBitmap(),this.updatePosition(),this.updateVisibility()},Sprite_Timer.prototype.updateBitmap=function(){this._seconds!==$gameTimer.seconds()&&(this._seconds=$gameTimer.seconds(),this.redraw())},Sprite_Timer.prototype.redraw=function(){const t=this.timerText(),e=this.bitmap.width,i=this.bitmap.height
this.bitmap.clear(),this.bitmap.drawText(t,0,0,e,i,"center")},Sprite_Timer.prototype.timerText=function(){const t=Math.floor(this._seconds/60)%60,e=this._seconds%60
return t.padZero(2)+":"+e.padZero(2)},Sprite_Timer.prototype.updatePosition=function(){this.x=Graphics.width-this.bitmap.width,this.y=0},Sprite_Timer.prototype.updateVisibility=function(){this.visible=$gameTimer.isWorking()},Sprite_Destination.prototype=Object.create(Sprite.prototype),Sprite_Destination.prototype.constructor=Sprite_Destination,Sprite_Destination.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.createBitmap(),this._frameCount=0},Sprite_Destination.prototype.update=function(){Sprite.prototype.update.call(this),$gameTemp.isDestinationValid()?(this.updatePosition(),this.updateAnimation(),this.visible=!0):(this._frameCount=0,this.visible=!1)},Sprite_Destination.prototype.createBitmap=function(){const t=$gameMap.tileWidth(),e=$gameMap.tileHeight()
this.bitmap=new Bitmap(t,e),this.bitmap.fillAll("white"),this.anchor.x=.5,this.anchor.y=.5,this.blendMode=Graphics.BLEND_ADD},Sprite_Destination.prototype.updatePosition=function(){const t=$gameMap.tileWidth(),e=$gameMap.tileHeight(),i=$gameTemp.destinationX(),a=$gameTemp.destinationY()
this.x=($gameMap.adjustX(i)+.5)*t,this.y=($gameMap.adjustY(a)+.5)*e},Sprite_Destination.prototype.updateAnimation=function(){this._frameCount++,this._frameCount%=20,this.opacity=6*(20-this._frameCount),this.scale.x=1+this._frameCount/20,this.scale.y=this.scale.x},Spriteset_Base.prototype=Object.create(Sprite.prototype),Spriteset_Base.prototype.constructor=Spriteset_Base,Spriteset_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.setFrame(0,0,Graphics.width,Graphics.height),this._tone=[0,0,0,0],this.opaque=!0,this.createLowerLayer(),this.createToneChanger(),this.createUpperLayer(),this.update()},Spriteset_Base.prototype.createLowerLayer=function(){this.createBaseSprite()},Spriteset_Base.prototype.createUpperLayer=function(){this.createPictures(),this.createTimer(),this.createScreenSprites()},Spriteset_Base.prototype.update=function(){Sprite.prototype.update.call(this),this.updateScreenSprites(),this.updateToneChanger(),this.updatePosition()},Spriteset_Base.prototype.createBaseSprite=function(){this._baseSprite=new Sprite,this._baseSprite.setFrame(0,0,this.width,this.height),this._blackScreen=new ScreenSprite,this._blackScreen.opacity=255,this.addChild(this._baseSprite),this._baseSprite.addChild(this._blackScreen)},Spriteset_Base.prototype.createToneChanger=function(){Graphics.isWebGL()?this.createWebGLToneChanger():this.createCanvasToneChanger()},Spriteset_Base.prototype.createWebGLToneChanger=function(){const t=48,e=Graphics.width+96,i=Graphics.height+96
this._toneFilter=new ToneFilter,this._toneFilter.enabled=!1,this._baseSprite.filters=[this._toneFilter],this._baseSprite.filterArea=new Rectangle(-48,-48,e,i)},Spriteset_Base.prototype.createCanvasToneChanger=function(){this._toneSprite=new ToneSprite,this.addChild(this._toneSprite)},Spriteset_Base.prototype.createPictures=function(){const t=Graphics.boxWidth,e=Graphics.boxHeight,i=(Graphics.width-t)/2,a=(Graphics.height-e)/2
this._pictureContainer=new Sprite,this._pictureContainer.setFrame(i,a,t,e)
for(let t=1;t<=$gameScreen.maxPictures();t++)this._pictureContainer.addChild(new Sprite_Picture(t))
this.addChild(this._pictureContainer)},Spriteset_Base.prototype.createTimer=function(){this._timerSprite=new Sprite_Timer,this.addChild(this._timerSprite)},Spriteset_Base.prototype.createScreenSprites=function(){this._flashSprite=new ScreenSprite,this._fadeSprite=new ScreenSprite,this.addChild(this._flashSprite),this.addChild(this._fadeSprite)},Spriteset_Base.prototype.updateScreenSprites=function(){const t=$gameScreen.flashColor()
this._flashSprite.setColor(t[0],t[1],t[2]),this._flashSprite.opacity=t[3],this._fadeSprite.opacity=255-$gameScreen.brightness()},Spriteset_Base.prototype.updateToneChanger=function(){const t=$gameScreen.tone()
this._tone.equals(t)||(this._tone=t.clone(),Graphics.isWebGL()?this.updateWebGLToneChanger():this.updateCanvasToneChanger())},Spriteset_Base.prototype.updateWebGLToneChanger=function(){const t=this._tone
this._toneFilter.reset(),t[0]||t[1]||t[2]||t[3]?(this._toneFilter.enabled=!0,this._toneFilter.adjustTone(t[0],t[1],t[2]),this._toneFilter.adjustSaturation(-t[3])):this._toneFilter.enabled=!1},Spriteset_Base.prototype.updateCanvasToneChanger=function(){const t=this._tone
this._toneSprite.setTone(t[0],t[1],t[2],t[3])},Spriteset_Base.prototype.updatePosition=function(){const t=$gameScreen,e=t.zoomScale()
this.scale.x=e,this.scale.y=e,this.x=Math.round(-t.zoomX()*(e-1)),this.y=Math.round(-t.zoomY()*(e-1)),this.x+=Math.round(t.shake())},Spriteset_Map.prototype=Object.create(Spriteset_Base.prototype),Spriteset_Map.prototype.constructor=Spriteset_Map,Spriteset_Map.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this)},Spriteset_Map.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this),this.createParallax(),this.createTilemap(),this.createCharacters(),this.createShadow(),this.createDestination(),this.createWeather()},Spriteset_Map.prototype.update=function(){Spriteset_Base.prototype.update.call(this),this.updateTileset(),this.updateParallax(),this.updateTilemap(),this.updateShadow(),this.updateWeather()},Spriteset_Map.prototype.hideCharacters=function(){for(let t=0;t<this._characterSprites.length;t++){const e=this._characterSprites[t]
e.isTile()||e.hide()}},Spriteset_Map.prototype.createParallax=function(){this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics.width,Graphics.height),this._baseSprite.addChild(this._parallax)},Spriteset_Map.prototype.createTilemap=function(){Graphics.isWebGL()?this._tilemap=new ShaderTilemap:this._tilemap=new Tilemap,this._tilemap.tileWidth=$gameMap.tileWidth(),this._tilemap.tileHeight=$gameMap.tileHeight(),this._tilemap.setData($gameMap.width(),$gameMap.height(),$gameMap.data()),this._tilemap.horizontalWrap=$gameMap.isLoopHorizontal(),this._tilemap.verticalWrap=$gameMap.isLoopVertical(),this.loadTileset(),this._baseSprite.addChild(this._tilemap)},Spriteset_Map.prototype.loadTileset=function(){if(this._tileset=$gameMap.tileset(),this._tileset){const t=this._tileset.tilesetNames
for(let e=0;e<t.length;e++)this._tilemap.bitmaps[e]=ImageManager.loadTileset(t[e])
const e=$gameMap.tilesetFlags()
this._tilemap.refreshTileset(),this._tilemap.flags.equals(e)||this._tilemap.refresh(),this._tilemap.flags=e}},Spriteset_Map.prototype.createCharacters=function(){this._characterSprites=[],$gameMap.events().forEach((function(t){this._characterSprites.push(new Sprite_Character(t))}),this),$gameMap.vehicles().forEach((function(t){this._characterSprites.push(new Sprite_Character(t))}),this),$gamePlayer.followers().reverseEach((function(t){this._characterSprites.push(new Sprite_Character(t))}),this),this._characterSprites.push(new Sprite_Character($gamePlayer))
for(let t=0;t<this._characterSprites.length;t++)this._tilemap.addChild(this._characterSprites[t])},Spriteset_Map.prototype.createShadow=function(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow1"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=1,this._shadowSprite.z=6,this._tilemap.addChild(this._shadowSprite)},Spriteset_Map.prototype.createDestination=function(){this._destinationSprite=new Sprite_Destination,this._destinationSprite.z=9,this._tilemap.addChild(this._destinationSprite)},Spriteset_Map.prototype.createWeather=function(){this._weather=new Weather,this.addChild(this._weather)},Spriteset_Map.prototype.updateTileset=function(){this._tileset!==$gameMap.tileset()&&this.loadTileset()},Spriteset_Map.prototype._canvasReAddParallax=function(){const t=this._baseSprite.children.indexOf(this._parallax)
this._baseSprite.removeChild(this._parallax),this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics.width,Graphics.height),this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName),this._baseSprite.addChildAt(this._parallax,t)},Spriteset_Map.prototype.updateParallax=function(){this._parallaxName!==$gameMap.parallaxName()&&(this._parallaxName=$gameMap.parallaxName(),this._parallax.bitmap&&1!=Graphics.isWebGL()?this._canvasReAddParallax():this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName)),this._parallax.bitmap&&(this._parallax.origin.x=$gameMap.parallaxOx(),this._parallax.origin.y=$gameMap.parallaxOy())},Spriteset_Map.prototype.updateTilemap=function(){this._tilemap.origin.x=$gameMap.displayX()*$gameMap.tileWidth(),this._tilemap.origin.y=$gameMap.displayY()*$gameMap.tileHeight(),this._tilemap.bitmaps&&!this.isTilesetReady&&this._tilemap.bitmaps.every((t=>t.isRequestReady()))&&(this._tilemap.refresh(),this._tilemap.refreshTileset(),this.isTilesetReady=!0)},Spriteset_Map.prototype.updateShadow=function(){const t=$gameMap.airship()
this._shadowSprite.x=t.shadowX(),this._shadowSprite.y=t.shadowY(),this._shadowSprite.opacity=t.shadowOpacity()},Spriteset_Map.prototype.updateWeather=function(){this._weather.type=$gameScreen.weatherType(),this._weather.power=$gameScreen.weatherPower(),this._weather.origin.x=$gameMap.displayX()*$gameMap.tileWidth(),this._weather.origin.y=$gameMap.displayY()*$gameMap.tileHeight()},Spriteset_Battle.prototype=Object.create(Spriteset_Base.prototype),Spriteset_Battle.prototype.constructor=Spriteset_Battle,Spriteset_Battle.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this),this._battlebackLocated=!1},Spriteset_Battle.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this),this.createBackground(),this.createBattleField(),this.createBattleback(),this.createEnemies(),this.createActors()},Spriteset_Battle.prototype.createBackground=function(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this._baseSprite.addChild(this._backgroundSprite)},Spriteset_Battle.prototype.update=function(){Spriteset_Base.prototype.update.call(this),this.updateActors(),this.updateBattleback()},Spriteset_Battle.prototype.createBattleField=function(){const t=Graphics.boxWidth,e=Graphics.boxHeight,i=(Graphics.width-t)/2,a=(Graphics.height-e)/2
this._battleField=new Sprite,this._battleField.setFrame(i,a,t,e),this._battleField.x=i,this._battleField.y=a,this._baseSprite.addChild(this._battleField)},Spriteset_Battle.prototype.createBattleback=function(){const t=32,e=-this._battleField.x-t,i=-this._battleField.y-t,a=Graphics.width+64,r=Graphics.height+64
this._back1Sprite=new TilingSprite,this._back2Sprite=new TilingSprite,this._back1Sprite.bitmap=this.battleback1Bitmap(),this._back2Sprite.bitmap=this.battleback2Bitmap(),this._back1Sprite.move(e,i,a,r),this._back2Sprite.move(e,i,a,r),this._battleField.addChild(this._back1Sprite),this._battleField.addChild(this._back2Sprite)},Spriteset_Battle.prototype.updateBattleback=function(){this._battlebackLocated||(this.locateBattleback(),this._battlebackLocated=!0)},Spriteset_Battle.prototype.locateBattleback=function(){const t=this._battleField.width,e=this._battleField.height,i=this._back1Sprite,a=this._back2Sprite
i.origin.x=i.x+(i.bitmap.width-t)/2,a.origin.x=i.y+(a.bitmap.width-t)/2,$gameSystem.isSideView()&&(i.origin.y=i.x+i.bitmap.height-e,a.origin.y=i.y+a.bitmap.height-e)},Spriteset_Battle.prototype.battleback1Bitmap=function(){return ImageManager.loadBattleback1(this.battleback1Name())},Spriteset_Battle.prototype.battleback2Bitmap=function(){return ImageManager.loadBattleback2(this.battleback2Name())},Spriteset_Battle.prototype.battleback1Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback1Name:$gameMap.battleback1Name()?$gameMap.battleback1Name():$gameMap.isOverworld()?this.overworldBattleback1Name():""},Spriteset_Battle.prototype.battleback2Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback2Name:$gameMap.battleback2Name()?$gameMap.battleback2Name():$gameMap.isOverworld()?this.overworldBattleback2Name():""},Spriteset_Battle.prototype.overworldBattleback1Name=function(){return""===$gameMap.battleback1Name()?"":$gamePlayer.isInVehicle()?this.shipBattleback1Name():this.normalBattleback1Name()},Spriteset_Battle.prototype.overworldBattleback2Name=function(){return""===$gameMap.battleback2Name()?"":$gamePlayer.isInVehicle()?this.shipBattleback2Name():this.normalBattleback2Name()},Spriteset_Battle.prototype.normalBattleback1Name=function(){return this.terrainBattleback1Name(this.autotileType(1))||this.terrainBattleback1Name(this.autotileType(0))||this.defaultBattleback1Name()},Spriteset_Battle.prototype.normalBattleback2Name=function(){return this.terrainBattleback2Name(this.autotileType(1))||this.terrainBattleback2Name(this.autotileType(0))||this.defaultBattleback2Name()},Spriteset_Battle.prototype.terrainBattleback1Name=function(t){switch(t){case 24:case 25:return"Wasteland"
case 26:case 27:return"DirtField"
case 32:case 33:return"Desert"
case 34:return"Lava1"
case 35:return"Lava2"
case 40:case 41:return"Snowfield"
case 42:return"Clouds"
case 4:case 5:return"PoisonSwamp"
default:return null}},Spriteset_Battle.prototype.terrainBattleback2Name=function(t){switch(t){case 20:case 21:return"Forest"
case 22:case 30:case 38:return"Cliff"
case 24:case 25:case 26:case 27:return"Wasteland"
case 32:case 33:return"Desert"
case 34:case 35:return"Lava"
case 40:case 41:return"Snowfield"
case 42:return"Clouds"
case 4:case 5:return"PoisonSwamp"}},Spriteset_Battle.prototype.defaultBattleback1Name=function(){return"Grassland"},Spriteset_Battle.prototype.defaultBattleback2Name=function(){return"Grassland"},Spriteset_Battle.prototype.shipBattleback1Name=function(){return"Ship"},Spriteset_Battle.prototype.shipBattleback2Name=function(){return"Ship"},Spriteset_Battle.prototype.autotileType=function(t){return $gameMap.autotileType($gamePlayer.x,$gamePlayer.y,t)},Spriteset_Battle.prototype.createEnemies=function(){const t=$gameTroop.members(),e=[]
for(let i=0;i<t.length;i++)e[i]=new Sprite_Enemy(t[i])
e.sort(this.compareEnemySprite.bind(this))
for(let t=0;t<e.length;t++)this._battleField.addChild(e[t])
this._enemySprites=e},Spriteset_Battle.prototype.compareEnemySprite=function(t,e){return t.y!==e.y?t.y-e.y:e.spriteId-t.spriteId},Spriteset_Battle.prototype.createActors=function(){this._actorSprites=[]
for(let t=0;t<$gameParty.maxBattleMembers();t++)this._actorSprites[t]=new Sprite_Actor,this._battleField.addChild(this._actorSprites[t])},Spriteset_Battle.prototype.updateActors=function(){const t=$gameParty.battleMembers()
for(let e=0;e<this._actorSprites.length;e++)this._actorSprites[e].setBattler(t[e])},Spriteset_Battle.prototype.battlerSprites=function(){return this._enemySprites.concat(this._actorSprites)},Spriteset_Battle.prototype.isAnimationPlaying=function(){return this.battlerSprites().some((function(t){return t.isAnimationPlaying()}))},Spriteset_Battle.prototype.isEffecting=function(){return this.battlerSprites().some((function(t){return t.isEffecting()}))},Spriteset_Battle.prototype.isAnyoneMoving=function(){return this.battlerSprites().some((function(t){return t.isMoving()}))},Spriteset_Battle.prototype.isBusy=function(){return this.isAnimationPlaying()||this.isAnyoneMoving()}
