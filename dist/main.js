/*!
 * main.js - v1.6.1 (community-1.4)
 * (c) 2015 KADOKAWA CORPORATION./YOJI OJIMA
 * Contributions by the RPG Maker MV CoreScript team
 * https://github.com/thinknathan/corescript/blob/master/CONTRIBUTORS.md
 *
 * Licensed under the MIT License.
 * https://github.com/thinknathan/corescript/blob/master/LICENSE
 */
(function(){"use strict";Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Number.prototype.mod=function(t){return(this%t+t)%t},String.prototype.format=function(){const t=arguments;return this.replace(/%([0-9]+)/g,((e,i)=>t[Number(i)-1]))},String.prototype.padZero=function(t){let e=this;for(;e.length<t;)e=`0${e}`;return e},Number.prototype.padZero=function(t){return String(this).padZero(t)},Object.defineProperties(Array.prototype,{equals:{enumerable:!1,value(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.length;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!==t[e])return!1;return!0}},clone:{enumerable:!1,value(){return this.slice(0)}},contains:{enumerable:!1,value(t){return this.includes(t)}}}),String.prototype.contains=function(t){return this.includes(t)},Math.randomInt=t=>Math.floor(t*Math.random());class CacheEntry{constructor(t,e,i){this.cache=t,this.key=e,this.item=i,this.cached=!1,this.touchTicks=0,this.touchSeconds=0,this.ttlTicks=0,this.ttlSeconds=0,this.freedByTTL=!1}free(t){this.freedByTTL=t||!1,this.cached&&(this.cached=!1,delete this.cache._inner[this.key])}allocate(){return this.cached||(this.cache._inner[this.key]=this,this.cached=!0),this.touch(),this}setTimeToLive(t,e){return this.ttlTicks=t||0,this.ttlSeconds=e||0,this}isStillAlive(){const t=this.cache;return(0==this.ttlTicks||this.touchTicks+this.ttlTicks<t.updateTicks)&&(0==this.ttlSeconds||this.touchSeconds+this.ttlSeconds<t.updateSeconds)}touch(){const t=this.cache;this.cached?(this.touchTicks=t.updateTicks,this.touchSeconds=t.updateSeconds):this.freedByTTL&&(this.freedByTTL=!1,t._inner[this.key]||(t._inner[this.key]=this))}}class CacheMap{constructor(t){this.manager=t,this._inner={},this._lastRemovedEntries={},this.updateTicks=0,this.lastCheckTTL=0,this.delayCheckTTL=100,this.updateSeconds=Date.now()}checkTTL(){const t=this._inner;let e=this._lastRemovedEntries;e||(e=[],this._lastRemovedEntries=e);for(let i in t){const s=t[i];s.isStillAlive()||e.push(s)}for(let t=0;t<e.length;t++)e[t].free(!0);e.length=0}getItem(t){const e=this._inner[t];return e?e.item:null}clear(){const t=Object.keys(this._inner);for(let e=0;e<t.length;e++)this._inner[t[e]].free()}setItem(t,e){return new CacheEntry(this,t,e).allocate()}update(t,e){this.updateTicks+=t,this.updateSeconds+=e,this.updateSeconds>=this.delayCheckTTL+this.lastCheckTTL&&(this.lastCheckTTL=this.updateSeconds,this.checkTTL())}}class ImageCache{constructor(...t){this.initialize(...t)}initialize(){this._items={}}add(t,e){this._items[t]={bitmap:e,touch:Date.now(),key:t},this._truncateCache()}get(t){if(this._items[t]){const e=this._items[t];return e.touch=Date.now(),e.bitmap}return null}reserve(t,e,i){this._items[t]||(this._items[t]={bitmap:e,touch:Date.now(),key:t}),this._items[t].reservationId=i}releaseReservation(t){const e=this._items;Object.keys(e).map((t=>e[t])).forEach((e=>{e.reservationId===t&&delete e.reservationId}))}_truncateCache(){const t=this._items;let e=ImageCache.limit;Object.keys(t).map((e=>t[e])).sort(((t,e)=>t.touch-e.touch)).forEach((i=>{if(e>0||this._mustBeHeld(i)){const t=i.bitmap;e-=t.width*t.height}else delete t[i.key]}))}_mustBeHeld({bitmap:t,reservationId:e}){return!(t.isRequestOnly()||!e&&t.isReady())}isReady(){const t=this._items;return!Object.keys(t).some((e=>!t[e].bitmap.isRequestOnly()&&!t[e].bitmap.isReady()))}getErrorBitmap(){const t=this._items;let e=null;return Object.keys(t).some((i=>!!t[i].bitmap.isError()&&(e=t[i].bitmap,!0)))?e:null}}ImageCache.limit=1e7;class RequestQueue{constructor(...t){this.initialize(...t)}initialize(){this._queue=[]}enqueue(t,e){this._queue.push({key:t,value:e})}update(){if(0===this._queue.length)return;const t=this._queue[0];t.value.isRequestReady()?(this._queue.shift(),0!==this._queue.length&&this._queue[0].value.startRequest()):t.value.startRequest()}raisePriority(t){for(let e=0;e<this._queue.length;e++){const i=this._queue[e];if(i.key===t){this._queue.splice(e,1),this._queue.unshift(i);break}}}clear(){this._queue.splice(0)}}class Utils{constructor(){throw new Error("This is a static class")}static isOptionValid(t){return!!location.search.slice(1).split("&").contains(t)||!!("undefined"!=typeof nw&&nw.App.argv.length>0&&nw.App.argv[0].split("&").contains(t))}static isNwjs(){if("boolean"==typeof Utils._nwjs)return Utils._nwjs;const t="function"==typeof require&&"object"==typeof process;return Utils._nwjs=t,t}static isHighFps(){return Utils._fpsChecked?Utils._highFps:Utils.getFps()>=66}
/**
		 * Returns estimated monitor refresh rate.
		 *
		 * @static
		 * @method getFps
		 * @return {Number} Refresh rate
		 * @credit Adapted from Adam Sassano on Stack Overflow
		 * @license CC BY-SA 4.0
		 */static getFps(){if(Utils._fpsChecked||Utils._fpsIsBusyCounting)return Utils._fps;{let t=0,e=0,i=0;const s=a=>{e<=180?(e++,i+=1e3/(a-t),t=a,requestAnimationFrame(s)):(Utils._fps!==1/0&&(Utils._fps=i/e,Utils._fps>=66&&(Utils._highFps=!0)),Utils._fpsChecked=!0,Utils._fpsIsBusyCounting=!1)};return requestAnimationFrame((e=>{t=e,requestAnimationFrame(s)})),Utils._fpsIsBusyCounting=!0,Utils._fps}}static isMobileDevice(){if("boolean"==typeof Utils._mobileDevice)return Utils._mobileDevice;const t=!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i);return Utils._mobileDevice=t,t}static isMobileSafari(){if("boolean"==typeof Utils._mobileSafari)return Utils._mobileSafari;const t=navigator.userAgent,e=!(!t.match(/iPhone|iPad|iPod/)||!t.match(/AppleWebKit/)||t.match("CriOS"));return Utils._mobileSafari=e,e}static isAndroidChrome(){if("boolean"==typeof Utils._androidChrome)return Utils._androidChrome;const t=navigator.userAgent,e=!(!t.match(/Android/)||!t.match(/Chrome/));return Utils._androidChrome=e,e}static canReadGameFiles(){const t=document.getElementsByTagName("script"),e=t[t.length-1],i=new XMLHttpRequest;try{return i.open("GET",e.src),i.overrideMimeType("text/javascript"),i.send(),!0}catch(t){return!1}}static rgbToCssColor(t,e,i){return`rgb(${t=Math.round(t)},${e=Math.round(e)},${i=Math.round(i)})`}static generateRuntimeId(){return Utils._id++}static isSupportPassiveEvent(){if("boolean"==typeof Utils._supportPassiveEvent)return Utils._supportPassiveEvent;let t=!1;const e=Object.defineProperty({},"passive",{get(){t=!0}});return window.addEventListener("test",null,e),Utils._supportPassiveEvent=t,t}}Utils.RPGMAKER_NAME="MV",Utils.RPGMAKER_VERSION="1.6.1",Utils.RPGMAKER_ENGINE="community-1.4",Utils._nwjs=null,Utils._highFps=!1,Utils._fps=60,Utils._fpsIsBusyCounting=!1,Utils._fpsChecked=!1,Utils._mobileDevice=null,Utils._mobileSafari=null,Utils._androidChrome=null,Utils._id=1,Utils._supportPassiveEvent=null;class Decrypter{constructor(){throw new Error("This is a static class")}static checkImgIgnore(t){for(let e=0;e<this._ignoreList.length;e++)if(t===this._ignoreList[e])return!0;return!1}static decryptImg(t,e){t=this.extToEncryptExt(t);const i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.send(),i.onload=function(){if(this.status<Decrypter._xhrOk){const t=Decrypter.decryptArrayBuffer(i.response);e._image.src=Decrypter.createBlobUrl(t),e._image.addEventListener("load",e._loadListener=Bitmap.prototype._onLoad.bind(e)),e._image.addEventListener("error",e._errorListener=e._loader||Bitmap.prototype._onError.bind(e))}},i.onerror=()=>{e._loader?e._loader():e._onError()}}static decryptArrayBuffer(t){if(!t)return null;const e=new Uint8Array(t,0,this._headerlength);let i;const s=this.SIGNATURE+this.VER+this.REMAIN,a=new Uint8Array(16);for(i=0;i<this._headerlength;i++)a[i]=parseInt(`0x${s.substr(2*i,2)}`,16);for(i=0;i<this._headerlength;i++)if(e[i]!==a[i])throw new Error("Header is wrong");t=this.cutArrayHeader(t,Decrypter._headerlength);const r=new DataView(t);if(this.readEncryptionkey(),t){const e=new Uint8Array(t);for(i=0;i<this._headerlength;i++)e[i]=e[i]^parseInt(Decrypter._encryptionKey[i],16),r.setUint8(i,e[i])}return t}static readEncryptionkey(){this._encryptionKey=self.$dataSystem.encryptionKey.split(/(.{2})/).filter(Boolean)}static cutArrayHeader(t,e){t.slice(e)}static createBlobUrl(t){const e=new Blob([t]);return window.URL.createObjectURL(e)}static extToEncryptExt(t){const e=t.split(".").pop();let i=e;return i="ogg"===e?".rpgmvo":"m4a"===e?".rpgmvm":"png"===e?".rpgmvp":e,t.slice(0,t.lastIndexOf(e)-1)+i}}Decrypter.hasEncryptedImages=!1,Decrypter.hasEncryptedAudio=!1,Decrypter._requestImgFile=[],Decrypter._headerlength=16,Decrypter._xhrOk=400,Decrypter._encryptionKey="",Decrypter._ignoreList=["img/system/Window.png"],Decrypter.SIGNATURE="5250474d56000000",Decrypter.VER="000301",Decrypter.REMAIN="0000000000";class WebAudio{constructor(...t){this.initialize(...t)}initialize(t){WebAudio._initialized||WebAudio.initialize(),this.clear(),WebAudio._standAlone||(this._loader=ResourceHandler.createLoader(t,this._load.bind(this,t),(()=>{this._hasError=!0}))),this._load(t),this._url=t}static initialize(t){return this._initialized||(t||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context}static canPlayOgg(){return this._initialized||this.initialize(),!!this._canPlayOgg}static canPlayM4a(){return this._initialized||this.initialize(),!!this._canPlayM4a}static setMasterVolume(t){this._masterVolume=t,this._masterGainNode&&this._masterGainNode.gain.setValueAtTime(this._masterVolume,this._context.currentTime)}static _createContext(){try{"undefined"!=typeof AudioContext?this._context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(t){this._context=null}}static _detectCodecs(){const t=document.createElement("audio");t.canPlayType&&(this._canPlayOgg=t.canPlayType('audio/ogg; codecs="vorbis"'),this._canPlayM4a=t.canPlayType("audio/mp4"))}static _createMasterGainNode(){const t=WebAudio._context;t&&(this._masterGainNode=t.createGain(),this._masterGainNode.gain.setValueAtTime(this._masterVolume,t.currentTime),this._masterGainNode.connect(t.destination))}static _setupEventHandlers(){const t=()=>{const t=WebAudio._context;t&&"suspended"===t.state&&"function"==typeof t.resume?t.resume().then((()=>{WebAudio._onTouchStart()})):WebAudio._onTouchStart()};document.addEventListener("keydown",t),document.addEventListener("mousedown",t),document.addEventListener("touchend",t),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))}static _onTouchStart(){const t=WebAudio._context;t&&!this._unlocked&&(t.createBufferSource().start(0),this._unlocked=!0)}static _onVisibilityChange(){"hidden"===document.visibilityState?this._onHide():this._onShow()}static _onHide(){this._shouldMuteOnHide()&&this._fadeOut(1)}static _onShow(){this._shouldMuteOnHide()&&this._fadeIn(1)}static _fadeIn(t){if(this._masterGainNode){const e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._masterVolume,i+t)}}static _fadeOut(t){if(this._masterGainNode){const e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._masterVolume,i),e.linearRampToValueAtTime(0,i+t)}}clear(){this.stop(),this._buffer=null,this._sourceNode=null,this._gainNode=null,this._pannerNode=null,this._totalTime=0,this._sampleRate=0,this._loopStart=0,this._loopLength=0,this._startTime=0,this._volume=1,this._pitch=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._hasError=!1,this._autoPlay=!1}get url(){return this._url}get volume(){return this._volume}set volume(t){this._volume=t,this._gainNode&&this._gainNode.gain.setValueAtTime(this._volume,WebAudio._context.currentTime)}get pitch(){return this._pitch}set pitch(t){this._pitch!==t&&(this._pitch=t,this.isPlaying()&&this.play(this._sourceNode.loop,0))}get pan(){return this._pan}set pan(t){this._pan=t,this._updatePanner()}isReady(){return!!this._buffer}isError(){return this._hasError}isPlaying(){return!!this._sourceNode}play(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener((()=>{this._autoPlay&&this.play(t,e)})))}stop(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;this._stopListeners.length>0;)this._stopListeners.shift()()}fadeIn(t){if(this.isReady()){if(this._gainNode){const e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._volume,i+t)}}else this._autoPlay&&this.addLoadListener((()=>{this.fadeIn(t)}))}fadeOut(t){if(this._gainNode){const e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._volume,i),e.linearRampToValueAtTime(0,i+t)}this._autoPlay=!1}seek(){if(WebAudio._context){let t=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(this._loopLength>0)for(;t>=this._loopStart+this._loopLength;)t-=this._loopLength;return t}return 0}addLoadListener(t){this._loadListeners.push(t)}addStopListener(t){this._stopListeners.push(t)}_load(t){if(WebAudio._context){const e=new XMLHttpRequest;Decrypter.hasEncryptedAudio&&(t=Decrypter.extToEncryptExt(t)),e.open("GET",t),e.responseType="arraybuffer",e.onload=()=>{e.status<400&&this._onXhrLoad(e)},e.onerror=this._loader||(()=>{this._hasError=!0}),e.send()}}_onXhrLoad({response:t}){let e=t;Decrypter.hasEncryptedAudio&&(e=Decrypter.decryptArrayBuffer(e)),this._readLoopComments(new Uint8Array(e)),WebAudio._context.decodeAudioData(e,(t=>{this._buffer=t,this._totalTime=t.duration,this._loopLength>0&&this._sampleRate>0?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()}))}_startPlaying(t,e){if(this._loopLength>0)for(;e>=this._loopStart+this._loopLength;)e-=this._loopLength;this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=t,this._sourceNode.start(0,e),this._startTime=WebAudio._context.currentTime-e/this._pitch,this._createEndTimer()}_createNodes(){const t=WebAudio._context;this._sourceNode=t.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.setValueAtTime(this._pitch,t.currentTime),this._gainNode=t.createGain(),this._gainNode.gain.setValueAtTime(this._volume,t.currentTime),this._pannerNode=t.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()}_connectNodes(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(WebAudio._masterGainNode)}_removeNodes(){this._sourceNode&&(this._sourceNode.stop(0),this._sourceNode=null,this._gainNode=null,this._pannerNode=null)}_createEndTimer(){if(this._sourceNode&&!this._sourceNode.loop){const t=this._startTime+this._totalTime/this._pitch-WebAudio._context.currentTime;this._endTimer=setTimeout((()=>{this.stop()}),1e3*t)}}_removeEndTimer(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)}_updatePanner(){if(this._pannerNode){const t=this._pan,e=1-Math.abs(t);this._pannerNode.setPosition(t,0,e)}}_onLoad(){for(;this._loadListeners.length>0;)this._loadListeners.shift()()}_readLoopComments(t){this._readOgg(t),this._readMp4(t)}_readOgg(t){let e=0;for(;e<t.length&&"OggS"===this._readFourCharacters(t,e);){e+=26;let i=!1;const s=t[e++],a=[];for(let i=0;i<s;i++)a.push(t[e++]);for(let r=0;r<s;r++){if("vorb"===this._readFourCharacters(t,e+1)){const n=t[e];if(1===n)this._sampleRate=this._readLittleEndian(t,e+12);else if(3===n){let i=0;for(;r<s&&(i+=a[r],!(a[r]<255));r++);this._readMetaData(t,e,i)}i=!0}e+=a[r]}if(!i)break}}_readMp4(t){if("ftyp"===this._readFourCharacters(t,4)){let e=0;for(;e<t.length;){const i=this._readBigEndian(t,e),s=this._readFourCharacters(t,e+4);if("moov"===s)e+=8;else if("mvhd"===s&&(this._sampleRate=this._readBigEndian(t,e+20)),"udta"!==s&&"meta"!==s||this._readMetaData(t,e,i),e+=i,i<=1)break}}}_readMetaData(t,e,i){for(let s=e;s<e+i-10;s++)if("LOOP"===this._readFourCharacters(t,s)){let e="";for(;t[s]>0;)e+=String.fromCharCode(t[s++]);if(e.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),e.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),"LOOPSTART"==e||"LOOPLENGTH"==e){let i="";for(s+=16;t[s]>0;)i+=String.fromCharCode(t[s++]);"LOOPSTART"==e?this._loopStart=parseInt(i):this._loopLength=parseInt(i)}}}_readLittleEndian(t,e){return 16777216*t[e+3]+65536*t[e+2]+256*t[e+1]+t[e+0]}_readBigEndian(t,e){return 16777216*t[e+0]+65536*t[e+1]+256*t[e+2]+t[e+3]}_readFourCharacters(t,e){let i="";for(let s=0;s<4;s++)i+=String.fromCharCode(t[e+s]);return i}static _shouldMuteOnHide(){return Utils.isMobileDevice()}}WebAudio._standAlone=!self.ResourceHandler,WebAudio._masterVolume=1,WebAudio._context=null,WebAudio._masterGainNode=null,WebAudio._initialized=!1,WebAudio._unlocked=!1;class AudioManager{constructor(){throw new Error("This is a static class")}static playBgm(t,e){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.stopBgm(),t.name&&(this._bgmBuffer=this.createBuffer("bgm",t.name),this.updateBgmParameters(t),this._meBuffer||this._bgmBuffer.play(!0,e||0))),this.updateCurrentBgm(t,e)}static playEncryptedBgm({name:t},e){const i=this.audioFileExt();let s=`${this._path}bgm/${encodeURIComponent(t)}${i}`;s=Decrypter.extToEncryptExt(s)}static createDecryptBuffer(t,e,i){this._blobUrl=t,this._bgmBuffer=this.createBuffer("bgm",e.name),this.updateBgmParameters(e),this._meBuffer||this._bgmBuffer.play(!0,i||0),this.updateCurrentBgm(e,i)}static replayBgm(t){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.playBgm(t,t.pos),this._bgmBuffer&&this._bgmBuffer.fadeIn(this._replayFadeTime))}static isCurrentBgm({name:t}){return this._currentBgm&&this._bgmBuffer&&this._currentBgm.name===t}static updateBgmParameters(t){this.updateBufferParameters(this._bgmBuffer,this._bgmVolume,t)}static updateCurrentBgm({name:t,volume:e,pitch:i,pan:s},a){this._currentBgm={name:t,volume:e,pitch:i,pan:s,pos:a}}static stopBgm(){this._bgmBuffer&&(this._bgmBuffer.stop(),this._bgmBuffer=null,this._currentBgm=null)}static fadeOutBgm(t){this._bgmBuffer&&this._currentBgm&&(this._bgmBuffer.fadeOut(t),this._currentBgm=null)}static fadeInBgm(t){this._bgmBuffer&&this._currentBgm&&this._bgmBuffer.fadeIn(t)}static playBgs(t,e){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.stopBgs(),t.name&&(this._bgsBuffer=this.createBuffer("bgs",t.name),this.updateBgsParameters(t),this._bgsBuffer.play(!0,e||0))),this.updateCurrentBgs(t,e)}static replayBgs(t){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.playBgs(t,t.pos),this._bgsBuffer&&this._bgsBuffer.fadeIn(this._replayFadeTime))}static isCurrentBgs({name:t}){return this._currentBgs&&this._bgsBuffer&&this._currentBgs.name===t}static updateBgsParameters(t){this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,t)}static updateCurrentBgs({name:t,volume:e,pitch:i,pan:s},a){this._currentBgs={name:t,volume:e,pitch:i,pan:s,pos:a}}static stopBgs(){this._bgsBuffer&&(this._bgsBuffer.stop(),this._bgsBuffer=null,this._currentBgs=null)}static fadeOutBgs(t){this._bgsBuffer&&this._currentBgs&&(this._bgsBuffer.fadeOut(t),this._currentBgs=null)}static fadeInBgs(t){this._bgsBuffer&&this._currentBgs&&this._bgsBuffer.fadeIn(t)}static playMe(t){this.stopMe(),t.name&&(this._bgmBuffer&&this._currentBgm&&(this._currentBgm.pos=this._bgmBuffer.seek(),this._bgmBuffer.stop()),this._meBuffer=this.createBuffer("me",t.name),this.updateMeParameters(t),this._meBuffer.play(!1),this._meBuffer.addStopListener(this.stopMe.bind(this)))}static updateMeParameters(t){this.updateBufferParameters(this._meBuffer,this._meVolume,t)}static fadeOutMe(t){this._meBuffer&&this._meBuffer.fadeOut(t)}static stopMe(){this._meBuffer&&(this._meBuffer.stop(),this._meBuffer=null,this._bgmBuffer&&this._currentBgm&&!this._bgmBuffer.isPlaying()&&(this._bgmBuffer.play(!0,this._currentBgm.pos),this._bgmBuffer.fadeIn(this._replayFadeTime)))}static playSe(t){if(t.name){this._seBuffers=this._seBuffers.filter((t=>t.isPlaying()));const e=this.createBuffer("se",t.name);this.updateSeParameters(e,t),e.play(!1),this._seBuffers.push(e)}}static updateSeParameters(t,e){this.updateBufferParameters(t,this._seVolume,e)}static stopSe(){this._seBuffers.forEach((t=>{t.stop()})),this._seBuffers=[]}static playStaticSe(t){if(t.name){this.loadStaticSe(t);for(const e of this._staticBuffers)if(e._reservedSeName===t.name){e.stop(),this.updateSeParameters(e,t),e.play(!1);break}}}static loadStaticSe(t){if(t.name&&!this.isStaticSe(t)){const e=this.createBuffer("se",t.name);e._reservedSeName=t.name,this._staticBuffers.push(e)}}static isStaticSe({name:t}){for(const e of this._staticBuffers)if(e._reservedSeName===t)return!0;return!1}static stopAll(){this.stopMe(),this.stopBgm(),this.stopBgs(),this.stopSe()}static saveBgm(){if(this._currentBgm){const t=this._currentBgm;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgmBuffer?this._bgmBuffer.seek():0}}return this.makeEmptyAudioObject()}static saveBgs(){if(this._currentBgs){const t=this._currentBgs;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgsBuffer?this._bgsBuffer.seek():0}}return this.makeEmptyAudioObject()}static createBuffer(t,e){const i=this.audioFileExt(),s=`${this._path+t}/${encodeURIComponent(e)}${i}`,a=new WebAudio(s);return this._callCreationHook(a),a}static checkErrors(){this.checkWebAudioError(this._bgmBuffer),this.checkWebAudioError(this._bgsBuffer),this.checkWebAudioError(this._meBuffer),this._seBuffers.forEach((t=>{this.checkWebAudioError(t)})),this._staticBuffers.forEach((t=>{this.checkWebAudioError(t)}))}static setCreationHook(t){this._creationHook=t}static _callCreationHook(t){this._creationHook&&this._creationHook(t)}static audioFileExt(){return WebAudio.canPlayOgg()&&!Utils.isMobileDevice()?".ogg":".m4a"}static shouldUseHtml5Audio(){return!1}static checkWebAudioError(t){if(t&&t.isError())throw new Error(`Failed to load: ${t.url}`)}static makeEmptyAudioObject(){return{name:"",volume:0,pitch:0}}static updateBufferParameters(t,e,i){t&&i&&(t.volume=e*(i.volume||0)/1e4,t.pitch=(i.pitch||0)/100,t.pan=(i.pan||0)/100)}}AudioManager._masterVolume=1,AudioManager._bgmVolume=100,AudioManager._bgsVolume=100,AudioManager._meVolume=100,AudioManager._seVolume=100,AudioManager._currentBgm=null,AudioManager._currentBgs=null,AudioManager._bgmBuffer=null,AudioManager._bgsBuffer=null,AudioManager._meBuffer=null,AudioManager._seBuffers=[],AudioManager._staticBuffers=[],AudioManager._replayFadeTime=.5,AudioManager._path="audio/",AudioManager._blobUrl=null,Object.defineProperty(AudioManager,"masterVolume",{get(){return this._masterVolume},set(t){this._masterVolume=t,WebAudio.setMasterVolume(this._masterVolume),Graphics$1.setVideoVolume(this._masterVolume)},configurable:!0}),Object.defineProperty(AudioManager,"bgmVolume",{get(){return this._bgmVolume},set(t){this._bgmVolume=t,this.updateBgmParameters(this._currentBgm)},configurable:!0}),Object.defineProperty(AudioManager,"bgsVolume",{get(){return this._bgsVolume},set(t){this._bgsVolume=t,this.updateBgsParameters(this._currentBgs)},configurable:!0}),Object.defineProperty(AudioManager,"meVolume",{get(){return this._meVolume},set(t){this._meVolume=t,this.updateMeParameters(this._currentMe)},configurable:!0}),Object.defineProperty(AudioManager,"seVolume",{get(){return this._seVolume},set(t){this._seVolume=t},configurable:!0});class Input{constructor(){throw new Error("This is a static class")}static initialize(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()}static clear(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._pressedTime=0,this._dir4=0,this._dir8=0,this._preferredAxis="",this._date=0}static update(){this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null;for(let t in this._currentState)this._currentState[t]&&!this._previousState[t]&&(this._latestButton=t,this._pressedTime=0,this._date=Date.now()),this._previousState[t]=this._currentState[t];this._updateDirection()}static isPressed(t){return!(!this._isEscapeCompatible(t)||!this.isPressed("escape"))||!!this._currentState[t]}static isTriggered(t){return!(!this._isEscapeCompatible(t)||!this.isTriggered("escape"))||this._latestButton===t&&0===this._pressedTime}static isRepeated(t){return!(!this._isEscapeCompatible(t)||!this.isRepeated("escape"))||this._latestButton===t&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval==0)}static isLongPressed(t){return!(!this._isEscapeCompatible(t)||!this.isLongPressed("escape"))||this._latestButton===t&&this._pressedTime>=this.keyRepeatWait}static _setupEventHandlers(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))}static _onKeyDown(t){this._shouldPreventDefault(t.keyCode)&&t.preventDefault(),144===t.keyCode&&this.clear();const e=this.keyMapper[t.keyCode];ResourceHandler.exists()&&"ok"===e?ResourceHandler.retry():e&&(this._currentState[e]=!0)}static _onKeyUp({keyCode:t}){const e=this.keyMapper[t];e&&(this._currentState[e]=!1),0===t&&this.clear()}static _onLostFocus(){this.clear()}static _pollGamepads(){if(navigator.getGamepads){const t=navigator.getGamepads();if(t)for(const e of t)e&&e.connected&&this._updateGamepadState(e)}}static _updateGamepadState(t){const e=this._gamepadStates[t.index]||[],i=[],s=t.buttons,a=t.axes;i[12]=!1,i[13]=!1,i[14]=!1,i[15]=!1;for(let t=0;t<s.length;t++)i[t]=s[t].pressed;a[1]<-.5?i[12]=!0:a[1]>.5&&(i[13]=!0),a[0]<-.5?i[14]=!0:a[0]>.5&&(i[15]=!0);for(let t=0;t<i.length;t++)if(i[t]!==e[t]){const e=this.gamepadMapper[t];e&&(this._currentState[e]=i[t])}this._gamepadStates[t.index]=i}static _updateDirection(){let t=this._signX(),e=this._signY();this._dir8=this._makeNumpadDirection(t,e),0!==t&&0!==e?"x"===this._preferredAxis?e=0:t=0:0!==t?this._preferredAxis="y":0!==e&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(t,e)}static _signX(){let t=0;return this.isPressed("left")&&t--,this.isPressed("right")&&t++,t}static _signY(){let t=0;return this.isPressed("up")&&t--,this.isPressed("down")&&t++,t}static _wrapNwjsAlert(){if(Utils.isNwjs()){const t=window.alert;window.alert=function(...e){const i=require("nw.gui").Window.get();t.apply(this,e),i.focus(),Input.clear()}}}static _shouldPreventDefault(t){switch(t){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1}static _makeNumpadDirection(t,e){return 0!==t||0!==e?5-3*e+t:0}static _isEscapeCompatible(t){return"cancel"===t||"menu"===t}}Input.keyRepeatWait=24,Input.keyRepeatInterval=6,Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"},Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"},Object.defineProperty(Input,"dir4",{get(){return this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get(){return this._dir8},configurable:!0}),Object.defineProperty(Input,"date",{get(){return this._date},configurable:!0});class PluginManager{constructor(){throw new Error("This is a static class")}static setup(t){t.forEach((function({status:t,name:e,parameters:i}){t&&!this._scripts.contains(e)&&(this.setParameters(e,i),this.loadScript(`${e}.js`),this._scripts.push(e))}),this)}static checkErrors(){const t=this._errorUrls.shift();if(t)throw new Error(`Failed to load: ${t}`)}static parameters(t){return this._parameters[t.toLowerCase()]||{}}static setParameters(t,e){this._parameters[t.toLowerCase()]=e}static loadScript(t){const e=this._path+t,i=document.createElement("script");i.type="text/javascript",i.src=e,i.async=!1,i.onerror=this.onError.bind(this),i._url=e,document.body.appendChild(i)}static onError({target:t}){this._errorUrls.push(t._url)}}PluginManager._path="js/plugins/",PluginManager._scripts=[],PluginManager._errorUrls=[],PluginManager._parameters={};class TouchInput{constructor(){throw new Error("This is a static class")}static initialize(){this.clear(),this._setupEventHandlers()}static clear(){this._mousePressed=!1,this._screenPressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._triggered=!1,this._cancelled=!1,this._moved=!1,this._released=!1,this._wheelX=0,this._wheelY=0,this._x=0,this._y=0,this._date=0}static update(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++}static isPressed(){return this._mousePressed||this._screenPressed}static isTriggered(){return this._triggered}static isRepeated(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval==0)}static isLongPressed(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait}static isCancelled(){return this._cancelled}static isMoved(){return this._moved}static isReleased(){return this._released}static _setupEventHandlers(){const t=Utils.isSupportPassiveEvent();document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this),!!t&&{passive:!1}),document.addEventListener("touchstart",this._onTouchStart.bind(this),!!t&&{passive:!1}),document.addEventListener("touchmove",this._onTouchMove.bind(this),!!t&&{passive:!1}),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))}static _onMouseDown(t){0===t.button?this._onLeftButtonDown(t):1===t.button?this._onMiddleButtonDown(t):2===t.button&&this._onRightButtonDown(t)}static _onLeftButtonDown({pageX:t,pageY:e}){const i=Graphics$1.pageToCanvasX(t),s=Graphics$1.pageToCanvasY(e);Graphics$1.isInsideCanvas(i,s)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(i,s))}static _onRightButtonDown({pageX:t,pageY:e}){const i=Graphics$1.pageToCanvasX(t),s=Graphics$1.pageToCanvasY(e);Graphics$1.isInsideCanvas(i,s)&&this._onCancel(i,s)}static _onMouseMove({pageX:t,pageY:e}){if(this._mousePressed){const i=Graphics$1.pageToCanvasX(t),s=Graphics$1.pageToCanvasY(e);this._onMove(i,s)}}static _onMouseUp({button:t,pageX:e,pageY:i}){if(0===t){const t=Graphics$1.pageToCanvasX(e),s=Graphics$1.pageToCanvasY(i);this._mousePressed=!1,this._onRelease(t,s)}}static _onWheel(t){this._events.wheelX+=t.deltaX,this._events.wheelY+=t.deltaY,t.preventDefault()}static _onTouchStart(t){for(const e of t.changedTouches){const i=Graphics$1.pageToCanvasX(e.pageX),s=Graphics$1.pageToCanvasY(e.pageY);Graphics$1.isInsideCanvas(i,s)&&(this._screenPressed=!0,this._pressedTime=0,t.touches.length>=2?this._onCancel(i,s):this._onTrigger(i,s),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()}static _onTouchMove({changedTouches:t}){for(const e of t){const t=Graphics$1.pageToCanvasX(e.pageX),i=Graphics$1.pageToCanvasY(e.pageY);this._onMove(t,i)}}static _onTouchEnd({changedTouches:t}){for(const e of t){const t=Graphics$1.pageToCanvasX(e.pageX),i=Graphics$1.pageToCanvasY(e.pageY);this._screenPressed=!1,this._onRelease(t,i)}}static _onTouchCancel(t){this._screenPressed=!1}static _onPointerDown(t){if("touch"===t.pointerType&&!t.isPrimary){const e=Graphics$1.pageToCanvasX(t.pageX),i=Graphics$1.pageToCanvasY(t.pageY);Graphics$1.isInsideCanvas(e,i)&&(this._onCancel(e,i),t.preventDefault())}}static _onLostFocus(){this.clear()}static _onTrigger(t,e){this._events.triggered=!0,this._x=t,this._y=e,this._date=Date.now()}static _onCancel(t,e){this._events.cancelled=!0,this._x=t,this._y=e}static _onMove(t,e){this._events.moved=!0,this._x=t,this._y=e}static _onRelease(t,e){this._events.released=!0,this._x=t,this._y=e}}TouchInput.keyRepeatWait=24,TouchInput.keyRepeatInterval=6,Object.defineProperty(TouchInput,"wheelX",{get(){return this._wheelX},configurable:!0}),Object.defineProperty(TouchInput,"wheelY",{get(){return this._wheelY},configurable:!0}),Object.defineProperty(TouchInput,"x",{get(){return this._x},configurable:!0}),Object.defineProperty(TouchInput,"y",{get(){return this._y},configurable:!0}),Object.defineProperty(TouchInput,"date",{get(){return this._date},configurable:!0}),TouchInput._onMiddleButtonDown=t=>{};class SceneManager{constructor(){throw new Error("This is a static class")}static run(t){try{this.initialize(),this.goto(t),this.requestUpdate()}catch(t){this.catchException(t)}}static initialize(){this.initProgressWatcher(),this.initGraphics(),this.checkFileAccess(),this.initAudio(),this.initInput(),this.initNwjs(),this.checkPluginErrors(),this.setupErrorHandlers()}static initGraphics(){const t=this.preferableRendererType();Graphics$1.initialize(this._screenWidth,this._screenHeight,t),Graphics$1.boxWidth=this._boxWidth,Graphics$1.boxHeight=this._boxHeight,Graphics$1.setLoadingImage("img/system/Loading.png"),Utils.isOptionValid("showfps")&&Graphics$1.showFps(),"webgl"===t&&this.checkWebGL()}static setupErrorHandlers(){window.addEventListener("error",this.onError.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this))}static frameCount(){return this._frameCount}static setFrameCount(t){this._frameCount=t}static resetFrameCount(){this._frameCount=0}static requestUpdate(){this._stopped||requestAnimationFrame(this.update.bind(this))}static update(){try{this.tickStart(),Utils.isMobileSafari()&&this.updateInputData(),this.updateManagers(),this.updateMain(),this.tickEnd()}catch(t){this.catchException(t)}}static onError({message:t,filename:e,lineno:i}){if(e||i)try{this.stop(),Graphics$1.printError("Error",t),AudioManager.stopAll()}catch(t){}}static catchException(t){t instanceof Error?(Graphics$1.printError(t.name,t.message),Graphics$1.printErrorDetail(t)):Graphics$1.printError("UnknownError",t),AudioManager.stopAll(),this.stop()}static updateMain(){if(Utils.isHighFps()){if(Utils.isMobileSafari())this.changeScene(),this.updateScene();else{const t=this._getTimeInMsWithoutMobileSafari();void 0===this._currentTime&&(this._currentTime=t);let e=(t-this._currentTime)/1e3;for(e>.25&&(e=.25),this._currentTime=t,this._accumulator+=e;this._accumulator>=this._deltaTime;)this.updateInputData(),this.changeScene(),this.updateScene(),this._accumulator-=this._deltaTime}this.renderScene(),this.requestUpdate()}else this.updateInputData(),this.changeScene(),this.updateScene(),this.renderScene(),this.requestUpdate()}static changeScene(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),this._scene=this._nextScene,this._scene&&(this._scene.attachReservation(),this._scene.create(),this._nextScene=null,this._sceneStarted=!1,this.onSceneCreate()),this._exiting&&this.terminate())}static updateScene(){this._scene&&(!this._sceneStarted&&this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart()),this.isCurrentSceneStarted()&&(this.updateFrameCount(),this._scene.update()))}static renderScene(){this.isCurrentSceneStarted()?Graphics$1.render(this._scene):this._scene&&this.onSceneLoading()}static updateFrameCount(){this._frameCount++}static isSceneChanging(){return this._exiting||!!this._nextScene}static isCurrentSceneBusy(){return this._scene&&this._scene.isBusy()}static isCurrentSceneStarted(){return this._scene&&this._sceneStarted}static isNextScene(t){return this._nextScene&&this._nextScene.constructor===t}static isPreviousScene(t){return this._previousClass===t}static goto(t){t&&(this._nextScene=new t),this._scene&&this._scene.stop()}static push(t){this._stack.push(this._scene.constructor),this.goto(t)}static pop(){this._stack.length>0?this.goto(this._stack.pop()):this.exit()}static exit(){this.goto(null),this._exiting=!0}static clearStack(){this._stack=[]}static stop(){this._stopped=!0}static prepareNextScene(...t){this._nextScene.prepare(...t)}static snap(){return Bitmap.snap(this._scene)}static snapForBackground(){this._backgroundBitmap=this.snap(),this._backgroundBitmap.blur()}static backgroundBitmap(){return this._backgroundBitmap}static resume(){this._stopped=!1,this.requestUpdate(),Utils.isMobileSafari()||(this._currentTime=this._getTimeInMsWithoutMobileSafari(),this._accumulator=0)}static _getTimeInMsWithoutMobileSafari(){return performance.now()}static initProgressWatcher(){ProgressWatcher$1.initialize()}static preferableRendererType(){return Utils.isOptionValid("canvas")?"canvas":Utils.isOptionValid("webgl")?"webgl":"auto"}static shouldUseCanvasRenderer(){return Utils.isMobileDevice()}static checkWebGL(){if(!Graphics$1.hasWebGL())throw new Error("Your browser does not support WebGL.")}static checkFileAccess(){if(!Utils.canReadGameFiles())throw new Error("Your browser does not allow to read local files.")}static initAudio(){const t=Utils.isOptionValid("noaudio");if(!WebAudio.initialize(t)&&!t)throw new Error("Your browser does not support Web Audio API.")}static initInput(){Input.initialize(),TouchInput.initialize()}static initNwjs(){if(Utils.isNwjs()){const t=require("nw.gui"),e=t.Window.get();if("darwin"===process.platform&&!e.menu){const i=new t.Menu({type:"menubar"}),s={hideEdit:!0,hideWindow:!0};i.createMacBuiltin("Game",s),e.menu=i}}}static checkPluginErrors(){PluginManager.checkErrors()}static terminate(){window.close()}static onKeyDown({ctrlKey:t,altKey:e,keyCode:i}){if(!t&&!e)switch(i){case 116:Utils.isNwjs()&&location.reload();break;case 119:Utils.isNwjs()&&Utils.isOptionValid("test")&&require("nw.gui").Window.get().showDevTools()}}static tickStart(){Graphics$1.tickStart()}static tickEnd(){Graphics$1.tickEnd()}static updateInputData(){Input.update(),TouchInput.update()}static updateManagers(){ImageManager.update()}static onSceneCreate(){Graphics$1.startLoading()}static onSceneStart(){Graphics$1.callGC(),Graphics$1.endLoading()}static onSceneLoading(){Graphics$1.updateLoading()}}SceneManager._scene=null,SceneManager._nextScene=null,SceneManager._stack=[],SceneManager._stopped=!1,SceneManager._sceneStarted=!1,SceneManager._exiting=!1,SceneManager._previousClass=null,SceneManager._backgroundBitmap=null,SceneManager._screenWidth=816,SceneManager._screenHeight=624,SceneManager._boxWidth=816,SceneManager._boxHeight=624,SceneManager._deltaTime=1/60,Utils.isMobileSafari()||(SceneManager._currentTime=SceneManager._getTimeInMsWithoutMobileSafari()),SceneManager._accumulator=0,SceneManager._frameCount=0;class ResourceHandler{constructor(){throw new Error("This is a static class")}static createLoader(t,e,i,s=this._defaultRetryInterval){const a=this._reloaders;let r=0;return()=>{r<s.length?(setTimeout(e,s[r]),r++):(i&&i(),t&&(0===a.length&&(Graphics$1.printLoadingError(t),SceneManager.stop()),a.push((()=>{r=0,e()}))))}}static exists(){return this._reloaders.length>0}static retry(){this._reloaders.length>0&&(Graphics$1.eraseLoadingError(),SceneManager.resume(),this._reloaders.forEach((t=>{t()})),this._reloaders.length=0)}}ResourceHandler._reloaders=[],ResourceHandler._defaultRetryInterval=[500,1e3,3e3];class Graphics{constructor(){throw new Error("This is a static class")}static initialize(t,e,i){this._width=t||800,this._height=e||600,this._rendererType=i||"auto",this._boxWidth=this._width,this._boxHeight=this._height,this._scale=1,this._realScale=1,this._errorShowed=!1,this._errorPrinter=null,this._canvas=null,this._video=null,this._videoUnlocked=!1,this._videoLoading=!1,this._upperCanvas=null,this._fpsMeter=null,this._modeBox=null,this._skipCount=0,this._maxSkip=3,this._rendered=!1,this._loadingImage=null,this._loadingCount=0,this._fpsMeterToggled=!1,this._stretchEnabled=this._defaultStretchMode(),this._canUseDifferenceBlend=!1,this._canUseSaturationBlend=!1,this._hiddenCanvas=null,this._app=null,this._testCanvasBlendModes(),this._modifyExistingElements(),this._updateRealScale(),this._createAllElements(),this._disableTextSelection(),this._disableContextMenu(),this._setupEventHandlers(),this._setupCssFontLoading(),this._setupProgress()}static canUseCssFontLoading(){return!!this._cssFontLoading}static render(t){t&&(this._app.stage=t)}static isWebGL(){return this._renderer&&this._renderer.type===PIXI.RENDERER_TYPE.WEBGL}static canUseDifferenceBlend(){return this._canUseDifferenceBlend}static canUseSaturationBlend(){return this._canUseSaturationBlend}static setLoadingImage(t){this._loadingImage=new Image,this._loadingImage.src=t}static setProgressEnabled(t){this._progressEnabled=t}static startLoading(){this._loadingCount=0,ProgressWatcher$1.truncateProgress(),ProgressWatcher$1.setProgressListener(this._updateProgressCount.bind(this)),this._progressTimeout=setTimeout((()=>{Graphics._showProgress()}),1500)}static _setupProgress(){this._progressElement=document.createElement("div"),this._progressElement.id="loading-progress",this._progressElement.width=600,this._progressElement.height=300,this._progressElement.style.visibility="hidden",this._barElement=document.createElement("div"),this._barElement.id="loading-bar",this._barElement.style.width="100%",this._barElement.style.height="10%",this._barElement.style.background="linear-gradient(to top, gray, lightgray)",this._barElement.style.border="5px solid white",this._barElement.style.borderRadius="15px",this._barElement.style.marginTop="40%",this._filledBarElement=document.createElement("div"),this._filledBarElement.id="loading-filled-bar",this._filledBarElement.style.width="0%",this._filledBarElement.style.height="100%",this._filledBarElement.style.background="linear-gradient(to top, lime, honeydew)",this._filledBarElement.style.borderRadius="10px",this._progressElement.appendChild(this._barElement),this._barElement.appendChild(this._filledBarElement),this._updateProgress(),document.body.appendChild(this._progressElement)}static _showProgress(){this._progressEnabled&&(this._progressElement.value=0,this._progressElement.style.visibility="visible",this._progressElement.style.zIndex=98)}static _hideProgress(){this._progressElement&&(this._progressElement.style.visibility="hidden"),clearTimeout(this._progressTimeout)}static _updateProgressCount(t,e){let i;i=0!==e?t/e*100:100,this._filledBarElement.style.width=`${i}%`}static _updateProgress(){this._centerElement(this._progressElement)}static updateLoading(){this._loadingCount++,this._paintUpperCanvas(),this._upperCanvas.style.opacity=1,this._updateProgress()}static endLoading(){this._clearUpperCanvas(),this._upperCanvas.style.opacity=0,this._hideProgress()}static printLoadingError(t){if(this._errorPrinter&&!this._errorShowed){this._updateErrorPrinter(),this._errorPrinter.innerHTML=this._makeErrorHtml("Loading Error",`Failed to load: ${t}`),this._errorPrinter.style.userSelect="text",this._errorPrinter.style.webkitUserSelect="text",this._errorPrinter.style.msUserSelect="text",this._errorPrinter.style.mozUserSelect="text",this._errorPrinter.oncontextmenu=null;const e=document.createElement("button");e.innerHTML="Retry",e.style.fontSize="24px",e.style.color="#ffffff",e.style.backgroundColor="#000000",e.addEventListener("touchstart",(t=>{t.stopPropagation()})),e.addEventListener("click",(t=>{ResourceHandler.retry()})),this._errorPrinter.appendChild(e),this._loadingCount=-1/0}}static eraseLoadingError(){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML="",this._errorPrinter.style.userSelect="none",this._errorPrinter.style.webkitUserSelect="none",this._errorPrinter.style.msUserSelect="none",this._errorPrinter.style.mozUserSelect="none",this._errorPrinter.oncontextmenu=()=>!1,this._loadingCount=0)}static printError(t,e){this._errorShowed=!0,this._hideProgress(),this.hideFps(),this._errorPrinter&&(this._updateErrorPrinter(),this._errorPrinter.innerHTML=this._makeErrorHtml(t,e),this._errorPrinter.style.userSelect="text",this._errorPrinter.style.webkitUserSelect="text",this._errorPrinter.style.msUserSelect="text",this._errorPrinter.style.mozUserSelect="text",this._errorPrinter.oncontextmenu=null,this._errorMessage&&this._makeErrorMessage()),this._applyCanvasFilter(),this._clearUpperCanvas()}static printErrorDetail(t){if(this._errorPrinter&&this._showErrorDetail){const e=this._formatEventInfo(t),i=this._formatEventCommandInfo(t),s=i?`${e}, ${i}`:e,a=this._formatStackTrace(t);this._makeErrorDetail(s,a)}}static setErrorMessage(t){this._errorMessage=t}static setShowErrorDetail(t){this._showErrorDetail=t}static showFps(){this._fpsMeter&&(this._fpsMeter.extensions.pixi||this._fpsMeter.enableExtension("pixi",[PIXI,this._app]),document.body.appendChild(this._fpsMeter.dom),this._fpsMeter.show(!0))}static hideFps(){this._fpsMeter&&(document.body.contains(this._fpsMeter.dom)&&document.body.removeChild(this._fpsMeter.dom),this._fpsMeter.show(!1))}static loadFont(t,e){const i=document.createElement("style"),s=document.getElementsByTagName("head"),a=`@font-face { font-family: "${t}"; src: url("${e}"); }`;i.type="text/css",s.item(0).appendChild(i),i.sheet.insertRule(a,0),this._createFontLoader(t)}static isFontLoaded(t){if(Graphics._cssFontLoading)return!!Graphics._fontLoaded&&Graphics._fontLoaded.check(`10px "${t}"`);{this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));const e=this._hiddenCanvas.getContext("2d"),i="abcdefghijklmnopqrstuvwxyz";let s,a;return e.font=`40px ${t}, sans-serif`,s=e.measureText(i).width,e.font="40px sans-serif",a=e.measureText(i).width,s!==a}}static playVideo(t){this._videoLoader=ResourceHandler.createLoader(null,this._playVideo.bind(this,t),this._onVideoError.bind(this)),this._playVideo(t)}static _playVideo(t){this._video.src=t,this._video.onloadeddata=this._onVideoLoad.bind(this),this._video.onerror=this._videoLoader,this._video.onended=this._onVideoEnd.bind(this),this._video.load(),this._videoLoading=!0}static isVideoPlaying(){return this._videoLoading||this._isVideoVisible()}static canPlayVideoType(t){return this._video&&this._video.canPlayType(t)}static setVideoVolume(t){this._videoVolume=t,this._video&&(this._video.volume=this._videoVolume)}static pageToCanvasX(t){if(this._canvas){const e=this._canvas.offsetLeft;return Math.round((t-e)/this._realScale)}return 0}static pageToCanvasY(t){if(this._canvas){const e=this._canvas.offsetTop;return Math.round((t-e)/this._realScale)}return 0}static isInsideCanvas(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height}static _createAllElements(){this._createErrorPrinter(),this._createCanvas(),this._createVideo(),this._createUpperCanvas(),this._createRenderer(),this._createPixiApp(),this._createFPSMeter(),this._createModeBox(),this._createGameFontLoader()}static _updateAllElements(){this._updateRealScale(),this._updateErrorPrinter(),this._updateCanvas(),this._updateVideo(),this._updateUpperCanvas(),this._updateRenderer(),this._paintUpperCanvas(),this._updateProgress()}static _updateRealScale(){if(this._stretchEnabled){let t=window.innerWidth/this._width,e=window.innerHeight/this._height;t>=1&&t-.01<=1&&(t=1),e>=1&&e-.01<=1&&(e=1),this._realScale=Math.min(t,e)}else this._realScale=this._scale}static _testCanvasBlendModes(){let t,e,i,s;t=document.createElement("canvas"),t.width=1,t.height=1,e=t.getContext("2d"),e.globalCompositeOperation="source-over",e.fillStyle="white",e.fillRect(0,0,1,1),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,1,1),i=e.getImageData(0,0,1,1),e.globalCompositeOperation="source-over",e.fillStyle="black",e.fillRect(0,0,1,1),e.globalCompositeOperation="saturation",e.fillStyle="white",e.fillRect(0,0,1,1),s=e.getImageData(0,0,1,1),this._canUseDifferenceBlend=0===i.data[0],this._canUseSaturationBlend=0===s.data[0]}static _createErrorPrinter(){this._errorPrinter=document.createElement("p"),this._errorPrinter.id="ErrorPrinter",this._updateErrorPrinter(),document.body.appendChild(this._errorPrinter)}static _updateErrorPrinter(){this._errorPrinter.width=.9*this._width,this._errorShowed&&this._showErrorDetail?this._errorPrinter.height=.9*this._height:this._errorShowed&&this._errorMessage?this._errorPrinter.height=100:this._errorPrinter.height=40,this._errorPrinter.style.textAlign="center",this._errorPrinter.style.textShadow="1px 1px 3px #000",this._errorPrinter.style.fontSize="20px",this._errorPrinter.style.zIndex=99,this._centerElement(this._errorPrinter)}static _makeErrorMessage(){const t=document.createElement("div"),e=t.style;e.color="white",e.textAlign="left",e.fontSize="18px",t.innerHTML=`<hr>${this._errorMessage}`,this._errorPrinter.appendChild(t)}static _makeErrorDetail(t,e){const i=document.createElement("div"),s=i.style;s.color="white",s.textAlign="left",s.fontSize="18px",i.innerHTML=`<br><hr>${t}<br><br>${e}`,this._errorPrinter.appendChild(i)}static _createCanvas(){this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this._updateCanvas(),document.body.appendChild(this._canvas)}static _updateCanvas(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.zIndex=1,this._centerElement(this._canvas)}static _createVideo(){this._video=document.createElement("video"),this._video.id="GameVideo",this._video.style.opacity=0,this._video.setAttribute("playsinline",""),this._video.volume=this._videoVolume,this._updateVideo(),makeVideoPlayableInline(this._video),document.body.appendChild(this._video)}static _updateVideo(){this._video.width=this._width,this._video.height=this._height,this._video.style.zIndex=2,this._centerElement(this._video)}static _createUpperCanvas(){this._upperCanvas=document.createElement("canvas"),this._upperCanvas.id="UpperCanvas",this._updateUpperCanvas(),document.body.appendChild(this._upperCanvas)}static _updateUpperCanvas(){this._upperCanvas.width=this._width,this._upperCanvas.height=this._height,this._upperCanvas.style.zIndex=3,this._centerElement(this._upperCanvas)}static _clearUpperCanvas(){this._upperCanvas.getContext("2d").clearRect(0,0,this._width,this._height)}static _paintUpperCanvas(){if(this._clearUpperCanvas(),this._loadingImage&&this._loadingCount>=20){const t=this._upperCanvas.getContext("2d"),e=(this._width-this._loadingImage.width)/2,i=(this._height-this._loadingImage.height)/2,s=((this._loadingCount-20)/30).clamp(0,1);t.save(),t.globalAlpha=s,t.drawImage(this._loadingImage,e,i),t.restore()}}static _updateRenderer(){this._app&&this._app.renderer.resize(this._width,this._height)}static _createFPSMeter(){"function"==typeof GameStats&&(this._fpsMeter=new GameStats({autoPlace:!1}),this._fpsMeter.show(!1),this._fpsMeter.dom.style.zIndex=1)}static _createModeBox(){const t=document.createElement("div");t.id="modeTextBack",t.style.position="absolute",t.style.left="5px",t.style.top="5px",t.style.width="119px",t.style.height="58px",t.style.background="rgba(0,0,0,0.2)",t.style.zIndex=9,t.style.opacity=0;const e=document.createElement("div");e.id="modeText",e.style.position="absolute",e.style.left="0px",e.style.top="41px",e.style.width="119px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.color="white",e.style.textAlign="center",e.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)",e.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode",document.body.appendChild(t),t.appendChild(e),this._modeBox=t}static _createGameFontLoader(){this._createFontLoader("GameFont")}static _centerElement(t){const e=t.width*this._realScale,i=t.height*this._realScale;t.style.position="absolute",t.style.margin="auto",t.style.top=0,t.style.left=0,t.style.right=0,t.style.bottom=0,t.style.width=`${e}px`,t.style.height=`${i}px`}static _applyCanvasFilter(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")}static _onVideoLoad(){this._video.play(),this._updateVisibility(!0),this._videoLoading=!1}static _onVideoError(){this._updateVisibility(!1),this._videoLoading=!1}static _onVideoEnd(){this._updateVisibility(!1)}static _updateVisibility(t){this._video.style.opacity=t?1:0,this._canvas.style.opacity=t?0:1}static _isVideoVisible(){return this._video.style.opacity>0}static _setupEventHandlers(){window.addEventListener("resize",this._onWindowResize.bind(this)),document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keydown",this._onTouchEnd.bind(this)),document.addEventListener("mousedown",this._onTouchEnd.bind(this)),document.addEventListener("touchend",this._onTouchEnd.bind(this))}static _onWindowResize(){this._updateAllElements()}static _onKeyDown(t){if(!t.ctrlKey&&!t.altKey)switch(t.keyCode){case 113:t.preventDefault(),this._switchFPSMeter();break;case 114:t.preventDefault(),this._switchStretchMode();break;case 115:t.preventDefault(),this._switchFullScreen()}}static _onTouchEnd(t){this._videoUnlocked||(this._video.play(),this._videoUnlocked=!0),this._isVideoVisible()&&this._video.paused&&this._video.play()}static _switchFPSMeter(){this._fpsMeter&&this._fpsMeterToggled?(this.hideFps(),this._fpsMeterToggled=!1):this._fpsMeter&&!this._fpsMeterToggled&&(this.showFps(),this._fpsMeterToggled=!0)}static _switchStretchMode(){this._stretchEnabled=!this._stretchEnabled,this._updateAllElements()}static _switchFullScreen(){this._isFullScreen()?this._cancelFullScreen():this._requestFullScreen()}static _onTick(t){this._fpsMeter&&this._fpsMeter.shown&&this._fpsMeter.begin(),this._app.stage&&this._app.render(),this._fpsMeter&&this._fpsMeter.shown&&this._fpsMeter.end()}static _createPixiApp(){const t={view:this._canvas,width:this._width,height:this._height,resolution:window.devicePixelRatio,powerPreference:"high-performance",autoStart:!0};try{this._app=new PIXI.Application(t),this._app.ticker.remove(this._app.render,this._app),this._app.ticker.add(this._onTick,this)}catch(t){this._app=null}}static _setupCssFontLoading(){Graphics._cssFontLoading&&document.fonts.ready.then((t=>{Graphics._fontLoaded=t})).catch((t=>{SceneManager.onError(t)}))}static tickStart(){}static tickEnd(){}static hasWebGL(){if("boolean"==typeof Graphics._canWebGL)return Graphics._canWebGL;try{const t=document.createElement("canvas"),e=!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"));return Graphics._canWebGL=e,e}catch(t){return Graphics._canWebGL=!1,!1}}static callGC(){Graphics.isWebGL()&&Graphics._renderer.textureGC.run()}static _makeErrorHtml(t,e){return`<font color="yellow"><b>${t}</b></font><br><font color="white">${decodeURIComponent(e)}</font><br>`}static _defaultStretchMode(){return Utils.isNwjs()||Utils.isMobileDevice()}static _modifyExistingElements(){const t=document.getElementsByTagName("*");for(let e=0;e<t.length;e++)t[e].style.zIndex>0&&(t[e].style.zIndex=0)}static _formatEventInfo(t){switch(String(t.eventType)){case"map_event":return"MapID: %1, MapEventID: %2, page: %3, line: %4".format(t.mapId,t.mapEventId,t.page,t.line);case"common_event":return"CommonEventID: %1, line: %2".format(t.commonEventId,t.line);case"battle_event":return"TroopID: %1, page: %2, line: %3".format(t.troopId,t.page,t.line);case"test_event":return"TestEvent, line: %1".format(t.line);default:return"No information"}}static _formatEventCommandInfo({eventCommand:t,content:e}){switch(String(t)){case"plugin_command":return`Plugin Command: ${e}`;case"script":return`Script: ${e}`;case"control_variables":return`Control Variables: Script: ${e}`;case"conditional_branch_script":return`If: Script: ${e}`;case"set_route_script":return`Set Movement Route: Script: ${e}`;case"auto_route_script":return`Autonomous Movement Custom Route: Script: ${e}`;default:return""}}static _formatStackTrace({stack:t}){return decodeURIComponent((t||"").replace(/file:.*js\//g,"").replace(/http:.*js\//g,"").replace(/https:.*js\//g,"").replace(/chrome-extension:.*js\//g,"").replace(/\n/g,"<br>"))}static _createRenderer(){}static _createFontLoader(t){const e=document.createElement("div"),i=document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(i),document.body.appendChild(e)}static _disableTextSelection(){const t=document.body;t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.mozUserSelect="none"}static _disableContextMenu(){const t=document.body.getElementsByTagName("*"),e=()=>!1;for(let i=0;i<t.length;i++)t[i].oncontextmenu=e}static _isFullScreen(){return document.fullscreenElement||document.mozFullScreen||document.webkitFullscreenElement||document.msFullscreenElement}static _requestFullScreen(){const t=document.body;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()}static _cancelFullScreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}}Graphics._cssFontLoading=document.fonts&&document.fonts.ready&&document.fonts.ready.then,Graphics._fontLoaded=null,Graphics._videoVolume=1,Object.defineProperty(Graphics,"app",{get(){return this._app},configurable:!0}),Object.defineProperty(Graphics,"_renderer",{get(){return this._app.renderer},configurable:!0}),Graphics.frameCount=0,Graphics.BLEND_NORMAL=0,Graphics.BLEND_ADD=1,Graphics.BLEND_MULTIPLY=2,Graphics.BLEND_SCREEN=3,Graphics._canWebGL=null,Object.defineProperty(Graphics,"width",{get(){return this._width},set(t){this._width!==t&&(this._width=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"height",{get(){return this._height},set(t){this._height!==t&&(this._height=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"boxWidth",{get(){return this._boxWidth},set(t){this._boxWidth=t},configurable:!0}),Object.defineProperty(Graphics,"boxHeight",{get(){return this._boxHeight},set(t){this._boxHeight=t},configurable:!0}),Object.defineProperty(Graphics,"scale",{get(){return this._scale},set(t){this._scale!==t&&(this._scale=t,this._updateAllElements())},configurable:!0});var Graphics$1=Graphics;class Rectangle extends PIXI.Rectangle{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){PIXI.Rectangle.call(this,t,e,i,s)}}Rectangle.emptyRectangle=new Rectangle(0,0,0,0);class Bitmap{constructor(...t){this.initialize(...t)}_createCanvas(t,e){if(this.__canvas=this.__canvas||document.createElement("canvas"),this.__context=this.__canvas.getContext("2d"),this.__canvas.width=Math.max(t||0,1),this.__canvas.height=Math.max(e||0,1),this._image){const t=Math.max(this._image.width||0,1),e=Math.max(this._image.height||0,1);this.__canvas.width=t,this.__canvas.height=e,this._createBaseTexture(this._canvas),this.__context.drawImage(this._image,0,0)}this._setDirty()}_createBaseTexture(t){this.__baseTexture=new PIXI.BaseTexture(t),this.__baseTexture.mipmap=!1,this.__baseTexture.width=t.width,this.__baseTexture.height=t.height,this._baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST}_clearImgInstance(){this._image.src="",this._image.onload=null,this._image.onerror=null,this._errorListener=null,this._loadListener=null,Bitmap._reuseImages.push(this._image),this._image=null}_renewCanvas(){const t=this._image;t&&this.__canvas&&(this.__canvas.width<t.width||this.__canvas.height<t.height)&&this._createCanvas()}initialize(t,e){this._defer||this._createCanvas(t,e),this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._loadingState="none",this._decodeAfterRequest=!1,this.cacheEntry=null,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4}isReady(){return"loaded"===this._loadingState||"none"===this._loadingState}isError(){return"error"===this._loadingState}touch(){this.cacheEntry&&this.cacheEntry.touch()}get url(){return this._url}get baseTexture(){return this._baseTexture}get canvas(){return this._canvas}get context(){return this._context}get width(){return this.isReady()?this._image?this._image.width:this._canvas.width:0}get height(){return this.isReady()?this._image?this._image.height:this._canvas.height:0}get rect(){return new Rectangle(0,0,this.width,this.height)}get smooth(){return this._smooth}set smooth(t){!1!==this._smooth&&(this._smooth=!1)}get paintOpacity(){return this._paintOpacity}set paintOpacity(t){this._paintOpacity!==t&&(this._paintOpacity=t,this._context.globalAlpha=this._paintOpacity/255)}resize(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._canvas.width=t,this._canvas.height=e,this._baseTexture.width=t,this._baseTexture.height=e}blt({width:t,height:e,_canvas:i},s,a,r,n,h,o,l,c){l=l||r,c=c||n,s=Math.floor(s),a=Math.floor(a),r=Math.floor(r),n=Math.floor(n),h=Math.floor(h),o=Math.floor(o),l=Math.floor(l),c=Math.floor(c),s>=0&&a>=0&&r>0&&n>0&&l>0&&c>0&&s+r<=t&&a+n<=e&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(i,s,a,r,n,h,o,l,c),this._setDirty())}bltImage({width:t,height:e,_image:i},s,a,r,n,h,o,l,c){l=l||r,c=c||n,s>=0&&a>=0&&r>0&&n>0&&l>0&&c>0&&s+r<=t&&a+n<=e&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(i,s,a,r,n,h,o,l,c),this._setDirty())}getPixel(t,e){const i=this._context.getImageData(t,e,1,1).data;let s="#";for(let t=0;t<3;t++)s+=i[t].toString(16).padZero(2);return s}getAlphaPixel(t,e){return this._context.getImageData(t,e,1,1).data[3]}clearRect(t,e,i,s){this._context.clearRect(t,e,i,s),this._setDirty()}clear(){this.clearRect(0,0,this.width,this.height)}fillRect(t,e,i,s,a){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),s=Math.floor(s);const r=this._context;r.save(),r.fillStyle=a,r.fillRect(t,e,i,s),r.restore(),this._setDirty()}fillAll(t){this.fillRect(0,0,this.width,this.height,t)}gradientFillRect(t,e,i,s,a,r,n){const h=this._context;let o;o=n?h.createLinearGradient(t,e,t,e+s):h.createLinearGradient(t,e,t+i,e),o.addColorStop(0,a),o.addColorStop(1,r),h.save(),h.fillStyle=o,h.fillRect(t,e,i,s),h.restore(),this._setDirty()}drawCircle(t,e,i,s){t=Math.floor(t),e=Math.floor(e);const a=this._context;a.save(),a.fillStyle=s,a.beginPath(),a.arc(t,e,i,0,2*Math.PI,!1),a.fill(),a.restore(),this._setDirty()}drawText(t,e,i,s,a,r){if(void 0!==t){e=Math.floor(e),i=Math.floor(i),s=Math.floor(s)||4294967295;let n=e;const h=i+(a=Math.floor(a))-Math.round((a-.7*this.fontSize)/2),o=this._context,l=o.globalAlpha;"center"===r&&(n+=s/2),"right"===r&&(n+=s),o.save(),o.font=this._makeFontNameText(),o.textAlign=r,o.textBaseline="alphabetic",o.globalAlpha=1,this._drawTextOutline(t,n,h,s),o.globalAlpha=l,this._drawTextBody(t,n,h,s),o.restore(),this._setDirty()}}drawSmallText(t,e,i,s,a,r){}measureTextWidth(t){const e=this._context;e.save(),e.font=this._makeFontNameText();const i=e.measureText(t).width;return e.restore(),i}adjustTone(t,e,i){if((t||e||i)&&this.width>0&&this.height>0){const s=this._context,a=s.getImageData(0,0,this.width,this.height),r=a.data;for(let s=0;s<r.length;s+=4)r[s+0]+=t,r[s+1]+=e,r[s+2]+=i;s.putImageData(a,0,0),this._setDirty()}}rotateHue(t){if(t&&t&&this.width>0&&this.height>0){t=(t%360+360)%360;const s=this._context,a=s.getImageData(0,0,this.width,this.height),r=a.data;for(let s=0;s<r.length;s+=4){const a=e(r[s+0],r[s+1],r[s+2]),n=i((a[0]+t)%360,a[1],a[2]);r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]}s.putImageData(a,0,0),this._setDirty()}function e(t,e,i){const s=Math.min(t,e,i),a=Math.max(t,e,i);let r=0,n=0;const h=(s+a)/2,o=a-s;return o>0&&(r=t===a?((e-i)/o+6)%6*60:e===a?60*((i-t)/o+2):60*((t-e)/o+4),n=o/(255-Math.abs(2*h-255))),[r,n,h]}function i(t,e,i){const s=(255-Math.abs(2*i-255))*e,a=i-s/2,r=s+a,n=s*(1-Math.abs(t/60%2-1))+a;return t<60?[r,n,a]:t<120?[n,r,a]:t<180?[a,r,n]:t<240?[a,n,r]:t<300?[n,a,r]:[r,a,n]}}blur(){for(let t=0;t<2;t++){const t=this.width,e=this.height,i=this._canvas,s=this._context,a=document.createElement("canvas"),r=a.getContext("2d");a.width=t+2,a.height=e+2,r.drawImage(i,0,0,t,e,1,1,t,e),r.drawImage(i,0,0,t,1,1,0,t,1),r.drawImage(i,0,0,1,e,0,1,1,e),r.drawImage(i,0,e-1,t,1,1,e+1,t,1),r.drawImage(i,t-1,0,1,e,t+1,1,1,e),s.save(),s.fillStyle="black",s.fillRect(0,0,t,e),s.globalCompositeOperation="lighter",s.globalAlpha=1/9;for(let i=0;i<3;i++)for(let r=0;r<3;r++)s.drawImage(a,r,i,t,e,0,0,t,e);s.restore()}this._setDirty()}addLoadListener(t){this.isReady()?t(this):this._loadListeners.push(t)}_makeFontNameText(){return`${(this.fontItalic?"Italic ":"")+this.fontSize}px ${this.fontFace}`}_drawTextOutline(t,e,i,s){const a=this._context;a.strokeStyle=this.outlineColor,a.lineWidth=this.outlineWidth,a.lineJoin="round",a.strokeText(t,e,i,s)}_drawTextBody(t,e,i,s){const a=this._context;a.fillStyle=this.textColor,a.fillText(t,e,i,s)}_onLoad(){switch(this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._renewCanvas(),this._loadingState){case"requesting":this._loadingState="requestCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break;case"decrypting":window.URL.revokeObjectURL(this._image.src),this._loadingState="decryptCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance())}}decode(){switch(this._loadingState){case"requestCompleted":case"decryptCompleted":this._loadingState="loaded",this.__canvas||this._createBaseTexture(this._image),this._setDirty(),this._callLoadListeners();break;case"requesting":case"decrypting":this._decodeAfterRequest=!0,this._loader||(this._loader=ResourceHandler.createLoader(this._url,this._requestImage.bind(this,this._url),this._onError.bind(this)),this._image.removeEventListener("error",this._errorListener),this._image.addEventListener("error",this._errorListener=this._loader));break;case"pending":case"purged":case"error":this._decodeAfterRequest=!0,this._requestImage(this._url)}}_callLoadListeners(){for(;this._loadListeners.length>0;)this._loadListeners.shift()(this)}_onError(){this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._loadingState="error"}_setDirty(){this._dirty=!0}checkDirty(){if(this._dirty){this._baseTexture.update();const t=this._baseTexture;setTimeout((()=>{t.update()}),0),this._dirty=!1}}_requestImage(t){0!==Bitmap._reuseImages.length?this._image=Bitmap._reuseImages.pop():this._image=new Image,this._decodeAfterRequest&&!this._loader&&(this._loader=ResourceHandler.createLoader(t,this._requestImage.bind(this,t),this._onError.bind(this))),this._url=t,this._loadingState="requesting",!Decrypter.checkImgIgnore(t)&&Decrypter.hasEncryptedImages?(this._loadingState="decrypting",Decrypter.decryptImg(t,this)):(this._image.src=t,this._image.addEventListener("load",this._loadListener=Bitmap.prototype._onLoad.bind(this)),this._image.addEventListener("error",this._errorListener=this._loader||Bitmap.prototype._onError.bind(this)))}isRequestOnly(){return!(this._decodeAfterRequest||this.isReady())}isRequestReady(){return"pending"!==this._loadingState&&"requesting"!==this._loadingState&&"decrypting"!==this._loadingState}startRequest(){"pending"===this._loadingState&&(this._decodeAfterRequest=!1,this._requestImage(this._url))}static load(t){const e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._decodeAfterRequest=!0,e._requestImage(t),e}static snap(t){const e=Graphics$1.width,i=Graphics$1.height,s=new Bitmap(e,i),a=s._context,r=PIXI.RenderTexture.create({width:e,height:i});if(t){Graphics$1._renderer.render(t,{renderTexture:r}),t.worldTransform.identity();let e=null;e=Graphics$1.isWebGL()?Graphics$1._renderer.plugins.extract.canvas(r):r.baseTexture._canvasRenderTarget.canvas,a.drawImage(e,0,0)}return r.destroy({destroyBase:!0}),s._setDirty(),s}static request(t){const e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._url=t,e._loadingState="pending",e}}Bitmap._reuseImages=[],Object.defineProperties(Bitmap.prototype,{_canvas:{get(){return this.__canvas||this._createCanvas(),this.__canvas}},_context:{get(){return this.__context||this._createCanvas(),this.__context}},_baseTexture:{get(){return this.__baseTexture||this._createBaseTexture(this._image||this.__canvas),this.__baseTexture}}});class ImageManager{constructor(){throw new Error("This is a static class")}static loadAnimation(t,e){return this.loadBitmap("img/animations/",t,e,!0)}static loadBattleback1(t,e){return this.loadBitmap("img/battlebacks1/",t,e,!0)}static loadBattleback2(t,e){return this.loadBitmap("img/battlebacks2/",t,e,!0)}static loadEnemy(t,e){return this.loadBitmap("img/enemies/",t,e,!0)}static loadCharacter(t,e){return this.loadBitmap("img/characters/",t,e,!1)}static loadFace(t,e){return this.loadBitmap("img/faces/",t,e,!0)}static loadParallax(t,e){return this.loadBitmap("img/parallaxes/",t,e,!0)}static loadPicture(t,e){return this.loadBitmap("img/pictures/",t,e,!0)}static loadSvActor(t,e){return this.loadBitmap("img/sv_actors/",t,e,!1)}static loadSvEnemy(t,e){return this.loadBitmap("img/sv_enemies/",t,e,!0)}static loadSystem(t,e){return this.loadBitmap("img/system/",t,e,!1)}static loadTileset(t,e){return this.loadBitmap("img/tilesets/",t,e,!1)}static loadTitle1(t,e){return this.loadBitmap("img/titles1/",t,e,!0)}static loadTitle2(t,e){return this.loadBitmap("img/titles2/",t,e,!0)}static loadBitmap(t,e,i,s){if(e){const s=`${t+encodeURIComponent(e)}.png`,a=this.loadNormalBitmap(s,i||0);return a.smooth=!1,a}return this.loadEmptyBitmap()}static loadEmptyBitmap(){let t=this._imageCache.get("empty");return t||(t=new Bitmap,this._imageCache.add("empty",t),this._imageCache.reserve("empty",t,this._systemReservationId)),t}static loadNormalBitmap(t,e){const i=this._generateCacheKey(t,e);let s=this._imageCache.get(i);return s?s.isReady()||s.decode():(s=Bitmap.load(t),this._callCreationHook(s),s.addLoadListener((()=>{s.rotateHue(e)})),this._imageCache.add(i,s)),s}static clear(){this._imageCache=new ImageCache}static isReady(){return this._imageCache.isReady()}static reserveAnimation(t,e,i){return this.reserveBitmap("img/animations/",t,e,!0,i)}static reserveBattleback1(t,e,i){return this.reserveBitmap("img/battlebacks1/",t,e,!0,i)}static reserveBattleback2(t,e,i){return this.reserveBitmap("img/battlebacks2/",t,e,!0,i)}static reserveEnemy(t,e,i){return this.reserveBitmap("img/enemies/",t,e,!0,i)}static reserveCharacter(t,e,i){return this.reserveBitmap("img/characters/",t,e,!1,i)}static reserveFace(t,e,i){return this.reserveBitmap("img/faces/",t,e,!0,i)}static reserveParallax(t,e,i){return this.reserveBitmap("img/parallaxes/",t,e,!0,i)}static reservePicture(t,e,i){return this.reserveBitmap("img/pictures/",t,e,!0,i)}static reserveSvActor(t,e,i){return this.reserveBitmap("img/sv_actors/",t,e,!1,i)}static reserveSvEnemy(t,e,i){return this.reserveBitmap("img/sv_enemies/",t,e,!0,i)}static reserveSystem(t,e,i){return this.reserveBitmap("img/system/",t,e,!1,i||this._systemReservationId)}static reserveTileset(t,e,i){return this.reserveBitmap("img/tilesets/",t,e,!1,i)}static reserveTitle1(t,e,i){return this.reserveBitmap("img/titles1/",t,e,!0,i)}static reserveTitle2(t,e,i){return this.reserveBitmap("img/titles2/",t,e,!0,i)}static reserveBitmap(t,e,i,s,a){if(e){const s=`${t+encodeURIComponent(e)}.png`,r=this.reserveNormalBitmap(s,i||0,a||this._defaultReservationId);return r.smooth=!1,r}return this.loadEmptyBitmap()}static reserveNormalBitmap(t,e,i){const s=this.loadNormalBitmap(t,e);return this._imageCache.reserve(this._generateCacheKey(t,e),s,i),s}static releaseReservation(t){this._imageCache.releaseReservation(t)}static setDefaultReservationId(t){this._defaultReservationId=t}static requestAnimation(t,e){return this.requestBitmap("img/animations/",t,e,!0)}static requestBattleback1(t,e){return this.requestBitmap("img/battlebacks1/",t,e,!0)}static requestBattleback2(t,e){return this.requestBitmap("img/battlebacks2/",t,e,!0)}static requestEnemy(t,e){return this.requestBitmap("img/enemies/",t,e,!0)}static requestCharacter(t,e){return this.requestBitmap("img/characters/",t,e,!1)}static requestFace(t,e){return this.requestBitmap("img/faces/",t,e,!0)}static requestParallax(t,e){return this.requestBitmap("img/parallaxes/",t,e,!0)}static requestPicture(t,e){return this.requestBitmap("img/pictures/",t,e,!0)}static requestSvActor(t,e){return this.requestBitmap("img/sv_actors/",t,e,!1)}static requestSvEnemy(t,e){return this.requestBitmap("img/sv_enemies/",t,e,!0)}static requestSystem(t,e){return this.requestBitmap("img/system/",t,e,!1)}static requestTileset(t,e){return this.requestBitmap("img/tilesets/",t,e,!1)}static requestTitle1(t,e){return this.requestBitmap("img/titles1/",t,e,!0)}static requestTitle2(t,e){return this.requestBitmap("img/titles2/",t,e,!0)}static requestBitmap(t,e,i,s){if(e){const s=`${t+encodeURIComponent(e)}.png`,a=this.requestNormalBitmap(s,i||0);return a.smooth=!1,a}return this.loadEmptyBitmap()}static requestNormalBitmap(t,e){const i=this._generateCacheKey(t,e);let s=this._imageCache.get(i);return s?this._requestQueue.raisePriority(i):(s=Bitmap.request(t),this._callCreationHook(s),s.addLoadListener((()=>{s.rotateHue(e)})),this._imageCache.add(i,s),this._requestQueue.enqueue(i,s)),s}static update(){this._requestQueue.update()}static clearRequest(){this._requestQueue.clear()}static setCreationHook(t){this._creationHook=t}static _callCreationHook(t){this._creationHook&&this._creationHook(t)}static isObjectCharacter(t){const e=t.match(/^[\!\$]+/);return e&&e[0].contains("!")}static isBigCharacter(t){const e=t.match(/^[\!\$]+/);return e&&e[0].contains("$")}static isZeroParallax(t){return"!"===t.charAt(0)}static _generateCacheKey(t,e){return`${t}:${e}`}}ImageManager.cache=new CacheMap(ImageManager),ImageManager._imageCache=new ImageCache,ImageManager._requestQueue=new RequestQueue,ImageManager._systemReservationId=Utils.generateRuntimeId();class ProgressWatcher{constructor(){throw new Error("This is a static class")}static initialize(){this.clearProgress(),ImageManager.setCreationHook(this._bitmapListener.bind(this)),AudioManager.setCreationHook(this._audioListener.bind(this))}static _bitmapListener(t){this._countLoading++,t.addLoadListener((()=>{this._countLoaded++,this._progressListener&&this._progressListener(this._countLoaded,this._countLoading)}))}static _audioListener(t){this._countLoading++,t.addLoadListener((()=>{this._countLoaded++,this._progressListener&&this._progressListener(this._countLoaded,this._countLoading)}))}static setProgressListener(t){this._progressListener=t}static clearProgress(){this._countLoading=0,this._countLoaded=0}static truncateProgress(){this._countLoaded&&(this._countLoading-=this._countLoaded,this._countLoaded=0)}}var ProgressWatcher$1=ProgressWatcher;class Point extends PIXI.Point{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){PIXI.Point.call(this,t,e)}}class BitmapPIXI extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){PIXI.Container.call(this),t=Math.max(t||0,1),e=Math.max(e||0,1),this._width=t,this._height=e,this._paintOpacity=255,this.textPadding=2,this.wordWrap=!1,this.wordWrapWidth=0,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4,this.textCache=[],this.on("removed",this.onRemoveAsAChild)}onRemoveAsAChild(){this.textCache=[];for(let t=this.children.length-1;t>=0;t--)this.children[t].destroy({children:!0,texture:!0}),this.removeChild(this.children[t])}get paintOpacity(){return this._paintOpacity}set paintOpacity(t){this._paintOpacity!==t&&(this._paintOpacity=t)}get width(){return this._width}set width(t){this._width!==t&&(this._width=t)}get height(){return this._height}set height(t){this._height!==t&&(this._height=t)}resize(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._width=t,this._height=e}clear(){for(let t=this.children.length-1;t>=0;t--)this.children[t].isBitmapText?this.children[t].text="":(this.children[t].destroy({children:!0,texture:!0}),this.removeChild(this.children[t]))}clearRect(t,e,i,s){const a=this,r=[];this.children.forEach((a=>{a&&a.x>=t&&a.x<t+i&&a.y>=e&&a.y<e+s&&(a.isBitmapText?a.text="":r.push(a))})),r.forEach((t=>{t.destroy({children:!0,texture:!0}),a.removeChild(t)}))}drawText(t,e,i,s,a,r){if(void 0===t)return;const n=this._paintOpacity/255;s=Math.floor(s)||4294967295,a=Math.floor(a),t=String(t),"center"===r?e+=s/2:"right"===r&&(e+=s),i=i+a-1.25*this.fontSize,e=Math.floor(e),i=Math.floor(i),this._updateExistingText(t,e,i,n)||this._drawNewText(t,e,i,n,s,a,r)}_updateExistingText(t,e,i,s){for(const a of this.textCache)if(a.x===e&&a.y===i){const e=PIXI.utils.string2hex(this.textColor);return a._tint!==e&&(a.tint=e),a.text!==t&&(a.text=t),a.alpha!==s&&(a.alpha=s),this.addChild(a),!0}return!1}_drawNewText(t,e,i,s,a,r,n){const h={fontFamily:this.fontFace,fontSize:this.fontSize,fill:16777215,lineHeight:r,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,padding:this.textPadding,fontStyle:this.fontItalic?"italic":"normal",stroke:this.outlineColor,strokeThickness:this.outlineWidth};PIXI.BitmapFont.available[h.fontFamily]||this._makeBitmapFont(h);const o=new PIXI.BitmapText(t,{fontName:h.fontFamily,fontSize:h.fontSize});!h.wordWrap&&o.width>a&&(o.scale.x=a/o.width),"center"===n?o.anchor.set(.5,0):"right"===n&&o.anchor.set(1,0),o&&(o.x=e,o.y=i,o.tint=PIXI.utils.string2hex(this.textColor),o.alpha=s,o.isBitmapText=!0,this.textCache.push(o),this.addChild(o))}_makeBitmapFont(t){PIXI.BitmapFont.from(t.fontFamily,t,{chars:[[" ","~"],"",""]})}measureTextWidth(t){t=String(t);const e=new PIXI.TextStyle({fontFamily:this.fontFace,fontSize:this.fontSize,padding:this.textPadding});return PIXI.TextMetrics.measureText(t,e).width}create9Slice(t,e,i,s,a,r,n,h,o){return new PIXI.NineSlicePlane(new PIXI.Texture(t,new PIXI.Rectangle(e,i,s,a)),r,n,h,o)}createTilingSprite(t,e,i,s,a,r,n){return new PIXI.TilingSprite(new PIXI.Texture(t,new PIXI.Rectangle(e,i,s,a)),r,n)}createCroppedSprite(t,e,i,s,a){return new PIXI.Sprite(new PIXI.Texture(t,new PIXI.Rectangle(e,i,s,a)))}blt({width:t,height:e,baseTexture:i},s,a,r,n,h,o,l,c){if(l=l||r,c=c||n,s=Math.floor(s),a=Math.floor(a),r=Math.floor(r),n=Math.floor(n),h=Math.floor(h),o=Math.floor(o),l=Math.floor(l),c=Math.floor(c),s>=0&&a>=0&&r>0&&n>0&&l>0&&c>0&&s+r<=t&&a+n<=e){const t=this.createCroppedSprite(i,s,a,r,n);if(t)return t.x=h,t.y=o,t.width=l,t.height=c,t.alpha=this._paintOpacity/255,this.addChild(t),t}}fillRect(t,e,i,s,a){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),s=Math.floor(s);const r=new PIXI.Graphics;return a=PIXI.utils.string2hex(a),r.beginFill(a),r.drawRect(0,0,i,s),r.endFill(),r&&(r.x=t,r.y=e,r.alpha=this._paintOpacity/255,this.addChild(r)),r}gradientFillRect(t,e,i,s,a,r,n){return this.fillRect(t,e,i,s,a)}drawCircle(t,e,i,s){t=Math.floor(t),e=Math.floor(e);const a=new PIXI.Graphics;return s=PIXI.utils.string2hex(s),a.beginFill(s),a.drawCircle(0,0,i),a.endFill(),a&&(a.x=t,a.y=e,a.alpha=this._paintOpacity/255,this.addChild(a)),a}}class Sprite extends PIXI.Sprite{constructor(...t){super(),this.initialize(...t)}initialize(t){const e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,e),this.filters=null,this._bitmap=null,this._frame=new Rectangle,this._realFrame=new Rectangle,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._canvas=null,this._context=null,this._tintTexture=null,this._colorMatrixFilter=null,this.spriteId=Sprite._counter++,this.opaque=!1,this.bitmap=t}get bitmap(){return this._bitmap}set bitmap(t){this._bitmap!==t&&(this._bitmap=t,t?(this._refreshFrame=!0,t.addLoadListener(this._onBitmapLoad.bind(this))):(this._refreshFrame=!1,this.texture.frame=Rectangle.emptyRectangle))}get width(){return this._frame.width}set width(t){this._frame.width=t,this._refresh()}get height(){return this._frame.height}set height(t){this._frame.height=t,this._refresh()}get opacity(){return 255*this.alpha}set opacity(t){this.alpha=t.clamp(0,255)/255}update(){this.children.forEach((t=>{t.update&&t.update()}))}move(t,e){this.x=t,this.y=e}setFrame(t,e,i,s){this._refreshFrame=!1;const a=this._frame;t===a.x&&e===a.y&&i===a.width&&s===a.height||(a.x=t,a.y=e,a.width=i,a.height=s,this._refresh())}getBlendColor(){return this._blendColor.clone()}setBlendColor(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._blendColor.equals(t)||(this._blendColor=t.clone(),this._refresh())}getColorTone(){return this._colorTone.clone()}setColorTone(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._colorTone.equals(t)||(this._colorTone=t.clone(),this._refresh())}_onBitmapLoad(t){t===this._bitmap&&this._refreshFrame&&this._bitmap&&(this._refreshFrame=!1,this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()}_refresh(){const t=Math.floor(this._frame.x),e=Math.floor(this._frame.y),i=Math.floor(this._frame.width),s=Math.floor(this._frame.height),a=this._bitmap?this._bitmap.width:0,r=this._bitmap?this._bitmap.height:0,n=t.clamp(0,a),h=e.clamp(0,r),o=(i-n+t).clamp(0,a-n),l=(s-h+e).clamp(0,r-h);this._realFrame.x=n,this._realFrame.y=h,this._realFrame.width=o,this._realFrame.height=l,this.pivot.x=t-n,this.pivot.y=e-h,o>0&&l>0?this._needsTint()?Graphics$1.isWebGL()?(this._createTinterWebGL(),this._executeTintWebGL()):(this._createTinter(o,l),this._executeTint(n,h,o,l),this._tintTexture.update(),this.texture.baseTexture=this._tintTexture,this.texture.frame=new Rectangle(0,0,o,l)):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.frame=this._realFrame,this._clearTintWebGL()):this._bitmap?this.texture.frame=Rectangle.emptyRectangle:(this.texture.baseTexture.width=Math.max(this.texture.baseTexture.width,this._frame.x+this._frame.width),this.texture.baseTexture.height=Math.max(this.texture.baseTexture.height,this._frame.y+this._frame.height),this.texture.frame=this._frame),this.texture._updateID++}_isInBitmapRect(t,e,i,s){return this._bitmap&&t+i>0&&e+s>0&&t<this._bitmap.width&&e<this._bitmap.height}_needsTint(){const t=this._colorTone;return t[0]||t[1]||t[2]||t[3]||this._blendColor[3]>0}_createTinter(t,e){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=t,this._canvas.height=e,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=t,this._tintTexture.height=e,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode}_executeTint(t,e,i,s){const a=this._context,r=this._colorTone,n=this._blendColor;if(a.globalCompositeOperation="copy",a.drawImage(this._bitmap.canvas,t,e,i,s,0,0,i,s),r[0]||r[1]||r[2]||r[3]){if(Graphics$1.canUseSaturationBlend()){const t=Math.max(0,r[3]);a.globalCompositeOperation="saturation",a.fillStyle=`rgba(255,255,255,${t/255})`,a.fillRect(0,0,i,s)}const t=Math.max(0,r[0]),e=Math.max(0,r[1]),n=Math.max(0,r[2]);if(a.globalCompositeOperation="lighter",a.fillStyle=Utils.rgbToCssColor(t,e,n),a.fillRect(0,0,i,s),Graphics$1.canUseDifferenceBlend()){a.globalCompositeOperation="difference",a.fillStyle="white",a.fillRect(0,0,i,s);const t=Math.max(0,-r[0]),e=Math.max(0,-r[1]),n=Math.max(0,-r[2]);a.globalCompositeOperation="lighter",a.fillStyle=Utils.rgbToCssColor(t,e,n),a.fillRect(0,0,i,s),a.globalCompositeOperation="difference",a.fillStyle="white",a.fillRect(0,0,i,s)}}const h=Math.max(0,n[0]),o=Math.max(0,n[1]),l=Math.max(0,n[2]),c=Math.max(0,n[3]);a.globalCompositeOperation="source-atop",a.fillStyle=Utils.rgbToCssColor(h,o,l),a.globalAlpha=c/255,a.fillRect(0,0,i,s),a.globalCompositeOperation="destination-in",a.globalAlpha=1,a.drawImage(this._bitmap.canvas,t,e,i,s,0,0,i,s)}_createTinterWebGL(){this.filters||(this.filters=[]),this._colorMatrixFilter||(this._colorMatrixFilter=new PIXI.filters.ColorMatrixFilter,this.filters.push(this._colorMatrixFilter)),this._colorMatrixFilter.enabled=!0}_executeTintWebGL(){const t=this._blendColor,e=t[0]/255,i=t[1]/255,s=t[2]/255,a=t[3]/255;this._colorMatrixFilter.matrix=[e/64,0,0,0,e,0,i/64,0,0,i,0,0,s/64,0,s,0,0,0,1,0],this._colorMatrixFilter.alpha=a}_clearTintWebGL(){this._colorMatrixFilter&&(this._colorMatrixFilter.enabled=!1)}_renderCanvas(t){this.bitmap&&this.bitmap.touch(),this.bitmap&&!this.bitmap.isReady()||this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)}_render(t){this.bitmap&&this.bitmap.touch(),this.bitmap&&!this.bitmap.isReady()||this.texture.frame.width>0&&this.texture.frame.height>0&&(this._bitmap&&this._bitmap.checkDirty(),this._render_PIXI(t))}}Sprite.voidFilter=new PIXI.filters.AlphaFilter,Sprite._counter=0,Sprite.prototype._renderCanvas_PIXI=PIXI.Sprite.prototype._renderCanvas,Sprite.prototype._render_PIXI=PIXI.Sprite.prototype._render;class Tilemap extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._margin=20,this._width=Graphics$1.width+2*this._margin,this._height=Graphics$1.height+2*this._margin,this._tileWidth=48,this._tileHeight=48,this._mapWidth=0,this._mapHeight=0,this._mapData=null,this._layerWidth=0,this._layerHeight=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Point,this.flags=[],this.animationCount=0,this.horizontalWrap=!1,this.verticalWrap=!1,this._createLayers(),this.refresh()}get width(){return this._width}set width(t){this._width!==t&&(this._width=t,this._createLayers())}get height(){return this._height}set height(t){this._height!==t&&(this._height=t,this._createLayers())}get tileWidth(){return this._tileWidth}set tileWidth(t){this._tileWidth!==t&&(this._tileWidth=t,this._createLayers())}get tileHeight(){return this._tileHeight}set tileHeight(t){this._tileHeight!==t&&(this._tileHeight=t,this._createLayers())}setData(t,e,i){this._mapWidth=t,this._mapHeight=e,this._mapData=i}isReady(){for(let t=0;t<this.bitmaps.length;t++)if(this.bitmaps[t]&&!this.bitmaps[t].isReady())return!1;return!0}update(){this.animationCount++,this.animationFrame=Math.floor(this.animationCount/30),this.children.forEach((t=>{t.update&&t.update()}));for(let t=0;t<this.bitmaps.length;t++)this.bitmaps[t]&&this.bitmaps[t].touch()}refresh(){this._lastTiles.length=0}refreshTileset(){}updateTransform(){const t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),s=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,s),(this._needsRepaint||this._lastAnimationFrame!==this.animationFrame||this._lastStartX!==i||this._lastStartY!==s)&&(this._frameUpdated=this._lastAnimationFrame!==this.animationFrame,this._lastAnimationFrame=this.animationFrame,this._lastStartX=i,this._lastStartY=s,this._paintAllTiles(i,s),this._needsRepaint=!1),this._sortChildren(),super.updateTransform()}_createLayers(){const t=this._width,e=this._height,i=this._margin,s=Math.ceil(t/this._tileWidth)+1,a=Math.ceil(e/this._tileHeight)+1,r=s*this._tileWidth,n=a*this._tileHeight;this._lowerBitmap=new Bitmap(r,n),this._upperBitmap=new Bitmap(r,n),this._layerWidth=r,this._layerHeight=n,this._lowerLayer=new Sprite,this._lowerLayer.move(-i,-i,t,e),this._lowerLayer.z=0,this._upperLayer=new Sprite,this._upperLayer.move(-i,-i,t,e),this._upperLayer.z=4;for(let t=0;t<4;t++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)}_updateLayerPositions(t,e){const i=this._margin,s=Math.floor(this.origin.x),a=Math.floor(this.origin.y),r=(s-i).mod(this._layerWidth),n=(a-i).mod(this._layerHeight),h=this._layerWidth-r,o=this._layerHeight-n,l=this._width-h,c=this._height-o;for(let t=0;t<2;t++){let e;e=0===t?this._lowerLayer.children:this._upperLayer.children,e[0].move(0,0,h,o),e[0].setFrame(r,n,h,o),e[1].move(h,0,l,o),e[1].setFrame(0,n,l,o),e[2].move(0,o,h,c),e[2].setFrame(r,0,h,c),e[3].move(h,o,l,c),e[3].setFrame(0,0,l,c)}}_paintAllTiles(t,e){const i=Math.ceil(this._width/this._tileWidth)+1,s=Math.ceil(this._height/this._tileHeight)+1;for(let a=0;a<s;a++)for(let s=0;s<i;s++)this._paintTiles(t,e,s,a)}_paintTiles(t,e,i,s){const a=t+i,r=e+s,n=(a*this._tileWidth).mod(this._layerWidth),h=(r*this._tileHeight).mod(this._layerHeight),o=n/this._tileWidth,l=h/this._tileHeight,c=this._readMapData(a,r,0),d=this._readMapData(a,r,1),m=this._readMapData(a,r,2),u=this._readMapData(a,r,3),p=this._readMapData(a,r,4),_=this._readMapData(a,r-1,1),g=[],f=[];this._isHigherTile(c)?f.push(c):g.push(c),this._isHigherTile(d)?f.push(d):g.push(d),g.push(-p),this._isTableTile(_)&&!this._isTableTile(d)&&(Tilemap.isShadowingTile(c)||g.push(1e4+_)),this._isOverpassPosition(a,r)?(f.push(m),f.push(u)):(this._isHigherTile(m)?f.push(m):g.push(m),this._isHigherTile(u)?f.push(u):g.push(u));const w=this._readLastTiles(0,o,l);if(!g.equals(w)||Tilemap.isTileA1(c)&&this._frameUpdated){this._lowerBitmap.clearRect(n,h,this._tileWidth,this._tileHeight);for(const t of g)t<0?this._drawShadow(this._lowerBitmap,p,n,h):t>=1e4?this._drawTableEdge(this._lowerBitmap,_,n,h):this._drawTile(this._lowerBitmap,t,n,h);this._writeLastTiles(0,o,l,g)}const y=this._readLastTiles(1,o,l);if(!f.equals(y)){this._upperBitmap.clearRect(n,h,this._tileWidth,this._tileHeight);for(let t=0;t<f.length;t++)this._drawTile(this._upperBitmap,f[t],n,h);this._writeLastTiles(1,o,l,f)}}_readLastTiles(t,e,i){const s=this._lastTiles[t];if(s){const t=s[i];if(t){const i=t[e];if(i)return i}}return[]}_writeLastTiles(t,e,i,s){let a=this._lastTiles[t];a||(a=this._lastTiles[t]=[]);let r=a[i];r||(r=a[i]=[]),r[e]=s}_drawTile(t,e,i,s){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,s):this._drawNormalTile(t,e,i,s))}_drawNormalTile(t,e,i,s){let a=0;a=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);const r=this._tileWidth,n=this._tileHeight,h=(Math.floor(e/128)%2*8+e%8)*r,o=Math.floor(e%256/8)%16*n,l=this.bitmaps[a];l&&t.bltImage(l,h,o,r,n,i,s,r,n)}_drawAutotile(t,e,i,s){let a=Tilemap.FLOOR_AUTOTILE_TABLE;const r=Tilemap.getAutotileKind(e),n=Tilemap.getAutotileShape(e),h=r%8,o=Math.floor(r/8);let l=0,c=0,d=0,m=!1;if(Tilemap.isTileA1(e)){const t=[0,1,2,1][this.animationFrame%4];d=0,0===r?(l=2*t,c=0):1===r?(l=2*t,c=3):2===r?(l=6,c=0):3===r?(l=6,c=3):(l=8*Math.floor(h/4),c=6*o+Math.floor(h/2)%2*3,r%2==0?l+=2*t:(l+=6,a=Tilemap.WATERFALL_AUTOTILE_TABLE,c+=this.animationFrame%3))}else Tilemap.isTileA2(e)?(d=1,l=2*h,c=3*(o-2),m=this._isTableTile(e)):Tilemap.isTileA3(e)?(d=2,l=2*h,c=2*(o-6),a=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(d=3,l=2*h,c=Math.floor(2.5*(o-10)+(o%2==1?.5:0)),o%2==1&&(a=Tilemap.WALL_AUTOTILE_TABLE));const u=a[n],p=this.bitmaps[d];if(u&&p){const e=this._tileWidth/2,a=this._tileHeight/2;for(let r=0;r<4;r++){const n=u[r][0],h=u[r][1],o=(2*l+n)*e,d=(2*c+h)*a,_=i+r%2*e;let g=s+Math.floor(r/2)*a;if(!m||1!==h&&5!==h)t.bltImage(p,o,d,e,a,_,g,e,a);else{let i=n;1===h&&(i=[0,3,2,1][n]);const s=(2*l+i)*e,r=(2*c+3)*a;t.bltImage(p,s,r,e,a,_,g,e,a),g+=a/2,t.bltImage(p,o,d,e,a/2,_,g,e,a/2)}}}}_drawTableEdge(t,e,i,s){if(Tilemap.isTileA2(e)){const a=Tilemap.FLOOR_AUTOTILE_TABLE,r=Tilemap.getAutotileKind(e),n=Tilemap.getAutotileShape(e),h=1,o=r%8*2,l=3*(Math.floor(r/8)-2),c=a[n];if(c){const e=this.bitmaps[h],a=this._tileWidth/2,r=this._tileHeight/2;for(let n=0;n<2;n++){const h=(2*o+c[2+n][0])*a,d=(2*l+c[2+n][1])*r+r/2,m=i+n%2*a,u=s+Math.floor(n/2)*r;t.bltImage(e,h,d,a,r/2,m,u,a,r/2)}}}}_drawShadow(t,e,i,s){if(15&e){const a=this._tileWidth/2,r=this._tileHeight/2,n="rgba(0,0,0,0.5)";for(let h=0;h<4;h++)if(e&1<<h){const e=i+h%2*a,o=s+Math.floor(h/2)*r;t.fillRect(e,o,a,r,n)}}}_readMapData(t,e,i){if(this._mapData){const s=this._mapWidth,a=this._mapHeight;return this.horizontalWrap&&(t=t.mod(s)),this.verticalWrap&&(e=e.mod(a)),t>=0&&t<s&&e>=0&&e<a&&this._mapData[(i*a+e)*s+t]||0}return 0}_isHigherTile(t){return 16&this.flags[t]}_isTableTile(t){return Tilemap.isTileA2(t)&&128&this.flags[t]}_isOverpassPosition(t,e){return!1}_sortChildren(){this.children.sort(this._compareChildOrder.bind(this))}_compareChildOrder(t,e){return t.z===e.z?t.y===e.y?t.spriteId-e.spriteId:t.y-e.y:t.z-e.z}static isVisibleTile(t){return t>0&&t<this.TILE_ID_MAX}static isAutotile(t){return t>=this.TILE_ID_A1}static getAutotileKind(t){return Math.floor((t-this.TILE_ID_A1)/48)}static getAutotileShape(t){return(t-this.TILE_ID_A1)%48}static makeAutotileId(t,e){return this.TILE_ID_A1+48*t+e}static isSameKindTile(t,e){return this.isAutotile(t)&&this.isAutotile(e)?this.getAutotileKind(t)===this.getAutotileKind(e):t===e}static isTileA1(t){return t>=this.TILE_ID_A1&&t<this.TILE_ID_A2}static isTileA2(t){return t>=this.TILE_ID_A2&&t<this.TILE_ID_A3}static isTileA3(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4}static isTileA4(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX}static isTileA5(t){return t>=this.TILE_ID_A5&&t<this.TILE_ID_A1}static isWaterTile(t){return!(!this.isTileA1(t)||t>=this.TILE_ID_A1+96&&t<this.TILE_ID_A1+192)}static isWaterfallTile(t){return t>=this.TILE_ID_A1+192&&t<this.TILE_ID_A2&&this.getAutotileKind(t)%2==1}static isGroundTile(t){return this.isTileA1(t)||this.isTileA2(t)||this.isTileA5(t)}static isShadowingTile(t){return this.isTileA3(t)||this.isTileA4(t)}static isRoofTile(t){return this.isTileA3(t)&&this.getAutotileKind(t)%16<8}static isWallTopTile(t){return this.isTileA4(t)&&this.getAutotileKind(t)%16<8}static isWallSideTile(t){return(this.isTileA3(t)||this.isTileA4(t))&&this.getAutotileKind(t)%16>=8}static isWallTile(t){return this.isWallTopTile(t)||this.isWallSideTile(t)}static isFloorTypeAutotile(t){return this.isTileA1(t)&&!this.isWaterfallTile(t)||this.isTileA2(t)||this.isWallTopTile(t)}static isWallTypeAutotile(t){return this.isRoofTile(t)||this.isWallSideTile(t)}static isWaterfallTypeAutotile(t){return this.isWaterfallTile(t)}}Tilemap.TILE_ID_B=0,Tilemap.TILE_ID_C=256,Tilemap.TILE_ID_D=512,Tilemap.TILE_ID_E=768,Tilemap.TILE_ID_A5=1536,Tilemap.TILE_ID_A1=2048,Tilemap.TILE_ID_A2=2816,Tilemap.TILE_ID_A3=4352,Tilemap.TILE_ID_A4=5888,Tilemap.TILE_ID_MAX=8192,Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]];class ShaderTilemap extends Tilemap{constructor(...t){super(...t),this.roundPixels=!0}_hackRenderer(t){let e=this.animationFrame%4;return 3==e&&(e=1),t.plugins.tilemap.tileAnim[0]=e*this._tileWidth,t.plugins.tilemap.tileAnim[1]=this.animationFrame%3*this._tileHeight,t}renderCanvas(t){this._hackRenderer(t),PIXI.Container.prototype.renderCanvas.call(this,t)}render(t){this._hackRenderer(t),PIXI.Container.prototype.render.call(this,t)}refresh(){this._lastBitmapLength!==this.bitmaps.length&&(this._lastBitmapLength=this.bitmaps.length,this.refreshTileset()),this._needsRepaint=!0}refreshTileset(){const t=this.bitmaps.map((t=>t._baseTexture?new PIXI.Texture(t._baseTexture):t));this.lowerLayer.setBitmaps(t),this.upperLayer.setBitmaps(t)}updateTransform(){const t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),s=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,s),(this._needsRepaint||this._lastStartX!==i||this._lastStartY!==s)&&(this._lastStartX=i,this._lastStartY=s,this._paintAllTiles(i,s),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)}_createLayers(){this._needsRepaint=!0,this.lowerZLayer||(this.addChild(this.lowerZLayer=new PIXI.tilemap.ZLayer(this,0)),this.addChild(this.upperZLayer=new PIXI.tilemap.ZLayer(this,4)),this.lowerZLayer.addChild(this.lowerLayer=new PIXI.tilemap.CompositeRectTileLayer(0,[])),this.lowerLayer.shadowColor=new Float32Array([0,0,0,.5]),this.upperZLayer.addChild(this.upperLayer=new PIXI.tilemap.CompositeRectTileLayer(4,[])))}_updateLayerPositions(t,e){const i=Math.floor(this.origin.x),s=Math.floor(this.origin.y);this.lowerZLayer.position.x=t*this._tileWidth-i,this.lowerZLayer.position.y=e*this._tileHeight-s,this.upperZLayer.position.x=t*this._tileWidth-i,this.upperZLayer.position.y=e*this._tileHeight-s}_paintAllTiles(t,e){this.lowerZLayer.clear(),this.upperZLayer.clear();const i=Math.ceil(this._width/this._tileWidth)+1,s=Math.ceil(this._height/this._tileHeight)+1;for(let a=0;a<s;a++)for(let s=0;s<i;s++)this._paintTiles(t,e,s,a)}_paintTiles(t,e,i,s){const a=t+i,r=e+s,n=i*this._tileWidth,h=s*this._tileHeight,o=this._readMapData(a,r,0),l=this._readMapData(a,r,1),c=this._readMapData(a,r,2),d=this._readMapData(a,r,3),m=this._readMapData(a,r,4),u=this._readMapData(a,r-1,1),p=this.lowerLayer.children[0],_=this.upperLayer.children[0];this._isHigherTile(o)?this._drawTile(_,o,n,h):this._drawTile(p,o,n,h),this._isHigherTile(l)?this._drawTile(_,l,n,h):this._drawTile(p,l,n,h),this._drawShadow(p,m,n,h),this._isTableTile(u)&&!this._isTableTile(l)&&(Tilemap.isShadowingTile(o)||this._drawTableEdge(p,u,n,h)),this._isOverpassPosition(a,r)?(this._drawTile(_,c,n,h),this._drawTile(_,d,n,h)):(this._isHigherTile(c)?this._drawTile(_,c,n,h):this._drawTile(p,c,n,h),this._isHigherTile(d)?this._drawTile(_,d,n,h):this._drawTile(p,d,n,h))}_drawTile(t,e,i,s){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,s):this._drawNormalTile(t,e,i,s))}_drawNormalTile(t,e,i,s){let a=0;a=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);const r=this._tileWidth,n=this._tileHeight,h=(Math.floor(e/128)%2*8+e%8)*r,o=Math.floor(e%256/8)%16*n;t.addRect(a,h,o,i,s,r,n)}_drawAutotile(t,e,i,s){let a=Tilemap.FLOOR_AUTOTILE_TABLE;const r=Tilemap.getAutotileKind(e),n=Tilemap.getAutotileShape(e),h=r%8,o=Math.floor(r/8);let l=0,c=0,d=0,m=!1,u=0,p=0;Tilemap.isTileA1(e)?(d=0,0===r?(u=2,c=0):1===r?(u=2,c=3):2===r?(l=6,c=0):3===r?(l=6,c=3):(l=8*Math.floor(h/4),c=6*o+Math.floor(h/2)%2*3,r%2==0?u=2:(l+=6,a=Tilemap.WATERFALL_AUTOTILE_TABLE,p=1))):Tilemap.isTileA2(e)?(d=1,l=2*h,c=3*(o-2),m=this._isTableTile(e)):Tilemap.isTileA3(e)?(d=2,l=2*h,c=2*(o-6),a=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(d=3,l=2*h,c=Math.floor(2.5*(o-10)+(o%2==1?.5:0)),o%2==1&&(a=Tilemap.WALL_AUTOTILE_TABLE));const _=a[n],g=this._tileWidth/2,f=this._tileHeight/2;for(let e=0;e<4;e++){const a=_[e][0],r=_[e][1],n=(2*l+a)*g,h=(2*c+r)*f,o=i+e%2*g,w=s+Math.floor(e/2)*f;if(!m||1!==r&&5!==r)t.addRect(d,n,h,o,w,g,f,u,p);else{let e=a;1===r&&(e=(4-a)%4);const i=(2*l+e)*g,s=(2*c+3)*f;t.addRect(d,i,s,o,w,g,f,u,p),t.addRect(d,n,h,o,w+f/2,g,f/2,u,p)}}}_drawTableEdge(t,e,i,s){if(Tilemap.isTileA2(e)){const a=Tilemap.FLOOR_AUTOTILE_TABLE,r=Tilemap.getAutotileKind(e),n=Tilemap.getAutotileShape(e),h=1,o=r%8*2,l=3*(Math.floor(r/8)-2),c=a[n],d=this._tileWidth/2,m=this._tileHeight/2;for(let e=0;e<2;e++){const a=(2*o+c[2+e][0])*d,r=(2*l+c[2+e][1])*m+m/2,n=i+e%2*d,u=s+Math.floor(e/2)*m;t.addRect(h,a,r,n,u,d,m/2)}}}_drawShadow(t,e,i,s){if(15&e){const a=this._tileWidth/2,r=this._tileHeight/2;for(let n=0;n<4;n++)if(e&1<<n){const e=i+n%2*a,h=s+Math.floor(n/2)*r;t.addRect(-1,0,0,e,h,a,r)}}}}PIXI.tilemap.Constant.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,PIXI.tilemap.Constant.DO_CLEAR=!0,PIXI.tilemap.Constant.boundCountPerBuffer=4,PIXI.tilemap.Constant.maxTextures=4;class TilingSprite extends PIXI.TilingSprite{constructor(...t){super(...t),this.initialize(...t)}initialize(t){const e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.TilingSprite.call(this,e),this._bitmap=null,this._width=0,this._height=0,this._frame=new Rectangle,this.spriteId=Sprite._counter++,this.origin=new Point,this.bitmap=t}_renderCanvas(t){this._bitmap&&this._bitmap.touch(),this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)}get bitmap(){return this._bitmap}set bitmap(t){this._bitmap!==t&&(this._bitmap=t,this._bitmap?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.frame=Rectangle.emptyRectangle)}get opacity(){return 255*this.alpha}set opacity(t){this.alpha=t.clamp(0,255)/255}update(){this.children.forEach((t=>{t.update&&t.update()}))}move(t,e,i,s){this.x=t||0,this.y=e||0,this._width=i||0,this._height=s||0}setFrame(t,e,i,s){this._frame.x=t,this._frame.y=e,this._frame.width=i,this._frame.height=s,this._refresh()}updateTransform(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.updateTransformTS()}_onBitmapLoad(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()}_refresh(){const t=this._frame.clone();0===t.width&&0===t.height&&this._bitmap&&(t.width=this._bitmap.width,t.height=this._bitmap.height),this.texture.frame=t,this.texture._updateID++,this.tilingTexture=null}_render(t){this._bitmap&&(this._bitmap.touch(),this._bitmap.checkDirty()),this._render_PIXI(t)}}TilingSprite.prototype._renderCanvas_PIXI=PIXI.TilingSprite.prototype._renderCanvas,TilingSprite.prototype._render_PIXI=PIXI.TilingSprite.prototype._render,TilingSprite.prototype.updateTransformTS=PIXI.TilingSprite.prototype.updateTransform;class ScreenSprite extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._graphics=new PIXI.Graphics,this.addChild(this._graphics),this.opacity=0,this._red=-1,this._green=-1,this._blue=-1,this._colorText="",this.setBlack()}get opacity(){return 255*this.alpha}set opacity(t){this.alpha=t.clamp(0,255)/255}get anchor(){return ScreenSprite.warnYep(),this.scale.x=1,this.scale.y=1,{x:0,y:0}}set anchor(t){this.alpha=t.clamp(0,255)/255}get blendMode(){return this._graphics.blendMode}set blendMode(t){this._graphics.blendMode=t}setBlack(){this.setColor(0,0,0)}setWhite(){this.setColor(255,255,255)}setColor(t,e,i){if(this._red!==t||this._green!==e||this._blue!==i){t=Math.round(t||0).clamp(0,255),e=Math.round(e||0).clamp(0,255),i=Math.round(i||0).clamp(0,255),this._red=t,this._green=e,this._blue=i,this._colorText=Utils.rgbToCssColor(t,e,i);const s=this._graphics;s.clear();const a=t<<16|e<<8|i;s.beginFill(a,1),s.drawRect(5*-Graphics$1.width,5*-Graphics$1.height,10*Graphics$1.width,10*Graphics$1.height)}}}class WindowSkinCache{constructor(){throw new Error("This is a static class")}static setItem(t,e,i){WindowSkinCache._cache[t]||(WindowSkinCache._cache[t]={}),WindowSkinCache._cache[t][i]=e}static getItem(t,e){return!!WindowSkinCache._cache[t]&&!!WindowSkinCache._cache[t][e]&&WindowSkinCache._cache[t][e]}}WindowSkinCache._cache={};class Window extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._isWindow=!0,this._windowskin=null,this._width=0,this._height=0,this._cursorRect=new Rectangle,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowSpriteContainer=null,this._windowBackSprite=null,this._windowCursorSprite=null,this._windowFrameSprite=null,this._windowContentsSprite=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Point,this.active=!0,this.downArrowVisible=!1,this.upArrowVisible=!1,this.pause=!1}get windowskin(){return this._windowskin}set windowskin(t){this._windowskin!==t&&(this._windowskin=t,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))}get contents(){return this._windowContentsSprite.children[0]}set contents(t){const e=this._windowContentsSprite.children[0];e&&this._windowContentsSprite.removeChild(e),this._windowContentsSprite.addChild(t)}get width(){return this._width}set width(t){this._width=t,this._refreshAllParts()}get height(){return this._height}set height(t){this._height=t,this._refreshAllParts()}get padding(){return this._padding}set padding(t){this._padding=t,this._refreshAllParts()}get margin(){return this._margin}set margin(t){this._margin=t,this._refreshAllParts()}get opacity(){return 255*this._windowSpriteContainer.alpha}set opacity(t){this._windowSpriteContainer.alpha=t.clamp(0,255)/255}get backOpacity(){return 255*this._windowBackSprite.alpha}set backOpacity(t){this._windowBackSprite.alpha=t.clamp(0,255)/255}get contentsOpacity(){return 255*this._windowContentsSprite.alpha}set contentsOpacity(t){this._windowContentsSprite.alpha=t.clamp(0,255)/255}get openness(){return this._openness}set openness(t){this._openness!==t&&(this._openness=t.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))}update(){this.active&&this._animationCount++,this.children.forEach((t=>{t.update&&t.update()}))}move(t,e,i,s){this.x=Math.floor(t||0),this.y=Math.floor(e||0),this._width===i&&this._height===s||(this._width=Math.floor(i||0),this._height=Math.floor(s||0),this._refreshAllParts())}isOpen(){return this._openness>=255}isClosed(){return this._openness<=0}setCursorRect(t,e,i,s){const a=Math.floor(t||0),r=Math.floor(e||0),n=Math.floor(i||0),h=Math.floor(s||0),o=this._cursorRect;o.x===a&&o.y===r&&o.width===n&&o.height===h||(this._cursorRect.x=a,this._cursorRect.y=r,this._cursorRect.width=n,this._cursorRect.height=h,this._refreshCursor())}setTone(t,e,i){const s=this._colorTone;(t/=255)<0&&(t=0),(e/=255)<0&&(e=0),(i/=255)<0&&(i=0),t===s[0]&&e===s[1]&&i===s[2]||(this._colorTone=[t,e,i],this._refreshBack())}addChildToBack(t){const e=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(t,e+1)}updateTransform(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),super.updateTransform()}_createAllParts(){this._windowSpriteContainer=new PIXI.Container,this._windowBackSprite=new BitmapPIXI,this._windowCursorSprite=new BitmapPIXI,this._windowFrameSprite=new PIXI.Container,this._windowContentsSprite=new Sprite,this._downArrowSprite=new Sprite,this._upArrowSprite=new Sprite,this._windowPauseSignSprite=new Sprite,this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)}_onWindowskinLoad(){this._refreshAllParts()}_refreshAllParts(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()}_refreshBack(){const t=this._margin,e=this._width-2*t,i=this._height-2*t,s=PIXI.utils.rgb2hex(this._colorTone);if(e>0&&i>0&&this._windowskin&&!this._windowBackSprite._setupComplete){const t=96;this._windowBackSprite.blt(this._windowskin,0,0,t,t,0,0,e,i),this._windowBackSprite.addChild(this._windowBackSprite.createTilingSprite(this._windowskin.baseTexture,0,t,t,t,e,i)),this._windowBackSprite._setupComplete=!0}this._windowBackSprite.width=e,this._windowBackSprite.height=i,this._windowBackSprite.x=t,this._windowBackSprite.y=t,this._windowBackSprite.children.forEach((t=>{t&&(t.width=e,t.height=i,t.tint=s)}))}_refreshFrame(){const t=this._width,e=this._height,i=24;if(t>0&&e>0&&this._windowskin&&!this._windowFrameSprite._setupComplete){let s;const a=WindowSkinCache.getItem(this._windowskin._url,"frame");if(a)s=a;else{const a=new BitmapPIXI,r=this._windowskin,n=96,h=96;a.blt(r,n+i,0,n-48,i,i,0,t-48,i),a.blt(r,n+i,0+h-i,n-48,i,i,e-i,t-48,i),a.blt(r,n+0,24,i,n-48,0,i,i,e-48),a.blt(r,n+h-i,24,i,n-48,t-i,i,i,e-48),a.blt(r,n+0,0,i,i,0,0,i,i),a.blt(r,n+h-i,0,i,i,t-i,0,i,i),a.blt(r,n+0,0+h-i,i,i,0,e-i,i,i),a.blt(r,n+h-i,0+h-i,i,i,t-i,e-i,i,i),s=Graphics$1._renderer.generateTexture(a),a.destroy({children:!0,texture:!0}),WindowSkinCache.setItem(this._windowskin._url,s,"frame")}this._windowFramePlane=new PIXI.NineSlicePlane(s,12,12,12,12),this._windowFrameSprite.addChild(this._windowFramePlane),this._windowFrameSprite._setupComplete=!0}this._windowFrameSprite._setupComplete&&(this._windowFramePlane.width=t,this._windowFramePlane.height=e)}_refreshCursor(){const t=this._padding,e=this._cursorRect.x+t-this.origin.x,i=this._cursorRect.y+t-this.origin.y,s=this._cursorRect.width,a=this._cursorRect.height;if(s>0&&a>0&&this._windowskin&&!this._windowCursorSprite._setupComplete){const t=96,e=48;this._windowCursorPlane=this._windowCursorSprite.create9Slice(this._windowskin.baseTexture,t,t,e,e,12,12,12,12),this._windowCursorSprite.addChild(this._windowCursorPlane),this._windowCursorSprite._setupComplete=!0}this._windowCursorPlane&&(this._windowCursorPlane.x=e,this._windowCursorPlane.y=i,this._windowCursorPlane.width=s,this._windowCursorPlane.height=a)}_refreshContents(){this._windowContentsSprite.move(this.padding,this.padding),this._windowContentsSprite.children.length&&this._windowContentsSprite.children[0].clear()}_refreshArrows(){const t=this._width,e=this._height;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(132,60,24,12),this._downArrowSprite.move(t/2,e-12),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(132,24,24,12),this._upArrowSprite.move(t/2,12)}_refreshPauseSign(){this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(144,96,24,24),this._windowPauseSignSprite.alpha=0}_updateCursor(){const t=this._animationCount%40;let e=this.contentsOpacity;this.active&&(e-=t<20?8*t:8*(40-t)),this._windowCursorSprite.alpha=e/255,this._windowCursorSprite.visible=this.isOpen()}_updateContents(){const t=this._width-2*this._padding,e=this._height-2*this._padding;t>0&&e>0?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,t,e),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1}_updateArrows(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible}_updatePauseSign(){const t=this._windowPauseSignSprite,e=Math.floor(this._animationCount/16)%2,i=Math.floor(this._animationCount/16/2)%2;this.pause?t.alpha<1&&(t.alpha=Math.min(t.alpha+.1,1)):t.alpha=0,t.setFrame(144+24*e,96+24*i,24,24),t.visible=this.isOpen()}}class WindowLayer extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._width=0,this._height=0,this.on("removed",this.onRemoveAsAChild)}onRemoveAsAChild(){this.removeChildren()}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}move(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}update(){this.children.forEach((t=>{t.update&&t.update()}))}}WindowLayer.voidFilter=new PIXI.filters.AlphaFilter,WindowLayer.prototype.render=PIXI.Container.prototype.render,WindowLayer.prototype.renderCanvas=PIXI.Container.prototype.renderCanvas;class Weather extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._width=Graphics$1.width,this._height=Graphics$1.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Point}update(){this._updateDimmer(),this._updateAllSprites()}_createBitmaps(){this._rainBitmap=new Bitmap(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new Bitmap(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new Bitmap(9,9),this._snowBitmap.drawCircle(4,4,4,"white")}_createDimmer(){this._dimmerSprite=new ScreenSprite,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)}_updateDimmer(){this._dimmerSprite.opacity=Math.floor(6*this.power)}_updateAllSprites(){const t=Math.floor(10*this.power);for(;this._sprites.length<t;)this._addSprite();for(;this._sprites.length>t;)this._removeSprite();this._sprites.forEach((function(t){this._updateSprite(t),t.x=t.ax-this.origin.x,t.y=t.ay-this.origin.y}),this)}_addSprite(){const t=new Sprite(this.viewport);t.opacity=0,this._sprites.push(t),this.addChild(t)}_removeSprite(){this.removeChild(this._sprites.pop())}_updateSprite(t){switch(this.type){case"rain":this._updateRainSprite(t);break;case"storm":this._updateStormSprite(t);break;case"snow":this._updateSnowSprite(t)}t.opacity<40&&this._rebornSprite(t)}_updateRainSprite(t){t.bitmap=this._rainBitmap,t.rotation=Math.PI/16,t.ax-=6*Math.sin(t.rotation),t.ay+=6*Math.cos(t.rotation),t.opacity-=6}_updateStormSprite(t){t.bitmap=this._stormBitmap,t.rotation=Math.PI/8,t.ax-=8*Math.sin(t.rotation),t.ay+=8*Math.cos(t.rotation),t.opacity-=8}_updateSnowSprite(t){t.bitmap=this._snowBitmap,t.rotation=Math.PI/16,t.ax-=3*Math.sin(t.rotation),t.ay+=3*Math.cos(t.rotation),t.opacity-=3}_rebornSprite(t){t.ax=Math.randomInt(Graphics$1.width+100)-100+this.origin.x,t.ay=Math.randomInt(Graphics$1.height+200)-200+this.origin.y,t.opacity=160+Math.randomInt(60)}}class ToneFilter extends PIXI.filters.ColorMatrixFilter{constructor(){super()}adjustHue(t){this.hue(t,!0)}adjustSaturation(t){t=(t||0).clamp(-255,255)/255,this.saturate(t,!0)}adjustTone(t,e,i){if(t=(t||0).clamp(-255,255)/255,e=(e||0).clamp(-255,255)/255,i=(i||0).clamp(-255,255)/255,0!==t||0!==e||0!==i){const s=[1,0,0,t,0,0,1,0,e,0,0,0,1,i,0,0,0,0,1,0];this._loadMatrix(s,!0)}}}class ToneSprite extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this.clear()}clear(){this._red=0,this._green=0,this._blue=0,this._gray=0}setTone(t,e,i,s){this._red=Math.round(t||0).clamp(-255,255),this._green=Math.round(e||0).clamp(-255,255),this._blue=Math.round(i||0).clamp(-255,255),this._gray=Math.round(s||0).clamp(0,255)}_renderCanvas(t){if(this.visible){const e=t.context,i=this.worldTransform,s=t.resolution,a=Graphics$1.width,r=Graphics$1.height;e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx*s,i.ty*s),Graphics$1.canUseSaturationBlend()&&this._gray>0&&(e.globalCompositeOperation="saturation",e.globalAlpha=this._gray/255,e.fillStyle="#ffffff",e.fillRect(0,0,a,r)),e.globalAlpha=1;const n=Math.max(0,this._red),h=Math.max(0,this._green),o=Math.max(0,this._blue);if((n||h||o)&&(e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(n,h,o),e.fillRect(0,0,a,r)),Graphics$1.canUseDifferenceBlend()){const t=Math.max(0,-this._red),i=Math.max(0,-this._green),s=Math.max(0,-this._blue);(t||i||s)&&(e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,a,r),e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(t,i,s),e.fillRect(0,0,a,r),e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,a,r))}e.restore()}}_render(t){}}class Stage extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this.interactive=!1}}class JsonEx{constructor(){throw new Error("This is a static class")}static stringify(t){return JSON.stringify(this._encode(t,[],0))}static parse(t){return this._decode(JSON.parse(t),[],{})}static makeDeepCopy(t){return this.parse(this.stringify(t))}static _encode(t,e,i=0){if(++i>=this.maxDepth)throw new Error("Object too deep");const s=Object.prototype.toString.call(t);if("[object Object]"===s||"[object Array]"===s){const s=t.constructor.name;"Object"!==s&&"Array"!==s&&(t["@"]=s);for(let s in t)t[s]=this._encode(t[s],e,i+1)}return i--,t}static _decode(t,e,i){const s=Object.prototype.toString.call(t);if("[object Object]"===s||"[object Array]"===s){const s=window[t["@"]];s&&Object.setPrototypeOf(t,s.prototype);for(let s in t)t[s]=this._decode(t[s],e,i)}return t}static _generateId(){}static _restoreCircularReference(t){}static _linkCircularReference(t,e,i){}static _cleanMetadata(t){}static _getConstructorName(){}static _resetPrototype(t,e){}}JsonEx.maxDepth=100,JsonEx._id=1;class StorageManager{constructor(){throw new Error("This is a static class")}static save(t,e){this.isLocalMode()?this.saveToLocalFile(t,e):this.saveToWebStorage(t,e)}static load(t){return this.isLocalMode()?this.loadFromLocalFile(t):this.loadFromWebStorage(t)}static exists(t){return this.isLocalMode()?this.localFileExists(t):this.webStorageExists(t)}static remove(t){this.isLocalMode()?this.removeLocalFile(t):this.removeWebStorage(t)}static backup(t){if(this.exists(t))if(this.isLocalMode()){const e=this.loadFromLocalFile(t),i=LZString.compressToBase64(e),s=require("fs"),a=this.localFileDirectoryPath(),r=`${this.localFilePath(t)}.bak`;s.existsSync(a)||s.mkdirSync(a),s.writeFileSync(r,i)}else{const e=this.loadFromWebStorage(t),i=LZString.compressToBase64(e),s=`${this.webStorageKey(t)}bak`;localStorage.setItem(s,i)}}static backupExists(t){return this.isLocalMode()?this.localFileBackupExists(t):this.webStorageBackupExists(t)}static cleanBackup(t){if(this.backupExists(t))if(this.isLocalMode()){const e=require("fs"),i=this.localFilePath(t);e.unlinkSync(`${i}.bak`)}else{const e=this.webStorageKey(t);localStorage.removeItem(`${e}bak`)}}static restoreBackup(t){if(this.backupExists(t))if(this.isLocalMode()){const e=this.loadFromLocalBackupFile(t),i=LZString.compressToBase64(e),s=require("fs"),a=this.localFileDirectoryPath(),r=this.localFilePath(t);s.existsSync(a)||s.mkdirSync(a),s.writeFileSync(r,i),s.unlinkSync(`${r}.bak`)}else{const e=this.loadFromWebStorageBackup(t),i=LZString.compressToBase64(e),s=this.webStorageKey(t);localStorage.setItem(s,i),localStorage.removeItem(`${s}bak`)}}static saveToLocalFile(t,e){const i=LZString.compressToBase64(e),s=require("fs"),a=this.localFileDirectoryPath(),r=this.localFilePath(t);s.existsSync(a)||s.mkdirSync(a),s.writeFileSync(r,i)}static loadFromLocalFile(t){let e=null;const i=require("fs"),s=this.localFilePath(t);return i.existsSync(s)&&(e=i.readFileSync(s,{encoding:"utf8"})),LZString.decompressFromBase64(e)}static loadFromLocalBackupFile(t){let e=null;const i=require("fs"),s=`${this.localFilePath(t)}.bak`;return i.existsSync(s)&&(e=i.readFileSync(s,{encoding:"utf8"})),LZString.decompressFromBase64(e)}static localFileBackupExists(t){return require("fs").existsSync(`${this.localFilePath(t)}.bak`)}static localFileExists(t){return require("fs").existsSync(this.localFilePath(t))}static removeLocalFile(t){const e=require("fs"),i=this.localFilePath(t);e.existsSync(i)&&e.unlinkSync(i)}static saveToWebStorage(t,e){const i=this.webStorageKey(t),s=LZString.compressToBase64(e);localStorage.setItem(i,s)}static loadFromWebStorage(t){const e=this.webStorageKey(t),i=localStorage.getItem(e);return LZString.decompressFromBase64(i)}static loadFromWebStorageBackup(t){const e=`${this.webStorageKey(t)}bak`,i=localStorage.getItem(e);return LZString.decompressFromBase64(i)}static webStorageBackupExists(t){const e=`${this.webStorageKey(t)}bak`;return!!localStorage.getItem(e)}static webStorageExists(t){const e=this.webStorageKey(t);return!!localStorage.getItem(e)}static removeWebStorage(t){const e=this.webStorageKey(t);localStorage.removeItem(e)}static localFileDirectoryPath(){const t=require("path"),e=t.dirname(process.mainModule.filename);return this.canMakeWwwSaveDirectory()?t.join(e,"save/"):t.join(t.dirname(e),"save/")}static localFilePath(t){let e="";return e=t<0?"config.rpgsave":0===t?"global.rpgsave":"file%1.rpgsave".format(t),this.localFileDirectoryPath()+e}static canMakeWwwSaveDirectory(){if(void 0===this._canMakeWwwSaveDirectory){const t=require("fs"),e=require("path"),i=e.dirname(process.mainModule.filename),s=e.join(i,"testDirectory/");try{t.mkdirSync(s),t.rmdirSync(s),this._canMakeWwwSaveDirectory=!0}catch(t){this._canMakeWwwSaveDirectory=!1}}return this._canMakeWwwSaveDirectory}static isLocalMode(){return Utils.isNwjs()}static webStorageKey(t){return t<0?"RPG Config":0===t?"RPG Global":"RPG File%1".format(t)}}class TextManager{constructor(){throw new Error("This is a static class")}static basic(t){return self.$dataSystem.terms.basic[t]||""}static param(t){return self.$dataSystem.terms.params[t]||""}static command(t){return self.$dataSystem.terms.commands[t]||""}static message(t){return self.$dataSystem.terms.messages[t]||""}static getter(t,e){return{get(){return this[t](e)},configurable:!0}}}Object.defineProperty(TextManager,"currencyUnit",{get:()=>self.$dataSystem.currencyUnit,configurable:!0}),Object.defineProperties(TextManager,{level:TextManager.getter("basic",0),levelA:TextManager.getter("basic",1),hp:TextManager.getter("basic",2),hpA:TextManager.getter("basic",3),mp:TextManager.getter("basic",4),mpA:TextManager.getter("basic",5),tp:TextManager.getter("basic",6),tpA:TextManager.getter("basic",7),exp:TextManager.getter("basic",8),expA:TextManager.getter("basic",9),fight:TextManager.getter("command",0),escape:TextManager.getter("command",1),attack:TextManager.getter("command",2),guard:TextManager.getter("command",3),item:TextManager.getter("command",4),skill:TextManager.getter("command",5),equip:TextManager.getter("command",6),status:TextManager.getter("command",7),formation:TextManager.getter("command",8),save:TextManager.getter("command",9),gameEnd:TextManager.getter("command",10),options:TextManager.getter("command",11),weapon:TextManager.getter("command",12),armor:TextManager.getter("command",13),keyItem:TextManager.getter("command",14),equip2:TextManager.getter("command",15),optimize:TextManager.getter("command",16),clear:TextManager.getter("command",17),newGame:TextManager.getter("command",18),continue_:TextManager.getter("command",19),toTitle:TextManager.getter("command",21),cancel:TextManager.getter("command",22),buy:TextManager.getter("command",24),sell:TextManager.getter("command",25),alwaysDash:TextManager.getter("message","alwaysDash"),commandRemember:TextManager.getter("message","commandRemember"),bgmVolume:TextManager.getter("message","bgmVolume"),bgsVolume:TextManager.getter("message","bgsVolume"),meVolume:TextManager.getter("message","meVolume"),seVolume:TextManager.getter("message","seVolume"),possession:TextManager.getter("message","possession"),expTotal:TextManager.getter("message","expTotal"),expNext:TextManager.getter("message","expNext"),saveMessage:TextManager.getter("message","saveMessage"),loadMessage:TextManager.getter("message","loadMessage"),file:TextManager.getter("message","file"),partyName:TextManager.getter("message","partyName"),emerge:TextManager.getter("message","emerge"),preemptive:TextManager.getter("message","preemptive"),surprise:TextManager.getter("message","surprise"),escapeStart:TextManager.getter("message","escapeStart"),escapeFailure:TextManager.getter("message","escapeFailure"),victory:TextManager.getter("message","victory"),defeat:TextManager.getter("message","defeat"),obtainExp:TextManager.getter("message","obtainExp"),obtainGold:TextManager.getter("message","obtainGold"),obtainItem:TextManager.getter("message","obtainItem"),levelUp:TextManager.getter("message","levelUp"),obtainSkill:TextManager.getter("message","obtainSkill"),useItem:TextManager.getter("message","useItem"),criticalToEnemy:TextManager.getter("message","criticalToEnemy"),criticalToActor:TextManager.getter("message","criticalToActor"),actorDamage:TextManager.getter("message","actorDamage"),actorRecovery:TextManager.getter("message","actorRecovery"),actorGain:TextManager.getter("message","actorGain"),actorLoss:TextManager.getter("message","actorLoss"),actorDrain:TextManager.getter("message","actorDrain"),actorNoDamage:TextManager.getter("message","actorNoDamage"),actorNoHit:TextManager.getter("message","actorNoHit"),enemyDamage:TextManager.getter("message","enemyDamage"),enemyRecovery:TextManager.getter("message","enemyRecovery"),enemyGain:TextManager.getter("message","enemyGain"),enemyLoss:TextManager.getter("message","enemyLoss"),enemyDrain:TextManager.getter("message","enemyDrain"),enemyNoDamage:TextManager.getter("message","enemyNoDamage"),enemyNoHit:TextManager.getter("message","enemyNoHit"),evasion:TextManager.getter("message","evasion"),magicEvasion:TextManager.getter("message","magicEvasion"),magicReflection:TextManager.getter("message","magicReflection"),counterAttack:TextManager.getter("message","counterAttack"),substitute:TextManager.getter("message","substitute"),buffAdd:TextManager.getter("message","buffAdd"),debuffAdd:TextManager.getter("message","debuffAdd"),buffRemove:TextManager.getter("message","buffRemove"),actionFailure:TextManager.getter("message","actionFailure")});class SoundManager{constructor(){throw new Error("This is a static class")}static preloadImportantSounds(){this.loadSystemSound(0),this.loadSystemSound(1),this.loadSystemSound(2),this.loadSystemSound(3)}static playCursor(){this.playSystemSound(0)}static playOk(){this.playSystemSound(1)}static playCancel(){this.playSystemSound(2)}static playBuzzer(){this.playSystemSound(3)}static playEquip(){this.playSystemSound(4)}static playSave(){this.playSystemSound(5)}static playLoad(){this.playSystemSound(6)}static playBattleStart(){this.playSystemSound(7)}static playEscape(){this.playSystemSound(8)}static playEnemyAttack(){this.playSystemSound(9)}static playEnemyDamage(){this.playSystemSound(10)}static playEnemyCollapse(){this.playSystemSound(11)}static playBossCollapse1(){this.playSystemSound(12)}static playBossCollapse2(){this.playSystemSound(13)}static playActorDamage(){this.playSystemSound(14)}static playActorCollapse(){this.playSystemSound(15)}static playRecovery(){this.playSystemSound(16)}static playMiss(){this.playSystemSound(17)}static playEvasion(){this.playSystemSound(18)}static playMagicEvasion(){this.playSystemSound(19)}static playReflection(){this.playSystemSound(20)}static playShop(){this.playSystemSound(21)}static playUseItem(){this.playSystemSound(22)}static playUseSkill(){this.playSystemSound(23)}static loadSystemSound(t){self.$dataSystem&&AudioManager.loadStaticSe(self.$dataSystem.sounds[t])}static playSystemSound(t){self.$dataSystem&&AudioManager.playStaticSe(self.$dataSystem.sounds[t])}}class Game_Item{constructor(...t){this.initialize(...t)}initialize(t){this._dataClass="",this._itemId=0,t&&this.setObject(t)}isSkill(){return"skill"===this._dataClass}isItem(){return"item"===this._dataClass}isUsableItem(){return this.isSkill()||this.isItem()}isWeapon(){return"weapon"===this._dataClass}isArmor(){return"armor"===this._dataClass}isEquipItem(){return this.isWeapon()||this.isArmor()}isNull(){return""===this._dataClass}itemId(){return this._itemId}object(){return this.isSkill()?self.$dataSkills[this._itemId]:this.isItem()?self.$dataItems[this._itemId]:this.isWeapon()?self.$dataWeapons[this._itemId]:this.isArmor()?self.$dataArmors[this._itemId]:null}setObject(t){DataManager.isSkill(t)?this._dataClass="skill":DataManager.isItem(t)?this._dataClass="item":DataManager.isWeapon(t)?this._dataClass="weapon":DataManager.isArmor(t)?this._dataClass="armor":this._dataClass="",this._itemId=t?t.id:0}setEquip(t,e){this._dataClass=t?"weapon":"armor",this._itemId=e}}class Game_Action{constructor(...t){this.initialize(...t)}initialize(t,e){this._subjectActorId=0,this._subjectEnemyIndex=-1,this._forcing=e||!1,this.setSubject(t),this.clear()}clear(){this._item=new Game_Item,this._targetIndex=-1}setSubject(t){t.isActor()?(this._subjectActorId=t.actorId(),this._subjectEnemyIndex=-1):(this._subjectEnemyIndex=t.index(),this._subjectActorId=0)}subject(){return this._subjectActorId>0?self.$gameActors.actor(this._subjectActorId):self.$gameTroop.members()[this._subjectEnemyIndex]}friendsUnit(){return this.subject().friendsUnit()}opponentsUnit(){return this.subject().opponentsUnit()}setEnemyAction(t){t?this.setSkill(t.skillId):this.clear()}setAttack(){this.setSkill(this.subject().attackSkillId())}setGuard(){this.setSkill(this.subject().guardSkillId())}setSkill(t){this._item.setObject(self.$dataSkills[t])}setItem(t){this._item.setObject(self.$dataItems[t])}setItemObject(t){this._item.setObject(t)}setTarget(t){this._targetIndex=t}item(){return this._item.object()}isSkill(){return this._item.isSkill()}isItem(){return this._item.isItem()}numRepeats(){let t=this.item().repeats;return this.isAttack()&&(t+=this.subject().attackTimesAdd()),Math.floor(t)}checkItemScope(t){return t.contains(this.item().scope)}isForOpponent(){return this.checkItemScope([1,2,3,4,5,6])}isForFriend(){return this.checkItemScope([7,8,9,10,11])}isForDeadFriend(){return this.checkItemScope([9,10])}isForUser(){return this.checkItemScope([11])}isForOne(){return this.checkItemScope([1,3,7,9,11])}isForRandom(){return this.checkItemScope([3,4,5,6])}isForAll(){return this.checkItemScope([2,8,10])}needsSelection(){return this.checkItemScope([1,7,9])}numTargets(){return this.isForRandom()?this.item().scope-2:0}checkDamageType(t){return t.contains(this.item().damage.type)}isHpEffect(){return this.checkDamageType([1,3,5])}isMpEffect(){return this.checkDamageType([2,4,6])}isDamage(){return this.checkDamageType([1,2])}isRecover(){return this.checkDamageType([3,4])}isDrain(){return this.checkDamageType([5,6])}isHpRecover(){return this.checkDamageType([3])}isMpRecover(){return this.checkDamageType([4])}isCertainHit(){return this.item().hitType===Game_Action.HITTYPE_CERTAIN}isPhysical(){return this.item().hitType===Game_Action.HITTYPE_PHYSICAL}isMagical(){return this.item().hitType===Game_Action.HITTYPE_MAGICAL}isAttack(){return this.item()===self.$dataSkills[this.subject().attackSkillId()]}isGuard(){return this.item()===self.$dataSkills[this.subject().guardSkillId()]}isMagicSkill(){return!!this.isSkill()&&self.$dataSystem.magicSkills.contains(this.item().stypeId)}decideRandomTarget(){let t;t=this.isForDeadFriend()?this.friendsUnit().randomDeadTarget():this.isForFriend()?this.friendsUnit().randomTarget():this.opponentsUnit().randomTarget(),t?this._targetIndex=t.index():this.clear()}setConfusion(){this.setAttack()}prepare(){this.subject().isConfused()&&!this._forcing&&this.setConfusion()}isValid(){return this._forcing&&this.item()||this.subject().canUse(this.item())}speed(){const t=this.subject().agi;let e=t+Math.randomInt(Math.floor(5+t/4));return this.item()&&(e+=this.item().speed),this.isAttack()&&(e+=this.subject().attackSpeed()),e}makeTargets(){let t=[];return!this._forcing&&this.subject().isConfused()?t=[this.confusionTarget()]:this.isForOpponent()?t=this.targetsForOpponents():this.isForFriend()&&(t=this.targetsForFriends()),this.repeatTargets(t)}repeatTargets(t){const e=[],i=this.numRepeats();for(const s of t)if(s)for(let t=0;t<i;t++)e.push(s);return e}confusionTarget(){switch(this.subject().confusionLevel()){case 1:return this.opponentsUnit().randomTarget();case 2:return 0===Math.randomInt(2)?this.opponentsUnit().randomTarget():this.friendsUnit().randomTarget();default:return this.friendsUnit().randomTarget()}}targetsForOpponents(){let t=[];const e=this.opponentsUnit();if(this.isForRandom())for(let i=0;i<this.numTargets();i++)t.push(e.randomTarget());else this.isForOne()?this._targetIndex<0?t.push(e.randomTarget()):t.push(e.smoothTarget(this._targetIndex)):t=e.aliveMembers();return t}targetsForFriends(){let t=[];const e=this.friendsUnit();return this.isForUser()?[this.subject()]:(this.isForDeadFriend()?this.isForOne()?t.push(e.smoothDeadTarget(this._targetIndex)):t=e.deadMembers():this.isForOne()?this._targetIndex<0?t.push(e.randomTarget()):t.push(e.smoothTarget(this._targetIndex)):t=e.aliveMembers(),t)}evaluate(){let t=0;return this.itemTargetCandidates().forEach((function(e){const i=this.evaluateWithTarget(e);this.isForAll()?t+=i:i>t&&(t=i,this._targetIndex=e.index())}),this),t*=this.numRepeats(),t>0&&(t+=Math.random()),t}itemTargetCandidates(){return this.isValid()?this.isForOpponent()?this.opponentsUnit().aliveMembers():this.isForUser()?[this.subject()]:this.isForDeadFriend()?this.friendsUnit().deadMembers():this.friendsUnit().aliveMembers():[]}evaluateWithTarget(t){if(this.isHpEffect()){const e=this.makeDamageValue(t,!1);return this.isForOpponent()?e/Math.max(t.hp,1):Math.min(-e,t.mhp-t.hp)/t.mhp}}testApply(t){return this.isForDeadFriend()===t.isDead()&&(self.$gameParty.inBattle()||this.isForOpponent()||this.isHpRecover()&&t.hp<t.mhp||this.isMpRecover()&&t.mp<t.mmp||this.hasItemAnyValidEffects(t))}hasItemAnyValidEffects(t){return this.item().effects.some((function(e){return this.testItemEffect(t,e)}),this)}testItemEffect(t,{code:e,value1:i,value2:s,dataId:a}){switch(e){case Game_Action.EFFECT_RECOVER_HP:return t.hp<t.mhp||i<0||s<0;case Game_Action.EFFECT_RECOVER_MP:return t.mp<t.mmp||i<0||s<0;case Game_Action.EFFECT_ADD_STATE:return!t.isStateAffected(a);case Game_Action.EFFECT_REMOVE_STATE:return t.isStateAffected(a);case Game_Action.EFFECT_ADD_BUFF:return!t.isMaxBuffAffected(a);case Game_Action.EFFECT_ADD_DEBUFF:return!t.isMaxDebuffAffected(a);case Game_Action.EFFECT_REMOVE_BUFF:return t.isBuffAffected(a);case Game_Action.EFFECT_REMOVE_DEBUFF:return t.isDebuffAffected(a);case Game_Action.EFFECT_LEARN_SKILL:return t.isActor()&&!t.isLearnedSkill(a);default:return!0}}itemCnt(t){return this.isPhysical()&&t.canMove()?t.cnt:0}itemMrf({mrf:t}){return this.isMagical()?t:0}itemHit(t){return this.isPhysical()?.01*this.item().successRate*this.subject().hit:.01*this.item().successRate}itemEva({eva:t,mev:e}){return this.isPhysical()?t:this.isMagical()?e:0}itemCri({cev:t}){return this.item().damage.critical?this.subject().cri*(1-t):0}apply(t){const e=t.result();if(this.subject().clearResult(),e.clear(),e.used=this.testApply(t),e.missed=e.used&&Math.random()>=this.itemHit(t),e.evaded=!e.missed&&Math.random()<this.itemEva(t),e.physical=this.isPhysical(),e.drain=this.isDrain(),e.isHit()){if(this.item().damage.type>0){e.critical=Math.random()<this.itemCri(t);const i=this.makeDamageValue(t,e.critical);this.executeDamage(t,i)}this.item().effects.forEach((function(e){this.applyItemEffect(t,e)}),this),this.applyItemUserEffect(t)}}makeDamageValue(t,e){const i=this.item(),s=this.evalDamageFormula(t);let a=s*this.calcElementRate(t);return this.isPhysical()&&(a*=t.pdr),this.isMagical()&&(a*=t.mdr),s<0&&(a*=t.rec),e&&(a=this.applyCritical(a)),a=this.applyVariance(a,i.damage.variance),a=this.applyGuard(a,t),a=Math.round(a),a}evalDamageFormula(target){try{const item=this.item(),a=this.subject(),b=target,v=self.$gameVariables._data,sign=[3,4].contains(item.damage.type)?-1:1,value=Math.max(eval(item.damage.formula),0)*sign;return isNaN(value)&&(value=0),value}catch(t){return 0}}calcElementRate(t){return this.item().damage.elementId<0?this.elementsMaxRate(t,this.subject().attackElements()):t.elementRate(this.item().damage.elementId)}elementsMaxRate(t,e){return e.length>0?Math.max.apply(null,e.map((e=>t.elementRate(e)),this)):1}applyCritical(t){return 3*t}applyVariance(t,e){const i=Math.floor(Math.max(Math.abs(t)*e/100,0)),s=Math.randomInt(i+1)+Math.randomInt(i+1)-i;return t>=0?t+s:t-s}applyGuard(t,e){return t/(t>0&&e.isGuard()?2*e.grd:1)}executeDamage(t,e){const i=t.result();0===e&&(i.critical=!1),this.isHpEffect()&&this.executeHpDamage(t,e),this.isMpEffect()&&this.executeMpDamage(t,e)}executeHpDamage(t,e){this.isDrain()&&(e=Math.min(t.hp,e)),this.makeSuccess(t),t.gainHp(-e),e>0&&t.onDamage(e),this.gainDrainedHp(e)}executeMpDamage(t,e){this.isMpRecover()||(e=Math.min(t.mp,e)),0!==e&&this.makeSuccess(t),t.gainMp(-e),this.gainDrainedMp(e)}gainDrainedHp(t){if(this.isDrain()){let e=this.subject();void 0!==this._reflectionTarget&&(e=this._reflectionTarget),e.gainHp(t)}}gainDrainedMp(t){if(this.isDrain()){let e=this.subject();void 0!==this._reflectionTarget&&(e=this._reflectionTarget),e.gainMp(t)}}applyItemEffect(t,e){switch(e.code){case Game_Action.EFFECT_RECOVER_HP:this.itemEffectRecoverHp(t,e);break;case Game_Action.EFFECT_RECOVER_MP:this.itemEffectRecoverMp(t,e);break;case Game_Action.EFFECT_GAIN_TP:this.itemEffectGainTp(t,e);break;case Game_Action.EFFECT_ADD_STATE:this.itemEffectAddState(t,e);break;case Game_Action.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(t,e);break;case Game_Action.EFFECT_ADD_BUFF:this.itemEffectAddBuff(t,e);break;case Game_Action.EFFECT_ADD_DEBUFF:this.itemEffectAddDebuff(t,e);break;case Game_Action.EFFECT_REMOVE_BUFF:this.itemEffectRemoveBuff(t,e);break;case Game_Action.EFFECT_REMOVE_DEBUFF:this.itemEffectRemoveDebuff(t,e);break;case Game_Action.EFFECT_SPECIAL:this.itemEffectSpecial(t,e);break;case Game_Action.EFFECT_GROW:this.itemEffectGrow(t,e);break;case Game_Action.EFFECT_LEARN_SKILL:this.itemEffectLearnSkill(t,e);break;case Game_Action.EFFECT_COMMON_EVENT:this.itemEffectCommonEvent(t,e)}}itemEffectRecoverHp(t,{value1:e,value2:i}){let s=(t.mhp*e+i)*t.rec;this.isItem()&&(s*=this.subject().pha),s=Math.floor(s),0!==s&&(t.gainHp(s),this.makeSuccess(t))}itemEffectRecoverMp(t,{value1:e,value2:i}){let s=(t.mmp*e+i)*t.rec;this.isItem()&&(s*=this.subject().pha),s=Math.floor(s),0!==s&&(t.gainMp(s),this.makeSuccess(t))}itemEffectGainTp(t,{value1:e}){const i=Math.floor(e);0!==i&&(t.gainTp(i),this.makeSuccess(t))}itemEffectAddState(t,e){0===e.dataId?this.itemEffectAddAttackState(t,e):this.itemEffectAddNormalState(t,e)}itemEffectAddAttackState(t,{value1:e}){this.subject().attackStates().forEach((i=>{let s=e;s*=t.stateRate(i),s*=this.subject().attackStatesRate(i),s*=this.lukEffectRate(t),Math.random()<s&&(t.addState(i),this.makeSuccess(t))}),t)}itemEffectAddNormalState(t,{value1:e,dataId:i}){let s=e;this.isCertainHit()||(s*=t.stateRate(i),s*=this.lukEffectRate(t)),Math.random()<s&&(t.addState(i),this.makeSuccess(t))}itemEffectRemoveState(t,{value1:e,dataId:i}){const s=e;Math.random()<s&&(t.removeState(i),this.makeSuccess(t))}itemEffectAddBuff(t,{dataId:e,value1:i}){t.addBuff(e,i),this.makeSuccess(t)}itemEffectAddDebuff(t,{dataId:e,value1:i}){const s=t.debuffRate(e)*this.lukEffectRate(t);Math.random()<s&&(t.addDebuff(e,i),this.makeSuccess(t))}itemEffectRemoveBuff(t,{dataId:e}){t.isBuffAffected(e)&&(t.removeBuff(e),this.makeSuccess(t))}itemEffectRemoveDebuff(t,{dataId:e}){t.isDebuffAffected(e)&&(t.removeBuff(e),this.makeSuccess(t))}itemEffectSpecial(t,{dataId:e}){e===Game_Action.SPECIAL_EFFECT_ESCAPE&&(t.escape(),this.makeSuccess(t))}itemEffectGrow(t,{dataId:e,value1:i}){t.addParam(e,Math.floor(i)),this.makeSuccess(t)}itemEffectLearnSkill(t,{dataId:e}){t.isActor()&&(t.learnSkill(e),this.makeSuccess(t))}itemEffectCommonEvent(t,e){}makeSuccess(t){t.result().success=!0}applyItemUserEffect(t){const e=Math.floor(this.item().tpGain*this.subject().tcr);this.subject().gainSilentTp(e)}lukEffectRate({luk:t}){return Math.max(1+.001*(this.subject().luk-t),0)}applyGlobal(){this.item().effects.forEach((({code:t,dataId:e})=>{t===Game_Action.EFFECT_COMMON_EVENT&&self.$gameTemp.reserveCommonEvent(e)}),this)}}Game_Action.EFFECT_RECOVER_HP=11,Game_Action.EFFECT_RECOVER_MP=12,Game_Action.EFFECT_GAIN_TP=13,Game_Action.EFFECT_ADD_STATE=21,Game_Action.EFFECT_REMOVE_STATE=22,Game_Action.EFFECT_ADD_BUFF=31,Game_Action.EFFECT_ADD_DEBUFF=32,Game_Action.EFFECT_REMOVE_BUFF=33,Game_Action.EFFECT_REMOVE_DEBUFF=34,Game_Action.EFFECT_SPECIAL=41,Game_Action.EFFECT_GROW=42,Game_Action.EFFECT_LEARN_SKILL=43,Game_Action.EFFECT_COMMON_EVENT=44,Game_Action.SPECIAL_EFFECT_ESCAPE=0,Game_Action.HITTYPE_CERTAIN=0,Game_Action.HITTYPE_PHYSICAL=1,Game_Action.HITTYPE_MAGICAL=2;class Scene_Base extends Stage{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._active=!1,this._fadeSign=0,this._fadeDuration=0,this._fadeSprite=null,this._imageReservationId=Utils.generateRuntimeId()}attachReservation(){ImageManager.setDefaultReservationId(this._imageReservationId)}detachReservation(){ImageManager.releaseReservation(this._imageReservationId)}create(){}isActive(){return this._active}isReady(){return ImageManager.isReady()}start(){this._active=!0}update(){this.updateFade(),this.updateChildren()}stop(){this._active=!1}isBusy(){return this._fadeDuration>0}terminate(){}createWindowLayer(){const t=Graphics$1.boxWidth,e=Graphics$1.boxHeight,i=(Graphics$1.width-t)/2,s=(Graphics$1.height-e)/2;this._windowLayer=new WindowLayer,this._windowLayer.move(i,s,t,e),this.addChild(this._windowLayer)}addWindow(t){this._windowLayer.addChild(t)}startFadeIn(t,e){this.createFadeSprite(e),this._fadeSign=1,this._fadeDuration=t||30,this._fadeSprite.opacity=255}startFadeOut(t,e){this.createFadeSprite(e),this._fadeSign=-1,this._fadeDuration=t||30,this._fadeSprite.opacity=0}createFadeSprite(t){this._fadeSprite||(this._fadeSprite=new ScreenSprite,this.addChild(this._fadeSprite)),t?this._fadeSprite.setWhite():this._fadeSprite.setBlack()}updateFade(){if(this._fadeDuration>0){const t=this._fadeDuration;this._fadeSign>0?this._fadeSprite.opacity-=this._fadeSprite.opacity/t:this._fadeSprite.opacity+=(255-this._fadeSprite.opacity)/t,this._fadeDuration--}}updateChildren(){this.children.forEach((t=>{t.update&&t.update()}))}popScene(){SceneManager.pop()}checkGameover(){self.$gameParty.isAllDead()&&SceneManager.goto(Scene_Gameover)}fadeOutAll(){const t=this.slowFadeSpeed()/60;AudioManager.fadeOutBgm(t),AudioManager.fadeOutBgs(t),AudioManager.fadeOutMe(t),this.startFadeOut(this.slowFadeSpeed())}fadeSpeed(){return 24}slowFadeSpeed(){return 2*this.fadeSpeed()}}class Sprite_Picture extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this._pictureId=t,this._pictureName="",this.update()}picture(){return self.$gameScreen.picture(this._pictureId)}update(){super.update(),this.updateBitmap(),this.visible&&(this.updateOrigin(),this.updatePosition(),this.updateScale(),this.updateTone(),this.updateOther())}updateBitmap(){const t=this.picture();if(t){const e=t.name();this._pictureName!==e&&(this._pictureName=e,this.loadBitmap()),this.visible=!0}else this._pictureName="",this.bitmap=null,this.visible=!1}updateOrigin(){0===this.picture().origin()?(this.anchor.x=0,this.anchor.y=0):(this.anchor.x=.5,this.anchor.y=.5)}updatePosition(){const t=this.picture();this.x=Math.floor(t.x()),this.y=Math.floor(t.y())}updateScale(){const t=this.picture();this.scale.x=t.scaleX()/100,this.scale.y=t.scaleY()/100}updateTone(){const t=this.picture();t.tone()?this.setColorTone(t.tone()):this.setColorTone([0,0,0,0])}updateOther(){const t=this.picture();this.opacity=t.opacity(),this.blendMode=t.blendMode(),this.rotation=t.angle()*Math.PI/180}loadBitmap(){this.bitmap=ImageManager.loadPicture(this._pictureName)}}class Sprite_Timer extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._seconds=0,this.createBitmap(),this.update()}createBitmap(){this.bitmap=new Bitmap(96,48),this.bitmap.fontSize=32}update(){super.update(),this.updateBitmap(),this.updatePosition(),this.updateVisibility()}updateBitmap(){this._seconds!==self.$gameTimer.seconds()&&(this._seconds=self.$gameTimer.seconds(),this.redraw())}redraw(){const t=this.timerText(),e=this.bitmap.width,i=this.bitmap.height;this.bitmap.clear(),this.bitmap.drawText(t,0,0,e,i,"center")}timerText(){const t=Math.floor(this._seconds/60)%60,e=this._seconds%60;return`${t.padZero(2)}:${e.padZero(2)}`}updatePosition(){this.x=Graphics$1.width-this.bitmap.width,this.y=0}updateVisibility(){this.visible=self.$gameTimer.isWorking()}}class Spriteset_Base extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.setFrame(0,0,Graphics$1.width,Graphics$1.height),this._tone=[0,0,0,0],this.opaque=!0,this.createLowerLayer(),this.createToneChanger(),this.createUpperLayer(),this.update()}createLowerLayer(){this.createBaseSprite()}createUpperLayer(){this.createPictures(),this.createTimer(),this.createScreenSprites()}update(){super.update(),this.updateScreenSprites(),this.updateToneChanger(),this.updatePosition()}createBaseSprite(){this._baseSprite=new Sprite,this._baseSprite.setFrame(0,0,this.width,this.height),this._blackScreen=new ScreenSprite,this._blackScreen.opacity=255,this.addChild(this._baseSprite),this._baseSprite.addChild(this._blackScreen)}createToneChanger(){Graphics$1.isWebGL()?this.createWebGLToneChanger():this.createCanvasToneChanger()}createWebGLToneChanger(){const t=Graphics$1.width+96,e=Graphics$1.height+96;this._toneFilter=new ToneFilter,this._toneFilter.enabled=!1,this._baseSprite.filters=[this._toneFilter],this._baseSprite.filterArea=new Rectangle(-48,-48,t,e)}createCanvasToneChanger(){this._toneSprite=new ToneSprite,this.addChild(this._toneSprite)}createPictures(){const t=Graphics$1.boxWidth,e=Graphics$1.boxHeight,i=(Graphics$1.width-t)/2,s=(Graphics$1.height-e)/2;this._pictureContainer=new Sprite,this._pictureContainer.setFrame(i,s,t,e);for(let t=1;t<=self.$gameScreen.maxPictures();t++)this._pictureContainer.addChild(new Sprite_Picture(t));this.addChild(this._pictureContainer)}createTimer(){this._timerSprite=new Sprite_Timer,this.addChild(this._timerSprite)}createScreenSprites(){this._flashSprite=new ScreenSprite,this._fadeSprite=new ScreenSprite,this.addChild(this._flashSprite),this.addChild(this._fadeSprite)}updateScreenSprites(){const t=self.$gameScreen.flashColor();this._flashSprite.setColor(t[0],t[1],t[2]),this._flashSprite.opacity=t[3],this._fadeSprite.opacity=255-self.$gameScreen.brightness()}updateToneChanger(){const t=self.$gameScreen.tone();this._tone.equals(t)||(this._tone=t.clone(),Graphics$1.isWebGL()?this.updateWebGLToneChanger():this.updateCanvasToneChanger())}updateWebGLToneChanger(){const t=this._tone;this._toneFilter.reset(),t[0]||t[1]||t[2]||t[3]?(this._toneFilter.enabled=!0,this._toneFilter.adjustTone(t[0],t[1],t[2]),this._toneFilter.adjustSaturation(-t[3])):this._toneFilter.enabled=!1}updateCanvasToneChanger(){const t=this._tone;this._toneSprite.setTone(t[0],t[1],t[2],t[3])}updatePosition(){const t=self.$gameScreen,e=t.zoomScale();this.scale.x=e,this.scale.y=e,this.x=Math.round(-t.zoomX()*(e-1)),this.y=Math.round(-t.zoomY()*(e-1)),this.x+=Math.round(t.shake())}}class Sprite_Animation extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._reduceArtifacts=!0,this.initMembers()}initMembers(){this._target=null,this._animation=null,this._mirror=!1,this._delay=0,this._rate=4,this._duration=0,this._flashColor=[0,0,0,0],this._flashDuration=0,this._screenFlashDuration=0,this._hidingDuration=0,this._bitmap1=null,this._bitmap2=null,this._cellSprites=[],this._screenFlashSprite=null,this._duplicated=!1,this.z=8}setup(t,e,i,s){this._target=t,this._animation=e,this._mirror=i,this._delay=s,this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())}remove(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())}setupRate(){this._rate=4}setupDuration(){this._duration=this._animation.frames.length*this._rate+1}update(){super.update(),this.updateMain(),this.updateFlash(),this.updateScreenFlash(),this.updateHiding(),Sprite_Animation._checker1={},Sprite_Animation._checker2={}}updateFlash(){if(this._flashDuration>0){const t=this._flashDuration--;this._flashColor[3]*=(t-1)/t,this._target.setBlendColor(this._flashColor)}}updateScreenFlash(){if(this._screenFlashDuration>0){const t=this._screenFlashDuration--;this._screenFlashSprite&&(this._screenFlashSprite.x=-this.absoluteX(),this._screenFlashSprite.y=-this.absoluteY(),this._screenFlashSprite.opacity*=(t-1)/t,this._screenFlashSprite.visible=this._screenFlashDuration>0)}}absoluteX(){let t=0,e=this;for(;e;)t+=e.x,e=e.parent;return t}absoluteY(){let t=0,e=this;for(;e;)t+=e.y,e=e.parent;return t}updateHiding(){this._hidingDuration>0&&(this._hidingDuration--,0===this._hidingDuration&&this._target.show())}isPlaying(){return this._duration>0}loadBitmaps(){const t=this._animation.animation1Name,e=this._animation.animation2Name,i=this._animation.animation1Hue,s=this._animation.animation2Hue;this._bitmap1=ImageManager.loadAnimation(t,i),this._bitmap2=ImageManager.loadAnimation(e,s)}isReady(){return this._bitmap1&&this._bitmap1.isReady()&&this._bitmap2&&this._bitmap2.isReady()}createSprites(){Sprite_Animation._checker2[this._animation]||(this.createCellSprites(),3===this._animation.position&&(Sprite_Animation._checker2[this._animation]=!0),this.createScreenFlashSprite()),Sprite_Animation._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,3===this._animation.position&&(Sprite_Animation._checker1[this._animation]=!0))}createCellSprites(){this._cellSprites=[];for(let t=0;t<16;t++){const t=new Sprite;t.anchor.x=.5,t.anchor.y=.5,this._cellSprites.push(t),this.addChild(t)}}createScreenFlashSprite(){this._screenFlashSprite=new ScreenSprite,this.addChild(this._screenFlashSprite)}updateMain(){this.isPlaying()&&this.isReady()&&(this._delay>0?this._delay--:(this._duration--,this.updatePosition(),this._duration%this._rate==0&&this.updateFrame()))}updatePosition(){if(3===this._animation.position)this.x=this.parent.width/2,this.y=this.parent.height/2;else{const t=this._target.parent,e=t?t.parent:null;this.x=this._target.x,this.y=this._target.y,this.parent===e&&(this.x+=t.x,this.y+=t.y),0===this._animation.position?this.y-=this._target.height:1===this._animation.position&&(this.y-=this._target.height/2)}}updateFrame(){if(this._duration>0){const t=this.currentFrameIndex();this.updateAllCellSprites(this._animation.frames[t]),this._animation.timings.forEach((function(e){e.frame===t&&this.processTimingData(e)}),this)}}currentFrameIndex(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)}updateAllCellSprites(t){this._cellSprites.forEach(((e,i)=>{i<t.length?this.updateCellSprite(e,t[i]):e.visible=!1}))}updateCellSprite(t,e){const i=e[0];if(i>=0){const s=i%5*192,a=192*Math.floor(i%100/5),r=this._mirror;t.bitmap=i<100?this._bitmap1:this._bitmap2,t.setFrame(s,a,192,192),t.x=e[1],t.y=e[2],t.rotation=e[4]*Math.PI/180,t.scale.x=e[3]/100,e[5]&&(t.scale.x*=-1),r&&(t.x*=-1,t.rotation*=-1,t.scale.x*=-1),t.scale.y=e[3]/100,t.opacity=e[6],t.blendMode=e[7],t.visible=!0}else t.visible=!1}processTimingData({flashDuration:t,flashScope:e,flashColor:i,se:s}){const a=t*this._rate;switch(e){case 1:this.startFlash(i,a);break;case 2:this.startScreenFlash(i,a);break;case 3:this.startHiding(a)}!this._duplicated&&s&&AudioManager.playSe(s)}startFlash(t,e){this._flashColor=t.clone(),this._flashDuration=e}startScreenFlash(t,e){this._screenFlashDuration=e,this._screenFlashSprite&&(this._screenFlashSprite.setColor(t[0],t[1],t[2]),this._screenFlashSprite.opacity=t[3])}startHiding(t){this._hidingDuration=t,this._target.hide()}}Sprite_Animation._checker1={},Sprite_Animation._checker2={};class Sprite_Base extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._animationSprites=[],this._effectTarget=this,this._hiding=!1}update(){super.update(),this.updateVisibility(),this.updateAnimationSprites()}hide(){this._hiding=!0,this.updateVisibility()}show(){this._hiding=!1,this.updateVisibility()}updateVisibility(){this.visible=!this._hiding}updateAnimationSprites(){if(this._animationSprites.length>0){const t=this._animationSprites.clone();this._animationSprites=[];for(const e of t)e.isPlaying()?this._animationSprites.push(e):e.remove()}}startAnimation(t,e,i){const s=new Sprite_Animation;s.setup(this._effectTarget,t,e,i),this.parent.addChild(s),this._animationSprites.push(s)}isAnimationPlaying(){return this._animationSprites.length>0}}class Sprite_Damage extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._duration=90,this._flashColor=[0,0,0,0],this._flashDuration=0,this._damageBitmap=ImageManager.loadSystem("Damage")}setup(t){const e=t.result();e.missed||e.evaded?this.createMiss():e.hpAffected?this.createDigits(0,e.hpDamage):t.isAlive()&&0!==e.mpDamage&&this.createDigits(2,e.mpDamage),e.critical&&this.setupCriticalEffect()}setupCriticalEffect(){this._flashColor=[255,0,0,160],this._flashDuration=60}digitWidth(){return this._damageBitmap?this._damageBitmap.width/10:0}digitHeight(){return this._damageBitmap?this._damageBitmap.height/5:0}createMiss(){const t=this.digitWidth(),e=this.digitHeight(),i=this.createChildSprite();i.setFrame(0,4*e,4*t,e),i.dy=0}createDigits(t,e){const i=Math.abs(e).toString(),s=t+(e<0?1:0),a=this.digitWidth(),r=this.digitHeight();for(let t=0;t<i.length;t++){const e=this.createChildSprite(),n=Number(i[t]);e.setFrame(n*a,s*r,a,r),e.x=(t-(i.length-1)/2)*a,e.dy=-t}}createChildSprite(){const t=new Sprite;return t.bitmap=this._damageBitmap,t.anchor.x=.5,t.anchor.y=1,t.y=-40,t.ry=t.y,this.addChild(t),t}update(){if(super.update(),this._duration>0){this._duration--;for(let t=0;t<this.children.length;t++)this.updateChild(this.children[t])}this.updateFlash(),this.updateOpacity()}updateChild(t){t.dy+=.5,t.ry+=t.dy,t.ry>=0&&(t.ry=0,t.dy*=-.6),t.y=Math.round(t.ry),t.setBlendColor(this._flashColor)}updateFlash(){if(this._flashDuration>0){const t=this._flashDuration--;this._flashColor[3]*=(t-1)/t}}updateOpacity(){this._duration<10&&(this.opacity=255*this._duration/10)}isPlaying(){return this._duration>0}}class Sprite_Battler extends Sprite_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this.initMembers(),this.setBattler(t)}initMembers(){this.anchor.x=.5,this.anchor.y=1,this._battler=null,this._damages=[],this._homeX=0,this._homeY=0,this._offsetX=0,this._offsetY=0,this._targetOffsetX=NaN,this._targetOffsetY=NaN,this._movementDuration=0,this._selectionEffectCount=0}setBattler(t){this._battler=t}setHome(t,e){this._homeX=t,this._homeY=e,this.updatePosition()}update(){super.update(),this._battler?(this.updateMain(),this.updateAnimation(),this.updateDamagePopup(),this.updateSelectionEffect()):this.bitmap=null}updateVisibility(){super.updateVisibility(),this._battler&&this._battler.isSpriteVisible()||(this.visible=!1)}updateMain(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame()),this.updateMove(),this.updatePosition()}updateBitmap(){}updateFrame(){}updateMove(){if(this._movementDuration>0){const t=this._movementDuration;this._offsetX=(this._offsetX*(t-1)+this._targetOffsetX)/t,this._offsetY=(this._offsetY*(t-1)+this._targetOffsetY)/t,this._movementDuration--,0===this._movementDuration&&this.onMoveEnd()}}updatePosition(){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY}updateAnimation(){this.setupAnimation()}updateDamagePopup(){if(this.setupDamagePopup(),this._damages.length>0){for(let t=0;t<this._damages.length;t++)this._damages[t].update();this._damages[0].isPlaying()||(this.parent.removeChild(this._damages[0]),this._damages.shift())}}updateSelectionEffect(){const t=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%30<15?t.setBlendColor([255,255,255,64]):t.setBlendColor([0,0,0,0])):this._selectionEffectCount>0&&(this._selectionEffectCount=0,t.setBlendColor([0,0,0,0]))}setupAnimation(){for(;this._battler.isAnimationRequested();){const t=this._battler.shiftAnimation(),e=self.$dataAnimations[t.animationId],i=t.mirror,s=3===e.position?0:t.delay;this.startAnimation(e,i,s);for(const t of this._animationSprites)t.visible=this._battler.isSpriteVisible()}}setupDamagePopup(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){const t=new Sprite_Damage;t.x=this.x+this.damageOffsetX(),t.y=this.y+this.damageOffsetY(),t.setup(this._battler),this._damages.push(t),this.parent.addChild(t)}this._battler.clearDamagePopup(),this._battler.clearResult()}}damageOffsetX(){return 0}damageOffsetY(){return 0}startMove(t,e,i){this._targetOffsetX===t&&this._targetOffsetY===e||(this._targetOffsetX=t,this._targetOffsetY=e,this._movementDuration=i,0===i&&(this._offsetX=t,this._offsetY=e))}onMoveEnd(){}isEffecting(){return!1}isMoving(){return this._movementDuration>0}inHomePosition(){return 0===this._offsetX&&0===this._offsetY}}class Sprite_StateIcon extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers(),this.loadBitmap()}initMembers(){this._battler=null,this._iconIndex=0,this._animationCount=0,this._animationIndex=0,this.anchor.x=.5,this.anchor.y=.5}loadBitmap(){this.bitmap=ImageManager.loadSystem("IconSet"),this.setFrame(0,0,0,0)}setup(t){this._battler=t}update(){super.update(),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updateIcon(),this.updateFrame(),this._animationCount=0)}animationWait(){return 40}updateIcon(){let t=[];this._battler&&this._battler.isAlive()&&(t=this._battler.allIcons()),t.length>0?(this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0),this._iconIndex=t[this._animationIndex]):(this._animationIndex=0,this._iconIndex=0)}updateFrame(){const t=Sprite_StateIcon._iconWidth,e=Sprite_StateIcon._iconHeight,i=this._iconIndex%16*t,s=Math.floor(this._iconIndex/16)*e;this.setFrame(i,s,t,e)}}Sprite_StateIcon._iconWidth=32,Sprite_StateIcon._iconHeight=32;class Sprite_Enemy extends Sprite_Battler{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(t)}initMembers(){super.initMembers(),this._enemy=null,this._appeared=!1,this._battlerName="",this._battlerHue=0,this._effectType=null,this._effectDuration=0,this._shake=0,this.createStateIconSprite()}createStateIconSprite(){this._stateIconSprite=new Sprite_StateIcon,this.addChild(this._stateIconSprite)}setBattler(t){super.setBattler(t),this._enemy=t,this.setHome(t.screenX(),t.screenY()),this._stateIconSprite.setup(t)}update(){super.update(),this._enemy&&(this.updateEffect(),this.updateStateSprite())}updateBitmap(){super.updateBitmap();const t=this._enemy.battlerName(),e=this._enemy.battlerHue();this._battlerName===t&&this._battlerHue===e||(this._battlerName=t,this._battlerHue=e,this.loadBitmap(t,e),this.initVisibility())}loadBitmap(t,e){self.$gameSystem.isSideView()?this.bitmap=ImageManager.loadSvEnemy(t,e):this.bitmap=ImageManager.loadEnemy(t,e)}updateFrame(){super.updateFrame();let t=this.bitmap.height;"bossCollapse"===this._effectType&&(t=this._effectDuration),this.setFrame(0,0,this.bitmap.width,t)}updatePosition(){super.updatePosition(),this.x+=this._shake}updateStateSprite(){this._stateIconSprite.y=-Math.round(.9*(this.bitmap.height+40)),this._stateIconSprite.y<20-this.y&&(this._stateIconSprite.y=20-this.y)}initVisibility(){this._appeared=this._enemy.isAlive(),this._appeared||(this.opacity=0)}setupEffect(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect()),!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")}startEffect(t){switch(this._effectType=t,this._effectType){case"appear":this.startAppear();break;case"disappear":this.startDisappear();break;case"whiten":this.startWhiten();break;case"blink":this.startBlink();break;case"collapse":this.startCollapse();break;case"bossCollapse":this.startBossCollapse();break;case"instantCollapse":this.startInstantCollapse()}this.revertToNormal()}startAppear(){this._effectDuration=16,this._appeared=!0}startDisappear(){this._effectDuration=32,this._appeared=!1}startWhiten(){this._effectDuration=16}startBlink(){this._effectDuration=20}startCollapse(){this._effectDuration=32,this._appeared=!1}startBossCollapse(){this._effectDuration=this.bitmap.height,this._appeared=!1}startInstantCollapse(){this._effectDuration=16,this._appeared=!1}updateEffect(){if(this.setupEffect(),this._effectDuration>0){switch(this._effectDuration--,this._effectType){case"whiten":this.updateWhiten();break;case"blink":this.updateBlink();break;case"appear":this.updateAppear();break;case"disappear":this.updateDisappear();break;case"collapse":this.updateCollapse();break;case"bossCollapse":this.updateBossCollapse();break;case"instantCollapse":this.updateInstantCollapse()}0===this._effectDuration&&(this._effectType=null)}}isEffecting(){return null!==this._effectType}revertToNormal(){this._shake=0,this.blendMode=0,this.opacity=255,this.setBlendColor([0,0,0,0])}updateWhiten(){const t=128-10*(16-this._effectDuration);this.setBlendColor([255,255,255,t])}updateBlink(){this.opacity=this._effectDuration%10<5?255:0}updateAppear(){this.opacity=16*(16-this._effectDuration)}updateDisappear(){this.opacity=256-10*(32-this._effectDuration)}updateCollapse(){this.blendMode=Graphics$1.BLEND_ADD,this.setBlendColor([255,128,128,128]),this.opacity*=this._effectDuration/(this._effectDuration+1)}updateBossCollapse(){this._shake=this._effectDuration%2*4-2,this.blendMode=Graphics$1.BLEND_ADD,this.opacity*=this._effectDuration/(this._effectDuration+1),this.setBlendColor([255,255,255,255-this.opacity]),this._effectDuration%20==19&&SoundManager.playBossCollapse2()}updateInstantCollapse(){this.opacity=0}damageOffsetX(){return 0}damageOffsetY(){return-8}}class Sprite_Weapon extends Sprite_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers()}initMembers(){this._weaponImageId=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1,this.x=-16}setup(t){this._weaponImageId=t,this._animationCount=0,this._pattern=0,this.loadBitmap(),this.updateFrame()}update(){super.update(),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)}animationWait(){return 12}updatePattern(){this._pattern++,this._pattern>=3&&(this._weaponImageId=0)}loadBitmap(){const t=Math.floor((this._weaponImageId-1)/12)+1;this.bitmap=t>=1?ImageManager.loadSystem(`Weapons${t}`):ImageManager.loadSystem("")}updateFrame(){if(this._weaponImageId>0){const t=(this._weaponImageId-1)%12,e=96,i=64,s=(3*Math.floor(t/6)+this._pattern)*e,a=Math.floor(t%6)*i;this.setFrame(s,a,e,i)}else this.setFrame(0,0,0,0)}isPlaying(){return this._weaponImageId>0}}class Sprite_StateOverlay extends Sprite_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers(),this.loadBitmap()}initMembers(){this._battler=null,this._overlayIndex=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1}loadBitmap(){this.bitmap=ImageManager.loadSystem("States"),this.setFrame(0,0,0,0)}setup(t){this._battler=t}update(){super.update(),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)}animationWait(){return 8}updatePattern(){this._pattern++,this._pattern%=8,this._battler&&(this._overlayIndex=this._battler.stateOverlayIndex())}updateFrame(){if(this._overlayIndex>0){const t=96,e=96,i=this._pattern*t,s=(this._overlayIndex-1)*e;this.setFrame(i,s,t,e)}else this.setFrame(0,0,0,0)}}class Sprite_Actor extends Sprite_Battler{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(t),this.moveToStartPosition()}initMembers(){super.initMembers(),this._battlerName="",this._motion=null,this._motionCount=0,this._pattern=0,this.createShadowSprite(),this.createWeaponSprite(),this.createMainSprite(),this.createStateSprite()}createMainSprite(){this._mainSprite=new Sprite_Base,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=1,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite}createShadowSprite(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow2"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=.5,this._shadowSprite.y=-2,this.addChild(this._shadowSprite)}createWeaponSprite(){this._weaponSprite=new Sprite_Weapon,this.addChild(this._weaponSprite)}createStateSprite(){this._stateSprite=new Sprite_StateOverlay,this.addChild(this._stateSprite)}setBattler(t){super.setBattler(t),t!==this._actor&&(this._actor=t,t&&this.setActorHome(t.index()),this.startEntryMotion(),this._stateSprite.setup(t))}moveToStartPosition(){this.startMove(300,0,0)}setActorHome(t){this.setHome(600+32*t,280+48*t)}update(){super.update(),this.updateShadow(),this._actor&&this.updateMotion()}updateShadow(){this._shadowSprite.visible=!!this._actor}updateMain(){super.updateMain(),this._actor.isSpriteVisible()&&!this.isMoving()&&this.updateTargetPosition()}setupMotion(){this._actor.isMotionRequested()&&(this.startMotion(this._actor.motionType()),this._actor.clearMotion())}setupWeaponAnimation(){this._actor.isWeaponAnimationRequested()&&(this._weaponSprite.setup(this._actor.weaponImageId()),this._actor.clearWeaponAnimation())}startMotion(t){const e=Sprite_Actor.MOTIONS[t];this._motion!==e&&(this._motion=e,this._motionCount=0,this._pattern=0)}updateTargetPosition(){this._actor.isInputting()||this._actor.isActing()?this.stepForward():this._actor.canMove()&&BattleManager.isEscaped()?this.retreat():this.inHomePosition()||this.stepBack()}updateBitmap(){super.updateBitmap();const t=this._actor.battlerName();this._battlerName!==t&&(this._battlerName=t,this._mainSprite.bitmap=ImageManager.loadSvActor(t))}updateFrame(){super.updateFrame();const t=this._mainSprite.bitmap;if(t){const e=this._motion?this._motion.index:0,i=this._pattern<3?this._pattern:1,s=t.width/9,a=t.height/6,r=3*Math.floor(e/6)+i,n=e%6;this._mainSprite.setFrame(r*s,n*a,s,a)}}updateMove(){const t=this._mainSprite.bitmap;t&&!t.isReady()||super.updateMove()}updateMotion(){this.setupMotion(),this.setupWeaponAnimation(),this._actor.isMotionRefreshRequested()&&(this.refreshMotion(),this._actor.clearMotion()),this.updateMotionCount()}updateMotionCount(){this._motion&&++this._motionCount>=this.motionSpeed()&&(this._motion.loop?this._pattern=(this._pattern+1)%4:this._pattern<2?this._pattern++:this.refreshMotion(),this._motionCount=0)}motionSpeed(){return 12}refreshMotion(){const t=this._actor,e=Sprite_Actor.MOTIONS.guard;if(t){if(this._motion===e&&!BattleManager.isInputting())return;const i=t.stateMotionIndex();t.isInputting()||t.isActing()?this.startMotion("walk"):3===i?this.startMotion("dead"):2===i?this.startMotion("sleep"):t.isChanting()?this.startMotion("chant"):t.isGuard()||t.isGuardWaiting()?this.startMotion("guard"):1===i?this.startMotion("abnormal"):t.isDying()?this.startMotion("dying"):t.isUndecided()?this.startMotion("walk"):this.startMotion("wait")}}startEntryMotion(){this._actor&&this._actor.canMove()?(this.startMotion("walk"),this.startMove(0,0,30)):this.isMoving()||(this.refreshMotion(),this.startMove(0,0,0))}stepForward(){this.startMove(-48,0,12)}stepBack(){this.startMove(0,0,12)}retreat(){this.startMove(300,0,30)}onMoveEnd(){super.onMoveEnd(),BattleManager.isBattleEnd()||this.refreshMotion()}damageOffsetX(){return-32}damageOffsetY(){return 0}}Sprite_Actor.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}};class Spriteset_Battle extends Spriteset_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._battlebackLocated=!1}createLowerLayer(){super.createLowerLayer(),this.createBackground(),this.createBattleField(),this.createBattleback(),this.createEnemies(),this.createActors()}createBackground(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this._baseSprite.addChild(this._backgroundSprite)}update(){super.update(),this.updateActors(),this.updateBattleback()}createBattleField(){const t=Graphics$1.boxWidth,e=Graphics$1.boxHeight,i=(Graphics$1.width-t)/2,s=(Graphics$1.height-e)/2;this._battleField=new Sprite,this._battleField.setFrame(i,s,t,e),this._battleField.x=i,this._battleField.y=s,this._baseSprite.addChild(this._battleField)}createBattleback(){const t=-this._battleField.x-32,e=-this._battleField.y-32,i=Graphics$1.width+64,s=Graphics$1.height+64;this._back1Sprite=new TilingSprite,this._back2Sprite=new TilingSprite,this._back1Sprite.bitmap=this.battleback1Bitmap(),this._back2Sprite.bitmap=this.battleback2Bitmap(),this._back1Sprite.move(t,e,i,s),this._back2Sprite.move(t,e,i,s),this._battleField.addChild(this._back1Sprite),this._battleField.addChild(this._back2Sprite)}updateBattleback(){this._battlebackLocated||(this.locateBattleback(),this._battlebackLocated=!0)}locateBattleback(){const t=this._battleField.width,e=this._battleField.height,i=this._back1Sprite,s=this._back2Sprite;i.origin.x=i.x+(i.bitmap.width-t)/2,s.origin.x=i.y+(s.bitmap.width-t)/2,self.$gameSystem.isSideView()&&(i.origin.y=i.x+i.bitmap.height-e,s.origin.y=i.y+s.bitmap.height-e)}battleback1Bitmap(){return ImageManager.loadBattleback1(this.battleback1Name())}battleback2Bitmap(){return ImageManager.loadBattleback2(this.battleback2Name())}battleback1Name(){return BattleManager.isBattleTest()?self.$dataSystem.battleback1Name:self.$gameMap.battleback1Name()?self.$gameMap.battleback1Name():self.$gameMap.isOverworld()?this.overworldBattleback1Name():""}battleback2Name(){return BattleManager.isBattleTest()?self.$dataSystem.battleback2Name:self.$gameMap.battleback2Name()?self.$gameMap.battleback2Name():self.$gameMap.isOverworld()?this.overworldBattleback2Name():""}overworldBattleback1Name(){return""===self.$gameMap.battleback1Name()?"":self.$gamePlayer.isInVehicle()?this.shipBattleback1Name():this.normalBattleback1Name()}overworldBattleback2Name(){return""===self.$gameMap.battleback2Name()?"":self.$gamePlayer.isInVehicle()?this.shipBattleback2Name():this.normalBattleback2Name()}normalBattleback1Name(){return this.terrainBattleback1Name(this.autotileType(1))||this.terrainBattleback1Name(this.autotileType(0))||this.defaultBattleback1Name()}normalBattleback2Name(){return this.terrainBattleback2Name(this.autotileType(1))||this.terrainBattleback2Name(this.autotileType(0))||this.defaultBattleback2Name()}terrainBattleback1Name(t){switch(t){case 24:case 25:return"Wasteland";case 26:case 27:return"DirtField";case 32:case 33:return"Desert";case 34:return"Lava1";case 35:return"Lava2";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp";default:return null}}terrainBattleback2Name(t){switch(t){case 20:case 21:return"Forest";case 22:case 30:case 38:return"Cliff";case 24:case 25:case 26:case 27:return"Wasteland";case 32:case 33:return"Desert";case 34:case 35:return"Lava";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp"}}defaultBattleback1Name(){return"Grassland"}defaultBattleback2Name(){return"Grassland"}shipBattleback1Name(){return"Ship"}shipBattleback2Name(){return"Ship"}autotileType(t){return self.$gameMap.autotileType(self.$gamePlayer.x,self.$gamePlayer.y,t)}createEnemies(){const t=self.$gameTroop.members(),e=[];for(let i=0;i<t.length;i++)e[i]=new Sprite_Enemy(t[i]);e.sort(this.compareEnemySprite.bind(this));for(let t=0;t<e.length;t++)this._battleField.addChild(e[t]);this._enemySprites=e}compareEnemySprite(t,e){return t.y!==e.y?t.y-e.y:t.spriteId-e.spriteId}createActors(){this._actorSprites=[];for(let t=0;t<self.$gameParty.maxBattleMembers();t++)this._actorSprites[t]=new Sprite_Actor,this._battleField.addChild(this._actorSprites[t])}updateActors(){const t=self.$gameParty.battleMembers();for(let e=0;e<this._actorSprites.length;e++)this._actorSprites[e].setBattler(t[e])}battlerSprites(){return this._enemySprites.concat(this._actorSprites)}isAnimationPlaying(){return this.battlerSprites().some((t=>t.isAnimationPlaying()))}isEffecting(){return this.battlerSprites().some((t=>t.isEffecting()))}isAnyoneMoving(){return this.battlerSprites().some((t=>t.isMoving()))}isBusy(){return this.isAnimationPlaying()||this.isAnyoneMoving()}}class Window_Base extends Window{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(),this.loadWindowskin(),this.move(t,e,i,s),this.updatePadding(),this.updateBackOpacity(),this.updateTone(),this.createContents(),this._opening=!1,this._closing=!1,this._dimmerSprite=null}lineHeight(){return 36}standardFontFace(){return self.$gameSystem.isChinese()?"SimHei, Heiti TC, sans-serif":self.$gameSystem.isKorean()?"Dotum, AppleGothic, sans-serif":"GameFont"}standardFontSize(){return 28}standardPadding(){return 18}textPadding(){return 6}standardBackOpacity(){return 192}loadWindowskin(){this.windowskin=ImageManager.loadSystem("Window")}updatePadding(){this.padding=this.standardPadding()}updateBackOpacity(){this.backOpacity=this.standardBackOpacity()}contentsWidth(){return this.width-2*this.standardPadding()}contentsHeight(){return this.height-2*this.standardPadding()}fittingHeight(t){return t*this.lineHeight()+2*this.standardPadding()}updateTone(){const t=self.$gameSystem.windowTone();this.setTone(t[0],t[1],t[2])}createContents(){this.contents?this.contents.clear():(this.contents=new BitmapPIXI(this.contentsWidth(),this.contentsHeight()),this._windowContentsSprite.addChild(this.contents)),this.resetFontSettings()}resetFontSettings(){this.contents.fontFace=this.standardFontFace(),this.contents.fontSize=this.standardFontSize(),this.resetTextColor()}resetTextColor(){this.changeTextColor(this.normalColor())}update(){super.update(),this.updateTone(),this.updateOpen(),this.updateClose(),this.updateBackgroundDimmer()}updateOpen(){this._opening&&(this.openness+=32,this.isOpen()&&(this._opening=!1))}updateClose(){this._closing&&(this.openness-=32,this.isClosed()&&(this._closing=!1))}open(){this.isOpen()||(this._opening=!0),this._closing=!1}close(){this.isClosed()||(this._closing=!0),this._opening=!1}isOpening(){return this._opening}isClosing(){return this._closing}show(){this.visible=!0}hide(){this.visible=!1}activate(){this.active=!0}deactivate(){this.active=!1}textColor(t){const e=96+t%8*12+6,i=144+12*Math.floor(t/8)+6;return this.windowskin.getPixel(e,i)}normalColor(){return this.textColor(0)}systemColor(){return this.textColor(16)}crisisColor(){return this.textColor(17)}deathColor(){return this.textColor(18)}gaugeBackColor(){return this.textColor(19)}hpGaugeColor1(){return this.textColor(20)}hpGaugeColor2(){return this.textColor(21)}mpGaugeColor1(){return this.textColor(22)}mpGaugeColor2(){return this.textColor(23)}mpCostColor(){return this.textColor(23)}powerUpColor(){return this.textColor(24)}powerDownColor(){return this.textColor(25)}tpGaugeColor1(){return this.textColor(28)}tpGaugeColor2(){return this.textColor(29)}tpCostColor(){return this.textColor(29)}pendingColor(){return this.windowskin.getPixel(120,120)}translucentOpacity(){return 160}changeTextColor(t){this.contents.textColor=t}changePaintOpacity(t){this.contents.paintOpacity=t?255:this.translucentOpacity()}drawText(t,e,i,s,a){this.contents.drawText(t,e,i,s,this.lineHeight(),a)}textWidth(t){return this.contents.measureTextWidth(t)}drawTextEx(t,e,i){if(t){const s={index:0,x:e,y:i,left:e};for(s.text=this.convertEscapeCharacters(t),s.height=this.calcTextHeight(s,!1),this.resetFontSettings();s.index<s.text.length;)this.processCharacter(s);return s.x-e}return 0}convertEscapeCharacters(t){return(t=(t=(t=(t=(t=(t=t.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(...t){return self.$gameVariables.value(parseInt(t[1]))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(...t){return self.$gameVariables.value(parseInt(t[1]))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(...t){return this.actorName(parseInt(t[1]))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(...t){return this.partyMemberName(parseInt(t[1]))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)}actorName(t){const e=t>=1?self.$gameActors.actor(t):null;return e?e.name():""}partyMemberName(t){const e=t>=1?self.$gameParty.members()[t-1]:null;return e?e.name():""}processCharacter(t){switch(t.text[t.index]){case"\n":this.processNewLine(t);break;case"\f":this.processNewPage(t);break;case"":this.processEscapeCharacter(this.obtainEscapeCode(t),t);break;default:this.processNormalCharacter(t)}}processNormalCharacter(t){const e=t.text[t.index++],i=this.textWidth(e);this.contents.drawText(e,t.x,t.y,2*i,t.height),t.x+=i}processNewLine(t){t.x=t.left,t.y+=t.height,t.height=this.calcTextHeight(t,!1),t.index++}processNewPage(t){t.index++}obtainEscapeCode(t){t.index++;const e=/^[\$\.\|\^!><\{\}\\]|^[A-Z]+/i.exec(t.text.slice(t.index));return e?(t.index+=e[0].length,e[0].toUpperCase()):""}obtainEscapeParam(t){const e=/^\[\d+\]/.exec(t.text.slice(t.index));return e?(t.index+=e[0].length,parseInt(e[0].slice(1))):""}processEscapeCharacter(t,e){switch(t){case"C":this.changeTextColor(this.textColor(this.obtainEscapeParam(e)));break;case"I":this.processDrawIcon(this.obtainEscapeParam(e),e);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller()}}processDrawIcon(t,e){this.drawIcon(t,e.x+2,e.y+2),e.x+=Window_Base._iconWidth+4}makeFontBigger(){this.contents.fontSize<=96&&(this.contents.fontSize+=12)}makeFontSmaller(){this.contents.fontSize>=24&&(this.contents.fontSize-=12)}calcTextHeight({text:t,index:e},i){const s=this.contents.fontSize;let a=0;const r=t.slice(e).split("\n"),n=i?r.length:1;for(let t=0;t<n;t++){let e=this.contents.fontSize;const i=/\x1b[\{\}]/g;for(;;){const s=i.exec(r[t]);if(!s)break;"{"===s[0]&&this.makeFontBigger(),"}"===s[0]&&this.makeFontSmaller(),e<this.contents.fontSize&&(e=this.contents.fontSize)}a+=e+8}return this.contents.fontSize=s,a}drawIcon(t,e,i){const s=ImageManager.loadSystem("IconSet"),a=Window_Base._iconWidth,r=Window_Base._iconHeight,n=t%16*a,h=Math.floor(t/16)*r;this.contents.blt(s,n,h,a,r,e,i)}drawFace(t,e,i,s,a=Window_Base._faceWidth,r=Window_Base._faceHeight){const n=ImageManager.loadFace(t),h=Window_Base._faceWidth,o=Window_Base._faceHeight,l=Math.min(a,h),c=Math.min(r,o),d=Math.floor(i+Math.max(a-h,0)/2),m=Math.floor(s+Math.max(r-o,0)/2),u=e%4*h+(h-l)/2,p=Math.floor(e/4)*o+(o-c)/2;this.contents.blt(n,u,p,l,c,d,m)}drawCharacter(t,e,i,s){const a=ImageManager.loadCharacter(t),r=ImageManager.isBigCharacter(t),n=a.width/(r?3:12),h=a.height/(r?4:8),o=r?0:e,l=(o%4*3+1)*n,c=4*Math.floor(o/4)*h;this.contents.blt(a,l,c,n,h,i-n/2,s-h)}drawGauge(t,e,i,s,a,r){const n=Math.floor(i*s),h=e+this.lineHeight()-8;this.contents.fillRect(t,h,i,6,this.gaugeBackColor()),this.contents.gradientFillRect(t,h,n,6,a,r)}hpColor(t){return t.isDead()?this.deathColor():t.isDying()?this.crisisColor():this.normalColor()}mpColor(t){return this.normalColor()}tpColor(t){return this.normalColor()}drawActorCharacter(t,e,i){this.drawCharacter(t.characterName(),t.characterIndex(),e,i)}drawActorFace(t,e,i,s,a){this.drawFace(t.faceName(),t.faceIndex(),e,i,s,a)}drawActorName(t,e,i,s=168){this.changeTextColor(this.hpColor(t)),this.drawText(t.name(),e,i,s)}drawActorClass(t,e,i,s=168){this.resetTextColor(),this.drawText(t.currentClass().name,e,i,s)}drawActorNickname(t,e,i,s=270){this.resetTextColor(),this.drawText(t.nickname(),e,i,s)}drawActorLevel({level:t},e,i){this.changeTextColor(this.systemColor()),this.drawText(TextManager.levelA,e,i,48),this.resetTextColor(),this.drawText(t,e+84,i,36,"right")}drawActorIcons(t,e,i,s=144){const a=t.allIcons().slice(0,Math.floor(s/Window_Base._iconWidth));for(let t=0;t<a.length;t++)this.drawIcon(a[t],e+Window_Base._iconWidth*t,i+2)}drawCurrentAndMax(t,e,i,s,a,r,n){const h=this.textWidth("HP"),o=this.textWidth("0000"),l=this.textWidth("/"),c=i+a-o,d=c-l,m=d-o;m>=i+h?(this.changeTextColor(r),this.drawText(t,m,s,o,"right"),this.changeTextColor(n),this.drawText("/",d,s,l,"right"),this.drawText(e,c,s,o,"right")):(this.changeTextColor(r),this.drawText(t,c,s,o,"right"))}drawActorHp(t,e,i,s=186){const a=this.hpGaugeColor1(),r=this.hpGaugeColor2();this.drawGauge(e,i,s,t.hpRate(),a,r),this.changeTextColor(this.systemColor()),this.drawText(TextManager.hpA,e,i,44),this.drawCurrentAndMax(t.hp,t.mhp,e,i,s,this.hpColor(t),this.normalColor())}drawActorMp(t,e,i,s=186){const a=this.mpGaugeColor1(),r=this.mpGaugeColor2();this.drawGauge(e,i,s,t.mpRate(),a,r),this.changeTextColor(this.systemColor()),this.drawText(TextManager.mpA,e,i,44),this.drawCurrentAndMax(t.mp,t.mmp,e,i,s,this.mpColor(t),this.normalColor())}drawActorTp(t,e,i,s=96){const a=this.tpGaugeColor1(),r=this.tpGaugeColor2();this.drawGauge(e,i,s,t.tpRate(),a,r),this.changeTextColor(this.systemColor()),this.drawText(TextManager.tpA,e,i,44),this.changeTextColor(this.tpColor(t)),this.drawText(t.tp,e+s-64,i,64,"right")}drawActorSimpleStatus(t,e,i,s){const a=this.lineHeight(),r=e+180,n=Math.min(200,s-180-this.textPadding());this.drawActorName(t,e,i),this.drawActorLevel(t,e,i+1*a),this.drawActorIcons(t,e,i+2*a),this.drawActorClass(t,r,i),this.drawActorHp(t,r,i+1*a,n),this.drawActorMp(t,r,i+2*a,n)}drawItemName(t,e,i,s=312){if(t){const a=Window_Base._iconWidth+4;this.resetTextColor(),this.drawIcon(t.iconIndex,e+2,i+2),this.drawText(t.name,e+a,i,s-a)}}drawCurrencyValue(t,e,i,s,a){const r=Math.min(80,this.textWidth(e));this.resetTextColor(),this.drawText(t,i,s,a-r-6,"right"),this.changeTextColor(this.systemColor()),this.drawText(e,i+a-r,s,r,"right")}paramchangeTextColor(t){return t>0?this.powerUpColor():t<0?this.powerDownColor():this.normalColor()}setBackgroundType(t){this.opacity=0===t?255:0,1===t?this.showBackgroundDimmer():this.hideBackgroundDimmer()}showBackgroundDimmer(){this._dimmerSprite||(this._dimmerSprite=new Sprite,this._dimmerSprite.bitmap=new Bitmap(0,0),this.addChildToBack(this._dimmerSprite));const t=this._dimmerSprite.bitmap;t.width===this.width&&t.height===this.height||this.refreshDimmerBitmap(),this._dimmerSprite.visible=!0,this.updateBackgroundDimmer()}hideBackgroundDimmer(){this._dimmerSprite&&(this._dimmerSprite.visible=!1)}updateBackgroundDimmer(){this._dimmerSprite&&(this._dimmerSprite.opacity=this.openness)}refreshDimmerBitmap(){if(this._dimmerSprite){const t=this._dimmerSprite.bitmap,e=this.width,i=this.height,s=this.padding,a=this.dimColor1(),r=this.dimColor2();t.resize(e,i),t.gradientFillRect(0,0,e,s,r,a,!0),t.fillRect(0,s,e,i-2*s,a),t.gradientFillRect(0,i-s,e,s,a,r,!0),this._dimmerSprite.setFrame(0,0,e,i)}}dimColor1(){return"rgba(0, 0, 0, 0.6)"}dimColor2(){return"rgba(0, 0, 0, 0)"}canvasToLocalX(t){let e=this;for(;e;)t-=e.x,e=e.parent;return t}canvasToLocalY(t){let e=this;for(;e;)t-=e.y,e=e.parent;return t}reserveFaceImages(){self.$gameParty.members().forEach((t=>{ImageManager.reserveFace(t.faceName())}),this)}}Window_Base._iconWidth=32,Window_Base._iconHeight=32,Window_Base._faceWidth=144,Window_Base._faceHeight=144;class Window_Help extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t){const e=Graphics$1.boxWidth,i=this.fittingHeight(t||2);super.initialize(0,0,e,i),this._text=""}setText(t){this._text!==t&&(this._text=t,this.refresh())}clear(){this.setText("")}setItem(t){this.setText(t?t.description:"")}refresh(){this.contents.clear(),this.drawTextEx(this._text,this.textPadding(),0)}}class Window_Gold extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){const i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh()}windowWidth(){return 240}windowHeight(){return this.fittingHeight(1)}refresh(){const t=this.textPadding(),e=this.contents.width-2*this.textPadding();this.contents.clear(),this.drawCurrencyValue(this.value(),this.currencyUnit(),t,0,e)}value(){return self.$gameParty.gold()}currencyUnit(){return TextManager.currencyUnit}open(){this.refresh(),super.open()}}class Window_Selectable extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._index=-1,this._cursorFixed=!1,this._cursorAll=!1,this._stayCount=0,this._helpWindow=null,this._handlers={},this._touching=!1,this._scrollX=0,this._scrollY=0,this.deactivate()}index(){return this._index}cursorFixed(){return this._cursorFixed}setCursorFixed(t){this._cursorFixed=t}cursorAll(){return this._cursorAll}setCursorAll(t){this._cursorAll=t}maxCols(){return 1}maxItems(){return 0}spacing(){return 12}itemWidth(){return Math.floor((this.width-2*this.padding+this.spacing())/this.maxCols()-this.spacing())}itemHeight(){return this.lineHeight()}maxRows(){return Math.max(Math.ceil(this.maxItems()/this.maxCols()),1)}activate(){super.activate(),this.reselect()}deactivate(){super.deactivate(),this.reselect()}select(t){this._index=t,this._stayCount=0,this.ensureCursorVisible(),this.updateCursor(),this.callUpdateHelp()}deselect(){this.select(-1)}reselect(){this.select(this._index)}row(){return Math.floor(this.index()/this.maxCols())}topRow(){return Math.floor(this._scrollY/this.itemHeight())}maxTopRow(){return Math.max(0,this.maxRows()-this.maxPageRows())}setTopRow(t){const e=t.clamp(0,this.maxTopRow())*this.itemHeight();this._scrollY!==e&&(this._scrollY=e,this.refresh(),this.updateCursor())}resetScroll(){this.setTopRow(0)}maxPageRows(){const t=this.height-2*this.padding;return Math.floor(t/this.itemHeight())}maxPageItems(){return this.maxPageRows()*this.maxCols()}isHorizontal(){return 1===this.maxPageRows()}bottomRow(){return Math.max(0,this.topRow()+this.maxPageRows()-1)}setBottomRow(t){this.setTopRow(t-(this.maxPageRows()-1))}topIndex(){return this.topRow()*this.maxCols()}itemRect(t){const e=new Rectangle,i=this.maxCols();return e.width=this.itemWidth(),e.height=this.itemHeight(),e.x=t%i*(e.width+this.spacing())-this._scrollX,e.y=Math.floor(t/i)*e.height-this._scrollY,e}itemRectForText(t){const e=this.itemRect(t);return e.x+=this.textPadding(),e.width-=2*this.textPadding(),e}setHelpWindow(t){this._helpWindow=t,this.callUpdateHelp()}showHelpWindow(){this._helpWindow&&this._helpWindow.show()}hideHelpWindow(){this._helpWindow&&this._helpWindow.hide()}setHandler(t,e){this._handlers[t]=e}isHandled(t){return!!this._handlers[t]}callHandler(t){this.isHandled(t)&&this._handlers[t]()}isOpenAndActive(){return this.isOpen()&&this.active}isCursorMovable(){return this.isOpenAndActive()&&!this._cursorFixed&&!this._cursorAll&&this.maxItems()>0}cursorDown(t){const e=this.index(),i=this.maxItems(),s=this.maxCols();(e<i-s||t&&1===s)&&this.select((e+s)%i)}cursorUp(t){const e=this.index(),i=this.maxItems(),s=this.maxCols();(e>=s||t&&1===s)&&this.select((e-s+i)%i)}cursorRight(t){const e=this.index(),i=this.maxItems();this.maxCols()>=2&&(e<i-1||t&&this.isHorizontal())&&this.select((e+1)%i)}cursorLeft(t){const e=this.index(),i=this.maxItems();this.maxCols()>=2&&(e>0||t&&this.isHorizontal())&&this.select((e-1+i)%i)}cursorPagedown(){const t=this.index(),e=this.maxItems();this.topRow()+this.maxPageRows()<this.maxRows()&&(this.setTopRow(this.topRow()+this.maxPageRows()),this.select(Math.min(t+this.maxPageItems(),e-1)))}cursorPageup(){const t=this.index();this.topRow()>0&&(this.setTopRow(this.topRow()-this.maxPageRows()),this.select(Math.max(t-this.maxPageItems(),0)))}scrollDown(){this.topRow()+1<this.maxRows()&&this.setTopRow(this.topRow()+1)}scrollUp(){this.topRow()>0&&this.setTopRow(this.topRow()-1)}update(){super.update(),this.updateArrows(),this.processCursorMove(),this.processHandling(),this.processWheel(),this.processTouch(),this._stayCount++}updateArrows(){const t=this.topRow(),e=this.maxTopRow();this.downArrowVisible=e>0&&t<e,this.upArrowVisible=t>0}processCursorMove(){if(this.isCursorMovable()){const t=this.index();Input.isRepeated("down")&&this.cursorDown(Input.isTriggered("down")),Input.isRepeated("up")&&this.cursorUp(Input.isTriggered("up")),Input.isRepeated("right")&&this.cursorRight(Input.isTriggered("right")),Input.isRepeated("left")&&this.cursorLeft(Input.isTriggered("left")),!this.isHandled("pagedown")&&Input.isTriggered("pagedown")&&this.cursorPagedown(),!this.isHandled("pageup")&&Input.isTriggered("pageup")&&this.cursorPageup(),this.index()!==t&&SoundManager.playCursor()}}processHandling(){this.isOpenAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()?this.processCancel():this.isHandled("pagedown")&&Input.isTriggered("pagedown")?this.processPagedown():this.isHandled("pageup")&&Input.isTriggered("pageup")&&this.processPageup())}processWheel(){if(this.isOpenAndActive()){const t=20;TouchInput.wheelY>=t&&this.scrollDown(),TouchInput.wheelY<=-t&&this.scrollUp()}}processTouch(){this.isOpenAndActive()?(TouchInput.isTriggered()&&this.isTouchedInsideFrame()?(this._touching=!0,this.onTouch(!0)):TouchInput.isCancelled()&&this.isCancelEnabled()&&this.processCancel(),this._touching&&(TouchInput.isPressed()?this.onTouch(!1):this._touching=!1)):this._touching=!1}isTouchedInsideFrame(){const t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y);return t>=0&&e>=0&&t<this.width&&e<this.height}onTouch(t){const e=this.index(),i=this.canvasToLocalX(TouchInput.x),s=this.canvasToLocalY(TouchInput.y),a=this.hitTest(i,s);a>=0?a===this.index()?t&&this.isTouchOkEnabled()&&this.processOk():this.isCursorMovable()&&this.select(a):this._stayCount>=10&&(s<this.padding?this.cursorUp():s>=this.height-this.padding&&this.cursorDown()),this.index()!==e&&SoundManager.playCursor()}hitTest(t,e){if(this.isContentsArea(t,e)){const i=t-this.padding,s=e-this.padding,a=this.topIndex();for(let t=0;t<this.maxPageItems();t++){const e=a+t;if(e<this.maxItems()){const t=this.itemRect(e),a=t.x+t.width,r=t.y+t.height;if(i>=t.x&&s>=t.y&&i<a&&s<r)return e}}}return-1}isContentsArea(t,e){const i=this.padding,s=this.padding,a=this.width-this.padding,r=this.height-this.padding;return t>=i&&e>=s&&t<a&&e<r}isTouchOkEnabled(){return this.isOkEnabled()}isOkEnabled(){return this.isHandled("ok")}isCancelEnabled(){return this.isHandled("cancel")}isOkTriggered(){return Input.isRepeated("ok")}isCancelTriggered(){return Input.isRepeated("cancel")}processOk(){this.isCurrentItemEnabled()?(this.playOkSound(),this.updateInputData(),this.deactivate(),this.callOkHandler()):this.playBuzzerSound()}playOkSound(){SoundManager.playOk()}playBuzzerSound(){SoundManager.playBuzzer()}callOkHandler(){this.callHandler("ok")}processCancel(){SoundManager.playCancel(),this.updateInputData(),this.deactivate(),this.callCancelHandler()}callCancelHandler(){this.callHandler("cancel")}processPageup(){SoundManager.playCursor(),this.updateInputData(),this.deactivate(),this.callHandler("pageup")}processPagedown(){SoundManager.playCursor(),this.updateInputData(),this.deactivate(),this.callHandler("pagedown")}updateInputData(){Input.update(),TouchInput.update()}updateCursor(){if(this._cursorAll){const t=this.maxRows()*this.itemHeight();this.setCursorRect(0,0,this.contents.width,t),this.setTopRow(0)}else if(this.isCursorVisible()){const t=this.itemRect(this.index());this.setCursorRect(t.x,t.y,t.width,t.height)}else this.setCursorRect(0,0,0,0)}isCursorVisible(){const t=this.row();return t>=this.topRow()&&t<=this.bottomRow()}ensureCursorVisible(){const t=this.row();t<this.topRow()?this.setTopRow(t):t>this.bottomRow()&&this.setBottomRow(t)}callUpdateHelp(){this.active&&this._helpWindow&&this.updateHelp()}updateHelp(){this._helpWindow.clear()}setHelpWindowItem(t){this._helpWindow&&this._helpWindow.setItem(t)}isCurrentItemEnabled(){return!0}drawAllItems(){const t=this.topIndex();for(let e=0;e<this.maxPageItems();e++){const i=t+e;i<this.maxItems()&&this.drawItem(i)}}drawItem(t){}clearItem(t){const e=this.itemRect(t);this.contents.clearRect(e.x,e.y,e.width,e.height)}redrawItem(t){t>=0&&(this.clearItem(t),this.drawItem(t))}redrawCurrentItem(){this.redrawItem(this.index())}refresh(){this.contents&&(this.contents.clear(),this.drawAllItems())}}class Window_Command extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this.clearCommandList(),this.makeCommandList();const i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh(),this.select(0),this.activate()}windowWidth(){return 240}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return Math.ceil(this.maxItems()/this.maxCols())}maxItems(){return this._list.length}clearCommandList(){this._list=[]}makeCommandList(){}addCommand(t,e,i,s){void 0===i&&(i=!0),void 0===s&&(s=null),this._list.push({name:t,symbol:e,enabled:i,ext:s})}commandName(t){return this._list[t].name}commandSymbol(t){return this._list[t].symbol}isCommandEnabled(t){return this._list[t].enabled}currentData(){return this.index()>=0?this._list[this.index()]:null}isCurrentItemEnabled(){return!!this.currentData()&&this.currentData().enabled}currentSymbol(){return this.currentData()?this.currentData().symbol:null}currentExt(){return this.currentData()?this.currentData().ext:null}findSymbol(t){for(let e=0;e<this._list.length;e++)if(this._list[e].symbol===t)return e;return-1}selectSymbol(t){const e=this.findSymbol(t);e>=0?this.select(e):this.select(0)}findExt(t){for(let e=0;e<this._list.length;e++)if(this._list[e].ext===t)return e;return-1}selectExt(t){const e=this.findExt(t);e>=0?this.select(e):this.select(0)}drawItem(t){const e=this.itemRectForText(t),i=this.itemTextAlign();this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(t)),this.drawText(this.commandName(t),e.x,e.y,e.width,i)}itemTextAlign(){return"left"}isOkEnabled(){return!0}callOkHandler(){const t=this.currentSymbol();this.isHandled(t)?this.callHandler(t):this.isHandled("ok")?super.callOkHandler():this.activate()}refresh(){this.clearCommandList(),this.makeCommandList(),this.createContents(),super.refresh()}}class Window_ChoiceList extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(t){this._messageWindow=t,super.initialize(0,0),this.openness=0,this.deactivate(),this._background=0}start(){this.updatePlacement(),this.updateBackground(),this.refresh(),this.selectDefault(),this.open(),this.activate()}selectDefault(){this.select(self.$gameMessage.choiceDefaultType())}updatePlacement(){const t=self.$gameMessage.choicePositionType(),e=this._messageWindow.y;switch(this.width=this.windowWidth(),this.height=this.windowHeight(),t){case 0:this.x=0;break;case 1:this.x=(Graphics$1.boxWidth-this.width)/2;break;case 2:this.x=Graphics$1.boxWidth-this.width}e>=Graphics$1.boxHeight/2?this.y=e-this.height:this.y=e+this._messageWindow.height}updateBackground(){this._background=self.$gameMessage.choiceBackground(),this.setBackgroundType(this._background)}windowWidth(){const t=this.maxChoiceWidth()+2*this.padding;return Math.min(t,Graphics$1.boxWidth)}numVisibleRows(){const t=this._messageWindow.y,e=this._messageWindow.height,i=Graphics$1.boxHeight/2;let s=self.$gameMessage.choices().length,a=8;return t<i&&t+e>i&&(a=4),s>a&&(s=a),s}maxChoiceWidth(){let t=96;const e=self.$gameMessage.choices();for(let i=0;i<e.length;i++){const s=this.textWidthEx(e[i])+2*this.textPadding();t<s&&(t=s)}return t}textWidthEx(t){return this.drawTextEx(t,0,this.contents.height)}contentsHeight(){return this.maxItems()*this.itemHeight()}makeCommandList(){const t=self.$gameMessage.choices();for(let e=0;e<t.length;e++)this.addCommand(t[e],"choice")}drawItem(t){const e=this.itemRectForText(t);this.drawTextEx(this.commandName(t),e.x,e.y)}isCancelEnabled(){return-1!==self.$gameMessage.choiceCancelType()}isOkTriggered(){return Input.isTriggered("ok")}callOkHandler(){self.$gameMessage.onChoice(this.index()),this._messageWindow.terminateMessage(),this.close()}callCancelHandler(){self.$gameMessage.onChoice(self.$gameMessage.choiceCancelType()),this._messageWindow.terminateMessage(),this.close()}}class Sprite_Button extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._touching=!1,this._coldFrame=null,this._hotFrame=null,this._clickHandler=null}update(){super.update(),this.updateFrame(),this.processTouch()}updateFrame(){let t;t=this._touching?this._hotFrame:this._coldFrame,t&&this.setFrame(t.x,t.y,t.width,t.height)}setColdFrame(t,e,i,s){this._coldFrame=new Rectangle(t,e,i,s)}setHotFrame(t,e,i,s){this._hotFrame=new Rectangle(t,e,i,s)}setClickHandler(t){this._clickHandler=t}callClickHandler(){this._clickHandler&&this._clickHandler()}processTouch(){this.isActive()?(TouchInput.isTriggered()&&this.isButtonTouched()&&(this._touching=!0),this._touching&&(!TouchInput.isReleased()&&this.isButtonTouched()||(this._touching=!1,TouchInput.isReleased()&&this.callClickHandler()))):this._touching=!1}isActive(){let t=this;for(;t;){if(!t.visible)return!1;t=t.parent}return!0}isButtonTouched(){const t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y);return t>=0&&e>=0&&t<this.width&&e<this.height}canvasToLocalX(t){let e=this;for(;e;)t-=e.x,e=e.parent;return t}canvasToLocalY(t){let e=this;for(;e;)t-=e.y,e=e.parent;return t}}class Window_NumberInput extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t){this._messageWindow=t,super.initialize(0,0,0,0),this._number=0,this._maxDigits=1,this.openness=0,this.createButtons(),this.deactivate()}start(){this._maxDigits=self.$gameMessage.numInputMaxDigits(),this._number=self.$gameVariables.value(self.$gameMessage.numInputVariableId()),this._number=this._number.clamp(0,Math.pow(10,this._maxDigits)-1),this.updatePlacement(),this.placeButtons(),this.updateButtonsVisiblity(),this.createContents(),this.refresh(),this.open(),this.activate(),this.select(0)}updatePlacement(){const t=this._messageWindow.y;this.width=this.windowWidth(),this.height=this.windowHeight(),this.x=(Graphics$1.boxWidth-this.width)/2,t>=Graphics$1.boxHeight/2?this.y=t-this.height-8:this.y=t+this._messageWindow.height+8}windowWidth(){return this.maxCols()*this.itemWidth()+2*this.padding}windowHeight(){return this.fittingHeight(1)}maxCols(){return this._maxDigits}maxItems(){return this._maxDigits}spacing(){return 0}itemWidth(){return 32}createButtons(){const t=ImageManager.loadSystem("ButtonSet");this._buttons=[];for(let e=0;e<3;e++){const i=new Sprite_Button,s=48*[1,2,4][e],a=48*(2===e?2:1);i.bitmap=t,i.setColdFrame(s,0,a,48),i.setHotFrame(s,48,a,48),i.visible=!1,this._buttons.push(i),this.addChild(i)}this._buttons[0].setClickHandler(this.onButtonDown.bind(this)),this._buttons[1].setClickHandler(this.onButtonUp.bind(this)),this._buttons[2].setClickHandler(this.onButtonOk.bind(this))}placeButtons(){const t=this._buttons.length;let e=-16;for(let i=0;i<t;i++)e+=this._buttons[i].width+16;let i=(this.width-e)/2;for(let e=0;e<t;e++){const t=this._buttons[e];t.x=i,t.y=this.buttonY(),i+=t.width+16}}updateButtonsVisiblity(){TouchInput.date>Input.date?this.showButtons():this.hideButtons()}showButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!0}hideButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!1}buttonY(){return this._messageWindow.y>=Graphics$1.boxHeight/2?0-this._buttons[0].height-8:this.height+8}update(){super.update(),this.processDigitChange()}processDigitChange(){this.isOpenAndActive()&&(Input.isRepeated("up")?this.changeDigit(!0):Input.isRepeated("down")&&this.changeDigit(!1))}changeDigit(t){const e=this.index(),i=Math.pow(10,this._maxDigits-1-e);let s=Math.floor(this._number/i)%10;this._number-=s*i,s=t?(s+1)%10:(s+9)%10,this._number+=s*i,this.refresh(),SoundManager.playCursor()}isTouchOkEnabled(){return!1}isOkEnabled(){return!0}isCancelEnabled(){return!1}isOkTriggered(){return Input.isTriggered("ok")}processOk(){SoundManager.playOk(),self.$gameVariables.setValue(self.$gameMessage.numInputVariableId(),this._number),this._messageWindow.terminateMessage(),this.updateInputData(),this.deactivate(),this.close()}drawItem(t){const e=this.itemRect(t),i=this._number.padZero(this._maxDigits).slice(t,t+1);this.resetTextColor(),this.drawText(i,e.x,e.y,e.width,"center")}onButtonUp(){this.changeDigit(!0)}onButtonDown(){this.changeDigit(!1)}onButtonOk(){this.processOk(),this.hideButtons()}}class Window_ItemList extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._category="none",this._data=[]}setCategory(t){this._category!==t&&(this._category=t,this.refresh(),this.resetScroll())}maxCols(){return 2}spacing(){return 48}maxItems(){return this._data?this._data.length:1}item(){const t=this.index();return this._data&&t>=0?this._data[t]:null}isCurrentItemEnabled(){return this.isEnabled(this.item())}includes(t){switch(this._category){case"item":return DataManager.isItem(t)&&1===t.itypeId;case"weapon":return DataManager.isWeapon(t);case"armor":return DataManager.isArmor(t);case"keyItem":return DataManager.isItem(t)&&2===t.itypeId;default:return!1}}needsNumber(){return!0}isEnabled(t){return self.$gameParty.canUse(t)}makeItemList(){this._data=self.$gameParty.allItems().filter((function(t){return this.includes(t)}),this),this.includes(null)&&this._data.push(null)}selectLast(){const t=this._data.indexOf(self.$gameParty.lastItem());this.select(t>=0?t:0)}drawItem(t){const e=this._data[t];if(e){const i=this.numberWidth(),s=this.itemRect(t);s.width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,s.x,s.y,s.width-i),this.drawItemNumber(e,s.x,s.y,s.width),this.changePaintOpacity(1)}}numberWidth(){return this.textWidth("000")}drawItemNumber(t,e,i,s){this.needsNumber()&&(this.drawText(":",e,i,s-this.textWidth("00"),"right"),this.drawText(self.$gameParty.numItems(t),e,i,s,"right"))}updateHelp(){this.setHelpWindowItem(this.item())}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}}class Window_EventItem extends Window_ItemList{constructor(...t){super(...t),this.initialize(...t)}initialize(t){this._messageWindow=t;const e=Graphics$1.boxWidth,i=this.windowHeight();super.initialize(0,0,e,i),this.openness=0,this.deactivate(),this.setHandler("ok",this.onOk.bind(this)),this.setHandler("cancel",this.onCancel.bind(this))}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 4}start(){this.refresh(),this.updatePlacement(),this.select(0),this.open(),this.activate()}updatePlacement(){this._messageWindow.y>=Graphics$1.boxHeight/2?this.y=0:this.y=Graphics$1.boxHeight-this.height}includes(t){const e=self.$gameMessage.itemChoiceItypeId();return DataManager.isItem(t)&&t.itypeId===e}isEnabled(t){return!0}onOk(){const t=this.item(),e=t?t.id:0;self.$gameVariables.setValue(self.$gameMessage.itemChoiceVariableId(),e),this._messageWindow.terminateMessage(),this.close()}onCancel(){self.$gameVariables.setValue(self.$gameMessage.itemChoiceVariableId(),0),this._messageWindow.terminateMessage(),this.close()}}class Window_Message extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=this.windowWidth(),e=this.windowHeight(),i=(Graphics$1.boxWidth-t)/2;super.initialize(i,0,t,e),this.openness=0,this.initMembers(),this.createSubWindows(),this.updatePlacement()}initMembers(){this._imageReservationId=Utils.generateRuntimeId(),this._background=0,this._positionType=2,this._waitCount=0,this._faceBitmap=null,this._textState=null,this.clearFlags()}subWindows(){return[this._goldWindow,this._choiceWindow,this._numberWindow,this._itemWindow]}createSubWindows(){this._goldWindow=new Window_Gold(0,0),this._goldWindow.x=Graphics$1.boxWidth-this._goldWindow.width,this._goldWindow.openness=0,this._choiceWindow=new Window_ChoiceList(this),this._numberWindow=new Window_NumberInput(this),this._itemWindow=new Window_EventItem(this)}windowWidth(){return Graphics$1.boxWidth}windowHeight(){return this.fittingHeight(this.numVisibleRows())}clearFlags(){this._showFast=!1,this._lineShowFast=!1,this._pauseSkip=!1,this._textSpeed=0,this._textSpeedCount=0}numVisibleRows(){return 4}update(){for(this.checkToNotClose(),super.update();!this.isOpening()&&!this.isClosing();){if(this.updateWait())return;if(this.updateLoading())return;if(this.updateInput())return;if(this.updateMessage())return;if(!this.canStart())return void this.startInput();this.startMessage()}}checkToNotClose(){this.isClosing()&&this.isOpen()&&this.doesContinue()&&this.open()}canStart(){return self.$gameMessage.hasText()&&!self.$gameMessage.scrollMode()}startMessage(){this._textState={},this._textState.index=0,this._textState.text=this.convertEscapeCharacters(self.$gameMessage.allText()),this.newPage(this._textState),this.updatePlacement(),this.updateBackground(),this.open()}updatePlacement(){this._positionType=self.$gameMessage.positionType(),this.y=this._positionType*(Graphics$1.boxHeight-this.height)/2,this._goldWindow.y=this.y>0?0:Graphics$1.boxHeight-this._goldWindow.height}updateBackground(){this._background=self.$gameMessage.background(),this.setBackgroundType(this._background)}terminateMessage(){this.close(),this._goldWindow.close(),self.$gameMessage.clear()}updateWait(){return this._waitCount>0&&(this._waitCount--,!0)}updateLoading(){return!(!this._faceBitmap||this._faceBitmap.isReady()&&(this.drawMessageFace(),this._faceBitmap=null,1))}updateInput(){return!!this.isAnySubWindowActive()||!!this.pause&&(this.isTriggered()&&(Input.update(),this.pause=!1,this._textState||this.terminateMessage()),!0)}isAnySubWindowActive(){return this._choiceWindow.active||this._numberWindow.active||this._itemWindow.active}updateMessage(){if(this._textState){for(;!this.isEndOfText(this._textState);){if(this.needsNewPage(this._textState)&&this.newPage(this._textState),this.updateShowFast(),!this._showFast&&!this._lineShowFast&&this._textSpeedCount<this._textSpeed){this._textSpeedCount++;break}if(this._textSpeedCount=0,this.processCharacter(this._textState),!this._showFast&&!this._lineShowFast&&-1!==this._textSpeed)break;if(this.pause||this._waitCount>0)break}return this.isEndOfText(this._textState)&&this.onEndOfText(),!0}return!1}onEndOfText(){this.startInput()||(this._pauseSkip?this.terminateMessage():this.startPause()),this._textState=null}startInput(){return self.$gameMessage.isChoice()?(this._choiceWindow.start(),!0):self.$gameMessage.isNumberInput()?(this._numberWindow.start(),!0):!!self.$gameMessage.isItemChoice()&&(this._itemWindow.start(),!0)}isTriggered(){return Input.isRepeated("ok")||Input.isRepeated("cancel")||TouchInput.isRepeated()}doesContinue(){return self.$gameMessage.hasText()&&!self.$gameMessage.scrollMode()&&!this.areSettingsChanged()}areSettingsChanged(){return this._background!==self.$gameMessage.background()||this._positionType!==self.$gameMessage.positionType()}updateShowFast(){this.isTriggered()&&(this._showFast=!0)}newPage(t){this.contents.clear(),this.resetFontSettings(),this.clearFlags(),this.loadMessageFace(),t.x=this.newLineX(),t.y=0,t.left=this.newLineX(),t.height=this.calcTextHeight(t,!1)}loadMessageFace(){this._faceBitmap=ImageManager.reserveFace(self.$gameMessage.faceName(),0,this._imageReservationId)}drawMessageFace(){this.drawFace(self.$gameMessage.faceName(),self.$gameMessage.faceIndex(),0,0),ImageManager.releaseReservation(this._imageReservationId)}newLineX(){return""===self.$gameMessage.faceName()?0:168}processNewLine(t){this._lineShowFast=!1,super.processNewLine(t),this.needsNewPage(t)&&this.startPause()}processNewPage(t){super.processNewPage(t),"\n"===t.text[t.index]&&t.index++,t.y=this.contents.height,this.startPause()}isEndOfText({index:t,text:e}){return t>=e.length}needsNewPage(t){return!this.isEndOfText(t)&&t.y+t.height>this.contents.height}processEscapeCharacter(t,e){switch(t){case"$":this._goldWindow.open();break;case".":this.startWait(15);break;case"|":this.startWait(60);break;case"!":this.startPause();break;case">":this._lineShowFast=!0;break;case"<":this._lineShowFast=!1;break;case"^":this._pauseSkip=!0;break;case"S":this._textSpeed=this.obtainEscapeParam(e)-1;break;default:super.processEscapeCharacter(t,e)}}startWait(t){this._waitCount=t}startPause(){this.startWait(10),this.pause=!0}}class Window_ScrollText extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=Graphics$1.boxWidth,e=Graphics$1.boxHeight;super.initialize(0,0,t,e),this.opacity=0,this.hide(),this._text="",this._allTextHeight=0}update(){super.update(),self.$gameMessage.scrollMode()&&(this._text&&this.updateMessage(),!this._text&&self.$gameMessage.hasText()&&this.startMessage())}startMessage(){this._text=self.$gameMessage.allText(),this.refresh(),this.show()}refresh(){const t={index:0};t.text=this.convertEscapeCharacters(this._text),this.resetFontSettings(),this._allTextHeight=this.calcTextHeight(t,!0),this.createContents(),this.origin.y=-this.height,this.drawTextEx(this._text,this.textPadding(),1)}contentsHeight(){return Math.max(this._allTextHeight,1)}updateMessage(){this.origin.y+=this.scrollSpeed(),this.origin.y>=this.contents.height&&this.terminateMessage()}scrollSpeed(){let t=self.$gameMessage.scrollSpeed()/2;return this.isFastForward()&&(t*=this.fastForwardRate()),t}isFastForward(){return!self.$gameMessage.scrollNoFast()&&(Input.isPressed("ok")||Input.isPressed("shift")||TouchInput.isPressed())}fastForwardRate(){return 3}terminateMessage(){this._text=null,self.$gameMessage.clear(),this.hide()}}class Window_BattleLog extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=this.windowWidth(),e=this.windowHeight();super.initialize(0,0,t,e),this.opacity=0,this._lines=[],this._methods=[],this._waitCount=0,this._waitMode="",this._baseLineStack=[],this._spriteset=null,this.createBackBitmap(),this.createBackSprite(),this.refresh()}setSpriteset(t){this._spriteset=t}windowWidth(){return Graphics$1.boxWidth}windowHeight(){return this.fittingHeight(this.maxLines())}maxLines(){return 10}createBackBitmap(){this._backBitmap=new Bitmap(this.width,this.height)}createBackSprite(){this._backSprite=new Sprite,this._backSprite.bitmap=this._backBitmap,this._backSprite.y=this.y,this.addChildToBack(this._backSprite)}numLines(){return this._lines.length}messageSpeed(){return 16}isBusy(){return this._waitCount>0||this._waitMode||this._methods.length>0}update(){this.updateWait()||this.callNextMethod()}updateWait(){return this.updateWaitCount()||this.updateWaitMode()}updateWaitCount(){return this._waitCount>0&&(this._waitCount-=this.isFastForward()?3:1,this._waitCount<0&&(this._waitCount=0),!0)}updateWaitMode(){let t=!1;switch(this._waitMode){case"effect":t=this._spriteset.isEffecting();break;case"movement":t=this._spriteset.isAnyoneMoving()}return t||(this._waitMode=""),t}setWaitMode(t){this._waitMode=t}callNextMethod(){if(this._methods.length>0){const t=this._methods.shift();if(!t.name||!this[t.name])throw new Error(`Method not found: ${t.name}`);this[t.name](...t.params)}}isFastForward(){return Input.isLongPressed("ok")||Input.isPressed("shift")||TouchInput.isLongPressed()}push(t){const e=Array.prototype.slice.call(arguments,1);this._methods.push({name:t,params:e})}clear(){this._lines=[],this._baseLineStack=[],this.refresh()}wait(){this._waitCount=this.messageSpeed()}waitForEffect(){this.setWaitMode("effect")}waitForMovement(){this.setWaitMode("movement")}addText(t){this._lines.push(t),this.refresh(),this.wait()}pushBaseLine(){this._baseLineStack.push(this._lines.length)}popBaseLine(){const t=this._baseLineStack.pop();for(;this._lines.length>t;)this._lines.pop()}waitForNewLine(){let t=0;this._baseLineStack.length>0&&(t=this._baseLineStack[this._baseLineStack.length-1]),this._lines.length>t&&this.wait()}popupDamage(t){t.startDamagePopup()}performActionStart(t,e){t.performActionStart(e)}performAction(t,e){t.performAction(e)}performActionEnd(t){t.performActionEnd()}performDamage(t){t.performDamage()}performMiss(t){t.performMiss()}performRecovery(t){t.performRecovery()}performEvasion(t){t.performEvasion()}performMagicEvasion(t){t.performMagicEvasion()}performCounter(t){t.performCounter()}performReflection(t){t.performReflection()}performSubstitute(t,e){t.performSubstitute(e)}performCollapse(t){t.performCollapse()}showAnimation(t,e,i){i<0?this.showAttackAnimation(t,e):this.showNormalAnimation(e,i)}showAttackAnimation(t,e){t.isActor()?this.showActorAttackAnimation(t,e):this.showEnemyAttackAnimation(t,e)}showActorAttackAnimation(t,e){this.showNormalAnimation(e,t.attackAnimationId1(),!1),this.showNormalAnimation(e,t.attackAnimationId2(),!0)}showEnemyAttackAnimation(t,e){SoundManager.playEnemyAttack()}showNormalAnimation(t,e,i){if(self.$dataAnimations[e]){let s=this.animationBaseDelay();const a=this.animationNextDelay();t.forEach((t=>{t.startAnimation(e,i,s),s+=a}))}}animationBaseDelay(){return 8}animationNextDelay(){return 12}refresh(){this.drawBackground(),this.contents.clear();for(let t=0;t<this._lines.length;t++)this.drawLineText(t)}drawBackground(){const t=this.backRect(),e=this.backColor();this._backBitmap.clear(),this._backBitmap.paintOpacity=this.backPaintOpacity(),this._backBitmap.fillRect(t.x,t.y,t.width,t.height,e),this._backBitmap.paintOpacity=255}backRect(){return{x:0,y:this.padding,width:this.width,height:this.numLines()*this.lineHeight()}}backColor(){return"#000000"}backPaintOpacity(){return 64}drawLineText(t){const e=this.itemRectForText(t);this.contents.clearRect(e.x,e.y,e.width,e.height),this.drawTextEx(this._lines[t],e.x,e.y,e.width)}startTurn(){this.push("wait")}startAction(t,e,i){const s=e.item();this.push("performActionStart",t,e),this.push("waitForMovement"),this.push("performAction",t,e),this.push("showAnimation",t,i.clone(),s.animationId),this.displayAction(t,s)}endAction(t){this.push("waitForNewLine"),this.push("clear"),this.push("performActionEnd",t)}displayCurrentState(t){const e=t.mostImportantStateText();e&&(this.push("addText",t.name()+e),this.push("wait"),this.push("clear"))}displayRegeneration(t){this.push("popupDamage",t)}displayAction(t,e){const i=this._methods.length;DataManager.isSkill(e)?(e.message1&&this.push("addText",t.name()+e.message1.format(e.name)),e.message2&&this.push("addText",e.message2.format(e.name))):this.push("addText",TextManager.useItem.format(t.name(),e.name)),this._methods.length===i&&this.push("wait")}displayCounter(t){this.push("performCounter",t),this.push("addText",TextManager.counterAttack.format(t.name()))}displayReflection(t){this.push("performReflection",t),this.push("addText",TextManager.magicReflection.format(t.name()))}displaySubstitute(t,e){const i=t.name();this.push("performSubstitute",t,e),this.push("addText",TextManager.substitute.format(i,e.name()))}displayActionResults(t,e){e.result().used&&(this.push("pushBaseLine"),this.displayCritical(e),this.push("popupDamage",e),this.push("popupDamage",t),this.displayDamage(e),this.displayAffectedStatus(e),this.displayFailure(e),this.push("waitForNewLine"),this.push("popBaseLine"))}displayFailure(t){t.result().isHit()&&!t.result().success&&this.push("addText",TextManager.actionFailure.format(t.name()))}displayCritical(t){t.result().critical&&(t.isActor()?this.push("addText",TextManager.criticalToActor):this.push("addText",TextManager.criticalToEnemy))}displayDamage(t){t.result().missed?this.displayMiss(t):t.result().evaded?this.displayEvasion(t):(this.displayHpDamage(t),this.displayMpDamage(t),this.displayTpDamage(t))}displayMiss(t){let e;t.result().physical?(e=t.isActor()?TextManager.actorNoHit:TextManager.enemyNoHit,this.push("performMiss",t)):e=TextManager.actionFailure,this.push("addText",e.format(t.name()))}displayEvasion(t){let e;t.result().physical?(e=TextManager.evasion,this.push("performEvasion",t)):(e=TextManager.magicEvasion,this.push("performMagicEvasion",t)),this.push("addText",e.format(t.name()))}displayHpDamage(t){t.result().hpAffected&&(t.result().hpDamage>0&&!t.result().drain&&this.push("performDamage",t),t.result().hpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeHpDamageText(t)))}displayMpDamage(t){t.isAlive()&&0!==t.result().mpDamage&&(t.result().mpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeMpDamageText(t)))}displayTpDamage(t){t.isAlive()&&0!==t.result().tpDamage&&(t.result().tpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeTpDamageText(t)))}displayAffectedStatus(t){t.result().isStatusAffected()&&(this.push("pushBaseLine"),this.displayChangedStates(t),this.displayChangedBuffs(t),this.push("waitForNewLine"),this.push("popBaseLine"))}displayAutoAffectedStatus(t){t.result().isStatusAffected()&&(this.displayAffectedStatus(t,null),this.push("clear"))}displayChangedStates(t){this.displayAddedStates(t),this.displayRemovedStates(t)}displayAddedStates(t){t.result().addedStateObjects().forEach((function({message1:e,message2:i,id:s}){const a=t.isActor()?e:i;s===t.deathStateId()&&this.push("performCollapse",t),a&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",t.name()+a),this.push("waitForEffect"))}),this)}displayRemovedStates(t){t.result().removedStateObjects().forEach((function({message4:e}){e&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",t.name()+e))}),this)}displayChangedBuffs(t){const e=t.result();this.displayBuffs(t,e.addedBuffs,TextManager.buffAdd),this.displayBuffs(t,e.addedDebuffs,TextManager.debuffAdd),this.displayBuffs(t,e.removedBuffs,TextManager.buffRemove)}displayBuffs(t,e,i){e.forEach((function(e){this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",i.format(t.name(),TextManager.param(e)))}),this)}makeHpDamageText(t){const e=t.result(),i=e.hpDamage,s=t.isActor();let a;return i>0&&e.drain?(a=s?TextManager.actorDrain:TextManager.enemyDrain,a.format(t.name(),TextManager.hp,i)):i>0?(a=s?TextManager.actorDamage:TextManager.enemyDamage,a.format(t.name(),i)):i<0?(a=s?TextManager.actorRecovery:TextManager.enemyRecovery,a.format(t.name(),TextManager.hp,-i)):(a=s?TextManager.actorNoDamage:TextManager.enemyNoDamage,a.format(t.name()))}makeMpDamageText(t){const e=t.result(),i=e.mpDamage,s=t.isActor();let a;return i>0&&e.drain?(a=s?TextManager.actorDrain:TextManager.enemyDrain,a.format(t.name(),TextManager.mp,i)):i>0?(a=s?TextManager.actorLoss:TextManager.enemyLoss,a.format(t.name(),TextManager.mp,i)):i<0?(a=s?TextManager.actorRecovery:TextManager.enemyRecovery,a.format(t.name(),TextManager.mp,-i)):""}makeTpDamageText(t){const e=t.result().tpDamage,i=t.isActor();let s;return e>0?(s=i?TextManager.actorLoss:TextManager.enemyLoss,s.format(t.name(),TextManager.tp,e)):e<0?(s=i?TextManager.actorGain:TextManager.enemyGain,s.format(t.name(),TextManager.tp,-e)):""}}class Window_PartyCommand extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=Graphics$1.boxHeight-this.windowHeight();super.initialize(0,t),this.openness=0,this.deactivate()}windowWidth(){return 192}numVisibleRows(){return 4}makeCommandList(){this.addCommand(TextManager.fight,"fight"),this.addCommand(TextManager.escape,"escape",BattleManager.canEscape())}setup(){this.clearCommandList(),this.makeCommandList(),this.refresh(),this.select(0),this.activate(),this.open()}}class ConfigManager{constructor(){throw new Error("This is a static class")}static load(){let t,e={};try{t=StorageManager.load(-1)}catch(t){}t&&(e=JSON.parse(t)),this.applyData(e)}static save(){StorageManager.save(-1,JSON.stringify(this.makeData()))}static makeData(){const t={};return t.alwaysDash=this.alwaysDash,t.commandRemember=this.commandRemember,t.bgmVolume=this.bgmVolume,t.bgsVolume=this.bgsVolume,t.meVolume=this.meVolume,t.seVolume=this.seVolume,t}static applyData(t){this.alwaysDash=this.readFlag(t,"alwaysDash"),this.commandRemember=this.readFlag(t,"commandRemember"),this.bgmVolume=this.readVolume(t,"bgmVolume"),this.bgsVolume=this.readVolume(t,"bgsVolume"),this.meVolume=this.readVolume(t,"meVolume"),this.seVolume=this.readVolume(t,"seVolume")}static readFlag(t,e){return!!t[e]}static readVolume(t,e){const i=t[e];return void 0!==i?Number(i).clamp(0,100):100}}ConfigManager.alwaysDash=!1,ConfigManager.commandRemember=!1,Object.defineProperty(ConfigManager,"bgmVolume",{get:()=>AudioManager._bgmVolume,set(t){AudioManager.bgmVolume=t},configurable:!0}),Object.defineProperty(ConfigManager,"bgsVolume",{get:()=>AudioManager.bgsVolume,set(t){AudioManager.bgsVolume=t},configurable:!0}),Object.defineProperty(ConfigManager,"meVolume",{get:()=>AudioManager.meVolume,set(t){AudioManager.meVolume=t},configurable:!0}),Object.defineProperty(ConfigManager,"seVolume",{get:()=>AudioManager.seVolume,set(t){AudioManager.seVolume=t},configurable:!0});class Window_ActorCommand extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=Graphics$1.boxHeight-this.windowHeight();super.initialize(0,t),this.openness=0,this.deactivate(),this._actor=null}windowWidth(){return 192}numVisibleRows(){return 4}makeCommandList(){this._actor&&(this.addAttackCommand(),this.addSkillCommands(),this.addGuardCommand(),this.addItemCommand())}addAttackCommand(){this.addCommand(TextManager.attack,"attack",this._actor.canAttack())}addSkillCommands(){const t=this._actor.addedSkillTypes();t.sort(((t,e)=>t-e)),t.forEach((function(t){const e=self.$dataSystem.skillTypes[t];this.addCommand(e,"skill",!0,t)}),this)}addGuardCommand(){this.addCommand(TextManager.guard,"guard",this._actor.canGuard())}addItemCommand(){this.addCommand(TextManager.item,"item")}setup(t){this._actor=t,this.clearCommandList(),this.makeCommandList(),this.refresh(),this.selectLast(),this.activate(),this.open()}processOk(){this._actor&&(ConfigManager.commandRemember?this._actor.setLastCommandSymbol(this.currentSymbol()):this._actor.setLastCommandSymbol("")),super.processOk()}selectLast(){if(this.select(0),this._actor&&ConfigManager.commandRemember){const t=this._actor.lastCommandSymbol();if(this.selectSymbol(t),"skill"===t){const t=this._actor.lastBattleSkill();t&&this.selectExt(t.stypeId)}}}}class Window_BattleStatus extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=this.windowWidth(),e=this.windowHeight(),i=Graphics$1.boxWidth-t,s=Graphics$1.boxHeight-e;super.initialize(i,s,t,e),this.refresh(),this.openness=0}windowWidth(){return Graphics$1.boxWidth-192}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 4}maxItems(){return self.$gameParty.battleMembers().length}refresh(){this.contents.clear(),this.drawAllItems()}drawItem(t){const e=self.$gameParty.battleMembers()[t];this.drawBasicArea(this.basicAreaRect(t),e),this.drawGaugeArea(this.gaugeAreaRect(t),e)}basicAreaRect(t){const e=this.itemRectForText(t);return e.width-=this.gaugeAreaWidth()+15,e}gaugeAreaRect(t){const e=this.itemRectForText(t);return e.x+=e.width-this.gaugeAreaWidth(),e.width=this.gaugeAreaWidth(),e}gaugeAreaWidth(){return 330}drawBasicArea({x:t,y:e,width:i},s){this.drawActorName(s,t+0,e,150),this.drawActorIcons(s,t+156,e,i-156)}drawGaugeArea(t,e){self.$dataSystem.optDisplayTp?this.drawGaugeAreaWithTp(t,e):this.drawGaugeAreaWithoutTp(t,e)}drawGaugeAreaWithTp({x:t,y:e},i){this.drawActorHp(i,t+0,e,108),this.drawActorMp(i,t+123,e,96),this.drawActorTp(i,t+234,e,96)}drawGaugeAreaWithoutTp({x:t,y:e},i){this.drawActorHp(i,t+0,e,201),this.drawActorMp(i,t+216,e,114)}}class Window_BattleActor extends Window_BattleStatus{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(),this.x=t,this.y=e,this.openness=255,this.hide()}show(){this.select(0),super.show()}hide(){super.hide(),self.$gameParty.select(null)}select(t){super.select(t),self.$gameParty.select(this.actor())}actor(){return self.$gameParty.members()[this.index()]}}class Window_BattleEnemy extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this._enemies=[];const i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh(),this.hide()}windowWidth(){return Graphics$1.boxWidth-192}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 4}maxCols(){return 2}maxItems(){return this._enemies.length}enemy(){return this._enemies[this.index()]}enemyIndex(){const t=this.enemy();return t?t.index():-1}drawItem(t){this.resetTextColor();const e=this._enemies[t].name(),i=this.itemRectForText(t);this.drawText(e,i.x,i.y,i.width)}show(){this.refresh(),this.select(0),super.show()}hide(){super.hide(),self.$gameTroop.select(null)}refresh(){this._enemies=self.$gameTroop.aliveMembers(),super.refresh()}select(t){super.select(t),self.$gameTroop.select(this.enemy())}}class Window_SkillList extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null,this._stypeId=0,this._data=[]}setActor(t){this._actor!==t&&(this._actor=t,this.refresh(),this.resetScroll())}setStypeId(t){this._stypeId!==t&&(this._stypeId=t,this.refresh(),this.resetScroll())}maxCols(){return 2}spacing(){return 48}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}isCurrentItemEnabled(){return this.isEnabled(this._data[this.index()])}includes(t){return t&&t.stypeId===this._stypeId}isEnabled(t){return this._actor&&this._actor.canUse(t)}makeItemList(){this._actor?this._data=this._actor.skills().filter((function(t){return this.includes(t)}),this):this._data=[]}selectLast(){let t;t=self.$gameParty.inBattle()?this._actor.lastBattleSkill():this._actor.lastMenuSkill();const e=this._data.indexOf(t);this.select(e>=0?e:0)}drawItem(t){const e=this._data[t];if(e){const i=this.costWidth(),s=this.itemRect(t);s.width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,s.x,s.y,s.width-i),this.drawSkillCost(e,s.x,s.y,s.width),this.changePaintOpacity(1)}}costWidth(){return this.textWidth("000")}drawSkillCost(t,e,i,s){this._actor.skillTpCost(t)>0?(this.changeTextColor(this.tpCostColor()),this.drawText(this._actor.skillTpCost(t),e,i,s,"right")):this._actor.skillMpCost(t)>0&&(this.changeTextColor(this.mpCostColor()),this.drawText(this._actor.skillMpCost(t),e,i,s,"right"))}updateHelp(){this.setHelpWindowItem(this.item())}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}}class Window_BattleSkill extends Window_SkillList{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this.hide()}show(){this.selectLast(),this.showHelpWindow(),super.show()}hide(){this.hideHelpWindow(),super.hide()}}class Window_BattleItem extends Window_ItemList{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this.hide()}includes(t){return self.$gameParty.canUse(t)}show(){this.selectLast(),this.showHelpWindow(),super.show()}hide(){this.hideHelpWindow(),super.hide()}}class Scene_Battle extends Scene_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createDisplayObjects()}start(){super.start(),this.startFadeIn(this.fadeSpeed(),!1),BattleManager.playBattleBgm(),BattleManager.startBattle()}update(){const t=this.isActive();self.$gameTimer.update(t),self.$gameScreen.update(),this.updateStatusWindow(),this.updateWindowPositions(),t&&!this.isBusy()&&this.updateBattleProcess(),super.update()}updateBattleProcess(){(!this.isAnyInputWindowActive()||BattleManager.isAborting()||BattleManager.isBattleEnd())&&(BattleManager.update(),this.changeInputWindow())}isAnyInputWindowActive(){return this._partyCommandWindow.active||this._actorCommandWindow.active||this._skillWindow.active||this._itemWindow.active||this._actorWindow.active||this._enemyWindow.active}changeInputWindow(){BattleManager.isInputting()?BattleManager.actor()?this.startActorCommandSelection():this.startPartyCommandSelection():this.endCommandSelection()}stop(){super.stop(),this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):this.startFadeOut(this.fadeSpeed(),!1),this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()}terminate(){super.terminate(),self.$gameParty.onBattleEnd(),self.$gameTroop.onBattleEnd(),AudioManager.stopMe(),ImageManager.clearRequest()}needsSlowFadeOut(){return SceneManager.isNextScene(Scene_Title)||SceneManager.isNextScene(Scene_Gameover)}updateStatusWindow(){self.$gameMessage.isBusy()?(this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()):this.isActive()&&!this._messageWindow.isClosing()&&this._statusWindow.open()}updateWindowPositions(){let t=0;t=BattleManager.isInputting()?this._partyCommandWindow.width:this._partyCommandWindow.width/2,this._statusWindow.x<t&&(this._statusWindow.x+=16,this._statusWindow.x>t&&(this._statusWindow.x=t)),this._statusWindow.x>t&&(this._statusWindow.x-=16,this._statusWindow.x<t&&(this._statusWindow.x=t))}createDisplayObjects(){this.createSpriteset(),this.createWindowLayer(),this.createAllWindows(),BattleManager.setLogWindow(this._logWindow),BattleManager.setStatusWindow(this._statusWindow),BattleManager.setSpriteset(this._spriteset),this._logWindow.setSpriteset(this._spriteset)}createSpriteset(){this._spriteset=new Spriteset_Battle,this.addChild(this._spriteset)}createAllWindows(){this.createLogWindow(),this.createStatusWindow(),this.createPartyCommandWindow(),this.createActorCommandWindow(),this.createHelpWindow(),this.createSkillWindow(),this.createItemWindow(),this.createActorWindow(),this.createEnemyWindow(),this.createMessageWindow(),this.createScrollTextWindow()}createLogWindow(){this._logWindow=new Window_BattleLog,this.addWindow(this._logWindow)}createStatusWindow(){this._statusWindow=new Window_BattleStatus,this.addWindow(this._statusWindow)}createPartyCommandWindow(){this._partyCommandWindow=new Window_PartyCommand,this._partyCommandWindow.setHandler("fight",this.commandFight.bind(this)),this._partyCommandWindow.setHandler("escape",this.commandEscape.bind(this)),this._partyCommandWindow.deselect(),this.addWindow(this._partyCommandWindow)}createActorCommandWindow(){this._actorCommandWindow=new Window_ActorCommand,this._actorCommandWindow.setHandler("attack",this.commandAttack.bind(this)),this._actorCommandWindow.setHandler("skill",this.commandSkill.bind(this)),this._actorCommandWindow.setHandler("guard",this.commandGuard.bind(this)),this._actorCommandWindow.setHandler("item",this.commandItem.bind(this)),this._actorCommandWindow.setHandler("cancel",this.selectPreviousCommand.bind(this)),this.addWindow(this._actorCommandWindow)}createHelpWindow(){this._helpWindow=new Window_Help,this._helpWindow.visible=!1,this.addWindow(this._helpWindow)}createSkillWindow(){const t=this._helpWindow.y+this._helpWindow.height,e=this._statusWindow.y-t;this._skillWindow=new Window_BattleSkill(0,t,Graphics$1.boxWidth,e),this._skillWindow.setHelpWindow(this._helpWindow),this._skillWindow.setHandler("ok",this.onSkillOk.bind(this)),this._skillWindow.setHandler("cancel",this.onSkillCancel.bind(this)),this.addWindow(this._skillWindow)}createItemWindow(){const t=this._helpWindow.y+this._helpWindow.height,e=this._statusWindow.y-t;this._itemWindow=new Window_BattleItem(0,t,Graphics$1.boxWidth,e),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this.addWindow(this._itemWindow)}createActorWindow(){this._actorWindow=new Window_BattleActor(0,this._statusWindow.y),this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)}createEnemyWindow(){this._enemyWindow=new Window_BattleEnemy(0,this._statusWindow.y),this._enemyWindow.x=Graphics$1.boxWidth-this._enemyWindow.width,this._enemyWindow.setHandler("ok",this.onEnemyOk.bind(this)),this._enemyWindow.setHandler("cancel",this.onEnemyCancel.bind(this)),this.addWindow(this._enemyWindow)}createMessageWindow(){this._messageWindow=new Window_Message,this.addWindow(this._messageWindow),this._messageWindow.subWindows().forEach((function(t){this.addWindow(t)}),this)}createScrollTextWindow(){this._scrollTextWindow=new Window_ScrollText,this.addWindow(this._scrollTextWindow)}refreshStatus(){this._statusWindow.refresh()}startPartyCommandSelection(){this.refreshStatus(),this._statusWindow.deselect(),this._statusWindow.open(),this._actorCommandWindow.close(),this._partyCommandWindow.setup()}commandFight(){this.selectNextCommand()}commandEscape(){BattleManager.processEscape(),this.changeInputWindow()}startActorCommandSelection(){this._statusWindow.select(BattleManager.actor().index()),this._partyCommandWindow.close(),this._actorCommandWindow.setup(BattleManager.actor())}commandAttack(){BattleManager.inputtingAction().setAttack(),this.selectEnemySelection()}commandSkill(){this._skillWindow.setActor(BattleManager.actor()),this._skillWindow.setStypeId(this._actorCommandWindow.currentExt()),this._skillWindow.refresh(),this._skillWindow.show(),this._skillWindow.activate()}commandGuard(){BattleManager.inputtingAction().setGuard(),this.selectNextCommand()}commandItem(){this._itemWindow.refresh(),this._itemWindow.show(),this._itemWindow.activate()}selectNextCommand(){BattleManager.selectNextCommand(),this.changeInputWindow()}selectPreviousCommand(){BattleManager.selectPreviousCommand(),this.changeInputWindow()}selectActorSelection(){this._actorWindow.refresh(),this._actorWindow.show(),this._actorWindow.activate()}onActorOk(){BattleManager.inputtingAction().setTarget(this._actorWindow.index()),this._actorWindow.hide(),this._skillWindow.hide(),this._itemWindow.hide(),this.selectNextCommand()}onActorCancel(){switch(this._actorWindow.hide(),this._actorCommandWindow.currentSymbol()){case"skill":this._skillWindow.show(),this._skillWindow.activate();break;case"item":this._itemWindow.show(),this._itemWindow.activate()}}selectEnemySelection(){this._enemyWindow.refresh(),this._enemyWindow.show(),this._enemyWindow.select(0),this._enemyWindow.activate()}onEnemyOk(){BattleManager.inputtingAction().setTarget(this._enemyWindow.enemyIndex()),this._enemyWindow.hide(),this._skillWindow.hide(),this._itemWindow.hide(),this.selectNextCommand()}onEnemyCancel(){switch(this._enemyWindow.hide(),this._actorCommandWindow.currentSymbol()){case"attack":this._actorCommandWindow.activate();break;case"skill":this._skillWindow.show(),this._skillWindow.activate();break;case"item":this._itemWindow.show(),this._itemWindow.activate()}}onSkillOk(){const t=this._skillWindow.item();BattleManager.inputtingAction().setSkill(t.id),BattleManager.actor().setLastBattleSkill(t),this.onSelectAction()}onSkillCancel(){this._skillWindow.hide(),this._actorCommandWindow.activate()}onItemOk(){const t=this._itemWindow.item();BattleManager.inputtingAction().setItem(t.id),self.$gameParty.setLastItem(t),this.onSelectAction()}onItemCancel(){this._itemWindow.hide(),this._actorCommandWindow.activate()}onSelectAction(){const t=BattleManager.inputtingAction();this._skillWindow.hide(),this._itemWindow.hide(),t.needsSelection()?t.isForOpponent()?this.selectEnemySelection():this.selectActorSelection():this.selectNextCommand()}endCommandSelection(){this._partyCommandWindow.close(),this._actorCommandWindow.close(),this._statusWindow.deselect()}}class Scene_MenuBase extends Scene_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createBackground(),this.updateActor(),this.createWindowLayer()}actor(){return this._actor}updateActor(){this._actor=self.$gameParty.menuActor()}createBackground(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this.addChild(this._backgroundSprite)}setBackgroundOpacity(t){this._backgroundSprite.opacity=t}createHelpWindow(){this._helpWindow=new Window_Help,this.addWindow(this._helpWindow)}nextActor(){self.$gameParty.makeMenuActorNext(),this.updateActor(),this.onActorChange()}previousActor(){self.$gameParty.makeMenuActorPrevious(),this.updateActor(),this.onActorChange()}onActorChange(){}}class Window_MenuCommand extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(t,e),this.selectLast()}static initCommandPosition(){this._lastCommandSymbol=null}windowWidth(){return 240}numVisibleRows(){return this.maxItems()}makeCommandList(){this.addMainCommands(),this.addFormationCommand(),this.addOriginalCommands(),this.addOptionsCommand(),this.addSaveCommand(),this.addGameEndCommand()}addMainCommands(){const t=this.areMainCommandsEnabled();this.needsCommand("item")&&this.addCommand(TextManager.item,"item",t),this.needsCommand("skill")&&this.addCommand(TextManager.skill,"skill",t),this.needsCommand("equip")&&this.addCommand(TextManager.equip,"equip",t),this.needsCommand("status")&&this.addCommand(TextManager.status,"status",t)}addFormationCommand(){if(this.needsCommand("formation")){const t=this.isFormationEnabled();this.addCommand(TextManager.formation,"formation",t)}}addOriginalCommands(){}addOptionsCommand(){if(this.needsCommand("options")){const t=this.isOptionsEnabled();this.addCommand(TextManager.options,"options",t)}}addSaveCommand(){if(this.needsCommand("save")){const t=this.isSaveEnabled();this.addCommand(TextManager.save,"save",t)}}addGameEndCommand(){const t=this.isGameEndEnabled();this.addCommand(TextManager.gameEnd,"gameEnd",t)}needsCommand(t){const e=self.$dataSystem.menuCommands;if(e)switch(t){case"item":return e[0];case"skill":return e[1];case"equip":return e[2];case"status":return e[3];case"formation":return e[4];case"save":return e[5]}return!0}areMainCommandsEnabled(){return self.$gameParty.exists()}isFormationEnabled(){return self.$gameParty.size()>=2&&self.$gameSystem.isFormationEnabled()}isOptionsEnabled(){return!0}isSaveEnabled(){return!DataManager.isEventTest()&&self.$gameSystem.isSaveEnabled()}isGameEndEnabled(){return!0}processOk(){Window_MenuCommand._lastCommandSymbol=this.currentSymbol(),super.processOk()}selectLast(){this.selectSymbol(Window_MenuCommand._lastCommandSymbol)}}Window_MenuCommand._lastCommandSymbol=null;class Window_MenuStatus extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){const i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this._formationMode=!1,this._pendingIndex=-1,this.refresh()}windowWidth(){return Graphics$1.boxWidth-240}windowHeight(){return Graphics$1.boxHeight}maxItems(){return self.$gameParty.size()}itemHeight(){const t=this.height-2*this.padding;return Math.floor(t/this.numVisibleRows())}numVisibleRows(){return 4}loadImages(){self.$gameParty.members().forEach((t=>{ImageManager.reserveFace(t.faceName())}),this)}drawItem(t){this.drawItemBackground(t),this.drawItemImage(t),this.drawItemStatus(t)}drawItemBackground(t){if(t===this._pendingIndex){const e=this.itemRect(t),i=this.pendingColor();this.changePaintOpacity(!1),this.contents.fillRect(e.x,e.y,e.width,e.height,i),this.changePaintOpacity(!0)}}drawItemImage(t){const e=self.$gameParty.members()[t],i=this.itemRect(t);this.changePaintOpacity(e.isBattleMember()),this.drawActorFace(e,i.x+1,i.y+1,Window_Base._faceWidth,Window_Base._faceHeight),this.changePaintOpacity(!0)}drawItemStatus(t){const e=self.$gameParty.members()[t],i=this.itemRect(t),s=i.x+162,a=i.y+i.height/2-1.5*this.lineHeight(),r=i.width-s-this.textPadding();this.drawActorSimpleStatus(e,s,a,r)}processOk(){super.processOk(),self.$gameParty.setMenuActor(self.$gameParty.members()[this.index()])}isCurrentItemEnabled(){if(this._formationMode){const t=self.$gameParty.members()[this.index()];return t&&t.isFormationChangeOk()}return!0}selectLast(){this.select(self.$gameParty.menuActor().index()||0)}formationMode(){return this._formationMode}setFormationMode(t){this._formationMode=t}pendingIndex(){return this._pendingIndex}setPendingIndex(t){const e=this._pendingIndex;this._pendingIndex=t,this.redrawItem(this._pendingIndex),this.redrawItem(e)}}class Window_MenuActor extends Window_MenuStatus{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.hide()}processOk(){this.cursorAll()||self.$gameParty.setTargetActor(self.$gameParty.members()[this.index()]),this.callOkHandler()}selectLast(){this.select(self.$gameParty.targetActor().index()||0)}selectForItem(t){const e=self.$gameParty.menuActor(),i=new Game_Action(e);i.setItemObject(t),this.setCursorFixed(!1),this.setCursorAll(!1),i.isForUser()?DataManager.isSkill(t)?(this.setCursorFixed(!0),this.select(e.index())):this.selectLast():i.isForAll()?(this.setCursorAll(!0),this.select(0)):this.selectLast()}}class Scene_ItemBase extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create()}createActorWindow(){this._actorWindow=new Window_MenuActor,this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)}item(){return this._itemWindow.item()}user(){return null}isCursorLeft(){return this._itemWindow.index()%2==0}showSubWindow(t){t.x=this.isCursorLeft()?Graphics$1.boxWidth-t.width:0,t.show(),t.activate()}hideSubWindow(t){t.hide(),t.deactivate(),this.activateItemWindow()}onActorOk(){this.canUse()?this.useItem():SoundManager.playBuzzer()}onActorCancel(){this.hideSubWindow(this._actorWindow)}action(){const t=new Game_Action(this.user());return t.setItemObject(this.item()),t}determineItem(){this.action().isForFriend()?(this.showSubWindow(this._actorWindow),this._actorWindow.selectForItem(this.item())):(this.useItem(),this.activateItemWindow())}useItem(){this.playSeForItem(),this.user().useItem(this.item()),this.applyItem(),this.checkCommonEvent(),this.checkGameover(),this._actorWindow.refresh()}activateItemWindow(){this._itemWindow.refresh(),this._itemWindow.activate()}itemTargetActors(){const t=this.action();return t.isForFriend()?t.isForAll()?self.$gameParty.members():[self.$gameParty.members()[this._actorWindow.index()]]:[]}canUse(){const t=this.user();return!!t&&t.canUse(this.item())&&this.isItemEffectsValid()}isItemEffectsValid(){const t=this.action();return this.itemTargetActors().some((e=>t.testApply(e)),this)}applyItem(){const t=this.action();this.itemTargetActors().forEach((e=>{const i=t.numRepeats();for(let s=0;s<i;s++)t.apply(e)})),t.applyGlobal()}checkCommonEvent(){self.$gameTemp.isCommonEventReserved()&&SceneManager.goto(Scene_Map)}}class Window_HorzCommand extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(t,e)}numVisibleRows(){return 1}maxCols(){return 4}itemTextAlign(){return"center"}}class Window_ItemCategory extends Window_HorzCommand{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0)}windowWidth(){return Graphics$1.boxWidth}maxCols(){return 4}update(){super.update(),this._itemWindow&&this._itemWindow.setCategory(this.currentSymbol())}makeCommandList(){this.addCommand(TextManager.item,"item"),this.addCommand(TextManager.weapon,"weapon"),this.addCommand(TextManager.armor,"armor"),this.addCommand(TextManager.keyItem,"keyItem")}setItemWindow(t){this._itemWindow=t}}class Scene_Item extends Scene_ItemBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createHelpWindow(),this.createCategoryWindow(),this.createItemWindow(),this.createActorWindow()}createCategoryWindow(){this._categoryWindow=new Window_ItemCategory,this._categoryWindow.setHelpWindow(this._helpWindow),this._categoryWindow.y=this._helpWindow.height,this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this)),this._categoryWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._categoryWindow)}createItemWindow(){const t=this._categoryWindow.y+this._categoryWindow.height,e=Graphics$1.boxHeight-t;this._itemWindow=new Window_ItemList(0,t,Graphics$1.boxWidth,e),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this.addWindow(this._itemWindow),this._categoryWindow.setItemWindow(this._itemWindow)}user(){const t=self.$gameParty.movableMembers();let e=t[0],i=0;for(let s=0;s<t.length;s++)t[s].pha>i&&(i=t[s].pha,e=t[s]);return e}onCategoryOk(){this._itemWindow.activate(),this._itemWindow.selectLast()}onItemOk(){self.$gameParty.setLastItem(this.item()),this.determineItem()}onItemCancel(){this._itemWindow.deselect(),this._categoryWindow.activate()}playSeForItem(){SoundManager.playUseItem()}useItem(){super.useItem(),this._itemWindow.redrawCurrentItem()}}class Window_SkillType extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(t,e),this._actor=null}windowWidth(){return 240}setActor(t){this._actor!==t&&(this._actor=t,this.refresh(),this.selectLast())}numVisibleRows(){return 4}makeCommandList(){if(this._actor){const t=this._actor.addedSkillTypes();t.sort(((t,e)=>t-e)),t.forEach((function(t){const e=self.$dataSystem.skillTypes[t];this.addCommand(e,"skill",!0,t)}),this)}}update(){super.update(),this._skillWindow&&this._skillWindow.setStypeId(this.currentExt())}setSkillWindow(t){this._skillWindow=t}selectLast(){const t=this._actor.lastMenuSkill();t?this.selectExt(t.stypeId):this.select(0)}}class Window_SkillStatus extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}refresh(){if(this.contents.clear(),this._actor){const t=this.width-2*this.padding,e=this.height-2*this.padding,i=e/2-1.5*this.lineHeight(),s=t-162-this.textPadding();this.drawActorFace(this._actor,0,0,144,e),this.drawActorSimpleStatus(this._actor,162,i,s)}}}class Scene_Skill extends Scene_ItemBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createHelpWindow(),this.createSkillTypeWindow(),this.createStatusWindow(),this.createItemWindow(),this.createActorWindow()}start(){super.start(),this.refreshActor()}createSkillTypeWindow(){const t=this._helpWindow.height;this._skillTypeWindow=new Window_SkillType(0,t),this._skillTypeWindow.setHelpWindow(this._helpWindow),this._skillTypeWindow.setHandler("skill",this.commandSkill.bind(this)),this._skillTypeWindow.setHandler("cancel",this.popScene.bind(this)),this._skillTypeWindow.setHandler("pagedown",this.nextActor.bind(this)),this._skillTypeWindow.setHandler("pageup",this.previousActor.bind(this)),this.addWindow(this._skillTypeWindow)}createStatusWindow(){const t=this._skillTypeWindow.width,e=this._helpWindow.height,i=Graphics$1.boxWidth-t,s=this._skillTypeWindow.height;this._statusWindow=new Window_SkillStatus(t,e,i,s),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)}createItemWindow(){const t=this._statusWindow.y+this._statusWindow.height,e=Graphics$1.boxWidth,i=Graphics$1.boxHeight-t;this._itemWindow=new Window_SkillList(0,t,e,i),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this._skillTypeWindow.setSkillWindow(this._itemWindow),this.addWindow(this._itemWindow)}refreshActor(){const t=this.actor();this._skillTypeWindow.setActor(t),this._statusWindow.setActor(t),this._itemWindow.setActor(t)}user(){return this.actor()}commandSkill(){this._itemWindow.activate(),this._itemWindow.selectLast()}onItemOk(){this.actor().setLastMenuSkill(this.item()),this.determineItem()}onItemCancel(){this._itemWindow.deselect(),this._skillTypeWindow.activate()}playSeForItem(){SoundManager.playUseSkill()}useItem(){super.useItem(),this._statusWindow.refresh(),this._itemWindow.refresh()}onActorChange(){this.refreshActor(),this._skillTypeWindow.activate()}}class Window_EquipStatus extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){const i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this._actor=null,this._tempActor=null,this.refresh()}windowWidth(){return 312}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 7}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}refresh(){if(this.contents.clear(),this._actor){this.drawActorName(this._actor,this.textPadding(),0);for(let t=0;t<6;t++)this.drawItem(0,this.lineHeight()*(1+t),2+t)}}setTempActor(t){this._tempActor!==t&&(this._tempActor=t,this.refresh())}drawItem(t,e,i){this.drawParamName(t+this.textPadding(),e,i),this._actor&&this.drawCurrentParam(t+140,e,i),this.drawRightArrow(t+188,e),this._tempActor&&this.drawNewParam(t+222,e,i)}drawParamName(t,e,i){this.changeTextColor(this.systemColor()),this.drawText(TextManager.param(i),t,e,120)}drawCurrentParam(t,e,i){this.resetTextColor(),this.drawText(this._actor.param(i),t,e,48,"right")}drawRightArrow(t,e){this.changeTextColor(this.systemColor()),this.drawText("",t,e,32,"center")}drawNewParam(t,e,i){const s=this._tempActor.param(i),a=s-this._actor.param(i);this.changeTextColor(this.paramchangeTextColor(a)),this.drawText(s,t,e,48,"right")}}class Window_EquipCommand extends Window_HorzCommand{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){this._windowWidth=i,super.initialize(t,e)}windowWidth(){return this._windowWidth}maxCols(){return 3}makeCommandList(){this.addCommand(TextManager.equip2,"equip"),this.addCommand(TextManager.optimize,"optimize"),this.addCommand(TextManager.clear,"clear")}}class Window_EquipSlot extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null,this.refresh()}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}update(){super.update(),this._itemWindow&&this._itemWindow.setSlotId(this.index())}maxItems(){return this._actor?this._actor.equipSlots().length:0}item(){return this._actor?this._actor.equips()[this.index()]:null}drawItem(t){if(this._actor){const e=this.itemRectForText(t);this.changeTextColor(this.systemColor()),this.changePaintOpacity(this.isEnabled(t)),this.drawText(this.slotName(t),e.x,e.y,138,this.lineHeight()),this.drawItemName(this._actor.equips()[t],e.x+138,e.y),this.changePaintOpacity(!0)}}slotName(t){const e=this._actor.equipSlots();return this._actor?self.$dataSystem.equipTypes[e[t]]:""}isEnabled(t){return!!this._actor&&this._actor.isEquipChangeOk(t)}isCurrentItemEnabled(){return this.isEnabled(this.index())}setStatusWindow(t){this._statusWindow=t,this.callUpdateHelp()}setItemWindow(t){this._itemWindow=t}updateHelp(){super.updateHelp(),this.setHelpWindowItem(this.item()),this._statusWindow&&this._statusWindow.setTempActor(null)}}class Window_EquipItem extends Window_ItemList{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null,this._slotId=0}setActor(t){this._actor!==t&&(this._actor=t,this.refresh(),this.resetScroll())}setSlotId(t){this._slotId!==t&&(this._slotId=t,this.refresh(),this.resetScroll())}includes(t){return null===t||!(this._slotId<0||t.etypeId!==this._actor.equipSlots()[this._slotId])&&this._actor.canEquip(t)}isEnabled(t){return!0}selectLast(){}setStatusWindow(t){this._statusWindow=t,this.callUpdateHelp()}updateHelp(){if(super.updateHelp(),this._actor&&this._statusWindow){const t=JsonEx.makeDeepCopy(this._actor);t.forceChangeEquip(this._slotId,this.item()),this._statusWindow.setTempActor(t)}}playOkSound(){}}class Scene_Equip extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createHelpWindow(),this.createStatusWindow(),this.createCommandWindow(),this.createSlotWindow(),this.createItemWindow(),this.refreshActor()}createStatusWindow(){this._statusWindow=new Window_EquipStatus(0,this._helpWindow.height),this.addWindow(this._statusWindow)}createCommandWindow(){const t=this._statusWindow.width,e=this._helpWindow.height,i=Graphics$1.boxWidth-this._statusWindow.width;this._commandWindow=new Window_EquipCommand(t,e,i),this._commandWindow.setHelpWindow(this._helpWindow),this._commandWindow.setHandler("equip",this.commandEquip.bind(this)),this._commandWindow.setHandler("optimize",this.commandOptimize.bind(this)),this._commandWindow.setHandler("clear",this.commandClear.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this._commandWindow.setHandler("pagedown",this.nextActor.bind(this)),this._commandWindow.setHandler("pageup",this.previousActor.bind(this)),this.addWindow(this._commandWindow)}createSlotWindow(){const t=this._statusWindow.width,e=this._commandWindow.y+this._commandWindow.height,i=Graphics$1.boxWidth-this._statusWindow.width,s=this._statusWindow.height-this._commandWindow.height;this._slotWindow=new Window_EquipSlot(t,e,i,s),this._slotWindow.setHelpWindow(this._helpWindow),this._slotWindow.setStatusWindow(this._statusWindow),this._slotWindow.setHandler("ok",this.onSlotOk.bind(this)),this._slotWindow.setHandler("cancel",this.onSlotCancel.bind(this)),this.addWindow(this._slotWindow)}createItemWindow(){const t=this._statusWindow.y+this._statusWindow.height,e=Graphics$1.boxWidth,i=Graphics$1.boxHeight-t;this._itemWindow=new Window_EquipItem(0,t,e,i),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setStatusWindow(this._statusWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this._slotWindow.setItemWindow(this._itemWindow),this.addWindow(this._itemWindow)}refreshActor(){const t=this.actor();this._statusWindow.setActor(t),this._slotWindow.setActor(t),this._itemWindow.setActor(t)}commandEquip(){this._slotWindow.activate(),this._slotWindow.select(0)}commandOptimize(){SoundManager.playEquip(),this.actor().optimizeEquipments(),this._statusWindow.refresh(),this._slotWindow.refresh(),this._commandWindow.activate()}commandClear(){SoundManager.playEquip(),this.actor().clearEquipments(),this._statusWindow.refresh(),this._slotWindow.refresh(),this._commandWindow.activate()}onSlotOk(){this._itemWindow.activate(),this._itemWindow.select(0)}onSlotCancel(){this._slotWindow.deselect(),this._commandWindow.activate()}onItemOk(){SoundManager.playEquip(),this.actor().changeEquip(this._slotWindow.index(),this._itemWindow.item()),this._slotWindow.activate(),this._slotWindow.refresh(),this._itemWindow.deselect(),this._itemWindow.refresh(),this._statusWindow.refresh()}onItemCancel(){this._slotWindow.activate(),this._itemWindow.deselect()}onActorChange(){this.refreshActor(),this._commandWindow.activate()}}class Window_Status extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=Graphics$1.boxWidth,e=Graphics$1.boxHeight;super.initialize(0,0,t,e),this._actor=null,this.refresh(),this.activate()}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}refresh(){if(this.contents.clear(),this._actor){const t=this.lineHeight();this.drawBlock1(0*t),this.drawHorzLine(1*t),this.drawBlock2(2*t),this.drawHorzLine(6*t),this.drawBlock3(7*t),this.drawHorzLine(13*t),this.drawBlock4(14*t)}}drawBlock1(t){this.drawActorName(this._actor,6,t),this.drawActorClass(this._actor,192,t),this.drawActorNickname(this._actor,432,t)}drawBlock2(t){this.drawActorFace(this._actor,12,t),this.drawBasicInfo(204,t),this.drawExpInfo(456,t)}drawBlock3(t){this.drawParameters(48,t),this.drawEquipments(432,t)}drawBlock4(t){this.drawProfile(6,t)}drawHorzLine(t){const e=t+this.lineHeight()/2-1;this.contents.paintOpacity=48,this.contents.fillRect(0,e,this.contentsWidth(),2,this.lineColor()),this.contents.paintOpacity=255}lineColor(){return this.normalColor()}drawBasicInfo(t,e){const i=this.lineHeight();this.drawActorLevel(this._actor,t,e+0*i),this.drawActorIcons(this._actor,t,e+1*i),this.drawActorHp(this._actor,t,e+2*i),this.drawActorMp(this._actor,t,e+3*i)}drawParameters(t,e){const i=this.lineHeight();for(let s=0;s<6;s++){const a=s+2,r=e+i*s;this.changeTextColor(this.systemColor()),this.drawText(TextManager.param(a),t,r,160),this.resetTextColor(),this.drawText(this._actor.param(a),t+160,r,60,"right")}}drawExpInfo(t,e){const i=this.lineHeight(),s=TextManager.expTotal.format(TextManager.exp),a=TextManager.expNext.format(TextManager.level);let r=this._actor.currentExp(),n=this._actor.nextRequiredExp();this._actor.isMaxLevel()&&(r="-------",n="-------"),this.changeTextColor(this.systemColor()),this.drawText(s,t,e+0*i,270),this.drawText(a,t,e+2*i,270),this.resetTextColor(),this.drawText(r,t,e+1*i,270,"right"),this.drawText(n,t,e+3*i,270,"right")}drawEquipments(t,e){const i=this._actor.equips(),s=Math.min(i.length,this.maxEquipmentLines());for(let a=0;a<s;a++)this.drawItemName(i[a],t,e+this.lineHeight()*a)}drawProfile(t,e){this.drawTextEx(this._actor.profile(),t,e)}maxEquipmentLines(){return 6}}class Scene_Status extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this._statusWindow=new Window_Status,this._statusWindow.setHandler("cancel",this.popScene.bind(this)),this._statusWindow.setHandler("pagedown",this.nextActor.bind(this)),this._statusWindow.setHandler("pageup",this.previousActor.bind(this)),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)}start(){super.start(),this.refreshActor()}refreshActor(){const t=this.actor();this._statusWindow.setActor(t)}onActorChange(){this.refreshActor(),this._statusWindow.activate()}}class Window_Options extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.updatePlacement()}windowWidth(){return 400}windowHeight(){return this.fittingHeight(Math.min(this.numVisibleRows(),12))}updatePlacement(){this.x=(Graphics$1.boxWidth-this.width)/2,this.y=(Graphics$1.boxHeight-this.height)/2}makeCommandList(){this.addGeneralOptions(),this.addVolumeOptions()}addGeneralOptions(){this.addCommand(TextManager.alwaysDash,"alwaysDash"),this.addCommand(TextManager.commandRemember,"commandRemember")}addVolumeOptions(){this.addCommand(TextManager.bgmVolume,"bgmVolume"),this.addCommand(TextManager.bgsVolume,"bgsVolume"),this.addCommand(TextManager.meVolume,"meVolume"),this.addCommand(TextManager.seVolume,"seVolume")}drawItem(t){const e=this.itemRectForText(t),i=this.statusWidth(),s=e.width-i;this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(t)),this.drawText(this.commandName(t),e.x,e.y,s,"left"),this.drawText(this.statusText(t),e.x+s,e.y,i,"right")}statusWidth(){return 120}statusText(t){const e=this.commandSymbol(t),i=this.getConfigValue(e);return this.isVolumeSymbol(e)?this.volumeStatusText(i):this.booleanStatusText(i)}isVolumeSymbol(t){return t.contains("Volume")}booleanStatusText(t){return t?"ON":"OFF"}volumeStatusText(t){return`${t}%`}processOk(){const t=this.index(),e=this.commandSymbol(t);let i=this.getConfigValue(e);this.isVolumeSymbol(e)?(i+=this.volumeOffset(),i>100&&(i=0),i=i.clamp(0,100),this.changeValue(e,i)):this.changeValue(e,!i)}cursorRight(t){const e=this.index(),i=this.commandSymbol(e);let s=this.getConfigValue(i);this.isVolumeSymbol(i)?(s+=this.volumeOffset(),s=s.clamp(0,100),this.changeValue(i,s)):this.changeValue(i,!0)}cursorLeft(t){const e=this.index(),i=this.commandSymbol(e);let s=this.getConfigValue(i);this.isVolumeSymbol(i)?(s-=this.volumeOffset(),s=s.clamp(0,100),this.changeValue(i,s)):this.changeValue(i,!1)}volumeOffset(){return 20}changeValue(t,e){this.getConfigValue(t)!==e&&(this.setConfigValue(t,e),this.redrawItem(this.findSymbol(t)),SoundManager.playCursor())}getConfigValue(t){return ConfigManager[t]}setConfigValue(t,e){ConfigManager[t]=e}}class Scene_Options extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createOptionsWindow()}terminate(){super.terminate(),ConfigManager.save()}createOptionsWindow(){this._optionsWindow=new Window_Options,this._optionsWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._optionsWindow)}}class Window_SavefileList extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this.activate(),this._mode=null}setMode(t){this._mode=t}maxItems(){return DataManager.maxSavefiles()}maxVisibleItems(){return 5}itemHeight(){const t=this.height-2*this.padding;return Math.floor(t/this.maxVisibleItems())}drawItem(t){const e=t+1,i=DataManager.isThisGameFile(e),s=DataManager.loadSavefileInfo(e),a=this.itemRectForText(t);this.resetTextColor(),"load"===this._mode&&this.changePaintOpacity(i),this.drawFileId(e,a.x,a.y),s&&(this.changePaintOpacity(i),this.drawContents(s,a,i),this.changePaintOpacity(!0))}drawFileId(t,e,i){DataManager.isAutoSaveFileId(t)?("save"===this._mode&&this.changePaintOpacity(!1),this.drawText(`${TextManager.file} ${t}(Auto)`,e,i,180)):this.drawText(`${TextManager.file} ${t}`,e,i,180)}drawContents(t,{y:e,height:i,width:s,x:a},r){const n=e+i;s>=420&&(this.drawGameTitle(t,a+192,e,s-192),r&&this.drawPartyCharacters(t,a+220,n-4));const h=this.lineHeight(),o=n-h;o>=h&&this.drawPlaytime(t,a,o,s)}drawGameTitle({title:t},e,i,s){t&&this.drawText(t,e,i,s)}drawPartyCharacters({characters:t},e,i){t&&t.forEach(((t,s)=>{this.drawCharacter(t[0],t[1],e+48*s,i)}))}drawPlaytime({playtime:t},e,i,s){t&&this.drawText(t,e,i,s,"right")}playOkSound(){}}class Scene_File extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),DataManager.loadAllSavefileImages(),this.createHelpWindow(),this.createListWindow()}start(){super.start(),this._listWindow.refresh()}savefileId(){return this._listWindow.index()+1}createHelpWindow(){this._helpWindow=new Window_Help(1),this._helpWindow.setText(this.helpWindowText()),this.addWindow(this._helpWindow)}createListWindow(){const t=this._helpWindow.height,e=Graphics$1.boxWidth,i=Graphics$1.boxHeight-t;this._listWindow=new Window_SavefileList(0,t,e,i),this._listWindow.setHandler("ok",this.onSavefileOk.bind(this)),this._listWindow.setHandler("cancel",this.popScene.bind(this)),this._listWindow.select(this.firstSavefileIndex()),this._listWindow.setTopRow(this.firstSavefileIndex()-2),this._listWindow.setMode(this.mode()),this._listWindow.refresh(),this.addWindow(this._listWindow)}mode(){return null}activateListWindow(){this._listWindow.activate()}helpWindowText(){return""}firstSavefileIndex(){return 0}onSavefileOk(){}}class Scene_Save extends Scene_File{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}mode(){return"save"}helpWindowText(){return TextManager.saveMessage}firstSavefileIndex(){return DataManager.lastAccessedSavefileId()-1}onSavefileOk(){DataManager.isAutoSaveFileId(this.savefileId())?this.onSaveFailure():(super.onSavefileOk(),self.$gameSystem.onBeforeSave(),DataManager.saveGame(this.savefileId())?this.onSaveSuccess():this.onSaveFailure())}onSaveSuccess(){SoundManager.playSave(),StorageManager.cleanBackup(this.savefileId()),this.popScene()}onSaveFailure(){SoundManager.playBuzzer(),this.activateListWindow()}}class Window_GameEnd extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.updatePlacement(),this.openness=0,this.open()}windowWidth(){return 240}updatePlacement(){this.x=(Graphics$1.boxWidth-this.width)/2,this.y=(Graphics$1.boxHeight-this.height)/2}makeCommandList(){this.addCommand(TextManager.toTitle,"toTitle"),this.addCommand(TextManager.cancel,"cancel")}}class Scene_GameEnd extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createCommandWindow()}stop(){super.stop(),this._commandWindow.close()}createBackground(){super.createBackground(),this.setBackgroundOpacity(128)}createCommandWindow(){this._commandWindow=new Window_GameEnd,this._commandWindow.setHandler("toTitle",this.commandToTitle.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)}commandToTitle(){this.fadeOutAll(),SceneManager.goto(Scene_Title)}}class Scene_Menu extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createCommandWindow(),this.createGoldWindow(),this.createStatusWindow()}start(){super.start(),this._statusWindow.refresh()}createCommandWindow(){this._commandWindow=new Window_MenuCommand(0,0),this._commandWindow.setHandler("item",this.commandItem.bind(this)),this._commandWindow.setHandler("skill",this.commandPersonal.bind(this)),this._commandWindow.setHandler("equip",this.commandPersonal.bind(this)),this._commandWindow.setHandler("status",this.commandPersonal.bind(this)),this._commandWindow.setHandler("formation",this.commandFormation.bind(this)),this._commandWindow.setHandler("options",this.commandOptions.bind(this)),this._commandWindow.setHandler("save",this.commandSave.bind(this)),this._commandWindow.setHandler("gameEnd",this.commandGameEnd.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)}createGoldWindow(){this._goldWindow=new Window_Gold(0,0),this._goldWindow.y=Graphics$1.boxHeight-this._goldWindow.height,this.addWindow(this._goldWindow)}createStatusWindow(){this._statusWindow=new Window_MenuStatus(this._commandWindow.width,0),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)}commandItem(){SceneManager.push(Scene_Item)}commandPersonal(){this._statusWindow.setFormationMode(!1),this._statusWindow.selectLast(),this._statusWindow.activate(),this._statusWindow.setHandler("ok",this.onPersonalOk.bind(this)),this._statusWindow.setHandler("cancel",this.onPersonalCancel.bind(this))}commandFormation(){this._statusWindow.setFormationMode(!0),this._statusWindow.selectLast(),this._statusWindow.activate(),this._statusWindow.setHandler("ok",this.onFormationOk.bind(this)),this._statusWindow.setHandler("cancel",this.onFormationCancel.bind(this))}commandOptions(){SceneManager.push(Scene_Options)}commandSave(){SceneManager.push(Scene_Save)}commandGameEnd(){SceneManager.push(Scene_GameEnd)}onPersonalOk(){switch(this._commandWindow.currentSymbol()){case"skill":SceneManager.push(Scene_Skill);break;case"equip":SceneManager.push(Scene_Equip);break;case"status":SceneManager.push(Scene_Status)}}onPersonalCancel(){this._statusWindow.deselect(),this._commandWindow.activate()}onFormationOk(){const t=this._statusWindow.index(),e=this._statusWindow.pendingIndex();e>=0?(self.$gameParty.swapOrder(t,e),this._statusWindow.setPendingIndex(-1),this._statusWindow.redrawItem(t)):this._statusWindow.setPendingIndex(t),this._statusWindow.activate()}onFormationCancel(){this._statusWindow.pendingIndex()>=0?(this._statusWindow.setPendingIndex(-1),this._statusWindow.activate()):(this._statusWindow.deselect(),this._commandWindow.activate())}}class Scene_Load extends Scene_File{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._loadSuccess=!1}terminate(){super.terminate(),this._loadSuccess&&self.$gameSystem.onAfterLoad()}mode(){return"load"}helpWindowText(){return TextManager.loadMessage}firstSavefileIndex(){return DataManager.latestSavefileId()-1}onSavefileOk(){super.onSavefileOk(),DataManager.loadGame(this.savefileId())?this.onLoadSuccess():this.onLoadFailure()}onLoadSuccess(){SoundManager.playLoad(),this.fadeOutAll(),this.reloadMapIfUpdated(),SceneManager.goto(Scene_Map),this._loadSuccess=!0}onLoadFailure(){SoundManager.playBuzzer(),this.activateListWindow()}reloadMapIfUpdated(){self.$gameSystem.versionId()!==self.$dataSystem.versionId&&(self.$gamePlayer.reserveTransfer(self.$gameMap.mapId(),self.$gamePlayer.x,self.$gamePlayer.y),self.$gamePlayer.requestMapReload())}}class Window_DebugRange extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this._maxSwitches=Math.ceil((self.$dataSystem.switches.length-1)/10),this._maxVariables=Math.ceil((self.$dataSystem.variables.length-1)/10);const i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh(),this.setTopRow(Window_DebugRange.lastTopRow),this.select(Window_DebugRange.lastIndex),this.activate()}windowWidth(){return 246}windowHeight(){return Graphics$1.boxHeight}maxItems(){return this._maxSwitches+this._maxVariables}update(){super.update(),this._editWindow&&(this._editWindow.setMode(this.mode()),this._editWindow.setTopId(this.topId()))}mode(){return this.index()<this._maxSwitches?"switch":"variable"}topId(){const t=this.index();return t<this._maxSwitches?10*t+1:10*(t-this._maxSwitches)+1}refresh(){this.createContents(),this.drawAllItems()}drawItem(t){const e=this.itemRectForText(t);let i,s;t<this._maxSwitches?(i=10*t+1,s="S"):(i=10*(t-this._maxSwitches)+1,s="V");const a=i+9;s+=` [${i.padZero(4)}-${a.padZero(4)}]`,this.drawText(s,e.x,e.y,e.width)}isCancelTriggered(){return Window_Selectable.prototype.isCancelTriggered()||Input.isTriggered("debug")}processCancel(){super.processCancel(),Window_DebugRange.lastTopRow=this.topRow(),Window_DebugRange.lastIndex=this.index()}setEditWindow(t){this._editWindow=t}}Window_DebugRange.lastTopRow=0,Window_DebugRange.lastIndex=0;class Window_DebugEdit extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){const s=this.fittingHeight(10);super.initialize(t,e,i,s),this._mode="switch",this._topId=1,this.refresh()}maxItems(){return 10}refresh(){this.contents.clear(),this.drawAllItems()}drawItem(t){const e=this._topId+t,i=`${e.padZero(4)}:`,s=this.textWidth(i),a=this.textWidth("-00000000"),r=this.itemName(e),n=this.itemStatus(e),h=this.itemRectForText(t);this.resetTextColor(),this.drawText(i,h.x,h.y,h.width),h.x+=s,h.width-=s+a,this.drawText(r,h.x,h.y,h.width),this.drawText(n,h.x+h.width,h.y,a,"right")}itemName(t){return"switch"===this._mode?self.$dataSystem.switches[t]:self.$dataSystem.variables[t]}itemStatus(t){return"switch"===this._mode?self.$gameSwitches.value(t)?"[ON]":"[OFF]":String(self.$gameVariables.value(t))}setMode(t){this._mode!==t&&(this._mode=t,this.refresh())}setTopId(t){this._topId!==t&&(this._topId=t,this.refresh())}currentId(){return this._topId+this.index()}update(){super.update(),this.active&&("switch"===this._mode?this.updateSwitch():this.updateVariable())}updateSwitch(){if(Input.isRepeated("ok")){const t=this.currentId();SoundManager.playCursor(),self.$gameSwitches.setValue(t,!self.$gameSwitches.value(t)),this.redrawCurrentItem()}}updateVariable(){const t=this.currentId();let e=self.$gameVariables.value(t);"number"==typeof e&&(Input.isRepeated("right")&&e++,Input.isRepeated("left")&&e--,Input.isRepeated("pagedown")&&(e+=10),Input.isRepeated("pageup")&&(e-=10),self.$gameVariables.value(t)!==e&&(self.$gameVariables.setValue(t,e),SoundManager.playCursor(),this.redrawCurrentItem()))}}class Scene_Debug extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createRangeWindow(),this.createEditWindow(),this.createDebugHelpWindow()}createRangeWindow(){this._rangeWindow=new Window_DebugRange(0,0),this._rangeWindow.setHandler("ok",this.onRangeOk.bind(this)),this._rangeWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._rangeWindow)}createEditWindow(){const t=this._rangeWindow.width,e=Graphics$1.boxWidth-t;this._editWindow=new Window_DebugEdit(t,0,e),this._editWindow.setHandler("cancel",this.onEditCancel.bind(this)),this._rangeWindow.setEditWindow(this._editWindow),this.addWindow(this._editWindow)}createDebugHelpWindow(){const t=this._editWindow.x,e=this._editWindow.height,i=this._editWindow.width,s=Graphics$1.boxHeight-e;this._debugHelpWindow=new Window_Base(t,e,i,s),this.addWindow(this._debugHelpWindow)}onRangeOk(){this._editWindow.activate(),this._editWindow.select(0),this.refreshHelpWindow()}onEditCancel(){this._rangeWindow.activate(),this._editWindow.deselect(),this.refreshHelpWindow()}refreshHelpWindow(){this._debugHelpWindow.contents.clear(),this._editWindow.active&&this._debugHelpWindow.drawTextEx(this.helpText(),4,0)}helpText(){return"switch"===this._rangeWindow.mode()?"Enter : ON / OFF":"Left     :  -1\nRight    :  +1\nPageup   : -10\nPagedown : +10"}}class Window_MapName extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){const t=this.windowWidth(),e=this.windowHeight();super.initialize(0,0,t,e),this.opacity=0,this.contentsOpacity=0,this._showCount=0,this.refresh()}windowWidth(){return 360}windowHeight(){return this.fittingHeight(1)}update(){super.update(),this._showCount>0&&self.$gameMap.isNameDisplayEnabled()?(this.updateFadeIn(),this._showCount--):this.updateFadeOut()}updateFadeIn(){this.contentsOpacity+=16}updateFadeOut(){this.contentsOpacity-=16}open(){this.refresh(),this._showCount=150}close(){this._showCount=0}refresh(){if(this.contents.clear(),self.$gameMap.displayName()){const t=this.contentsWidth();this.drawBackground(0,0,t,this.lineHeight()),this.drawText(self.$gameMap.displayName(),0,0,t,"center")}}drawBackground(t,e,i,s){const a=this.dimColor1(),r=this.dimColor2();this.contents.gradientFillRect(t,e,i/2,s,r,a),this.contents.gradientFillRect(t+i/2,e,i/2,s,a,r)}}class Sprite_Balloon extends Sprite_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers(),this.loadBitmap()}initMembers(){this._balloonId=0,this._duration=0,this.anchor.x=.5,this.anchor.y=1,this.z=7}loadBitmap(){this.bitmap=ImageManager.loadSystem("Balloon"),this.setFrame(0,0,0,0)}setup(t){this._balloonId=t,this._duration=8*this.speed()+this.waitTime()}update(){super.update(),this._duration>0&&(this._duration--,this._duration>0&&this.updateFrame())}updateFrame(){const t=48*this.frameIndex(),e=48*(this._balloonId-1);this.setFrame(t,e,48,48)}speed(){return 8}waitTime(){return 12}frameIndex(){const t=(this._duration-this.waitTime())/this.speed();return 7-Math.max(Math.floor(t),0)}isPlaying(){return this._duration>0}}class Sprite_Character extends Sprite_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this.initMembers(),this.setCharacter(t)}initMembers(){this.anchor.x=.5,this.anchor.y=1,this._character=null,this._balloonDuration=0,this._tilesetId=0,this._upperBody=null,this._lowerBody=null}setCharacter(t){this._character=t}update(){super.update(),this.updateBitmap(),this.updateFrame(),this.updatePosition(),this.updateAnimation(),this.updateBalloon(),this.updateOther()}updateVisibility(){super.updateVisibility(),this._character.isTransparent()&&(this.visible=!1)}isTile(){return this._character.tileId>0}tilesetBitmap(t){const e=self.$gameMap.tileset(),i=5+Math.floor(t/256);return ImageManager.loadTileset(e.tilesetNames[i])}updateBitmap(){this.isImageChanged()&&(this._tilesetId=self.$gameMap.tilesetId(),this._tileId=this._character.tileId(),this._characterName=this._character.characterName(),this._characterIndex=this._character.characterIndex(),this._tileId>0?this.setTileBitmap():this.setCharacterBitmap())}isImageChanged(){return this._tilesetId!==self.$gameMap.tilesetId()||this._tileId!==this._character.tileId()||this._characterName!==this._character.characterName()||this._characterIndex!==this._character.characterIndex()}setTileBitmap(){this.bitmap=this.tilesetBitmap(this._tileId)}setCharacterBitmap(){this.bitmap=ImageManager.loadCharacter(this._characterName),this._isBigCharacter=ImageManager.isBigCharacter(this._characterName)}updateFrame(){this._tileId>0?this.updateTileFrame():this.updateCharacterFrame()}updateTileFrame(){const t=this.patternWidth(),e=this.patternHeight(),i=(Math.floor(this._tileId/128)%2*8+this._tileId%8)*t,s=Math.floor(this._tileId%256/8)%16*e;this.setFrame(i,s,t,e)}updateCharacterFrame(){const t=this.patternWidth(),e=this.patternHeight(),i=(this.characterBlockX()+this.characterPatternX())*t,s=(this.characterBlockY()+this.characterPatternY())*e;if(this.updateHalfBodySprites(),this._bushDepth>0){const a=this._bushDepth;this._upperBody.setFrame(i,s,t,e-a),this._lowerBody.setFrame(i,s+e-a,t,a),this.setFrame(i,s,0,e)}else this.setFrame(i,s,t,e)}characterBlockX(){return this._isBigCharacter?0:this._character.characterIndex()%4*3}characterBlockY(){if(this._isBigCharacter)return 0;{const t=this._character.characterIndex();return 4*Math.floor(t/4)}}characterPatternX(){return this._character.pattern()}characterPatternY(){return(this._character.direction()-2)/2}patternWidth(){return this._tileId>0?self.$gameMap.tileWidth():this._isBigCharacter?this.bitmap.width/3:this.bitmap.width/12}patternHeight(){return this._tileId>0?self.$gameMap.tileHeight():this._isBigCharacter?this.bitmap.height/4:this.bitmap.height/8}updateHalfBodySprites(){this._bushDepth>0?(this.createHalfBodySprites(),this._upperBody.bitmap=this.bitmap,this._upperBody.visible=!0,this._upperBody.y=-this._bushDepth,this._lowerBody.bitmap=this.bitmap,this._lowerBody.visible=!0,this._upperBody.setBlendColor(this.getBlendColor()),this._lowerBody.setBlendColor(this.getBlendColor()),this._upperBody.setColorTone(this.getColorTone()),this._lowerBody.setColorTone(this.getColorTone())):this._upperBody&&(this._upperBody.visible=!1,this._lowerBody.visible=!1)}createHalfBodySprites(){this._upperBody||(this._upperBody=new Sprite,this._upperBody.anchor.x=.5,this._upperBody.anchor.y=1,this.addChild(this._upperBody)),this._lowerBody||(this._lowerBody=new Sprite,this._lowerBody.anchor.x=.5,this._lowerBody.anchor.y=1,this._lowerBody.opacity=128,this.addChild(this._lowerBody))}updatePosition(){this.x=this._character.screenX(),this.y=this._character.screenY(),this.z=this._character.screenZ()}updateAnimation(){this.setupAnimation(),this.isAnimationPlaying()||this._character.endAnimation(),this.isBalloonPlaying()||this._character.endBalloon()}updateOther(){this.opacity=this._character.opacity(),this.blendMode=this._character.blendMode(),this._bushDepth=this._character.bushDepth()}setupAnimation(){if(this._character.animationId()>0){const t=self.$dataAnimations[this._character.animationId()];this.startAnimation(t,!1,0),this._character.startAnimation()}}setupBalloon(){this._character.balloonId()>0&&(this.startBalloon(),this._character.startBalloon())}startBalloon(){this._balloonSprite||(this._balloonSprite=new Sprite_Balloon),this._balloonSprite.setup(this._character.balloonId()),this.parent.addChild(this._balloonSprite)}updateBalloon(){this.setupBalloon(),this._balloonSprite&&(this._balloonSprite.x=this.x,this._balloonSprite.y=this.y-this.height,this._balloonSprite.isPlaying()||this.endBalloon())}endBalloon(){this._balloonSprite&&(this.parent.removeChild(this._balloonSprite),this._balloonSprite=null)}isBalloonPlaying(){return!!this._balloonSprite}}class Sprite_Destination extends Sprite{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.createBitmap(),this._frameCount=0}update(){super.update(),self.$gameTemp.isDestinationValid()?(this.updatePosition(),this.updateAnimation(),this.visible=!0):(this._frameCount=0,this.visible=!1)}createBitmap(){const t=self.$gameMap.tileWidth(),e=self.$gameMap.tileHeight();this.bitmap=new Bitmap(t,e),this.bitmap.fillAll("white"),this.anchor.x=.5,this.anchor.y=.5,this.blendMode=Graphics$1.BLEND_ADD}updatePosition(){const t=self.$gameMap.tileWidth(),e=self.$gameMap.tileHeight(),i=self.$gameTemp.destinationX(),s=self.$gameTemp.destinationY();this.x=(self.$gameMap.adjustX(i)+.5)*t,this.y=(self.$gameMap.adjustY(s)+.5)*e}updateAnimation(){this._frameCount++,this._frameCount%=20,this.opacity=6*(20-this._frameCount),this.scale.x=1+this._frameCount/20,this.scale.y=this.scale.x}}class Spriteset_Map extends Spriteset_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}createLowerLayer(){super.createLowerLayer(),this.createParallax(),this.createTilemap(),this.createCharacters(),this.createShadow(),this.createDestination(),this.createWeather()}update(){super.update(),this.updateTileset(),this.updateParallax(),this.updateTilemap(),this.updateShadow(),this.updateWeather()}hideCharacters(){for(const t of this._characterSprites)t.isTile()||t.hide()}createParallax(){this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics$1.width,Graphics$1.height),this._baseSprite.addChild(this._parallax)}createTilemap(){Graphics$1.isWebGL()?this._tilemap=new ShaderTilemap:this._tilemap=new Tilemap,this._tilemap.tileWidth=self.$gameMap.tileWidth(),this._tilemap.tileHeight=self.$gameMap.tileHeight(),this._tilemap.setData(self.$gameMap.width(),self.$gameMap.height(),self.$gameMap.data()),this._tilemap.horizontalWrap=self.$gameMap.isLoopHorizontal(),this._tilemap.verticalWrap=self.$gameMap.isLoopVertical(),this.loadTileset(),this._baseSprite.addChild(this._tilemap)}loadTileset(){if(this._tileset=self.$gameMap.tileset(),this._tileset){const t=this._tileset.tilesetNames;for(let e=0;e<t.length;e++)this._tilemap.bitmaps[e]=ImageManager.loadTileset(t[e]);const e=self.$gameMap.tilesetFlags();this._tilemap.refreshTileset(),this._tilemap.flags.equals(e)||this._tilemap.refresh(),this._tilemap.flags=e}}createCharacters(){this._characterSprites=[],self.$gameMap.events().forEach((function(t){this._characterSprites.push(new Sprite_Character(t))}),this),self.$gameMap.vehicles().forEach((function(t){this._characterSprites.push(new Sprite_Character(t))}),this),self.$gamePlayer.followers().reverseEach((function(t){this._characterSprites.push(new Sprite_Character(t))}),this),this._characterSprites.push(new Sprite_Character(self.$gamePlayer));for(let t=0;t<this._characterSprites.length;t++)this._tilemap.addChild(this._characterSprites[t])}createShadow(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow1"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=1,this._shadowSprite.z=6,this._tilemap.addChild(this._shadowSprite)}createDestination(){this._destinationSprite=new Sprite_Destination,this._destinationSprite.z=9,this._tilemap.addChild(this._destinationSprite)}createWeather(){this._weather=new Weather,this.addChild(this._weather)}updateTileset(){this._tileset!==self.$gameMap.tileset()&&this.loadTileset()}_canvasReAddParallax(){const t=this._baseSprite.children.indexOf(this._parallax);this._baseSprite.removeChild(this._parallax),this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics$1.width,Graphics$1.height),this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName),this._baseSprite.addChildAt(this._parallax,t)}updateParallax(){this._parallaxName!==self.$gameMap.parallaxName()&&(this._parallaxName=self.$gameMap.parallaxName(),this._parallax.bitmap&&1!=Graphics$1.isWebGL()?this._canvasReAddParallax():this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName)),this._parallax.bitmap&&(this._parallax.origin.x=self.$gameMap.parallaxOx(),this._parallax.origin.y=self.$gameMap.parallaxOy())}updateTilemap(){this._tilemap.origin.x=self.$gameMap.displayX()*self.$gameMap.tileWidth(),this._tilemap.origin.y=self.$gameMap.displayY()*self.$gameMap.tileHeight(),this._tilemap.bitmaps&&!this.isTilesetReady&&this._tilemap.bitmaps.every((t=>t.isRequestReady()))&&(this._tilemap.refresh(),this._tilemap.refreshTileset(),this.isTilesetReady=!0)}updateShadow(){const t=self.$gameMap.airship();this._shadowSprite.x=t.shadowX(),this._shadowSprite.y=t.shadowY(),this._shadowSprite.opacity=t.shadowOpacity()}updateWeather(){this._weather.type=self.$gameScreen.weatherType(),this._weather.power=self.$gameScreen.weatherPower(),this._weather.origin.x=self.$gameMap.displayX()*self.$gameMap.tileWidth(),this._weather.origin.y=self.$gameMap.displayY()*self.$gameMap.tileHeight()}}class Scene_Map extends Scene_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._waitCount=0,this._encounterEffectDuration=0,this._mapLoaded=!1,this._touchCount=0}create(){super.create(),this._transfer=self.$gamePlayer.isTransferring();const t=this._transfer?self.$gamePlayer.newMapId():self.$gameMap.mapId();DataManager.loadMapData(t)}isReady(){return!this._mapLoaded&&DataManager.isMapLoaded()&&(this.onMapLoaded(),this._mapLoaded=!0),this._mapLoaded&&Scene_Base.prototype.isReady.call(this)}onMapLoaded(){this._transfer&&self.$gamePlayer.performTransfer(),this.createDisplayObjects()}start(){super.start(),SceneManager.clearStack(),this._transfer?(this.fadeInForTransfer(),this._mapNameWindow.open(),self.$gameMap.autoplay()):this.needsFadeIn()&&this.startFadeIn(this.fadeSpeed(),!1),this.menuCalling=!1}update(){this.updateDestination(),this.updateMainMultiply(),this.isSceneChangeOk()?this.updateScene():SceneManager.isNextScene(Scene_Battle)&&this.updateEncounterEffect(),this.updateWaitCount(),super.update()}updateMainMultiply(){this.updateMain(),this.isFastForward()&&(this.isMapTouchOk()||this.updateDestination(),this.updateMain())}updateMain(){const t=this.isActive();self.$gameMap.update(t),self.$gamePlayer.update(t),self.$gameTimer.update(t),self.$gameScreen.update()}isFastForward(){return self.$gameMap.isEventRunning()&&!SceneManager.isSceneChanging()&&(Input.isLongPressed("ok")||TouchInput.isLongPressed())}stop(){super.stop(),self.$gamePlayer.straighten(),this._mapNameWindow.close(),this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):SceneManager.isNextScene(Scene_Map)?this.fadeOutForTransfer():SceneManager.isNextScene(Scene_Battle)&&this.launchBattle()}isBusy(){return this._messageWindow&&this._messageWindow.isClosing()||this._waitCount>0||this._encounterEffectDuration>0||Scene_Base.prototype.isBusy.call(this)}terminate(){super.terminate(),SceneManager.isNextScene(Scene_Battle)?ImageManager.clearRequest():(this._spriteset.update(),this._mapNameWindow.hide(),SceneManager.snapForBackground()),SceneManager.isNextScene(Scene_Map)&&ImageManager.clearRequest(),self.$gameScreen.clearZoom(),this.removeChild(this._fadeSprite),this.removeChild(this._mapNameWindow),this.removeChild(this._windowLayer),this.removeChild(this._spriteset)}needsFadeIn(){return SceneManager.isPreviousScene(Scene_Battle)||SceneManager.isPreviousScene(Scene_Load)}needsSlowFadeOut(){return SceneManager.isNextScene(Scene_Title)||SceneManager.isNextScene(Scene_Gameover)}updateWaitCount(){return this._waitCount>0&&(this._waitCount--,!0)}updateDestination(){this.isMapTouchOk()?this.processMapTouch():(self.$gameTemp.clearDestination(),this._touchCount=0)}isMapTouchOk(){return this.isActive()&&self.$gamePlayer.canMove()}processMapTouch(){if(TouchInput.isTriggered()||this._touchCount>0)if(TouchInput.isPressed()){if(0===this._touchCount||this._touchCount>=15){const t=self.$gameMap.canvasToMapX(TouchInput.x),e=self.$gameMap.canvasToMapY(TouchInput.y);self.$gameTemp.setDestination(t,e)}this._touchCount++}else this._touchCount=0}isSceneChangeOk(){return this.isActive()&&!self.$gameMessage.isBusy()}updateScene(){this.checkGameover(),SceneManager.isSceneChanging()||this.updateTransferPlayer(),SceneManager.isSceneChanging()||this.updateEncounter(),SceneManager.isSceneChanging()||this.updateCallMenu(),SceneManager.isSceneChanging()||this.updateCallDebug()}createDisplayObjects(){this.createSpriteset(),this.createMapNameWindow(),this.createWindowLayer(),this.createAllWindows()}createSpriteset(){this._spriteset=new Spriteset_Map,this.addChild(this._spriteset)}createAllWindows(){this.createMessageWindow(),this.createScrollTextWindow()}createMapNameWindow(){this._mapNameWindow=new Window_MapName,this.addChild(this._mapNameWindow)}createMessageWindow(){this._messageWindow=new Window_Message,this.addWindow(this._messageWindow),this._messageWindow.subWindows().forEach((function(t){this.addWindow(t)}),this)}createScrollTextWindow(){this._scrollTextWindow=new Window_ScrollText,this.addWindow(this._scrollTextWindow)}updateTransferPlayer(){self.$gamePlayer.isTransferring()&&SceneManager.goto(Scene_Map)}updateEncounter(){self.$gamePlayer.executeEncounter()&&SceneManager.push(Scene_Battle)}updateCallMenu(){this.isMenuEnabled()?(this.isMenuCalled()&&(this.menuCalling=!0),this.menuCalling&&!self.$gamePlayer.isMoving()&&this.callMenu()):this.menuCalling=!1}isMenuEnabled(){return self.$gameSystem.isMenuEnabled()&&!self.$gameMap.isEventRunning()}isMenuCalled(){return Input.isTriggered("menu")||TouchInput.isCancelled()}callMenu(){SoundManager.playOk(),SceneManager.push(Scene_Menu),Window_MenuCommand.initCommandPosition(),self.$gameTemp.clearDestination(),this._mapNameWindow.hide(),this._waitCount=2}updateCallDebug(){this.isDebugCalled()&&SceneManager.push(Scene_Debug)}isDebugCalled(){return Input.isTriggered("debug")&&self.$gameTemp.isPlaytest()}fadeInForTransfer(){const t=self.$gamePlayer.fadeType();switch(t){case 0:case 1:this.startFadeIn(this.fadeSpeed(),1===t)}}fadeOutForTransfer(){const t=self.$gamePlayer.fadeType();switch(t){case 0:case 1:this.startFadeOut(this.fadeSpeed(),1===t)}}launchBattle(){BattleManager.saveBgmAndBgs(),this.stopAudioOnBattleStart(),SoundManager.playBattleStart(),this.startEncounterEffect(),this._mapNameWindow.hide()}stopAudioOnBattleStart(){AudioManager.isCurrentBgm(self.$gameSystem.battleBgm())||AudioManager.stopBgm(),AudioManager.stopBgs(),AudioManager.stopMe(),AudioManager.stopSe()}startEncounterEffect(){this._spriteset.hideCharacters(),this._encounterEffectDuration=this.encounterEffectSpeed()}updateEncounterEffect(){if(this._encounterEffectDuration>0){this._encounterEffectDuration--;const t=this.encounterEffectSpeed(),e=t-this._encounterEffectDuration,i=e/t,s=(20*(i-1)*i+5)*i+1,a=self.$gamePlayer.screenX(),r=self.$gamePlayer.screenY()-24;2===e&&(self.$gameScreen.setZoom(a,r,1),this.snapForBattleBackground(),this.startFlashForEncounter(t/2)),self.$gameScreen.setZoom(a,r,s),e===Math.floor(t/6)&&this.startFlashForEncounter(t/2),e===Math.floor(t/2)&&(BattleManager.playBattleBgm(),this.startFadeOut(this.fadeSpeed()))}}snapForBattleBackground(){this._windowLayer.visible=!1,SceneManager.snapForBackground(),this._windowLayer.visible=!0}startFlashForEncounter(t){self.$gameScreen.startFlash([255,255,255,255],t)}encounterEffectSpeed(){return 60}}class Window_TitleCommand extends Window_Command{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.updatePlacement(),this.openness=0,this.selectLast()}static initCommandPosition(){this._lastCommandSymbol=null}windowWidth(){return 240}updatePlacement(){this.x=(Graphics$1.boxWidth-this.width)/2,this.y=Graphics$1.boxHeight-this.height-96}makeCommandList(){this.addCommand(TextManager.newGame,"newGame"),this.addCommand(TextManager.continue_,"continue",this.isContinueEnabled()),this.addCommand(TextManager.options,"options")}isContinueEnabled(){return DataManager.isAnySavefileExists()}processOk(){Window_TitleCommand._lastCommandSymbol=this.currentSymbol(),super.processOk()}selectLast(){Window_TitleCommand._lastCommandSymbol?this.selectSymbol(Window_TitleCommand._lastCommandSymbol):this.isContinueEnabled()&&this.selectSymbol("continue")}}Window_TitleCommand._lastCommandSymbol=null;class Scene_Title extends Scene_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createBackground(),this.createForeground(),this.createWindowLayer(),this.createCommandWindow()}start(){super.start(),SceneManager.clearStack(),this.centerSprite(this._backSprite1),this.centerSprite(this._backSprite2),this.playTitleMusic(),this.startFadeIn(this.fadeSpeed(),!1)}update(){this.isBusy()||this._commandWindow.open(),super.update()}isBusy(){return this._commandWindow.isClosing()||Scene_Base.prototype.isBusy.call(this)}terminate(){super.terminate(),SceneManager.snapForBackground()}createBackground(){this._backSprite1=new Sprite(ImageManager.loadTitle1(self.$dataSystem.title1Name)),this._backSprite2=new Sprite(ImageManager.loadTitle2(self.$dataSystem.title2Name)),this.addChild(this._backSprite1),this.addChild(this._backSprite2)}createForeground(){this._gameTitleSprite=new Sprite(new Bitmap(Graphics$1.width,Graphics$1.height)),this.addChild(this._gameTitleSprite),self.$dataSystem.optDrawTitle&&this.drawGameTitle()}drawGameTitle(){const t=Graphics$1.height/4,e=Graphics$1.width-40,i=self.$dataSystem.gameTitle;this._gameTitleSprite.bitmap.outlineColor="black",this._gameTitleSprite.bitmap.outlineWidth=8,this._gameTitleSprite.bitmap.fontSize=72,this._gameTitleSprite.bitmap.drawText(i,20,t,e,48,"center")}centerSprite(t){t.x=Graphics$1.width/2,t.y=Graphics$1.height/2,t.anchor.x=.5,t.anchor.y=.5}createCommandWindow(){this._commandWindow=new Window_TitleCommand,this._commandWindow.setHandler("newGame",this.commandNewGame.bind(this)),this._commandWindow.setHandler("continue",this.commandContinue.bind(this)),this._commandWindow.setHandler("options",this.commandOptions.bind(this)),this.addWindow(this._commandWindow)}commandNewGame(){DataManager.setupNewGame(),this._commandWindow.close(),this.fadeOutAll(),SceneManager.goto(Scene_Map)}commandContinue(){this._commandWindow.close(),SceneManager.push(Scene_Load)}commandOptions(){this._commandWindow.close(),SceneManager.push(Scene_Options)}playTitleMusic(){AudioManager.playBgm(self.$dataSystem.titleBgm),AudioManager.stopBgs(),AudioManager.stopMe()}}class Scene_Gameover extends Scene_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.playGameoverMusic(),this.createBackground()}start(){super.start(),this.startFadeIn(this.slowFadeSpeed(),!1)}update(){this.isActive()&&!this.isBusy()&&this.isTriggered()&&this.gotoTitle(),super.update()}stop(){super.stop(),this.fadeOutAll()}terminate(){super.terminate(),AudioManager.stopAll()}playGameoverMusic(){AudioManager.stopBgm(),AudioManager.stopBgs(),AudioManager.playMe(self.$dataSystem.gameoverMe)}createBackground(){this._backSprite=new Sprite,this._backSprite.bitmap=ImageManager.loadSystem("GameOver"),this.addChild(this._backSprite)}isTriggered(){return Input.isTriggered("ok")||TouchInput.isTriggered()}gotoTitle(){SceneManager.goto(Scene_Title)}}class BattleManager{constructor(){throw new Error("This is a static class")}static setup(t,e,i){this.initMembers(),this._canEscape=e,this._canLose=i,self.$gameTroop.setup(t),self.$gameScreen.onBattleStart(),this.makeEscapeRatio()}static initMembers(){this._phase="init",this._canEscape=!1,this._canLose=!1,this._battleTest=!1,this._eventCallback=null,this._preemptive=!1,this._surprise=!1,this._actorIndex=-1,this._actionForcedBattler=null,this._mapBgm=null,this._mapBgs=null,this._actionBattlers=[],this._subject=null,this._action=null,this._targets=[],this._logWindow=null,this._statusWindow=null,this._spriteset=null,this._escapeRatio=0,this._escaped=!1,this._rewards={},this._turnForced=!1}static isBattleTest(){return this._battleTest}static setBattleTest(t){this._battleTest=t}static setEventCallback(t){this._eventCallback=t}static setLogWindow(t){this._logWindow=t}static setStatusWindow(t){this._statusWindow=t}static setSpriteset(t){this._spriteset=t}static onEncounter(){this._preemptive=Math.random()<this.ratePreemptive(),this._surprise=Math.random()<this.rateSurprise()&&!this._preemptive}static saveBgmAndBgs(){this._mapBgm=AudioManager.saveBgm(),this._mapBgs=AudioManager.saveBgs()}static replayBgmAndBgs(){this._mapBgm?AudioManager.replayBgm(this._mapBgm):AudioManager.stopBgm(),this._mapBgs&&AudioManager.replayBgs(this._mapBgs)}static makeEscapeRatio(){this._escapeRatio=.5*self.$gameParty.agility()/self.$gameTroop.agility()}static update(){if(!this.isBusy()&&!this.updateEvent())switch(this._phase){case"start":this.startInput();break;case"turn":this.updateTurn();break;case"action":this.updateAction();break;case"turnEnd":this.updateTurnEnd();break;case"battleEnd":this.updateBattleEnd()}}static updateEvent(){switch(this._phase){case"start":case"turn":case"turnEnd":return this.isActionForced()?(this.processForcedAction(),!0):this.updateEventMain()}return this.checkAbort()}static updateEventMain(){return self.$gameTroop.updateInterpreter(),self.$gameParty.requestMotionRefresh(),!!(self.$gameTroop.isEventRunning()||this.checkBattleEnd()||(self.$gameTroop.setupBattleEvent(),self.$gameTroop.isEventRunning()||SceneManager.isSceneChanging()))}static isBusy(){return self.$gameMessage.isBusy()||this._spriteset.isBusy()||this._logWindow.isBusy()}static isInputting(){return"input"===this._phase}static isInTurn(){return"turn"===this._phase}static isTurnEnd(){return"turnEnd"===this._phase}static isAborting(){return"aborting"===this._phase}static isBattleEnd(){return"battleEnd"===this._phase}static canEscape(){return this._canEscape}static canLose(){return this._canLose}static isEscaped(){return this._escaped}static actor(){return this._actorIndex>=0?self.$gameParty.members()[this._actorIndex]:null}static clearActor(){this.changeActor(-1,"")}static changeActor(t,e){const i=this.actor();this._actorIndex=t;const s=this.actor();i&&i.setActionState(e),s&&s.setActionState("inputting")}static startBattle(){this._phase="start",self.$gameSystem.onBattleStart(),self.$gameParty.onBattleStart(),self.$gameTroop.onBattleStart(),this.displayStartMessages()}static displayStartMessages(){self.$gameTroop.enemyNames().forEach((t=>{self.$gameMessage.add(TextManager.emerge.format(t))})),this._preemptive?self.$gameMessage.add(TextManager.preemptive.format(self.$gameParty.name())):this._surprise&&self.$gameMessage.add(TextManager.surprise.format(self.$gameParty.name()))}static startInput(){this._phase="input",self.$gameParty.makeActions(),self.$gameTroop.makeActions(),this.clearActor(),!this._surprise&&self.$gameParty.canInput()||this.startTurn()}static inputtingAction(){const t=this.actor();return t?t.inputtingAction():null}static selectNextCommand(){do{const t=this.actor();if((!t||!t.selectNextCommand())&&(this.changeActor(this._actorIndex+1,"waiting"),this._actorIndex>=self.$gameParty.size())){this.startTurn();break}}while(!this.actor().canInput())}static selectPreviousCommand(){do{const t=this.actor();if((!t||!t.selectPreviousCommand())&&(this.changeActor(this._actorIndex-1,"undecided"),this._actorIndex<0))return}while(!this.actor().canInput())}static refreshStatus(){this._statusWindow.refresh()}static startTurn(){this._phase="turn",this.clearActor(),self.$gameTroop.increaseTurn(),this.makeActionOrders(),self.$gameParty.requestMotionRefresh(),this._logWindow.startTurn()}static updateTurn(){self.$gameParty.requestMotionRefresh(),this._subject||(this._subject=this.getNextSubject()),this._subject?this.processTurn():this.endTurn()}static processTurn(){const t=this._subject,e=t.currentAction();e?(e.prepare(),e.isValid()&&this.startAction(),t.removeCurrentAction()):(t.onAllActionsEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(t),this._logWindow.displayCurrentState(t),this._logWindow.displayRegeneration(t),this._subject=this.getNextSubject())}static endTurn(){this._phase="turnEnd",this._preemptive=!1,this._surprise=!1,this.allBattleMembers().forEach((function(t){t.onTurnEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(t),this._logWindow.displayRegeneration(t)}),this),this.isForcedTurn()&&(this._turnForced=!1)}static isForcedTurn(){return this._turnForced}static updateTurnEnd(){this.startInput()}static getNextSubject(){for(;;){const t=this._actionBattlers.shift();if(!t)return null;if(t.isBattleMember()&&t.isAlive())return t}}static makeActionOrders(){let t=[];this._surprise||(t=t.concat(self.$gameParty.members())),this._preemptive||(t=t.concat(self.$gameTroop.members())),t.forEach((t=>{t.makeSpeed()})),t.sort(((t,e)=>e.speed()-t.speed())),this._actionBattlers=t}static startAction(){const t=this._subject,e=t.currentAction(),i=e.makeTargets();this._phase="action",this._action=e,this._targets=i,t.useItem(e.item()),this._action.applyGlobal(),this.refreshStatus(),this._logWindow.startAction(t,e,i)}static updateAction(){const t=this._targets.shift();t?this.invokeAction(this._subject,t):this.endAction()}static endAction(){this._logWindow.endAction(this._subject),this._phase="turn"}static invokeAction(t,e){this._logWindow.push("pushBaseLine"),Math.random()<this._action.itemCnt(e)?this.invokeCounterAttack(t,e):Math.random()<this._action.itemMrf(e)?this.invokeMagicReflection(t,e):this.invokeNormalAction(t,e),t.setLastTarget(e),this._logWindow.push("popBaseLine"),this.refreshStatus()}static invokeNormalAction(t,e){const i=this.applySubstitute(e);this._action.apply(i),this._logWindow.displayActionResults(t,i)}static invokeCounterAttack(t,e){const i=new Game_Action(e);i.setAttack(),i.apply(t),this._logWindow.displayCounter(e),this._logWindow.displayActionResults(e,t)}static invokeMagicReflection(t,e){this._action._reflectionTarget=e,this._logWindow.displayReflection(e),this._action.apply(t),this._logWindow.displayActionResults(e,t)}static applySubstitute(t){if(this.checkSubstitute(t)){const e=t.friendsUnit().substituteBattler();if(e&&t!==e)return this._logWindow.displaySubstitute(e,t),e}return t}static checkSubstitute(t){return t.isDying()&&!this._action.isCertainHit()}static isActionForced(){return!!this._actionForcedBattler}static forceAction(t){this._actionForcedBattler=t;const e=this._actionBattlers.indexOf(t);e>=0&&this._actionBattlers.splice(e,1)}static processForcedAction(){this._actionForcedBattler&&(this._turnForced=!0,this._subject=this._actionForcedBattler,this._actionForcedBattler=null,this.startAction(),this._subject.removeCurrentAction())}static abort(){this._phase="aborting"}static checkBattleEnd(){if(this._phase){if(this.checkAbort())return!0;if(self.$gameParty.isAllDead())return this.processDefeat(),!0;if(self.$gameTroop.isAllDead())return this.processVictory(),!0}return!1}static checkAbort(){return(self.$gameParty.isEmpty()||this.isAborting())&&(SoundManager.playEscape(),this._escaped=!0,this.processAbort()),!1}static processVictory(){self.$gameParty.removeBattleStates(),self.$gameParty.performVictory(),this.playVictoryMe(),this.replayBgmAndBgs(),this.makeRewards(),this.displayVictoryMessage(),this.displayRewards(),this.gainRewards(),this.endBattle(0)}static processEscape(){self.$gameParty.performEscape(),SoundManager.playEscape();const t=this.processEscapeFormula();return t?(this.displayEscapeSuccessMessage(),this._escaped=!0,this.processAbort()):(this.displayEscapeFailureMessage(),this._escapeRatio+=.1,self.$gameParty.clearActions(),this.startTurn()),t}static processEscapeFormula(){return!!this._preemptive||Math.random()<this._escapeRatio}static processAbort(){self.$gameParty.removeBattleStates(),this.replayBgmAndBgs(),this.endBattle(1)}static processDefeat(){this.displayDefeatMessage(),this.playDefeatMe(),this._canLose?this.replayBgmAndBgs():AudioManager.stopBgm(),this.endBattle(2)}static endBattle(t){this._phase="battleEnd",this._eventCallback&&this._eventCallback(t),0===t?self.$gameSystem.onBattleWin():this._escaped&&self.$gameSystem.onBattleEscape()}static updateBattleEnd(){this.isBattleTest()?(AudioManager.stopBgm(),SceneManager.exit()):!this._escaped&&self.$gameParty.isAllDead()?this._canLose?(self.$gameParty.reviveBattleMembers(),SceneManager.pop()):SceneManager.goto(Scene_Gameover):SceneManager.pop(),this._phase=null}static makeRewards(){this._rewards={},this._rewards.gold=self.$gameTroop.goldTotal(),this._rewards.exp=self.$gameTroop.expTotal(),this._rewards.items=self.$gameTroop.makeDropItems()}static displayRewards(){this.displayExp(),this.displayGold(),this.displayDropItems()}static displayExp(){const t=this._rewards.exp;if(t>0){const e=TextManager.obtainExp.format(t,TextManager.exp);self.$gameMessage.add(`\\.${e}`)}}static displayGold(){const t=this._rewards.gold;t>0&&self.$gameMessage.add(`\\.${TextManager.obtainGold.format(t)}`)}static displayDropItems(){const t=this._rewards.items;t.length>0&&(self.$gameMessage.newPage(),t.forEach((({name:t})=>{self.$gameMessage.add(TextManager.obtainItem.format(t))})))}static gainRewards(){this.gainExp(),this.gainGold(),this.gainDropItems()}static gainExp(){const t=this._rewards.exp;self.$gameParty.allMembers().forEach((e=>{e.gainExp(t)}))}static gainGold(){self.$gameParty.gainGold(this._rewards.gold)}static gainDropItems(){this._rewards.items.forEach((t=>{self.$gameParty.gainItem(t,1)}))}static ratePreemptive(){return self.$gameParty.ratePreemptive(self.$gameTroop.agility())}static rateSurprise(){return self.$gameParty.rateSurprise(self.$gameTroop.agility())}static playBattleBgm(){AudioManager.playBgm(self.$gameSystem.battleBgm()),AudioManager.stopBgs()}static playVictoryMe(){AudioManager.playMe(self.$gameSystem.victoryMe())}static playDefeatMe(){AudioManager.playMe(self.$gameSystem.defeatMe())}static allBattleMembers(){return self.$gameParty.members().concat(self.$gameTroop.members())}static displayVictoryMessage(){self.$gameMessage.add(TextManager.victory.format(self.$gameParty.name()))}static displayDefeatMessage(){self.$gameMessage.add(TextManager.defeat.format(self.$gameParty.name()))}static displayEscapeSuccessMessage(){self.$gameMessage.add(TextManager.escapeStart.format(self.$gameParty.name()))}static displayEscapeFailureMessage(){self.$gameMessage.add(TextManager.escapeStart.format(self.$gameParty.name())),self.$gameMessage.add(`\\.${TextManager.escapeFailure}`)}}class Scene_Boot extends Scene_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._startDate=Date.now()}create(){super.create(),DataManager.loadDatabase(),ConfigManager.load(),this.loadSystemWindowImage()}loadSystemWindowImage(){ImageManager.reserveSystem("Window")}isReady(){return!!Scene_Base.prototype.isReady.call(this)&&DataManager.isDatabaseLoaded()&&this.isGameFontLoaded()}isGameFontLoaded(){if(Graphics$1.isFontLoaded("GameFont"))return!0;if(!Graphics$1.canUseCssFontLoading()&&Date.now()-this._startDate>=6e4)throw new Error("Failed to load GameFont")}start(){super.start(),SoundManager.preloadImportantSounds(),DataManager.isBattleTest()?(DataManager.setupBattleTest(),SceneManager.goto(Scene_Battle)):DataManager.isEventTest()?(DataManager.setupEventTest(),SceneManager.goto(Scene_Map)):(this.checkPlayerLocation(),DataManager.setupNewGame(),SceneManager.goto(Scene_Title),Window_TitleCommand.initCommandPosition()),this.updateDocumentTitle()}updateDocumentTitle(){document.title=self.$dataSystem.gameTitle}checkPlayerLocation(){if(0===self.$dataSystem.startMapId)throw new Error("Player's starting position is not set")}static loadSystemImages(){ImageManager.reserveSystem("IconSet"),ImageManager.reserveSystem("Balloon"),ImageManager.reserveSystem("Shadow1"),ImageManager.reserveSystem("Shadow2"),ImageManager.reserveSystem("Damage"),ImageManager.reserveSystem("States"),ImageManager.reserveSystem("Weapons1"),ImageManager.reserveSystem("Weapons2"),ImageManager.reserveSystem("Weapons3"),ImageManager.reserveSystem("ButtonSet")}}class Game_Temp{constructor(...t){this.initialize(...t)}initialize(){this._isPlaytest=Utils.isOptionValid("test"),this._commonEventId=0,this._destinationX=null,this._destinationY=null}isPlaytest(){return this._isPlaytest}reserveCommonEvent(t){this._commonEventId=t}clearCommonEvent(){this._commonEventId=0}isCommonEventReserved(){return this._commonEventId>0}reservedCommonEvent(){return self.$dataCommonEvents[this._commonEventId]}reservedCommonEventId(){return this._commonEventId}setDestination(t,e){this._destinationX=t,this._destinationY=e}clearDestination(){this._destinationX=null,this._destinationY=null}isDestinationValid(){return null!==this._destinationX}destinationX(){return this._destinationX}destinationY(){return this._destinationY}}class Game_System{constructor(...t){this.initialize(...t)}initialize(){this._saveEnabled=!0,this._menuEnabled=!0,this._encounterEnabled=!0,this._formationEnabled=!0,this._battleCount=0,this._winCount=0,this._escapeCount=0,this._saveCount=0,this._versionId=0,this._framesOnSave=0,this._sceneFramesOnSave=0,this._bgmOnSave=null,this._bgsOnSave=null,this._windowTone=null,this._battleBgm=null,this._victoryMe=null,this._defeatMe=null,this._savedBgm=null,this._walkingBgm=null}isJapanese(){return self.$dataSystem.locale.match(/^ja/)}isChinese(){return self.$dataSystem.locale.match(/^zh/)}isKorean(){return self.$dataSystem.locale.match(/^ko/)}isCJK(){return self.$dataSystem.locale.match(/^(ja|zh|ko)/)}isRussian(){return self.$dataSystem.locale.match(/^ru/)}isSideView(){return self.$dataSystem.optSideView}isSaveEnabled(){return this._saveEnabled}disableSave(){this._saveEnabled=!1}enableSave(){this._saveEnabled=!0}isMenuEnabled(){return this._menuEnabled}disableMenu(){this._menuEnabled=!1}enableMenu(){this._menuEnabled=!0}isEncounterEnabled(){return this._encounterEnabled}disableEncounter(){this._encounterEnabled=!1}enableEncounter(){this._encounterEnabled=!0}isFormationEnabled(){return this._formationEnabled}disableFormation(){this._formationEnabled=!1}enableFormation(){this._formationEnabled=!0}battleCount(){return this._battleCount}winCount(){return this._winCount}escapeCount(){return this._escapeCount}saveCount(){return this._saveCount}versionId(){return this._versionId}windowTone(){return this._windowTone||self.$dataSystem.windowTone}setWindowTone(t){this._windowTone=t}battleBgm(){return this._battleBgm||self.$dataSystem.battleBgm}setBattleBgm(t){this._battleBgm=t}victoryMe(){return this._victoryMe||self.$dataSystem.victoryMe}setVictoryMe(t){this._victoryMe=t}defeatMe(){return this._defeatMe||self.$dataSystem.defeatMe}setDefeatMe(t){this._defeatMe=t}onBattleStart(){this._battleCount++}onBattleWin(){this._winCount++}onBattleEscape(){this._escapeCount++}onBeforeSave(){this._saveCount++,this._versionId=self.$dataSystem.versionId,this._framesOnSave=Graphics$1.frameCount,this._sceneFramesOnSave=SceneManager.frameCount(),this._bgmOnSave=AudioManager.saveBgm(),this._bgsOnSave=AudioManager.saveBgs()}onAfterLoad(){Graphics$1.frameCount=this._framesOnSave,SceneManager.setFrameCount(this._sceneFramesOnSave||this._framesOnSave),AudioManager.playBgm(this._bgmOnSave),AudioManager.playBgs(this._bgsOnSave)}playtime(){return Math.floor(SceneManager.frameCount()/60)}playtimeText(){const t=Math.floor(this.playtime()/60/60),e=Math.floor(this.playtime()/60)%60,i=this.playtime()%60;return`${t.padZero(2)}:${e.padZero(2)}:${i.padZero(2)}`}saveBgm(){this._savedBgm=AudioManager.saveBgm()}replayBgm(){this._savedBgm&&AudioManager.replayBgm(this._savedBgm)}saveWalkingBgm(){this._walkingBgm=AudioManager.saveBgm()}replayWalkingBgm(){this._walkingBgm&&AudioManager.playBgm(this._walkingBgm)}saveWalkingBgm2(){this._walkingBgm=self.$dataMap.bgm}}class Game_Picture{constructor(...t){this.initialize(...t)}initialize(){this.initBasic(),this.initTarget(),this.initTone(),this.initRotation()}name(){return this._name}origin(){return this._origin}x(){return this._x}y(){return this._y}scaleX(){return this._scaleX}scaleY(){return this._scaleY}opacity(){return this._opacity}blendMode(){return this._blendMode}tone(){return this._tone}angle(){return this._angle}initBasic(){this._name="",this._origin=0,this._x=0,this._y=0,this._scaleX=100,this._scaleY=100,this._opacity=255,this._blendMode=0}initTarget(){this._targetX=this._x,this._targetY=this._y,this._targetScaleX=this._scaleX,this._targetScaleY=this._scaleY,this._targetOpacity=this._opacity,this._duration=0}initTone(){this._tone=null,this._toneTarget=null,this._toneDuration=0}initRotation(){this._angle=0,this._rotationSpeed=0}show(t,e,i,s,a,r,n,h){this._name=t,this._origin=e,this._x=i,this._y=s,this._scaleX=a,this._scaleY=r,this._opacity=n,this._blendMode=h,this.initTarget(),this.initTone(),this.initRotation()}move(t,e,i,s,a,r,n,h){this._origin=t,this._targetX=e,this._targetY=i,this._targetScaleX=s,this._targetScaleY=a,this._targetOpacity=r,this._blendMode=n,this._duration=h}rotate(t){this._rotationSpeed=t}tint(t,e){this._tone||(this._tone=[0,0,0,0]),this._toneTarget=t.clone(),this._toneDuration=e,0===this._toneDuration&&(this._tone=this._toneTarget.clone())}erase(){this._name="",this._origin=0,this.initTarget(),this.initTone(),this.initRotation()}update(){this.updateMove(),this.updateTone(),this.updateRotation()}updateMove(){if(this._duration>0){const t=this._duration;this._x=(this._x*(t-1)+this._targetX)/t,this._y=(this._y*(t-1)+this._targetY)/t,this._scaleX=(this._scaleX*(t-1)+this._targetScaleX)/t,this._scaleY=(this._scaleY*(t-1)+this._targetScaleY)/t,this._opacity=(this._opacity*(t-1)+this._targetOpacity)/t,this._duration--}}updateTone(){if(this._toneDuration>0){const t=this._toneDuration;for(let e=0;e<4;e++)this._tone[e]=(this._tone[e]*(t-1)+this._toneTarget[e])/t;this._toneDuration--}}updateRotation(){0!==this._rotationSpeed&&(this._angle+=this._rotationSpeed/2)}}class Game_Screen{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this.clearFade(),this.clearTone(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.clearWeather(),this.clearPictures()}onBattleStart(){this.clearFade(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.eraseBattlePictures()}brightness(){return this._brightness}tone(){return this._tone}flashColor(){return this._flashColor}shake(){return this._shake}zoomX(){return this._zoomX}zoomY(){return this._zoomY}zoomScale(){return this._zoomScale}weatherType(){return this._weatherType}weatherPower(){return this._weatherPower}picture(t){const e=this.realPictureId(t);return this._pictures[e]}realPictureId(t){return self.$gameParty.inBattle()?t+this.maxPictures():t}clearFade(){this._brightness=255,this._fadeOutDuration=0,this._fadeInDuration=0}clearTone(){this._tone=[0,0,0,0],this._toneTarget=[0,0,0,0],this._toneDuration=0}clearFlash(){this._flashColor=[0,0,0,0],this._flashDuration=0}clearShake(){this._shakePower=0,this._shakeSpeed=0,this._shakeDuration=0,this._shakeDirection=1,this._shake=0}clearZoom(){this._zoomX=0,this._zoomY=0,this._zoomScale=1,this._zoomScaleTarget=1,this._zoomDuration=0}clearWeather(){this._weatherType="none",this._weatherPower=0,this._weatherPowerTarget=0,this._weatherDuration=0}clearPictures(){this._pictures=[]}eraseBattlePictures(){this._pictures=this._pictures.slice(0,this.maxPictures()+1)}maxPictures(){return 100}startFadeOut(t){this._fadeOutDuration=t,this._fadeInDuration=0}startFadeIn(t){this._fadeInDuration=t,this._fadeOutDuration=0}startTint(t,e){this._toneTarget=t.clone(),this._toneDuration=e,0===this._toneDuration&&(this._tone=this._toneTarget.clone())}startFlash(t,e){this._flashColor=t.clone(),this._flashDuration=e}startShake(t,e,i){this._shakePower=t,this._shakeSpeed=e,this._shakeDuration=i}startZoom(t,e,i,s){this._zoomX=t,this._zoomY=e,this._zoomScaleTarget=i,this._zoomDuration=s}setZoom(t,e,i){this._zoomX=t,this._zoomY=e,this._zoomScale=i}changeWeather(t,e,i){"none"===t&&0!==i||(this._weatherType=t),this._weatherPowerTarget="none"===t?0:e,this._weatherDuration=i,0===i&&(this._weatherPower=this._weatherPowerTarget)}update(){this.updateFadeOut(),this.updateFadeIn(),this.updateTone(),this.updateFlash(),this.updateShake(),this.updateZoom(),this.updateWeather(),this.updatePictures()}updateFadeOut(){if(this._fadeOutDuration>0){const t=this._fadeOutDuration;this._brightness=this._brightness*(t-1)/t,this._fadeOutDuration--}}updateFadeIn(){if(this._fadeInDuration>0){const t=this._fadeInDuration;this._brightness=(this._brightness*(t-1)+255)/t,this._fadeInDuration--}}updateTone(){if(this._toneDuration>0){const t=this._toneDuration;for(let e=0;e<4;e++)this._tone[e]=(this._tone[e]*(t-1)+this._toneTarget[e])/t;this._toneDuration--}}updateFlash(){if(this._flashDuration>0){const t=this._flashDuration;this._flashColor[3]*=(t-1)/t,this._flashDuration--}}updateShake(){if(this._shakeDuration>0||0!==this._shake){const t=this._shakePower*this._shakeSpeed*this._shakeDirection/10;this._shakeDuration<=1&&this._shake*(this._shake+t)<0?this._shake=0:this._shake+=t,this._shake>2*this._shakePower&&(this._shakeDirection=-1),this._shake<2*-this._shakePower&&(this._shakeDirection=1),this._shakeDuration--}}updateZoom(){if(this._zoomDuration>0){const t=this._zoomDuration,e=this._zoomScaleTarget;this._zoomScale=(this._zoomScale*(t-1)+e)/t,this._zoomDuration--}}updateWeather(){if(this._weatherDuration>0){const t=this._weatherDuration,e=this._weatherPowerTarget;this._weatherPower=(this._weatherPower*(t-1)+e)/t,this._weatherDuration--,0===this._weatherDuration&&0===this._weatherPowerTarget&&(this._weatherType="none")}}updatePictures(){this._pictures.forEach((t=>{t&&t.update()}))}startFlashForDamage(){this.startFlash([255,0,0,128],8)}showPicture(t,e,i,s,a,r,n,h,o){const l=this.realPictureId(t),c=new Game_Picture;c.show(e,i,s,a,r,n,h,o),this._pictures[l]=c}movePicture(t,e,i,s,a,r,n,h,o){const l=this.picture(t);l&&l.move(e,i,s,a,r,n,h,o)}rotatePicture(t,e){const i=this.picture(t);i&&i.rotate(e)}tintPicture(t,e,i){const s=this.picture(t);s&&s.tint(e,i)}erasePicture(t){const e=this.realPictureId(t);this._pictures[e]=null}}class Game_Timer{constructor(...t){this.initialize(...t)}initialize(){this._frames=0,this._working=!1}update(t){t&&this._working&&this._frames>0&&(this._frames--,0===this._frames&&this.onExpire())}start(t){this._frames=t,this._working=!0}stop(){this._working=!1}isWorking(){return this._working}seconds(){return Math.floor(this._frames/60)}onExpire(){BattleManager.abort()}}class Game_Message{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._texts=[],this._choices=[],this._faceName="",this._faceIndex=0,this._background=0,this._positionType=2,this._choiceDefaultType=0,this._choiceCancelType=0,this._choiceBackground=0,this._choicePositionType=2,this._numInputVariableId=0,this._numInputMaxDigits=0,this._itemChoiceVariableId=0,this._itemChoiceItypeId=0,this._scrollMode=!1,this._scrollSpeed=2,this._scrollNoFast=!1,this._choiceCallback=null}choices(){return this._choices}faceName(){return this._faceName}faceIndex(){return this._faceIndex}background(){return this._background}positionType(){return this._positionType}choiceDefaultType(){return this._choiceDefaultType}choiceCancelType(){return this._choiceCancelType}choiceBackground(){return this._choiceBackground}choicePositionType(){return this._choicePositionType}numInputVariableId(){return this._numInputVariableId}numInputMaxDigits(){return this._numInputMaxDigits}itemChoiceVariableId(){return this._itemChoiceVariableId}itemChoiceItypeId(){return this._itemChoiceItypeId}scrollMode(){return this._scrollMode}scrollSpeed(){return this._scrollSpeed}scrollNoFast(){return this._scrollNoFast}add(t){this._texts.push(t)}setFaceImage(t,e){this._faceName=t,this._faceIndex=e}setBackground(t){this._background=t}setPositionType(t){this._positionType=t}setChoices(t,e,i){this._choices=t,this._choiceDefaultType=e,this._choiceCancelType=i}setChoiceBackground(t){this._choiceBackground=t}setChoicePositionType(t){this._choicePositionType=t}setNumberInput(t,e){this._numInputVariableId=t,this._numInputMaxDigits=e}setItemChoice(t,e){this._itemChoiceVariableId=t,this._itemChoiceItypeId=e}setScroll(t,e){this._scrollMode=!0,this._scrollSpeed=t,this._scrollNoFast=e}setChoiceCallback(t){this._choiceCallback=t}onChoice(t){this._choiceCallback&&(this._choiceCallback(t),this._choiceCallback=null)}hasText(){return this._texts.length>0}isChoice(){return this._choices.length>0}isNumberInput(){return this._numInputVariableId>0}isItemChoice(){return this._itemChoiceVariableId>0}isBusy(){return this.hasText()||this.isChoice()||this.isNumberInput()||this.isItemChoice()}newPage(){this._texts.length>0&&(this._texts[this._texts.length-1]+="\f")}allText(){return this._texts.join("\n")}}class Game_Switches{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._data=[]}value(t){return!!this._data[t]}setValue(t,e){t>0&&t<self.$dataSystem.switches.length&&(this._data[t]=e,this.onChange())}onChange(){self.$gameMap.requestRefresh()}}class Game_Variables{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._data=[]}value(t){return this._data[t]||0}setValue(t,e){t>0&&t<self.$dataSystem.variables.length&&("number"==typeof e&&(e=Math.floor(e)),this._data[t]=e,this.onChange())}onChange(){self.$gameMap.requestRefresh()}}class Game_SelfSwitches{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._data={}}value(t){return!!this._data[t]}setValue(t,e){e?this._data[t]=!0:delete this._data[t],this.onChange()}onChange(){self.$gameMap.requestRefresh()}}class Game_BattlerBase{constructor(...t){this.initialize(...t)}initialize(){this.initMembers()}initMembers(){this._hp=1,this._mp=0,this._tp=0,this._hidden=!1,this.clearParamPlus(),this.clearStates(),this.clearBuffs()}clearParamPlus(){this._paramPlus=[0,0,0,0,0,0,0,0]}clearStates(){this._states=[],this._stateTurns={}}eraseState(t){const e=this._states.indexOf(t);e>=0&&this._states.splice(e,1),delete this._stateTurns[t]}isStateAffected(t){return this._states.contains(t)}isDeathStateAffected(){return this.isStateAffected(this.deathStateId())}deathStateId(){return 1}resetStateCounts(t){const e=self.$dataStates[t],i=1+Math.max(e.maxTurns-e.minTurns,0);this._stateTurns[t]=e.minTurns+Math.randomInt(i)}isStateExpired(t){return 0===this._stateTurns[t]}updateStateTurns(){this._states.forEach((function(t){this._stateTurns[t]>0&&this._stateTurns[t]--}),this)}clearBuffs(){this._buffs=[0,0,0,0,0,0,0,0],this._buffTurns=[0,0,0,0,0,0,0,0]}eraseBuff(t){this._buffs[t]=0,this._buffTurns[t]=0}buffLength(){return this._buffs.length}buff(t){return this._buffs[t]}isBuffAffected(t){return this._buffs[t]>0}isDebuffAffected(t){return this._buffs[t]<0}isBuffOrDebuffAffected(t){return 0!==this._buffs[t]}isMaxBuffAffected(t){return 2===this._buffs[t]}isMaxDebuffAffected(t){return-2===this._buffs[t]}increaseBuff(t){this.isMaxBuffAffected(t)||this._buffs[t]++}decreaseBuff(t){this.isMaxDebuffAffected(t)||this._buffs[t]--}overwriteBuffTurns(t,e){this._buffTurns[t]<e&&(this._buffTurns[t]=e)}isBuffExpired(t){return 0===this._buffTurns[t]}updateBuffTurns(){for(let t=0;t<this._buffTurns.length;t++)this._buffTurns[t]>0&&this._buffTurns[t]--}die(){this._hp=0,this.clearStates(),this.clearBuffs()}revive(){0===this._hp&&(this._hp=1)}states(){return this._states.map((t=>self.$dataStates[t]))}stateIcons(){return this.states().map((({iconIndex:t})=>t)).filter((t=>t>0))}buffIcons(){const t=[];for(let e=0;e<this._buffs.length;e++)0!==this._buffs[e]&&t.push(this.buffIconIndex(this._buffs[e],e));return t}buffIconIndex(t,e){return t>0?Game_BattlerBase.ICON_BUFF_START+8*(t-1)+e:t<0?Game_BattlerBase.ICON_DEBUFF_START+8*(-t-1)+e:0}allIcons(){return this.stateIcons().concat(this.buffIcons())}traitObjects(){return this.states()}allTraits(){return this.traitObjects().reduce(((t,{traits:e})=>t.concat(e)),[])}traits(t){return this.allTraits().filter((e=>e.code===t))}traitsWithId(t,e){return this.allTraits().filter((i=>i.code===t&&i.dataId===e))}traitsPi(t,e){return this.traitsWithId(t,e).reduce(((t,{value:e})=>t*e),1)}traitsSum(t,e){return this.traitsWithId(t,e).reduce(((t,{value:e})=>t+e),0)}traitsSumAll(t){return this.traits(t).reduce(((t,{value:e})=>t+e),0)}traitsSet(t){return this.traits(t).reduce(((t,{dataId:e})=>t.concat(e)),[])}paramBase(t){return 0}paramPlus(t){return this._paramPlus[t]}paramMin(t){return 1===t?0:1}paramMax(t){return 0===t?999999:1===t?9999:999}paramRate(t){return this.traitsPi(Game_BattlerBase.TRAIT_PARAM,t)}paramBuffRate(t){return.25*this._buffs[t]+1}param(t){let e=this.paramBase(t)+this.paramPlus(t);e*=this.paramRate(t)*this.paramBuffRate(t);const i=this.paramMax(t),s=this.paramMin(t);return Math.round(e.clamp(s,i))}xparam(t){return this.traitsSum(Game_BattlerBase.TRAIT_XPARAM,t)}sparam(t){return this.traitsPi(Game_BattlerBase.TRAIT_SPARAM,t)}elementRate(t){return this.traitsPi(Game_BattlerBase.TRAIT_ELEMENT_RATE,t)}debuffRate(t){return this.traitsPi(Game_BattlerBase.TRAIT_DEBUFF_RATE,t)}stateRate(t){return this.traitsPi(Game_BattlerBase.TRAIT_STATE_RATE,t)}stateResistSet(){return this.traitsSet(Game_BattlerBase.TRAIT_STATE_RESIST)}isStateResist(t){return this.stateResistSet().contains(t)}attackElements(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_ELEMENT)}attackStates(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_STATE)}attackStatesRate(t){return this.traitsSum(Game_BattlerBase.TRAIT_ATTACK_STATE,t)}attackSpeed(){return this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_SPEED)}attackTimesAdd(){return Math.max(this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_TIMES),0)}addedSkillTypes(){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_ADD)}isSkillTypeSealed(t){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_SEAL).contains(t)}addedSkills(){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_ADD)}isSkillSealed(t){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_SEAL).contains(t)}isEquipWtypeOk(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_WTYPE).contains(t)}isEquipAtypeOk(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_ATYPE).contains(t)}isEquipTypeLocked(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_LOCK).contains(t)}isEquipTypeSealed(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_SEAL).contains(t)}slotType(){const t=this.traitsSet(Game_BattlerBase.TRAIT_SLOT_TYPE);return t.length>0?Math.max.apply(null,t):0}isDualWield(){return 1===this.slotType()}actionPlusSet(){return this.traits(Game_BattlerBase.TRAIT_ACTION_PLUS).map((({value:t})=>t))}specialFlag(t){return this.traits(Game_BattlerBase.TRAIT_SPECIAL_FLAG).some((({dataId:e})=>e===t))}collapseType(){const t=this.traitsSet(Game_BattlerBase.TRAIT_COLLAPSE_TYPE);return t.length>0?Math.max.apply(null,t):0}partyAbility(t){return this.traits(Game_BattlerBase.TRAIT_PARTY_ABILITY).some((({dataId:e})=>e===t))}isAutoBattle(){return this.specialFlag(Game_BattlerBase.FLAG_ID_AUTO_BATTLE)}isGuard(){return this.specialFlag(Game_BattlerBase.FLAG_ID_GUARD)&&this.canMove()}isSubstitute(){return this.specialFlag(Game_BattlerBase.FLAG_ID_SUBSTITUTE)&&this.canMove()}isPreserveTp(){return this.specialFlag(Game_BattlerBase.FLAG_ID_PRESERVE_TP)}addParam(t,e){this._paramPlus[t]+=e,this.refresh()}setHp(t){this._hp=t,this.refresh()}setMp(t){this._mp=t,this.refresh()}setTp(t){this._tp=t,this.refresh()}maxTp(){return 100}refresh(){this.stateResistSet().forEach((function(t){this.eraseState(t)}),this),this._hp=this._hp.clamp(0,this.mhp),this._mp=this._mp.clamp(0,this.mmp),this._tp=this._tp.clamp(0,this.maxTp())}recoverAll(){this.clearStates(),this._hp=this.mhp,this._mp=this.mmp}hpRate(){return this.hp/this.mhp}mpRate(){return this.mmp>0?this.mp/this.mmp:0}tpRate(){return this.tp/this.maxTp()}hide(){this._hidden=!0}appear(){this._hidden=!1}isHidden(){return this._hidden}isAppeared(){return!this.isHidden()}isDead(){return this.isAppeared()&&this.isDeathStateAffected()}isAlive(){return this.isAppeared()&&!this.isDeathStateAffected()}isDying(){return this.isAlive()&&this._hp<this.mhp/4}isRestricted(){return this.isAppeared()&&this.restriction()>0}canInput(){return this.isAppeared()&&!this.isRestricted()&&!this.isAutoBattle()}canMove(){return this.isAppeared()&&this.restriction()<4}isConfused(){return this.isAppeared()&&this.restriction()>=1&&this.restriction()<=3}confusionLevel(){return this.isConfused()?this.restriction():0}isActor(){return!1}isEnemy(){return!1}sortStates(){this._states.sort(((t,e)=>{const i=self.$dataStates[t].priority,s=self.$dataStates[e].priority;return i!==s?s-i:t-e}))}restriction(){return Math.max.apply(null,this.states().map((({restriction:t})=>t)).concat(0))}addNewState(t){t===this.deathStateId()&&this.die();const e=this.isRestricted();this._states.push(t),this.sortStates(),!e&&this.isRestricted()&&this.onRestrict()}onRestrict(){}mostImportantStateText(){const t=this.states();for(let e=0;e<t.length;e++)if(t[e].message3)return t[e].message3;return""}stateMotionIndex(){const t=this.states();return t.length>0?t[0].motion:0}stateOverlayIndex(){const t=this.states();return t.length>0?t[0].overlay:0}isSkillWtypeOk(t){return!0}skillMpCost({mpCost:t}){return Math.floor(t*this.mcr)}skillTpCost({tpCost:t}){return t}canPaySkillCost(t){return this._tp>=this.skillTpCost(t)&&this._mp>=this.skillMpCost(t)}paySkillCost(t){this._mp-=this.skillMpCost(t),this._tp-=this.skillTpCost(t)}isOccasionOk({occasion:t}){return self.$gameParty.inBattle()?0===t||1===t:0===t||2===t}meetsUsableItemConditions(t){return this.canMove()&&this.isOccasionOk(t)}meetsSkillConditions(t){return this.meetsUsableItemConditions(t)&&this.isSkillWtypeOk(t)&&this.canPaySkillCost(t)&&!this.isSkillSealed(t.id)&&!this.isSkillTypeSealed(t.stypeId)}meetsItemConditions(t){return this.meetsUsableItemConditions(t)&&self.$gameParty.hasItem(t)}canUse(t){return!!t&&(DataManager.isSkill(t)?this.meetsSkillConditions(t):!!DataManager.isItem(t)&&this.meetsItemConditions(t))}canEquip(t){return!!t&&(DataManager.isWeapon(t)?this.canEquipWeapon(t):!!DataManager.isArmor(t)&&this.canEquipArmor(t))}canEquipWeapon({wtypeId:t,etypeId:e}){return this.isEquipWtypeOk(t)&&!this.isEquipTypeSealed(e)}canEquipArmor({atypeId:t,etypeId:e}){return this.isEquipAtypeOk(t)&&!this.isEquipTypeSealed(e)}attackSkillId(){return 1}guardSkillId(){return 2}canAttack(){return this.canUse(self.$dataSkills[this.attackSkillId()])}canGuard(){return this.canUse(self.$dataSkills[this.guardSkillId()])}}Game_BattlerBase.TRAIT_ELEMENT_RATE=11,Game_BattlerBase.TRAIT_DEBUFF_RATE=12,Game_BattlerBase.TRAIT_STATE_RATE=13,Game_BattlerBase.TRAIT_STATE_RESIST=14,Game_BattlerBase.TRAIT_PARAM=21,Game_BattlerBase.TRAIT_XPARAM=22,Game_BattlerBase.TRAIT_SPARAM=23,Game_BattlerBase.TRAIT_ATTACK_ELEMENT=31,Game_BattlerBase.TRAIT_ATTACK_STATE=32,Game_BattlerBase.TRAIT_ATTACK_SPEED=33,Game_BattlerBase.TRAIT_ATTACK_TIMES=34,Game_BattlerBase.TRAIT_STYPE_ADD=41,Game_BattlerBase.TRAIT_STYPE_SEAL=42,Game_BattlerBase.TRAIT_SKILL_ADD=43,Game_BattlerBase.TRAIT_SKILL_SEAL=44,Game_BattlerBase.TRAIT_EQUIP_WTYPE=51,Game_BattlerBase.TRAIT_EQUIP_ATYPE=52,Game_BattlerBase.TRAIT_EQUIP_LOCK=53,Game_BattlerBase.TRAIT_EQUIP_SEAL=54,Game_BattlerBase.TRAIT_SLOT_TYPE=55,Game_BattlerBase.TRAIT_ACTION_PLUS=61,Game_BattlerBase.TRAIT_SPECIAL_FLAG=62,Game_BattlerBase.TRAIT_COLLAPSE_TYPE=63,Game_BattlerBase.TRAIT_PARTY_ABILITY=64,Game_BattlerBase.FLAG_ID_AUTO_BATTLE=0,Game_BattlerBase.FLAG_ID_GUARD=1,Game_BattlerBase.FLAG_ID_SUBSTITUTE=2,Game_BattlerBase.FLAG_ID_PRESERVE_TP=3,Game_BattlerBase.ICON_BUFF_START=32,Game_BattlerBase.ICON_DEBUFF_START=48,Object.defineProperties(Game_BattlerBase.prototype,{hp:{get(){return this._hp},configurable:!0},mp:{get(){return this._mp},configurable:!0},tp:{get(){return this._tp},configurable:!0},mhp:{get(){return this.param(0)},configurable:!0},mmp:{get(){return this.param(1)},configurable:!0},atk:{get(){return this.param(2)},configurable:!0},def:{get(){return this.param(3)},configurable:!0},mat:{get(){return this.param(4)},configurable:!0},mdf:{get(){return this.param(5)},configurable:!0},agi:{get(){return this.param(6)},configurable:!0},luk:{get(){return this.param(7)},configurable:!0},hit:{get(){return this.xparam(0)},configurable:!0},eva:{get(){return this.xparam(1)},configurable:!0},cri:{get(){return this.xparam(2)},configurable:!0},cev:{get(){return this.xparam(3)},configurable:!0},mev:{get(){return this.xparam(4)},configurable:!0},mrf:{get(){return this.xparam(5)},configurable:!0},cnt:{get(){return this.xparam(6)},configurable:!0},hrg:{get(){return this.xparam(7)},configurable:!0},mrg:{get(){return this.xparam(8)},configurable:!0},trg:{get(){return this.xparam(9)},configurable:!0},tgr:{get(){return this.sparam(0)},configurable:!0},grd:{get(){return this.sparam(1)},configurable:!0},rec:{get(){return this.sparam(2)},configurable:!0},pha:{get(){return this.sparam(3)},configurable:!0},mcr:{get(){return this.sparam(4)},configurable:!0},tcr:{get(){return this.sparam(5)},configurable:!0},pdr:{get(){return this.sparam(6)},configurable:!0},mdr:{get(){return this.sparam(7)},configurable:!0},fdr:{get(){return this.sparam(8)},configurable:!0},exr:{get(){return this.sparam(9)},configurable:!0}});class Game_ActionResult{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this.used=!1,this.missed=!1,this.evaded=!1,this.physical=!1,this.drain=!1,this.critical=!1,this.success=!1,this.hpAffected=!1,this.hpDamage=0,this.mpDamage=0,this.tpDamage=0,this.addedStates=[],this.removedStates=[],this.addedBuffs=[],this.addedDebuffs=[],this.removedBuffs=[]}addedStateObjects(){return this.addedStates.map((t=>self.$dataStates[t]))}removedStateObjects(){return this.removedStates.map((t=>self.$dataStates[t]))}isStatusAffected(){return this.addedStates.length>0||this.removedStates.length>0||this.addedBuffs.length>0||this.addedDebuffs.length>0||this.removedBuffs.length>0}isHit(){return this.used&&!this.missed&&!this.evaded}isStateAdded(t){return this.addedStates.contains(t)}pushAddedState(t){this.isStateAdded(t)||this.addedStates.push(t)}isStateRemoved(t){return this.removedStates.contains(t)}pushRemovedState(t){this.isStateRemoved(t)||this.removedStates.push(t)}isBuffAdded(t){return this.addedBuffs.contains(t)}pushAddedBuff(t){this.isBuffAdded(t)||this.addedBuffs.push(t)}isDebuffAdded(t){return this.addedDebuffs.contains(t)}pushAddedDebuff(t){this.isDebuffAdded(t)||this.addedDebuffs.push(t)}isBuffRemoved(t){return this.removedBuffs.contains(t)}pushRemovedBuff(t){this.isBuffRemoved(t)||this.removedBuffs.push(t)}}class Game_Battler extends Game_BattlerBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}initMembers(){super.initMembers(),this._actions=[],this._speed=0,this._result=new Game_ActionResult,this._actionState="",this._lastTargetIndex=0,this._animations=[],this._damagePopup=!1,this._effectType=null,this._motionType=null,this._weaponImageId=0,this._motionRefresh=!1,this._selected=!1}clearAnimations(){this._animations=[]}clearDamagePopup(){this._damagePopup=!1}clearWeaponAnimation(){this._weaponImageId=0}clearEffect(){this._effectType=null}clearMotion(){this._motionType=null,this._motionRefresh=!1}requestEffect(t){this._effectType=t}requestMotion(t){this._motionType=t}requestMotionRefresh(){this._motionRefresh=!0}select(){this._selected=!0}deselect(){this._selected=!1}isAnimationRequested(){return this._animations.length>0}isDamagePopupRequested(){return this._damagePopup}isEffectRequested(){return!!this._effectType}isMotionRequested(){return!!this._motionType}isWeaponAnimationRequested(){return this._weaponImageId>0}isMotionRefreshRequested(){return this._motionRefresh}isSelected(){return this._selected}effectType(){return this._effectType}motionType(){return this._motionType}weaponImageId(){return this._weaponImageId}shiftAnimation(){return this._animations.shift()}startAnimation(t,e,i){const s={animationId:t,mirror:e,delay:i};this._animations.push(s)}startDamagePopup(){this._damagePopup=!0}startWeaponAnimation(t){this._weaponImageId=t}action(t){return this._actions[t]}setAction(t,e){this._actions[t]=e}numActions(){return this._actions.length}clearActions(){this._actions=[]}result(){return this._result}clearResult(){this._result.clear()}refresh(){super.refresh(),0===this.hp?this.addState(this.deathStateId()):this.removeState(this.deathStateId())}addState(t){this.isStateAddable(t)&&(this.isStateAffected(t)||(this.addNewState(t),this.refresh()),this.resetStateCounts(t),this._result.pushAddedState(t))}isStateAddable(t){return this.isAlive()&&self.$dataStates[t]&&!this.isStateResist(t)&&!this._result.isStateRemoved(t)&&!this.isStateRestrict(t)}isStateRestrict(t){return self.$dataStates[t].removeByRestriction&&this.isRestricted()}onRestrict(){super.onRestrict(),this.clearActions(),this.states().forEach((function({removeByRestriction:t,id:e}){t&&this.removeState(e)}),this)}removeState(t){this.isStateAffected(t)&&(t===this.deathStateId()&&this.revive(),this.eraseState(t),this.refresh(),this._result.pushRemovedState(t))}escape(){self.$gameParty.inBattle()&&this.hide(),this.clearActions(),this.clearStates(),SoundManager.playEscape()}addBuff(t,e){this.isAlive()&&(this.increaseBuff(t),this.isBuffAffected(t)&&this.overwriteBuffTurns(t,e),this._result.pushAddedBuff(t),this.refresh())}addDebuff(t,e){this.isAlive()&&(this.decreaseBuff(t),this.isDebuffAffected(t)&&this.overwriteBuffTurns(t,e),this._result.pushAddedDebuff(t),this.refresh())}removeBuff(t){this.isAlive()&&this.isBuffOrDebuffAffected(t)&&(this.eraseBuff(t),this._result.pushRemovedBuff(t),this.refresh())}removeBattleStates(){this.states().forEach((function({removeAtBattleEnd:t,id:e}){t&&this.removeState(e)}),this)}removeAllBuffs(){for(let t=0;t<this.buffLength();t++)this.removeBuff(t)}removeStatesAuto(t){this.states().forEach((function({id:e,autoRemovalTiming:i}){this.isStateExpired(e)&&i===t&&this.removeState(e)}),this)}removeBuffsAuto(){for(let t=0;t<this.buffLength();t++)this.isBuffExpired(t)&&this.removeBuff(t)}removeStatesByDamage(){this.states().forEach((function({removeByDamage:t,chanceByDamage:e,id:i}){t&&Math.randomInt(100)<e&&this.removeState(i)}),this)}makeActionTimes(){return this.actionPlusSet().reduce(((t,e)=>Math.random()<e?t+1:t),1)}makeActions(){if(this.clearActions(),this.canMove()){const t=this.makeActionTimes();this._actions=[];for(let e=0;e<t;e++)this._actions.push(new Game_Action(this))}}speed(){return this._speed}makeSpeed(){this._speed=Math.min.apply(null,this._actions.map((t=>t.speed())))||0}currentAction(){return this._actions[0]}removeCurrentAction(){this._actions.shift()}setLastTarget(t){this._lastTargetIndex=t?t.index():0}forceAction(t,e){this.clearActions();const i=new Game_Action(this,!0);i.setSkill(t),-2===e?i.setTarget(this._lastTargetIndex):-1===e?i.decideRandomTarget():i.setTarget(e),this._actions.push(i)}useItem(t){DataManager.isSkill(t)?this.paySkillCost(t):DataManager.isItem(t)&&this.consumeItem(t)}consumeItem(t){self.$gameParty.consumeItem(t)}gainHp(t){this._result.hpDamage=-t,this._result.hpAffected=!0,this.setHp(this.hp+t)}gainMp(t){this._result.mpDamage=-t,this.setMp(this.mp+t)}gainTp(t){this._result.tpDamage=-t,this.setTp(this.tp+t)}gainSilentTp(t){this.setTp(this.tp+t)}initTp(){this.setTp(Math.randomInt(25))}clearTp(){this.setTp(0)}chargeTpByDamage(t){const e=Math.floor(50*t*this.tcr);this.gainSilentTp(e)}regenerateHp(){let t=Math.floor(this.mhp*this.hrg);t=Math.max(t,-this.maxSlipDamage()),0!==t&&this.gainHp(t)}maxSlipDamage(){return self.$dataSystem.optSlipDeath?this.hp:Math.max(this.hp-1,0)}regenerateMp(){const t=Math.floor(this.mmp*this.mrg);0!==t&&this.gainMp(t)}regenerateTp(){const t=Math.floor(100*this.trg);this.gainSilentTp(t)}regenerateAll(){this.isAlive()&&(this.regenerateHp(),this.regenerateMp(),this.regenerateTp())}onBattleStart(){this.setActionState("undecided"),this.clearMotion(),this.isPreserveTp()||this.initTp()}onAllActionsEnd(){this.clearResult(),this.removeStatesAuto(1),this.removeBuffsAuto()}onTurnEnd(){this.clearResult(),this.regenerateAll(),BattleManager.isForcedTurn()||(this.updateStateTurns(),this.updateBuffTurns()),this.removeStatesAuto(2)}onBattleEnd(){this.clearResult(),this.removeBattleStates(),this.removeAllBuffs(),this.clearActions(),this.isPreserveTp()||this.clearTp(),this.appear()}onDamage(t){this.removeStatesByDamage(),this.chargeTpByDamage(t/this.mhp)}setActionState(t){this._actionState=t,this.requestMotionRefresh()}isUndecided(){return"undecided"===this._actionState}isInputting(){return"inputting"===this._actionState}isWaiting(){return"waiting"===this._actionState}isActing(){return"acting"===this._actionState}isChanting(){return!!this.isWaiting()&&this._actions.some((t=>t.isMagicSkill()))}isGuardWaiting(){return!!this.isWaiting()&&this._actions.some((t=>t.isGuard()))}performActionStart(t){t.isGuard()||this.setActionState("acting")}performAction(t){}performActionEnd(){this.setActionState("done")}performDamage(){}performMiss(){SoundManager.playMiss()}performRecovery(){SoundManager.playRecovery()}performEvasion(){SoundManager.playEvasion()}performMagicEvasion(){SoundManager.playMagicEvasion()}performCounter(){SoundManager.playEvasion()}performReflection(){SoundManager.playReflection()}performSubstitute(t){}performCollapse(){}}class Game_Actor extends Game_Battler{constructor(...t){super(...t),this.initialize(...t)}get level(){return this._level}initialize(t){super.initialize(),this.setup(t)}initMembers(){super.initMembers(),this._actorId=0,this._name="",this._nickname="",this._classId=0,this._level=0,this._characterName="",this._characterIndex=0,this._faceName="",this._faceIndex=0,this._battlerName="",this._exp={},this._skills=[],this._equips=[],this._actionInputIndex=0,this._lastMenuSkill=new Game_Item,this._lastBattleSkill=new Game_Item,this._lastCommandSymbol=""}setup(t){const e=self.$dataActors[t];this._actorId=t,this._name=e.name,this._nickname=e.nickname,this._profile=e.profile,this._classId=e.classId,this._level=e.initialLevel,this.initImages(),this.initExp(),this.initSkills(),this.initEquips(e.equips),this.clearParamPlus(),this.recoverAll()}actorId(){return this._actorId}actor(){return self.$dataActors[this._actorId]}name(){return this._name}setName(t){this._name=t}nickname(){return this._nickname}setNickname(t){this._nickname=t}profile(){return this._profile}setProfile(t){this._profile=t}characterName(){return this._characterName}characterIndex(){return this._characterIndex}faceName(){return this._faceName}faceIndex(){return this._faceIndex}battlerName(){return this._battlerName}clearStates(){super.clearStates(),this._stateSteps={}}eraseState(t){super.eraseState(t),delete this._stateSteps[t]}resetStateCounts(t){super.resetStateCounts(t),this._stateSteps[t]=self.$dataStates[t].stepsToRemove}initImages(){const t=this.actor();this._characterName=t.characterName,this._characterIndex=t.characterIndex,this._faceName=t.faceName,this._faceIndex=t.faceIndex,this._battlerName=t.battlerName}expForLevel(t){const e=this.currentClass(),i=e.expParams[0],s=e.expParams[1],a=e.expParams[2],r=e.expParams[3];return Math.round(i*Math.pow(t-1,.9+a/250)*t*(t+1)/(6+Math.pow(t,2)/50/r)+(t-1)*s)}initExp(){this._exp[this._classId]=this.currentLevelExp()}currentExp(){return this._exp[this._classId]}currentLevelExp(){return this.expForLevel(this._level)}nextLevelExp(){return this.expForLevel(this._level+1)}nextRequiredExp(){return this.nextLevelExp()-this.currentExp()}maxLevel(){return this.actor().maxLevel}isMaxLevel(){return this._level>=this.maxLevel()}initSkills(){this._skills=[],this.currentClass().learnings.forEach((function({level:t,skillId:e}){t<=this._level&&this.learnSkill(e)}),this)}initEquips(t){const e=this.equipSlots(),i=e.length;this._equips=[];for(let t=0;t<i;t++)this._equips[t]=new Game_Item;for(let s=0;s<t.length;s++)s<i&&this._equips[s].setEquip(1===e[s],t[s]);this.releaseUnequippableItems(!0),this.refresh()}equipSlots(){const t=[];for(let e=1;e<self.$dataSystem.equipTypes.length;e++)t.push(e);return t.length>=2&&this.isDualWield()&&(t[1]=1),t}equips(){return this._equips.map((t=>t.object()))}weapons(){return this.equips().filter((t=>t&&DataManager.isWeapon(t)))}armors(){return this.equips().filter((t=>t&&DataManager.isArmor(t)))}hasWeapon(t){return this.weapons().contains(t)}hasArmor(t){return this.armors().contains(t)}isEquipChangeOk(t){return!this.isEquipTypeLocked(this.equipSlots()[t])&&!this.isEquipTypeSealed(this.equipSlots()[t])}changeEquip(t,e){!this.tradeItemWithParty(e,this.equips()[t])||e&&this.equipSlots()[t]!==e.etypeId||(this._equips[t].setObject(e),this.refresh())}forceChangeEquip(t,e){this._equips[t].setObject(e),this.releaseUnequippableItems(!0),this.refresh()}tradeItemWithParty(t,e){return!(t&&!self.$gameParty.hasItem(t)||(self.$gameParty.gainItem(e,1),self.$gameParty.loseItem(t,1),0))}changeEquipById(t,e){const i=t-1;1===this.equipSlots()[i]?this.changeEquip(i,self.$dataWeapons[e]):this.changeEquip(i,self.$dataArmors[e])}isEquipped(t){return this.equips().contains(t)}discardEquip(t){const e=this.equips().indexOf(t);e>=0&&this._equips[e].setObject(null)}releaseUnequippableItems(t){for(;;){const e=this.equipSlots(),i=this.equips();let s=!1;if(i.forEach(((i,a)=>{!i||this.canEquip(i)&&i.etypeId===e[a]||(t||this.tradeItemWithParty(null,i),this._equips[a].setObject(null),s=!0)})),!s)break}}clearEquipments(){const t=this.equipSlots().length;for(let e=0;e<t;e++)this.isEquipChangeOk(e)&&this.changeEquip(e,null)}optimizeEquipments(){const t=this.equipSlots().length;this.clearEquipments();for(let e=0;e<t;e++)this.isEquipChangeOk(e)&&this.changeEquip(e,this.bestEquipItem(e))}bestEquipItem(t){const e=this.equipSlots()[t],i=self.$gameParty.equipItems().filter((function(t){return t.etypeId===e&&this.canEquip(t)}),this);let s=null,a=-1e3;for(let t=0;t<i.length;t++){const e=this.calcEquipItemPerformance(i[t]);e>a&&(a=e,s=i[t])}return s}calcEquipItemPerformance({params:t}){return t.reduce(((t,e)=>t+e))}isSkillWtypeOk({requiredWtypeId1:t,requiredWtypeId2:e}){const i=t,s=e;return!!(0===i&&0===s||i>0&&this.isWtypeEquipped(i)||s>0&&this.isWtypeEquipped(s))}isWtypeEquipped(t){return this.weapons().some((e=>e.wtypeId===t))}refresh(){this.releaseUnequippableItems(!1),super.refresh()}isActor(){return!0}friendsUnit(){return self.$gameParty}opponentsUnit(){return self.$gameTroop}index(){return self.$gameParty.members().indexOf(this)}isBattleMember(){return self.$gameParty.battleMembers().contains(this)}isFormationChangeOk(){return!0}currentClass(){return self.$dataClasses[this._classId]}isClass(t){return t&&this._classId===t.id}skills(){const t=[];return this._skills.concat(this.addedSkills()).forEach((e=>{t.contains(self.$dataSkills[e])||t.push(self.$dataSkills[e])})),t}usableSkills(){return this.skills().filter((function(t){return this.canUse(t)}),this)}traitObjects(){let t=Game_Battler.prototype.traitObjects.call(this);t=t.concat([this.actor(),this.currentClass()]);const e=this.equips();for(const i of e)i&&t.push(i);return t}attackElements(){const t=Game_Battler.prototype.attackElements.call(this);return this.hasNoWeapons()&&!t.contains(this.bareHandsElementId())&&t.push(this.bareHandsElementId()),t}hasNoWeapons(){return 0===this.weapons().length}bareHandsElementId(){return 1}paramMax(t){return 0===t?9999:Game_Battler.prototype.paramMax.call(this,t)}paramBase(t){return this.currentClass().params[t][this._level]}paramPlus(t){let e=Game_Battler.prototype.paramPlus.call(this,t);const i=this.equips();for(const s of i)s&&(e+=s.params[t]);return e}attackAnimationId1(){if(this.hasNoWeapons())return this.bareHandsAnimationId();{const t=this.weapons();return t[0]?t[0].animationId:0}}attackAnimationId2(){const t=this.weapons();return t[1]?t[1].animationId:0}bareHandsAnimationId(){return 1}changeExp(t,e){this._exp[this._classId]=Math.max(t,0);const i=this._level,s=this.skills();for(;!this.isMaxLevel()&&this.currentExp()>=this.nextLevelExp();)this.levelUp();for(;this.currentExp()<this.currentLevelExp();)this.levelDown();e&&this._level>i&&this.displayLevelUp(this.findNewSkills(s)),this.refresh()}levelUp(){this._level++,this.currentClass().learnings.forEach((function({level:t,skillId:e}){t===this._level&&this.learnSkill(e)}),this)}levelDown(){this._level--}findNewSkills(t){const e=this.skills();for(let i=0;i<t.length;i++){const s=e.indexOf(t[i]);s>=0&&e.splice(s,1)}return e}displayLevelUp(t){const e=TextManager.levelUp.format(this._name,TextManager.level,this._level);self.$gameMessage.newPage(),self.$gameMessage.add(e),t.forEach((({name:t})=>{self.$gameMessage.add(TextManager.obtainSkill.format(t))}))}gainExp(t){const e=this.currentExp()+Math.round(t*this.finalExpRate());this.changeExp(e,this.shouldDisplayLevelUp())}finalExpRate(){return this.exr*(this.isBattleMember()?1:this.benchMembersExpRate())}benchMembersExpRate(){return self.$dataSystem.optExtraExp?1:0}shouldDisplayLevelUp(){return!0}changeLevel(t,e){t=t.clamp(1,this.maxLevel()),this.changeExp(this.expForLevel(t),e)}learnSkill(t){this.isLearnedSkill(t)||(this._skills.push(t),this._skills.sort(((t,e)=>t-e)))}forgetSkill(t){const e=this._skills.indexOf(t);e>=0&&this._skills.splice(e,1)}isLearnedSkill(t){return this._skills.contains(t)}hasSkill(t){return this.skills().contains(self.$dataSkills[t])}changeClass(t,e){e&&(this._exp[t]=this.currentExp()),this._classId=t,this.changeExp(this._exp[this._classId]||0,!1),this.refresh()}setCharacterImage(t,e){this._characterName=t,this._characterIndex=e}setFaceImage(t,e){this._faceName=t,this._faceIndex=e}setBattlerImage(t){this._battlerName=t}isSpriteVisible(){return self.$gameSystem.isSideView()}startAnimation(t,e,i){e=!e,super.startAnimation(t,e,i)}performActionStart(t){super.performActionStart(t)}performAction(t){super.performAction(t),t.isAttack()?this.performAttack():t.isGuard()?this.requestMotion("guard"):t.isMagicSkill()?this.requestMotion("spell"):t.isSkill()?this.requestMotion("skill"):t.isItem()&&this.requestMotion("item")}performActionEnd(){super.performActionEnd()}performAttack(){const t=this.weapons(),e=t[0]?t[0].wtypeId:0,i=self.$dataSystem.attackMotions[e];i&&(0===i.type?this.requestMotion("thrust"):1===i.type?this.requestMotion("swing"):2===i.type&&this.requestMotion("missile"),this.startWeaponAnimation(i.weaponImageId))}performDamage(){super.performDamage(),this.isSpriteVisible()?this.requestMotion("damage"):self.$gameScreen.startShake(5,5,10),SoundManager.playActorDamage()}performEvasion(){super.performEvasion(),this.requestMotion("evade")}performMagicEvasion(){super.performMagicEvasion(),this.requestMotion("evade")}performCounter(){super.performCounter(),this.performAttack()}performCollapse(){super.performCollapse(),self.$gameParty.inBattle()&&SoundManager.playActorCollapse()}performVictory(){this.canMove()&&this.requestMotion("victory")}performEscape(){this.canMove()&&this.requestMotion("escape")}makeActionList(){const t=[];let e=new Game_Action(this);return e.setAttack(),t.push(e),this.usableSkills().forEach((function({id:i}){e=new Game_Action(this),e.setSkill(i),t.push(e)}),this),t}makeAutoBattleActions(){for(let t=0;t<this.numActions();t++){const e=this.makeActionList();let i=Number.MIN_VALUE;for(let s=0;s<e.length;s++){const a=e[s].evaluate();a>i&&(i=a,this.setAction(t,e[s]))}}this.setActionState("waiting")}makeConfusionActions(){for(let t=0;t<this.numActions();t++)this.action(t).setConfusion();this.setActionState("waiting")}makeActions(){super.makeActions(),this.numActions()>0?this.setActionState("undecided"):this.setActionState("waiting"),this.isAutoBattle()?this.makeAutoBattleActions():this.isConfused()&&this.makeConfusionActions()}onPlayerWalk(){this.clearResult(),this.checkFloorEffect(),self.$gamePlayer.isNormal()&&(this.turnEndOnMap(),this.states().forEach((function(t){this.updateStateSteps(t)}),this),this.showAddedStates(),this.showRemovedStates())}updateStateSteps({removeByWalking:t,id:e}){t&&this._stateSteps[e]>0&&0==--this._stateSteps[e]&&this.removeState(e)}showAddedStates(){this.result().addedStateObjects().forEach((function({message1:t}){t&&self.$gameMessage.add(this._name+t)}),this)}showRemovedStates(){this.result().removedStateObjects().forEach((function({message4:t}){t&&self.$gameMessage.add(this._name+t)}),this)}stepsForTurn(){return 20}turnEndOnMap(){self.$gameParty.steps()%this.stepsForTurn()==0&&(this.onTurnEnd(),this.result().hpDamage>0&&this.performMapDamage())}checkFloorEffect(){self.$gamePlayer.isOnDamageFloor()&&this.executeFloorDamage()}executeFloorDamage(){let t=Math.floor(this.basicFloorDamage()*this.fdr);t=Math.min(t,this.maxFloorDamage()),this.gainHp(-t),t>0&&this.performMapDamage()}basicFloorDamage(){return 10}maxFloorDamage(){return self.$dataSystem.optFloorDeath?this.hp:Math.max(this.hp-1,0)}performMapDamage(){self.$gameParty.inBattle()||self.$gameScreen.startFlashForDamage()}clearActions(){super.clearActions(),this._actionInputIndex=0}inputtingAction(){return this.action(this._actionInputIndex)}selectNextCommand(){return this._actionInputIndex<this.numActions()-1&&(this._actionInputIndex++,!0)}selectPreviousCommand(){return this._actionInputIndex>0&&(this._actionInputIndex--,!0)}lastMenuSkill(){return this._lastMenuSkill.object()}setLastMenuSkill(t){this._lastMenuSkill.setObject(t)}lastBattleSkill(){return this._lastBattleSkill.object()}setLastBattleSkill(t){this._lastBattleSkill.setObject(t)}lastCommandSymbol(){return this._lastCommandSymbol}setLastCommandSymbol(t){this._lastCommandSymbol=t}testEscape({effects:t}){return t.some(((t,e,i)=>t&&t.code===Game_Action.EFFECT_SPECIAL))}meetsUsableItemConditions(t){return!(self.$gameParty.inBattle()&&!BattleManager.canEscape()&&this.testEscape(t))&&Game_BattlerBase.prototype.meetsUsableItemConditions.call(this,t)}}class Game_Actors{constructor(...t){this.initialize(...t)}initialize(){this._data=[]}actor(t){return self.$dataActors[t]?(this._data[t]||(this._data[t]=new Game_Actor(t)),this._data[t]):null}}class Game_Unit{constructor(...t){this.initialize(...t)}initialize(){this._inBattle=!1}inBattle(){return this._inBattle}members(){return[]}aliveMembers(){return this.members().filter((t=>t.isAlive()))}deadMembers(){return this.members().filter((t=>t.isDead()))}movableMembers(){return this.members().filter((t=>t.canMove()))}clearActions(){return this.members().forEach((t=>t.clearActions()))}agility(){const t=this.members();return 0===t.length?1:t.reduce(((t,{agi:e})=>t+e),0)/t.length}tgrSum(){return this.aliveMembers().reduce(((t,{tgr:e})=>t+e),0)}randomTarget(){let t=Math.random()*this.tgrSum(),e=null;return this.aliveMembers().forEach((i=>{t-=i.tgr,t<=0&&!e&&(e=i)})),e}randomDeadTarget(){const t=this.deadMembers();return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}smoothTarget(t){t<0&&(t=0);const e=this.members()[t];return e&&e.isAlive()?e:this.aliveMembers()[0]}smoothDeadTarget(t){t<0&&(t=0);const e=this.members()[t];return e&&e.isDead()?e:this.deadMembers()[0]}clearResults(){this.members().forEach((t=>{t.clearResult()}))}onBattleStart(){this.members().forEach((t=>{t.onBattleStart()})),this._inBattle=!0}onBattleEnd(){this._inBattle=!1,this.members().forEach((t=>{t.onBattleEnd()}))}makeActions(){this.members().forEach((t=>{t.makeActions()}))}select(t){this.members().forEach((e=>{e===t?e.select():e.deselect()}))}isAllDead(){return 0===this.aliveMembers().length}substituteBattler(){const t=this.members();for(let e=0;e<t.length;e++)if(t[e].isSubstitute())return t[e]}}class Game_Party extends Game_Unit{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._gold=0,this._steps=0,this._lastItem=new Game_Item,this._menuActorId=0,this._targetActorId=0,this._actors=[],this.initAllItems()}initAllItems(){this._items={},this._weapons={},this._armors={}}exists(){return this._actors.length>0}size(){return this.members().length}isEmpty(){return 0===this.size()}members(){return this.inBattle()?this.battleMembers():this.allMembers()}allMembers(){return this._actors.map((t=>self.$gameActors.actor(t)))}battleMembers(){return this.allMembers().slice(0,this.maxBattleMembers()).filter((t=>t.isAppeared()))}maxBattleMembers(){return 4}leader(){return this.battleMembers()[0]}reviveBattleMembers(){this.battleMembers().forEach((t=>{t.isDead()&&t.setHp(1)}))}items(){const t=[];for(let e in this._items)t.push(self.$dataItems[e]);return t}weapons(){const t=[];for(let e in this._weapons)t.push(self.$dataWeapons[e]);return t}armors(){const t=[];for(let e in this._armors)t.push(self.$dataArmors[e]);return t}equipItems(){return this.weapons().concat(this.armors())}allItems(){return this.items().concat(this.equipItems())}itemContainer(t){return t?DataManager.isItem(t)?this._items:DataManager.isWeapon(t)?this._weapons:DataManager.isArmor(t)?this._armors:null:null}setupStartingMembers(){this._actors=[],self.$dataSystem.partyMembers.forEach((function(t){self.$gameActors.actor(t)&&this._actors.push(t)}),this)}name(){const t=this.battleMembers().length;return 0===t?"":1===t?this.leader().name():TextManager.partyName.format(this.leader().name())}setupBattleTest(){this.setupBattleTestMembers(),this.setupBattleTestItems()}setupBattleTestMembers(){self.$dataSystem.testBattlers.forEach((function({actorId:t,level:e,equips:i}){const s=self.$gameActors.actor(t);s&&(s.changeLevel(e,!1),s.initEquips(i),s.recoverAll(),this.addActor(t))}),this)}setupBattleTestItems(){self.$dataItems.forEach((function(t){t&&t.name.length>0&&this.gainItem(t,this.maxItems(t))}),this)}highestLevel(){return Math.max.apply(null,this.members().map((({level:t})=>t)))}addActor(t){this._actors.contains(t)||(this._actors.push(t),self.$gamePlayer.refresh(),self.$gameMap.requestRefresh())}removeActor(t){this._actors.contains(t)&&(this._actors.splice(this._actors.indexOf(t),1),self.$gamePlayer.refresh(),self.$gameMap.requestRefresh())}gold(){return this._gold}gainGold(t){this._gold=(this._gold+t).clamp(0,this.maxGold())}loseGold(t){this.gainGold(-t)}maxGold(){return 99999999}steps(){return this._steps}increaseSteps(){this._steps++}numItems(t){const e=this.itemContainer(t);return e&&e[t.id]||0}maxItems(t){return 99}hasMaxItems(t){return this.numItems(t)>=this.maxItems(t)}hasItem(t,e){return void 0===e&&(e=!1),this.numItems(t)>0||!(!e||!this.isAnyMemberEquipped(t))}isAnyMemberEquipped(t){return this.members().some((e=>e.equips().contains(t)))}gainItem(t,e,i){const s=this.itemContainer(t);if(s){const a=this.numItems(t)+e;s[t.id]=a.clamp(0,this.maxItems(t)),0===s[t.id]&&delete s[t.id],i&&a<0&&this.discardMembersEquip(t,-a),self.$gameMap.requestRefresh()}}discardMembersEquip(t,e){let i=e;this.members().forEach((e=>{for(;i>0&&e.isEquipped(t);)e.discardEquip(t),i--}))}loseItem(t,e,i){this.gainItem(t,-e,i)}consumeItem(t){DataManager.isItem(t)&&t.consumable&&this.loseItem(t,1)}canUse(t){return this.members().some((e=>e.canUse(t)))}canInput(){return this.members().some((t=>t.canInput()))}isAllDead(){return!!Game_Unit.prototype.isAllDead.call(this)&&(this.inBattle()||!this.isEmpty())}onPlayerWalk(){this.members().forEach((t=>t.onPlayerWalk()))}menuActor(){let t=self.$gameActors.actor(this._menuActorId);return this.members().contains(t)||(t=this.members()[0]),t}setMenuActor(t){this._menuActorId=t.actorId()}makeMenuActorNext(){let t=this.members().indexOf(this.menuActor());t>=0?(t=(t+1)%this.members().length,this.setMenuActor(this.members()[t])):this.setMenuActor(this.members()[0])}makeMenuActorPrevious(){let t=this.members().indexOf(this.menuActor());t>=0?(t=(t+this.members().length-1)%this.members().length,this.setMenuActor(this.members()[t])):this.setMenuActor(this.members()[0])}targetActor(){let t=self.$gameActors.actor(this._targetActorId);return this.members().contains(t)||(t=this.members()[0]),t}setTargetActor(t){this._targetActorId=t.actorId()}lastItem(){return this._lastItem.object()}setLastItem(t){this._lastItem.setObject(t)}swapOrder(t,e){const i=this._actors[t];this._actors[t]=this._actors[e],this._actors[e]=i,self.$gamePlayer.refresh()}charactersForSavefile(){return this.battleMembers().map((t=>[t.characterName(),t.characterIndex()]))}facesForSavefile(){return this.battleMembers().map((t=>[t.faceName(),t.faceIndex()]))}partyAbility(t){return this.battleMembers().some((e=>e.partyAbility(t)))}hasEncounterHalf(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_HALF)}hasEncounterNone(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_NONE)}hasCancelSurprise(){return this.partyAbility(Game_Party.ABILITY_CANCEL_SURPRISE)}hasRaisePreemptive(){return this.partyAbility(Game_Party.ABILITY_RAISE_PREEMPTIVE)}hasGoldDouble(){return this.partyAbility(Game_Party.ABILITY_GOLD_DOUBLE)}hasDropItemDouble(){return this.partyAbility(Game_Party.ABILITY_DROP_ITEM_DOUBLE)}ratePreemptive(t){let e=this.agility()>=t?.05:.03;return this.hasRaisePreemptive()&&(e*=4),e}rateSurprise(t){let e=this.agility()>=t?.03:.05;return this.hasCancelSurprise()&&(e=0),e}performVictory(){this.members().forEach((t=>{t.performVictory()}))}performEscape(){this.members().forEach((t=>{t.performEscape()}))}removeBattleStates(){this.members().forEach((t=>{t.removeBattleStates()}))}requestMotionRefresh(){this.members().forEach((t=>{t.requestMotionRefresh()}))}}Game_Party.ABILITY_ENCOUNTER_HALF=0,Game_Party.ABILITY_ENCOUNTER_NONE=1,Game_Party.ABILITY_CANCEL_SURPRISE=2,Game_Party.ABILITY_RAISE_PREEMPTIVE=3,Game_Party.ABILITY_GOLD_DOUBLE=4,Game_Party.ABILITY_DROP_ITEM_DOUBLE=5;class Game_Enemy extends Game_Battler{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){super.initialize(),this.setup(t,e,i)}initMembers(){super.initMembers(),this._enemyId=0,this._letter="",this._plural=!1,this._screenX=0,this._screenY=0}setup(t,e,i){this._enemyId=t,this._screenX=e,this._screenY=i,this.recoverAll()}isEnemy(){return!0}friendsUnit(){return self.$gameTroop}opponentsUnit(){return self.$gameParty}index(){return self.$gameTroop.members().indexOf(this)}isBattleMember(){return this.index()>=0}enemyId(){return this._enemyId}enemy(){return self.$dataEnemies[this._enemyId]}traitObjects(){return Game_Battler.prototype.traitObjects.call(this).concat(this.enemy())}paramBase(t){return this.enemy().params[t]}exp(){return this.enemy().exp}gold(){return this.enemy().gold}makeDropItems(){return this.enemy().dropItems.reduce(((t,{kind:e,denominator:i,dataId:s})=>e>0&&Math.random()*i<this.dropItemRate()?t.concat(this.itemObject(e,s)):t),[])}dropItemRate(){return self.$gameParty.hasDropItemDouble()?2:1}itemObject(t,e){return 1===t?self.$dataItems[e]:2===t?self.$dataWeapons[e]:3===t?self.$dataArmors[e]:null}isSpriteVisible(){return!0}screenX(){return this._screenX}screenY(){return this._screenY}battlerName(){return this.enemy().battlerName}battlerHue(){return this.enemy().battlerHue}originalName(){return this.enemy().name}name(){return this.originalName()+(this._plural?this._letter:"")}isLetterEmpty(){return""===this._letter}setLetter(t){this._letter=t}setPlural(t){this._plural=t}performActionStart(t){super.performActionStart(t),this.requestEffect("whiten")}performAction(t){super.performAction(t)}performActionEnd(){super.performActionEnd()}performDamage(){super.performDamage(),SoundManager.playEnemyDamage(),this.requestEffect("blink")}performCollapse(){switch(super.performCollapse(),this.collapseType()){case 0:this.requestEffect("collapse"),SoundManager.playEnemyCollapse();break;case 1:this.requestEffect("bossCollapse"),SoundManager.playBossCollapse1();break;case 2:this.requestEffect("instantCollapse")}}transform(t){const e=this.originalName();this._enemyId=t,this.originalName()!==e&&(this._letter="",this._plural=!1),this.refresh(),this.numActions()>0&&this.makeActions()}meetsCondition({conditionParam1:t,conditionParam2:e,conditionType:i}){const s=t,a=e;switch(i){case 1:return this.meetsTurnCondition(s,a);case 2:return this.meetsHpCondition(s,a);case 3:return this.meetsMpCondition(s,a);case 4:return this.meetsStateCondition(s);case 5:return this.meetsPartyLevelCondition(s);case 6:return this.meetsSwitchCondition(s);default:return!0}}meetsTurnCondition(t,e){const i=self.$gameTroop.turnCount();return 0===e?i===t:i>0&&i>=t&&i%e==t%e}meetsHpCondition(t,e){return this.hpRate()>=t&&this.hpRate()<=e}meetsMpCondition(t,e){return this.mpRate()>=t&&this.mpRate()<=e}meetsStateCondition(t){return this.isStateAffected(t)}meetsPartyLevelCondition(t){return self.$gameParty.highestLevel()>=t}meetsSwitchCondition(t){return self.$gameSwitches.value(t)}isActionValid(t){return this.meetsCondition(t)&&this.canUse(self.$dataSkills[t.skillId])}selectAction(t,e){const i=t.reduce(((t,{rating:i})=>t+i-e),0);if(!(i>0))return null;{let s=Math.randomInt(i);for(const i of t)if(s-=i.rating-e,s<0)return i}}selectAllActions(t){const e=Math.max.apply(null,t.map((({rating:t})=>t)))-3;t=t.filter((({rating:t})=>t>e));for(let i=0;i<this.numActions();i++)this.action(i).setEnemyAction(this.selectAction(t,e))}makeActions(){if(super.makeActions(),this.numActions()>0){const t=this.enemy().actions.filter((function(t){return this.isActionValid(t)}),this);t.length>0&&this.selectAllActions(t)}this.setActionState("waiting")}}class Game_CharacterBase{constructor(...t){this.initialize(...t)}initialize(){this.initMembers()}initMembers(){this._x=0,this._y=0,this._realX=0,this._realY=0,this._moveSpeed=4,this._moveFrequency=6,this._opacity=255,this._blendMode=0,this._direction=2,this._pattern=1,this._priorityType=1,this._tileId=0,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!1,this._walkAnime=!0,this._stepAnime=!1,this._directionFix=!1,this._through=!1,this._transparent=!1,this._bushDepth=0,this._animationId=0,this._balloonId=0,this._animationPlaying=!1,this._balloonPlaying=!1,this._animationCount=0,this._stopCount=0,this._jumpCount=0,this._jumpPeak=0,this._movementSuccess=!0}pos(t,e){return this._x===t&&this._y===e}posNt(t,e){return this.pos(t,e)&&!this.isThrough()}moveSpeed(){return this._moveSpeed}setMoveSpeed(t){this._moveSpeed=t}moveFrequency(){return this._moveFrequency}setMoveFrequency(t){this._moveFrequency=t}opacity(){return this._opacity}setOpacity(t){this._opacity=t}blendMode(){return this._blendMode}setBlendMode(t){this._blendMode=t}isNormalPriority(){return 1===this._priorityType}setPriorityType(t){this._priorityType=t}isMoving(){return this._realX!==this._x||this._realY!==this._y}isJumping(){return this._jumpCount>0}jumpHeight(){return(this._jumpPeak*this._jumpPeak-Math.pow(Math.abs(this._jumpCount-this._jumpPeak),2))/2}isStopping(){return!this.isMoving()&&!this.isJumping()}checkStop(t){return this._stopCount>t}resetStopCount(){this._stopCount=0}realMoveSpeed(){return this._moveSpeed+(this.isDashing()?1:0)}distancePerFrame(){return Math.pow(2,this.realMoveSpeed())/256}isDashing(){return!1}isDebugThrough(){return!1}straighten(){(this.hasWalkAnime()||this.hasStepAnime())&&(this._pattern=1),this._animationCount=0}reverseDir(t){return 10-t}canPass(t,e,i){const s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i);return!(!self.$gameMap.isValid(s,a)||!this.isThrough()&&!this.isDebugThrough()&&(!this.isMapPassable(t,e,i)||this.isCollidedWithCharacters(s,a)))}canPassDiagonally(t,e,i,s){const a=self.$gameMap.roundXWithDirection(t,i),r=self.$gameMap.roundYWithDirection(e,s);return!(!this.canPass(t,e,s)||!this.canPass(t,r,i))||!(!this.canPass(t,e,i)||!this.canPass(a,e,s))}isMapPassable(t,e,i){const s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i),r=this.reverseDir(i);return self.$gameMap.isPassable(t,e,i)&&self.$gameMap.isPassable(s,a,r)}isCollidedWithCharacters(t,e){return this.isCollidedWithEvents(t,e)||this.isCollidedWithVehicles(t,e)}isCollidedWithEvents(t,e){return self.$gameMap.eventsXyNt(t,e).some((t=>t.isNormalPriority()))}isCollidedWithVehicles(t,e){return self.$gameMap.boat().posNt(t,e)||self.$gameMap.ship().posNt(t,e)}setPosition(t,e){this._x=Math.round(t),this._y=Math.round(e),this._realX=t,this._realY=e}copyPosition(t){this._x=t._x,this._y=t._y,this._realX=t._realX,this._realY=t._realY,this._direction=t._direction}locate(t,e){this.setPosition(t,e),this.straighten(),this.refreshBushDepth()}direction(){return this._direction}setDirection(t){!this.isDirectionFixed()&&t&&(this._direction=t),this.resetStopCount()}isTile(){return this._tileId>0&&0===this._priorityType}isObjectCharacter(){return this._isObjectCharacter}shiftY(){return this.isObjectCharacter()?0:6}scrolledX(){return self.$gameMap.adjustX(this._realX)}scrolledY(){return self.$gameMap.adjustY(this._realY)}screenX(){const t=self.$gameMap.tileWidth();return Math.round(this.scrolledX()*t+t/2)}screenY(){const t=self.$gameMap.tileHeight();return Math.round(this.scrolledY()*t+t-this.shiftY()-this.jumpHeight())}screenZ(){return 2*this._priorityType+1}isNearTheScreen(){const t=Graphics$1.width,e=Graphics$1.height,i=self.$gameMap.tileWidth(),s=self.$gameMap.tileHeight(),a=this.scrolledX()*i+i/2-t/2,r=this.scrolledY()*s+s/2-e/2;return a>=-t&&a<=t&&r>=-e&&r<=e}update(){this.isStopping()&&this.updateStop(),this.isJumping()?this.updateJump():this.isMoving()&&this.updateMove(),this.updateAnimation()}updateStop(){this._stopCount++}updateJump(){this._jumpCount--,this._realX=(this._realX*this._jumpCount+this._x)/(this._jumpCount+1),this._realY=(this._realY*this._jumpCount+this._y)/(this._jumpCount+1),this.refreshBushDepth(),0===this._jumpCount&&(this._realX=this._x=self.$gameMap.roundX(this._x),this._realY=this._y=self.$gameMap.roundY(this._y))}updateMove(){this._x<this._realX&&(this._realX=Math.max(this._realX-this.distancePerFrame(),this._x)),this._x>this._realX&&(this._realX=Math.min(this._realX+this.distancePerFrame(),this._x)),this._y<this._realY&&(this._realY=Math.max(this._realY-this.distancePerFrame(),this._y)),this._y>this._realY&&(this._realY=Math.min(this._realY+this.distancePerFrame(),this._y)),this.isMoving()||this.refreshBushDepth()}updateAnimation(){this.updateAnimationCount(),this._animationCount>=this.animationWait()&&(this.updatePattern(),this._animationCount=0)}animationWait(){return 3*(9-this.realMoveSpeed())}updateAnimationCount(){this.isMoving()&&this.hasWalkAnime()?this._animationCount+=1.5:!this.hasStepAnime()&&this.isOriginalPattern()||this._animationCount++}updatePattern(){!this.hasStepAnime()&&this._stopCount>0?this.resetPattern():this._pattern=(this._pattern+1)%this.maxPattern()}maxPattern(){return 4}pattern(){return this._pattern<3?this._pattern:1}setPattern(t){this._pattern=t}isOriginalPattern(){return 1===this.pattern()}resetPattern(){this.setPattern(1)}refreshBushDepth(){this.isNormalPriority()&&!this.isObjectCharacter()&&this.isOnBush()&&!this.isJumping()?this.isMoving()||(this._bushDepth=12):this._bushDepth=0}isOnLadder(){return self.$gameMap.isLadder(this._x,this._y)}isOnBush(){return self.$gameMap.isBush(this._x,this._y)}terrainTag(){return self.$gameMap.terrainTag(this._x,this._y)}regionId(){return self.$gameMap.regionId(this._x,this._y)}increaseSteps(){this.isOnLadder()&&this.setDirection(8),this.resetStopCount(),this.refreshBushDepth()}tileId(){return this._tileId}characterName(){return this._characterName}characterIndex(){return this._characterIndex}setImage(t,e){this._tileId=0,this._characterName=t,this._characterIndex=e,this._isObjectCharacter=ImageManager.isObjectCharacter(t)}setTileImage(t){this._tileId=t,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!0}checkEventTriggerTouchFront(t){const e=self.$gameMap.roundXWithDirection(this._x,t),i=self.$gameMap.roundYWithDirection(this._y,t);this.checkEventTriggerTouch(e,i)}checkEventTriggerTouch(t,e){return!1}isMovementSucceeded(t,e){return this._movementSuccess}setMovementSuccess(t){this._movementSuccess=t}moveStraight(t){this.setMovementSuccess(this.canPass(this._x,this._y,t)),this.isMovementSucceeded()?(this.setDirection(t),this._x=self.$gameMap.roundXWithDirection(this._x,t),this._y=self.$gameMap.roundYWithDirection(this._y,t),this._realX=self.$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=self.$gameMap.yWithDirection(this._y,this.reverseDir(t)),this.increaseSteps()):(this.setDirection(t),this.checkEventTriggerTouchFront(t))}moveDiagonally(t,e){this.setMovementSuccess(this.canPassDiagonally(this._x,this._y,t,e)),this.isMovementSucceeded()&&(this._x=self.$gameMap.roundXWithDirection(this._x,t),this._y=self.$gameMap.roundYWithDirection(this._y,e),this._realX=self.$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=self.$gameMap.yWithDirection(this._y,this.reverseDir(e)),this.increaseSteps()),this._direction===this.reverseDir(t)&&this.setDirection(t),this._direction===this.reverseDir(e)&&this.setDirection(e)}jump(t,e){Math.abs(t)>Math.abs(e)?0!==t&&this.setDirection(t<0?4:6):0!==e&&this.setDirection(e<0?8:2),this._x+=t,this._y+=e;const i=Math.round(Math.sqrt(t*t+e*e));this._jumpPeak=10+i-this._moveSpeed,this._jumpCount=2*this._jumpPeak,this.resetStopCount(),this.straighten()}hasWalkAnime(){return this._walkAnime}setWalkAnime(t){this._walkAnime=t}hasStepAnime(){return this._stepAnime}setStepAnime(t){this._stepAnime=t}isDirectionFixed(){return this._directionFix}setDirectionFix(t){this._directionFix=t}isThrough(){return this._through}setThrough(t){this._through=t}isTransparent(){return this._transparent}bushDepth(){return this._bushDepth}setTransparent(t){this._transparent=t}requestAnimation(t){this._animationId=t}requestBalloon(t){this._balloonId=t}animationId(){return this._animationId}balloonId(){return this._balloonId}startAnimation(){this._animationId=0,this._animationPlaying=!0}startBalloon(){this._balloonId=0,this._balloonPlaying=!0}isAnimationPlaying(){return this._animationId>0||this._animationPlaying}isBalloonPlaying(){return this._balloonId>0||this._balloonPlaying}endAnimation(){this._animationPlaying=!1}endBalloon(){this._balloonPlaying=!1}}Object.defineProperties(Game_CharacterBase.prototype,{x:{get(){return this._x},configurable:!0},y:{get(){return this._y},configurable:!0}});class Game_Character extends Game_CharacterBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}initMembers(){super.initMembers(),this._moveRouteForcing=!1,this._moveRoute=null,this._moveRouteIndex=0,this._originalMoveRoute=null,this._originalMoveRouteIndex=0,this._waitCount=0,this._callerEventInfo=null}memorizeMoveRoute(){this._originalMoveRoute=this._moveRoute,this._originalMoveRouteIndex=this._moveRouteIndex}restoreMoveRoute(){this._moveRoute=this._originalMoveRoute,this._moveRouteIndex=this._originalMoveRouteIndex-1,this._originalMoveRoute=null,this._callerEventInfo=null}isMoveRouteForcing(){return this._moveRouteForcing}setMoveRoute(t){this._moveRoute=t,this._moveRouteIndex=0,this._moveRouteForcing=!1}forceMoveRoute(t){this._originalMoveRoute||this.memorizeMoveRoute(),this._moveRoute=t,this._moveRouteIndex=0,this._moveRouteForcing=!0,this._waitCount=0}setCallerEventInfo(t){this._callerEventInfo=t}updateStop(){super.updateStop(),this._moveRouteForcing&&this.updateRoutineMove()}updateRoutineMove(){if(this._waitCount>0)this._waitCount--;else{this.setMovementSuccess(!0);const t=this._moveRoute.list[this._moveRouteIndex];t&&(this.processMoveCommand(t),this.advanceMoveRouteIndex())}}processMoveCommand(command){const gc=Game_Character,params=command.parameters;switch(command.code){case gc.ROUTE_END:this.processRouteEnd();break;case gc.ROUTE_MOVE_DOWN:this.moveStraight(2);break;case gc.ROUTE_MOVE_LEFT:this.moveStraight(4);break;case gc.ROUTE_MOVE_RIGHT:this.moveStraight(6);break;case gc.ROUTE_MOVE_UP:this.moveStraight(8);break;case gc.ROUTE_MOVE_LOWER_L:this.moveDiagonally(4,2);break;case gc.ROUTE_MOVE_LOWER_R:this.moveDiagonally(6,2);break;case gc.ROUTE_MOVE_UPPER_L:this.moveDiagonally(4,8);break;case gc.ROUTE_MOVE_UPPER_R:this.moveDiagonally(6,8);break;case gc.ROUTE_MOVE_RANDOM:this.moveRandom();break;case gc.ROUTE_MOVE_TOWARD:this.moveTowardPlayer();break;case gc.ROUTE_MOVE_AWAY:this.moveAwayFromPlayer();break;case gc.ROUTE_MOVE_FORWARD:this.moveForward();break;case gc.ROUTE_MOVE_BACKWARD:this.moveBackward();break;case gc.ROUTE_JUMP:this.jump(params[0],params[1]);break;case gc.ROUTE_WAIT:this._waitCount=params[0]-1;break;case gc.ROUTE_TURN_DOWN:this.setDirection(2);break;case gc.ROUTE_TURN_LEFT:this.setDirection(4);break;case gc.ROUTE_TURN_RIGHT:this.setDirection(6);break;case gc.ROUTE_TURN_UP:this.setDirection(8);break;case gc.ROUTE_TURN_90D_R:this.turnRight90();break;case gc.ROUTE_TURN_90D_L:this.turnLeft90();break;case gc.ROUTE_TURN_180D:this.turn180();break;case gc.ROUTE_TURN_90D_R_L:this.turnRightOrLeft90();break;case gc.ROUTE_TURN_RANDOM:this.turnRandom();break;case gc.ROUTE_TURN_TOWARD:this.turnTowardPlayer();break;case gc.ROUTE_TURN_AWAY:this.turnAwayFromPlayer();break;case gc.ROUTE_SWITCH_ON:self.$gameSwitches.setValue(params[0],!0);break;case gc.ROUTE_SWITCH_OFF:self.$gameSwitches.setValue(params[0],!1);break;case gc.ROUTE_CHANGE_SPEED:this.setMoveSpeed(params[0]);break;case gc.ROUTE_CHANGE_FREQ:this.setMoveFrequency(params[0]);break;case gc.ROUTE_WALK_ANIME_ON:this.setWalkAnime(!0);break;case gc.ROUTE_WALK_ANIME_OFF:this.setWalkAnime(!1);break;case gc.ROUTE_STEP_ANIME_ON:this.setStepAnime(!0);break;case gc.ROUTE_STEP_ANIME_OFF:this.setStepAnime(!1);break;case gc.ROUTE_DIR_FIX_ON:this.setDirectionFix(!0);break;case gc.ROUTE_DIR_FIX_OFF:this.setDirectionFix(!1);break;case gc.ROUTE_THROUGH_ON:this.setThrough(!0);break;case gc.ROUTE_THROUGH_OFF:this.setThrough(!1);break;case gc.ROUTE_TRANSPARENT_ON:this.setTransparent(!0);break;case gc.ROUTE_TRANSPARENT_OFF:this.setTransparent(!1);break;case gc.ROUTE_CHANGE_IMAGE:this.setImage(params[0],params[1]);break;case gc.ROUTE_CHANGE_OPACITY:this.setOpacity(params[0]);break;case gc.ROUTE_CHANGE_BLEND_MODE:this.setBlendMode(params[0]);break;case gc.ROUTE_PLAY_SE:AudioManager.playSe(params[0]);break;case gc.ROUTE_SCRIPT:try{eval(params[0])}catch(t){if(this._callerEventInfo){for(let e in this._callerEventInfo)t[e]=this._callerEventInfo[e];t.line+=this._moveRouteIndex+1,t.eventCommand="set_route_script",t.content=command.parameters[0]}else t.eventType="map_event",t.mapId=this._mapId,t.mapEventId=this._eventId,t.page=this._pageIndex+1,t.line=this._moveRouteIndex+1,t.eventCommand="auto_route_script",t.content=command.parameters[0];throw t}}}deltaXFrom(t){return self.$gameMap.deltaX(this.x,t)}deltaYFrom(t){return self.$gameMap.deltaY(this.y,t)}moveRandom(){const t=2+2*Math.randomInt(4);this.canPass(this.x,this.y,t)&&this.moveStraight(t)}moveTowardCharacter({x:t,y:e}){const i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?(this.moveStraight(i>0?4:6),this.isMovementSucceeded()||0===s||this.moveStraight(s>0?8:2)):0!==s&&(this.moveStraight(s>0?8:2),this.isMovementSucceeded()||0===i||this.moveStraight(i>0?4:6))}moveAwayFromCharacter({x:t,y:e}){const i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?(this.moveStraight(i>0?6:4),this.isMovementSucceeded()||0===s||this.moveStraight(s>0?2:8)):0!==s&&(this.moveStraight(s>0?2:8),this.isMovementSucceeded()||0===i||this.moveStraight(i>0?6:4))}turnTowardCharacter({x:t,y:e}){const i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?this.setDirection(i>0?4:6):0!==s&&this.setDirection(s>0?8:2)}turnAwayFromCharacter({x:t,y:e}){const i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?this.setDirection(i>0?6:4):0!==s&&this.setDirection(s>0?2:8)}turnTowardPlayer(){this.turnTowardCharacter(self.$gamePlayer)}turnAwayFromPlayer(){this.turnAwayFromCharacter(self.$gamePlayer)}moveTowardPlayer(){this.moveTowardCharacter(self.$gamePlayer)}moveAwayFromPlayer(){this.moveAwayFromCharacter(self.$gamePlayer)}moveForward(){this.moveStraight(this.direction())}moveBackward(){const t=this.isDirectionFixed();this.setDirectionFix(!0),this.moveStraight(this.reverseDir(this.direction())),this.setDirectionFix(t)}processRouteEnd(){this._moveRoute.repeat?this._moveRouteIndex=-1:this._moveRouteForcing&&(this._moveRouteForcing=!1,this.restoreMoveRoute())}advanceMoveRouteIndex(){const t=this._moveRoute;if(t&&(this.isMovementSucceeded()||t.skippable)){const e=t.list.length-1;this._moveRouteIndex++,t.repeat&&this._moveRouteIndex>=e&&(this._moveRouteIndex=0)}}turnRight90(){switch(this.direction()){case 2:this.setDirection(4);break;case 4:this.setDirection(8);break;case 6:this.setDirection(2);break;case 8:this.setDirection(6)}}turnLeft90(){switch(this.direction()){case 2:this.setDirection(6);break;case 4:this.setDirection(2);break;case 6:this.setDirection(8);break;case 8:this.setDirection(4)}}turn180(){this.setDirection(this.reverseDir(this.direction()))}turnRightOrLeft90(){switch(Math.randomInt(2)){case 0:this.turnRight90();break;case 1:this.turnLeft90()}}turnRandom(){this.setDirection(2+2*Math.randomInt(4))}swap(t){const e=t.x,i=t.y;t.locate(this.x,this.y),this.locate(e,i)}findDirectionTo(t,e){const i=this.searchLimit(),s=self.$gameMap.width(),a=[],r=[],n=[],h={};let o=h;if(this.x===t&&this.y===e)return 0;for(h.parent=null,h.x=this.x,h.y=this.y,h.g=0,h.f=self.$gameMap.distance(h.x,h.y,t,e),a.push(h),r.push(h.y*s+h.x);a.length>0;){let h=0;for(let t=0;t<a.length;t++)a[t].f<a[h].f&&(h=t);const l=a[h],c=l.x,d=l.y,m=d*s+c,u=l.g;if(a.splice(h,1),r.splice(r.indexOf(m),1),n.push(m),l.x===t&&l.y===e){o=l;break}if(!(u>=i))for(let i=0;i<4;i++){const h=2+2*i,m=self.$gameMap.roundXWithDirection(c,h),p=self.$gameMap.roundYWithDirection(d,h),_=p*s+m;if(n.contains(_))continue;if(!this.canPass(c,d,h))continue;const g=u+1,f=r.indexOf(_);if(f<0||g<a[f].g){let i;f>=0?i=a[f]:(i={},a.push(i),r.push(_)),i.parent=l,i.x=m,i.y=p,i.g=g,i.f=g+self.$gameMap.distance(m,p,t,e),(!o||i.f-i.g<o.f-o.g)&&(o=i)}}}let l=o;for(;l.parent&&l.parent!==h;)l=l.parent;const c=self.$gameMap.deltaX(l.x,h.x),d=self.$gameMap.deltaY(l.y,h.y);if(d>0)return 2;if(c<0)return 4;if(c>0)return 6;if(d<0)return 8;const m=this.deltaXFrom(t),u=this.deltaYFrom(e);return Math.abs(m)>Math.abs(u)?m>0?4:6:0!==u?u>0?8:2:0}searchLimit(){return 12}}Game_Character.ROUTE_END=0,Game_Character.ROUTE_MOVE_DOWN=1,Game_Character.ROUTE_MOVE_LEFT=2,Game_Character.ROUTE_MOVE_RIGHT=3,Game_Character.ROUTE_MOVE_UP=4,Game_Character.ROUTE_MOVE_LOWER_L=5,Game_Character.ROUTE_MOVE_LOWER_R=6,Game_Character.ROUTE_MOVE_UPPER_L=7,Game_Character.ROUTE_MOVE_UPPER_R=8,Game_Character.ROUTE_MOVE_RANDOM=9,Game_Character.ROUTE_MOVE_TOWARD=10,Game_Character.ROUTE_MOVE_AWAY=11,Game_Character.ROUTE_MOVE_FORWARD=12,Game_Character.ROUTE_MOVE_BACKWARD=13,Game_Character.ROUTE_JUMP=14,Game_Character.ROUTE_WAIT=15,Game_Character.ROUTE_TURN_DOWN=16,Game_Character.ROUTE_TURN_LEFT=17,Game_Character.ROUTE_TURN_RIGHT=18,Game_Character.ROUTE_TURN_UP=19,Game_Character.ROUTE_TURN_90D_R=20,Game_Character.ROUTE_TURN_90D_L=21,Game_Character.ROUTE_TURN_180D=22,Game_Character.ROUTE_TURN_90D_R_L=23,Game_Character.ROUTE_TURN_RANDOM=24,Game_Character.ROUTE_TURN_TOWARD=25,Game_Character.ROUTE_TURN_AWAY=26,Game_Character.ROUTE_SWITCH_ON=27,Game_Character.ROUTE_SWITCH_OFF=28,Game_Character.ROUTE_CHANGE_SPEED=29,Game_Character.ROUTE_CHANGE_FREQ=30,Game_Character.ROUTE_WALK_ANIME_ON=31,Game_Character.ROUTE_WALK_ANIME_OFF=32,Game_Character.ROUTE_STEP_ANIME_ON=33,Game_Character.ROUTE_STEP_ANIME_OFF=34,Game_Character.ROUTE_DIR_FIX_ON=35,Game_Character.ROUTE_DIR_FIX_OFF=36,Game_Character.ROUTE_THROUGH_ON=37,Game_Character.ROUTE_THROUGH_OFF=38,Game_Character.ROUTE_TRANSPARENT_ON=39,Game_Character.ROUTE_TRANSPARENT_OFF=40,Game_Character.ROUTE_CHANGE_IMAGE=41,Game_Character.ROUTE_CHANGE_OPACITY=42,Game_Character.ROUTE_CHANGE_BLEND_MODE=43,Game_Character.ROUTE_PLAY_SE=44,Game_Character.ROUTE_SCRIPT=45;class Window_ShopCommand extends Window_HorzCommand{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this._windowWidth=t,this._purchaseOnly=e,super.initialize(0,0)}windowWidth(){return this._windowWidth}maxCols(){return 3}makeCommandList(){this.addCommand(TextManager.buy,"buy"),this.addCommand(TextManager.sell,"sell",!this._purchaseOnly),this.addCommand(TextManager.cancel,"cancel")}}class Window_ShopBuy extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){const a=this.windowWidth();super.initialize(t,e,a,i),this._shopGoods=s,this._money=0,this.refresh(),this.select(0)}windowWidth(){return 456}maxItems(){return this._data?this._data.length:1}item(){return this._data[this.index()]}setMoney(t){this._money=t,this.refresh()}isCurrentItemEnabled(){return this.isEnabled(this._data[this.index()])}price(t){return this._price[this._data.indexOf(t)]||0}isEnabled(t){return t&&this.price(t)<=this._money&&!self.$gameParty.hasMaxItems(t)}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}makeItemList(){this._data=[],this._price=[],this._shopGoods.forEach((function(t){let e=null;switch(t[0]){case 0:e=self.$dataItems[t[1]];break;case 1:e=self.$dataWeapons[t[1]];break;case 2:e=self.$dataArmors[t[1]]}e&&(this._data.push(e),this._price.push(0===t[2]?e.price:t[3]))}),this)}drawItem(t){const e=this._data[t],i=this.itemRect(t);i.width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,i.x,i.y,i.width-96),this.drawText(this.price(e),i.x+i.width-96,i.y,96,"right"),this.changePaintOpacity(!0)}setStatusWindow(t){this._statusWindow=t,this.callUpdateHelp()}updateHelp(){this.setHelpWindowItem(this.item()),this._statusWindow&&this._statusWindow.setItem(this.item())}}class Window_ShopSell extends Window_ItemList{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s)}isEnabled(t){return t&&t.price>0}}class Window_ShopNumber extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){const s=this.windowWidth();super.initialize(t,e,s,i),this._item=null,this._max=1,this._price=0,this._number=1,this._currencyUnit=TextManager.currencyUnit,this.createButtons()}windowWidth(){return 456}number(){return this._number}setup(t,e,i){this._item=t,this._max=Math.floor(e),this._price=i,this._number=1,this.placeButtons(),this.updateButtonsVisiblity(),this.refresh()}setCurrencyUnit(t){this._currencyUnit=t,this.refresh()}createButtons(){const t=ImageManager.loadSystem("ButtonSet");this._buttons=[];for(let e=0;e<5;e++){const i=new Sprite_Button,s=48*e,a=48*(4===e?2:1);i.bitmap=t,i.setColdFrame(s,0,a,48),i.setHotFrame(s,48,a,48),i.visible=!1,this._buttons.push(i),this.addChild(i)}this._buttons[0].setClickHandler(this.onButtonDown2.bind(this)),this._buttons[1].setClickHandler(this.onButtonDown.bind(this)),this._buttons[2].setClickHandler(this.onButtonUp.bind(this)),this._buttons[3].setClickHandler(this.onButtonUp2.bind(this)),this._buttons[4].setClickHandler(this.onButtonOk.bind(this))}placeButtons(){const t=this._buttons.length;let e=-16;for(let i=0;i<t;i++)e+=this._buttons[i].width+16;let i=(this.width-e)/2;for(let e=0;e<t;e++){const t=this._buttons[e];t.x=i,t.y=this.buttonY(),i+=t.width+16}}updateButtonsVisiblity(){TouchInput.date>Input.date?this.showButtons():this.hideButtons()}showButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!0}hideButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!1}refresh(){this.contents.clear(),this.drawItemName(this._item,0,this.itemY()),this.drawMultiplicationSign(),this.drawNumber(),this.drawTotalPrice()}drawMultiplicationSign(){const t=this.textWidth(""),e=this.cursorX()-2*t,i=this.itemY();this.resetTextColor(),this.drawText("",e,i,t)}drawNumber(){const t=this.cursorX(),e=this.itemY(),i=this.cursorWidth()-this.textPadding();this.resetTextColor(),this.drawText(this._number,t,e,i,"right")}drawTotalPrice(){const t=this._price*this._number,e=this.contentsWidth()-this.textPadding();this.drawCurrencyValue(t,this._currencyUnit,0,this.priceY(),e)}itemY(){return Math.round(this.contentsHeight()/2-1.5*this.lineHeight())}priceY(){return Math.round(this.contentsHeight()/2+this.lineHeight()/2)}buttonY(){return Math.round(this.priceY()+2.5*this.lineHeight())}cursorWidth(){const t=this.textWidth("0");return this.maxDigits()*t+2*this.textPadding()}cursorX(){return this.contentsWidth()-this.cursorWidth()-this.textPadding()}maxDigits(){return 2}update(){super.update(),this.processNumberChange()}isOkTriggered(){return Input.isTriggered("ok")}playOkSound(){}processNumberChange(){this.isOpenAndActive()&&(Input.isRepeated("right")&&this.changeNumber(1),Input.isRepeated("left")&&this.changeNumber(-1),Input.isRepeated("up")&&this.changeNumber(10),Input.isRepeated("down")&&this.changeNumber(-10))}changeNumber(t){const e=this._number;this._number=(this._number+t).clamp(1,this._max),this._number!==e&&(SoundManager.playCursor(),this.refresh())}updateCursor(){this.setCursorRect(this.cursorX(),this.itemY(),this.cursorWidth(),this.lineHeight())}onButtonUp(){this.changeNumber(1)}onButtonUp2(){this.changeNumber(10)}onButtonDown(){this.changeNumber(-1)}onButtonDown2(){this.changeNumber(-10)}onButtonOk(){this.processOk()}}class Window_ShopStatus extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._item=null,this._pageIndex=0,this.refresh()}refresh(){if(this.contents.clear(),this._item){const t=this.textPadding();this.drawPossession(t,0),this.isEquipItem()&&this.drawEquipInfo(t,2*this.lineHeight())}}setItem(t){this._item=t,this.refresh()}isEquipItem(){return DataManager.isWeapon(this._item)||DataManager.isArmor(this._item)}drawPossession(t,e){const i=this.contents.width-this.textPadding()-t,s=this.textWidth("0000");this.changeTextColor(this.systemColor()),this.drawText(TextManager.possession,t,e,i-s),this.resetTextColor(),this.drawText(self.$gameParty.numItems(this._item),t,e,i,"right")}drawEquipInfo(t,e){const i=this.statusMembers();for(let s=0;s<i.length;s++)this.drawActorEquipInfo(t,e+this.lineHeight()*(2.4*s),i[s])}statusMembers(){const t=this._pageIndex*this.pageSize(),e=t+this.pageSize();return self.$gameParty.members().slice(t,e)}pageSize(){return 4}maxPages(){return Math.floor((self.$gameParty.size()+this.pageSize()-1)/this.pageSize())}drawActorEquipInfo(t,e,i){const s=i.canEquip(this._item);this.changePaintOpacity(s),this.resetTextColor(),this.drawText(i.name(),t,e,168);const a=this.currentEquippedItem(i,this._item.etypeId);s&&this.drawActorParamChange(t,e,i,a),this.drawItemName(a,t,e+this.lineHeight()),this.changePaintOpacity(!0)}drawActorParamChange(t,e,i,s){const a=this.contents.width-this.textPadding()-t,r=this.paramId(),n=this._item.params[r]-(s?s.params[r]:0);this.changeTextColor(this.paramchangeTextColor(n)),this.drawText((n>0?"+":"")+n,t,e,a,"right")}paramId(){return DataManager.isWeapon(this._item)?2:3}currentEquippedItem(t,e){const i=[],s=t.equips(),a=t.equipSlots();for(let t=0;t<a.length;t++)a[t]===e&&i.push(s[t]);const r=this.paramId();let n=Number.MAX_VALUE,h=null;for(let t=0;t<i.length;t++)i[t]&&i[t].params[r]<n&&(n=i[t].params[r],h=i[t]);return h}update(){super.update(),this.updatePage()}updatePage(){this.isPageChangeEnabled()&&this.isPageChangeRequested()&&this.changePage()}isPageChangeEnabled(){return this.visible&&this.maxPages()>=2}isPageChangeRequested(){return!!Input.isTriggered("shift")||!(!TouchInput.isTriggered()||!this.isTouchedInsideFrame())}isTouchedInsideFrame(){const t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y);return t>=0&&e>=0&&t<this.width&&e<this.height}changePage(){this._pageIndex=(this._pageIndex+1)%this.maxPages(),this.refresh(),SoundManager.playCursor()}}class Scene_Shop extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}prepare(t,e){this._goods=t,this._purchaseOnly=e,this._item=null}create(){super.create(),this.createHelpWindow(),this.createGoldWindow(),this.createCommandWindow(),this.createDummyWindow(),this.createNumberWindow(),this.createStatusWindow(),this.createBuyWindow(),this.createCategoryWindow(),this.createSellWindow()}createGoldWindow(){this._goldWindow=new Window_Gold(0,this._helpWindow.height),this._goldWindow.x=Graphics$1.boxWidth-this._goldWindow.width,this.addWindow(this._goldWindow)}createCommandWindow(){this._commandWindow=new Window_ShopCommand(this._goldWindow.x,this._purchaseOnly),this._commandWindow.y=this._helpWindow.height,this._commandWindow.setHandler("buy",this.commandBuy.bind(this)),this._commandWindow.setHandler("sell",this.commandSell.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)}createDummyWindow(){const t=this._commandWindow.y+this._commandWindow.height,e=Graphics$1.boxHeight-t;this._dummyWindow=new Window_Base(0,t,Graphics$1.boxWidth,e),this.addWindow(this._dummyWindow)}createNumberWindow(){const t=this._dummyWindow.y,e=this._dummyWindow.height;this._numberWindow=new Window_ShopNumber(0,t,e),this._numberWindow.hide(),this._numberWindow.setHandler("ok",this.onNumberOk.bind(this)),this._numberWindow.setHandler("cancel",this.onNumberCancel.bind(this)),this.addWindow(this._numberWindow)}createStatusWindow(){const t=this._numberWindow.width,e=this._dummyWindow.y,i=Graphics$1.boxWidth-t,s=this._dummyWindow.height;this._statusWindow=new Window_ShopStatus(t,e,i,s),this._statusWindow.hide(),this.addWindow(this._statusWindow)}createBuyWindow(){const t=this._dummyWindow.y,e=this._dummyWindow.height;this._buyWindow=new Window_ShopBuy(0,t,e,this._goods),this._buyWindow.setHelpWindow(this._helpWindow),this._buyWindow.setStatusWindow(this._statusWindow),this._buyWindow.hide(),this._buyWindow.setHandler("ok",this.onBuyOk.bind(this)),this._buyWindow.setHandler("cancel",this.onBuyCancel.bind(this)),this.addWindow(this._buyWindow)}createCategoryWindow(){this._categoryWindow=new Window_ItemCategory,this._categoryWindow.setHelpWindow(this._helpWindow),this._categoryWindow.y=this._dummyWindow.y,this._categoryWindow.hide(),this._categoryWindow.deactivate(),this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this)),this._categoryWindow.setHandler("cancel",this.onCategoryCancel.bind(this)),this.addWindow(this._categoryWindow)}createSellWindow(){const t=this._categoryWindow.y+this._categoryWindow.height,e=Graphics$1.boxHeight-t;this._sellWindow=new Window_ShopSell(0,t,Graphics$1.boxWidth,e),this._sellWindow.setHelpWindow(this._helpWindow),this._sellWindow.hide(),this._sellWindow.setHandler("ok",this.onSellOk.bind(this)),this._sellWindow.setHandler("cancel",this.onSellCancel.bind(this)),this._categoryWindow.setItemWindow(this._sellWindow),this.addWindow(this._sellWindow)}activateBuyWindow(){this._buyWindow.setMoney(this.money()),this._buyWindow.show(),this._buyWindow.activate(),this._statusWindow.show()}activateSellWindow(){this._categoryWindow.show(),this._sellWindow.refresh(),this._sellWindow.show(),this._sellWindow.activate(),this._statusWindow.hide()}commandBuy(){this._dummyWindow.hide(),this.activateBuyWindow()}commandSell(){this._dummyWindow.hide(),this._categoryWindow.show(),this._categoryWindow.activate(),this._sellWindow.show(),this._sellWindow.deselect(),this._sellWindow.refresh()}onBuyOk(){this._item=this._buyWindow.item(),this._buyWindow.hide(),this._numberWindow.setup(this._item,this.maxBuy(),this.buyingPrice()),this._numberWindow.setCurrencyUnit(this.currencyUnit()),this._numberWindow.show(),this._numberWindow.activate()}onBuyCancel(){this._commandWindow.activate(),this._dummyWindow.show(),this._buyWindow.hide(),this._statusWindow.hide(),this._statusWindow.setItem(null),this._helpWindow.clear()}onCategoryOk(){this.activateSellWindow(),this._sellWindow.select(0)}onCategoryCancel(){this._commandWindow.activate(),this._dummyWindow.show(),this._categoryWindow.hide(),this._sellWindow.hide()}onSellOk(){this._item=this._sellWindow.item(),this._categoryWindow.hide(),this._sellWindow.hide(),this._numberWindow.setup(this._item,this.maxSell(),this.sellingPrice()),this._numberWindow.setCurrencyUnit(this.currencyUnit()),this._numberWindow.show(),this._numberWindow.activate(),this._statusWindow.setItem(this._item),this._statusWindow.show()}onSellCancel(){this._sellWindow.deselect(),this._categoryWindow.activate(),this._statusWindow.setItem(null),this._helpWindow.clear()}onNumberOk(){switch(SoundManager.playShop(),this._commandWindow.currentSymbol()){case"buy":this.doBuy(this._numberWindow.number());break;case"sell":this.doSell(this._numberWindow.number())}this.endNumberInput(),this._goldWindow.refresh(),this._statusWindow.refresh()}onNumberCancel(){SoundManager.playCancel(),this.endNumberInput()}doBuy(t){self.$gameParty.loseGold(t*this.buyingPrice()),self.$gameParty.gainItem(this._item,t)}doSell(t){self.$gameParty.gainGold(t*this.sellingPrice()),self.$gameParty.loseItem(this._item,t)}endNumberInput(){switch(this._numberWindow.hide(),this._commandWindow.currentSymbol()){case"buy":this.activateBuyWindow();break;case"sell":this.activateSellWindow()}}maxBuy(){const t=self.$gameParty.maxItems(this._item)-self.$gameParty.numItems(this._item),e=this.buyingPrice();return e>0?Math.min(t,Math.floor(this.money()/e)):t}maxSell(){return self.$gameParty.numItems(this._item)}money(){return this._goldWindow.value()}currencyUnit(){return this._goldWindow.currencyUnit()}buyingPrice(){return this._buyWindow.price(this._item)}sellingPrice(){return Math.floor(this._item.price/2)}}class Window_NameEdit extends Window_Base{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){const i=this.windowWidth(),s=this.windowHeight(),a=(Graphics$1.boxWidth-i)/2,r=(Graphics$1.boxHeight-(s+this.fittingHeight(9)+8))/2;super.initialize(a,r,i,s),this._actor=t,this._name=t.name().slice(0,this._maxLength),this._index=this._name.length,this._maxLength=e,this._defaultName=this._name,this.deactivate(),this.refresh(),ImageManager.reserveFace(t.faceName())}windowWidth(){return 480}windowHeight(){return this.fittingHeight(4)}name(){return this._name}restoreDefault(){return this._name=this._defaultName,this._index=this._name.length,this.refresh(),this._name.length>0}add(t){return this._index<this._maxLength&&(this._name+=t,this._index++,this.refresh(),!0)}back(){return this._index>0&&(this._index--,this._name=this._name.slice(0,this._index),this.refresh(),!0)}faceWidth(){return 144}charWidth(){const t=self.$gameSystem.isJapanese()?"":"A";return this.textWidth(t)}left(){const t=(this.contentsWidth()+this.faceWidth())/2,e=(this._maxLength+1)*this.charWidth();return Math.min(t-e/2,this.contentsWidth()-e)}itemRect(t){return{x:this.left()+t*this.charWidth(),y:54,width:this.charWidth(),height:this.lineHeight()}}underlineRect(t){const e=this.itemRect(t);return e.x++,e.y+=e.height-4,e.width-=2,e.height=2,e}underlineColor(){return this.normalColor()}drawUnderline(t){const e=this.underlineRect(t),i=this.underlineColor();this.contents.paintOpacity=48,this.contents.fillRect(e.x,e.y,e.width,e.height,i),this.contents.paintOpacity=255}drawChar(t){const e=this.itemRect(t);this.resetTextColor(),this.drawText(this._name[t]||"",e.x,e.y)}refresh(){this.contents.clear(),this.drawActorFace(this._actor,0,0);for(let t=0;t<this._maxLength;t++)this.drawUnderline(t);for(let t=0;t<this._name.length;t++)this.drawChar(t);const t=this.itemRect(this._index);this.setCursorRect(t.x,t.y,t.width,t.height)}}class Window_NameInput extends Window_Selectable{constructor(...t){super(...t),this.initialize(...t)}initialize(t){const e=t.x,i=t.y+t.height+8,s=t.width,a=this.windowHeight();super.initialize(e,i,s,a),this._editWindow=t,this._page=0,this._index=0,this.refresh(),this.updateCursor(),this.activate()}windowHeight(){return this.fittingHeight(9)}table(){return self.$gameSystem.isJapanese()?[Window_NameInput.JAPAN1,Window_NameInput.JAPAN2,Window_NameInput.JAPAN3]:self.$gameSystem.isRussian()?[Window_NameInput.RUSSIA]:[Window_NameInput.LATIN1,Window_NameInput.LATIN2]}maxCols(){return 10}maxItems(){return 90}character(){return this._index<88?this.table()[this._page][this._index]:""}isPageChange(){return 88===this._index}isOk(){return 89===this._index}itemRect(t){return{x:t%10*42+24*Math.floor(t%10/5),y:Math.floor(t/10)*this.lineHeight(),width:42,height:this.lineHeight()}}refresh(){const t=this.table();this.contents.clear(),this.resetTextColor();for(let e=0;e<90;e++){const i=this.itemRect(e);i.x+=3,i.width-=6,this.drawText(t[this._page][e],i.x,i.y,i.width,"center")}}updateCursor(){const t=this.itemRect(this._index);this.setCursorRect(t.x,t.y,t.width,t.height)}isCursorMovable(){return this.active}cursorDown(t){(this._index<80||t)&&(this._index=(this._index+10)%90)}cursorUp(t){(this._index>=10||t)&&(this._index=(this._index+80)%90)}cursorRight(t){this._index%10<9?this._index++:t&&(this._index-=9)}cursorLeft(t){this._index%10>0?this._index--:t&&(this._index+=9)}cursorPagedown(){this._page=(this._page+1)%this.table().length,this.refresh()}cursorPageup(){this._page=(this._page+this.table().length-1)%this.table().length,this.refresh()}processCursorMove(){const t=this._page;super.processCursorMove(),this.updateCursor(),this._page!==t&&SoundManager.playCursor()}processHandling(){this.isOpen()&&this.active&&(Input.isTriggered("shift")&&this.processJump(),Input.isRepeated("cancel")&&this.processBack(),Input.isRepeated("ok")&&this.processOk())}isCancelEnabled(){return!0}processCancel(){this.processBack()}processJump(){89!==this._index&&(this._index=89,SoundManager.playCursor())}processBack(){this._editWindow.back()&&SoundManager.playCancel()}processOk(){this.character()?this.onNameAdd():this.isPageChange()?(SoundManager.playOk(),this.cursorPagedown()):this.isOk()&&this.onNameOk()}onNameAdd(){this._editWindow.add(this.character())?SoundManager.playOk():SoundManager.playBuzzer()}onNameOk(){""===this._editWindow.name()?this._editWindow.restoreDefault()?SoundManager.playOk():SoundManager.playBuzzer():(SoundManager.playOk(),this.callOkHandler())}}Window_NameInput.LATIN1=["A","B","C","D","E","a","b","c","d","e","F","G","H","I","J","f","g","h","i","j","K","L","M","N","O","k","l","m","n","o","P","Q","R","S","T","p","q","r","s","t","U","V","W","X","Y","u","v","w","x","y","Z","[","]","^","_","z","{","}","|","~","0","1","2","3","4","!","#","$","%","&","5","6","7","8","9","(",")","*","+","-","/","=","@","<",">",":",";"," ","Page","OK"],Window_NameInput.LATIN2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","Page","OK"],Window_NameInput.RUSSIA=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","^","_","","","","%","&","0","1","2","3","4","(",")","*","+","-","5","6","7","8","9",":",";"," ","","OK"],Window_NameInput.JAPAN1=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Window_NameInput.JAPAN2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Window_NameInput.JAPAN3=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];class Scene_Name extends Scene_MenuBase{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}prepare(t,e){this._actorId=t,this._maxLength=e}create(){super.create(),this._actor=self.$gameActors.actor(this._actorId),this.createEditWindow(),this.createInputWindow()}start(){super.start(),this._editWindow.refresh()}createEditWindow(){this._editWindow=new Window_NameEdit(this._actor,this._maxLength),this.addWindow(this._editWindow)}createInputWindow(){this._inputWindow=new Window_NameInput(this._editWindow),this._inputWindow.setHandler("ok",this.onInputOk.bind(this)),this.addWindow(this._inputWindow)}onInputOk(){this._actor.setName(this._editWindow.name()),this.popScene()}}class Game_Interpreter{constructor(...t){this.initialize(...t)}initialize(t){this._depth=t||0,this.checkOverflow(),this.clear(),this._branch={},this._params=[],this._indent=0,this._frameCount=0,this._freezeChecker=0}checkOverflow(){if(this._depth>=100)throw new Error("Common event calls exceeded the limit")}clear(){this._mapId=0,this._eventId=0,this._list=null,this._index=0,this._waitCount=0,this._waitMode="",this._comments="",this._eventInfo=null,this._character=null,this._childInterpreter=null}setup(t,e){this.clear(),this._mapId=self.$gameMap.mapId(),this._eventId=e||0,this._list=t,Game_Interpreter.requestImages(t)}eventId(){return this._eventId}isOnCurrentMap(){return this._mapId===self.$gameMap.mapId()}setEventInfo(t){this._eventInfo=t}setupReservedCommonEvent(){return!!self.$gameTemp.isCommonEventReserved()&&(this.setup(self.$gameTemp.reservedCommonEvent().list),this.setEventInfo({eventType:"common_event",commonEventId:self.$gameTemp.reservedCommonEventId()}),self.$gameTemp.clearCommonEvent(),!0)}isRunning(){return!!this._list}update(){for(;this.isRunning()&&!this.updateChild()&&!this.updateWait()&&!SceneManager.isSceneChanging()&&this.executeCommand()&&!this.checkFreeze(););}updateChild(){if(this._childInterpreter){if(this._childInterpreter.update(),this._childInterpreter.isRunning())return!0;this._childInterpreter=null}return!1}updateWait(){return this.updateWaitCount()||this.updateWaitMode()}updateWaitCount(){return this._waitCount>0&&(this._waitCount--,!0)}updateWaitMode(){let t=!1;switch(this._waitMode){case"message":t=self.$gameMessage.isBusy();break;case"transfer":t=self.$gamePlayer.isTransferring();break;case"scroll":t=self.$gameMap.isScrolling();break;case"route":t=this._character.isMoveRouteForcing();break;case"animation":t=this._character.isAnimationPlaying();break;case"balloon":t=this._character.isBalloonPlaying();break;case"gather":t=self.$gamePlayer.areFollowersGathering();break;case"action":t=BattleManager.isActionForced();break;case"video":t=Graphics$1.isVideoPlaying();break;case"image":t=!ImageManager.isReady()}return t||(this._waitMode=""),t}setWaitMode(t){this._waitMode=t}wait(t){this._waitCount=t}fadeSpeed(){return 24}executeCommand(){const t=this.currentCommand();if(t){this._params=t.parameters,this._indent=t.indent;const e=`command${t.code}`;if("function"==typeof this[e])try{if(!this[e]())return!1}catch(t){for(let e in this._eventInfo)t[e]=this._eventInfo[e];throw t.eventCommand=t.eventCommand||"other",t.line=t.line||this._index+1,t}this._index++}else this.terminate();return!0}checkFreeze(){return this._frameCount!==Graphics$1.frameCount&&(this._frameCount=Graphics$1.frameCount,this._freezeChecker=0),this._freezeChecker++>=1e5}terminate(){this._list=null,this._comments=""}skipBranch(){for(;this._list[this._index+1].indent>this._indent;)this._index++}currentCommand(){return this._list[this._index]}nextEventCode(){const t=this._list[this._index+1];return t?t.code:0}iterateActorId(t,e){if(0===t)self.$gameParty.members().forEach(e);else{const i=self.$gameActors.actor(t);i&&e(i)}}iterateActorEx(t,e,i){0===t?this.iterateActorId(e,i):this.iterateActorId(self.$gameVariables.value(e),i)}iterateActorIndex(t,e){if(t<0)self.$gameParty.members().forEach(e);else{const i=self.$gameParty.members()[t];i&&e(i)}}iterateEnemyIndex(t,e){if(t<0)self.$gameTroop.members().forEach(e);else{const i=self.$gameTroop.members()[t];i&&e(i)}}iterateBattler(t,e,i){self.$gameParty.inBattle()&&(0===t?this.iterateEnemyIndex(e,i):this.iterateActorId(e,i))}character(t){return self.$gameParty.inBattle()?null:t<0?self.$gamePlayer:this.isOnCurrentMap()?self.$gameMap.event(t>0?t:this._eventId):null}operateValue(t,e,i){const s=0===e?i:self.$gameVariables.value(i);return 0===t?s:-s}changeHp(t,e,i){t.isAlive()&&(!i&&t.hp<=-e&&(e=1-t.hp),t.gainHp(e),t.isDead()&&t.performCollapse())}command101(){if(!self.$gameMessage.isBusy()){for(self.$gameMessage.setFaceImage(this._params[0],this._params[1]),self.$gameMessage.setBackground(this._params[2]),self.$gameMessage.setPositionType(this._params[3]);401===this.nextEventCode();)this._index++,self.$gameMessage.add(this.currentCommand().parameters[0]);switch(this.nextEventCode()){case 102:this._index++,this.setupChoices(this.currentCommand().parameters);break;case 103:this._index++,this.setupNumInput(this.currentCommand().parameters);break;case 104:this._index++,this.setupItemChoice(this.currentCommand().parameters)}this._index++,this.setWaitMode("message")}return!1}command102(){return self.$gameMessage.isBusy()||(this.setupChoices(this._params),this._index++,this.setWaitMode("message")),!1}setupChoices(t){const e=t[0].clone();let i=t[1];const s=t.length>2?t[2]:0,a=t.length>3?t[3]:2,r=t.length>4?t[4]:0;i>=e.length&&(i=-2),self.$gameMessage.setChoices(e,s,i),self.$gameMessage.setChoiceBackground(r),self.$gameMessage.setChoicePositionType(a),self.$gameMessage.setChoiceCallback((t=>{this._branch[this._indent]=t}))}command402(){return this._branch[this._indent]!==this._params[0]&&this.skipBranch(),!0}command403(){return this._branch[this._indent]>=0&&this.skipBranch(),!0}command103(){return self.$gameMessage.isBusy()||(this.setupNumInput(this._params),this._index++,this.setWaitMode("message")),!1}setupNumInput(t){self.$gameMessage.setNumberInput(t[0],t[1])}command104(){return self.$gameMessage.isBusy()||(this.setupItemChoice(this._params),this._index++,this.setWaitMode("message")),!1}setupItemChoice(t){self.$gameMessage.setItemChoice(t[0],t[1]||2)}command105(){if(!self.$gameMessage.isBusy()){for(self.$gameMessage.setScroll(this._params[0],this._params[1]);405===this.nextEventCode();)this._index++,self.$gameMessage.add(this.currentCommand().parameters[0]);this._index++,this.setWaitMode("message")}return!1}command108(){for(this._comments=[this._params[0]];408===this.nextEventCode();)this._index++,this._comments.push(this.currentCommand().parameters[0]);return!0}command111(){let result=!1;switch(this._params[0]){case 0:result=self.$gameSwitches.value(this._params[1])===(0===this._params[2]);break;case 1:const value1=self.$gameVariables.value(this._params[1]);let value2;switch(value2=0===this._params[2]?this._params[3]:self.$gameVariables.value(this._params[3]),this._params[4]){case 0:result=value1===value2;break;case 1:result=value1>=value2;break;case 2:result=value1<=value2;break;case 3:result=value1>value2;break;case 4:result=value1<value2;break;case 5:result=value1!==value2}break;case 2:if(this._eventId>0){const t=[this._mapId,this._eventId,this._params[1]];result=self.$gameSelfSwitches.value(t)===(0===this._params[2])}break;case 3:self.$gameTimer.isWorking()&&(result=0===this._params[2]?self.$gameTimer.seconds()>=this._params[1]:self.$gameTimer.seconds()<=this._params[1]);break;case 4:const actor=self.$gameActors.actor(this._params[1]);if(actor){const t=this._params[3];switch(this._params[2]){case 0:result=self.$gameParty.members().contains(actor);break;case 1:result=actor.name()===t;break;case 2:result=actor.isClass(self.$dataClasses[t]);break;case 3:result=actor.hasSkill(t);break;case 4:result=actor.hasWeapon(self.$dataWeapons[t]);break;case 5:result=actor.hasArmor(self.$dataArmors[t]);break;case 6:result=actor.isStateAffected(t)}}break;case 5:const enemy=self.$gameTroop.members()[this._params[1]];if(enemy)switch(this._params[2]){case 0:result=enemy.isAlive();break;case 1:result=enemy.isStateAffected(this._params[3])}break;case 6:const character=this.character(this._params[1]);character&&(result=character.direction()===this._params[2]);break;case 7:switch(this._params[2]){case 0:result=self.$gameParty.gold()>=this._params[1];break;case 1:result=self.$gameParty.gold()<=this._params[1];break;case 2:result=self.$gameParty.gold()<this._params[1]}break;case 8:result=self.$gameParty.hasItem(self.$dataItems[this._params[1]]);break;case 9:result=self.$gameParty.hasItem(self.$dataWeapons[this._params[1]],this._params[2]);break;case 10:result=self.$gameParty.hasItem(self.$dataArmors[this._params[1]],this._params[2]);break;case 11:result=Input.isPressed(this._params[1]);break;case 12:try{result=!!eval(this._params[1])}catch(t){throw t.eventCommand="conditional_branch_script",t.content=this._params[1],t}break;case 13:result=self.$gamePlayer.vehicle()===self.$gameMap.vehicle(this._params[1])}return this._branch[this._indent]=result,!1===this._branch[this._indent]&&this.skipBranch(),!0}command411(){return!1!==this._branch[this._indent]&&this.skipBranch(),!0}command112(){return!0}command413(){do{this._index--}while(this.currentCommand().indent!==this._indent);return!0}command113(){let t=0;for(;this._index<this._list.length-1;){this._index++;const e=this.currentCommand();if(112===e.code&&t++,413===e.code){if(!(t>0))break;t--}}return!0}command115(){return this._index=this._list.length,!0}command117(){const t=self.$dataCommonEvents[this._params[0]];if(t){const e=this.isOnCurrentMap()?this._eventId:0;this.setupChild(t.list,e)}return!0}setupChild(t,e){this._childInterpreter=new Game_Interpreter(this._depth+1),this._childInterpreter.setup(t,e),this._childInterpreter.setEventInfo({eventType:"common_event",commonEventId:this._params[0]})}command118(){return!0}command119(){const t=this._params[0];for(let e=0;e<this._list.length;e++){const i=this._list[e];if(118===i.code&&i.parameters[0]===t)return void this.jumpTo(e)}return!0}jumpTo(t){const e=this._index,i=Math.min(t,e),s=Math.max(t,e);let a=this._indent;for(let t=i;t<=s;t++){const e=this._list[t].indent;e!==a&&(this._branch[a]=null,a=e)}this._index=t}command121(){for(let t=this._params[0];t<=this._params[1];t++)self.$gameSwitches.setValue(t,0===this._params[2]);return!0}command122(){let value=0;switch(this._params[3]){case 0:value=this._params[4];break;case 1:value=self.$gameVariables.value(this._params[4]);break;case 2:value=this._params[5]-this._params[4]+1;for(let t=this._params[0];t<=this._params[1];t++)this.operateVariable(t,this._params[2],this._params[4]+Math.randomInt(value));return!0;case 3:value=this.gameDataOperand(this._params[4],this._params[5],this._params[6]);break;case 4:try{value=eval(this._params[4])}catch(t){throw t.eventCommand="control_variables",t.content=this._params[4],t}}for(let t=this._params[0];t<=this._params[1];t++)this.operateVariable(t,this._params[2],value);return!0}gameDataOperand(t,e,i){switch(t){case 0:return self.$gameParty.numItems(self.$dataItems[e]);case 1:return self.$gameParty.numItems(self.$dataWeapons[e]);case 2:return self.$gameParty.numItems(self.$dataArmors[e]);case 3:const t=self.$gameActors.actor(e);if(t)switch(i){case 0:return t.level;case 1:return t.currentExp();case 2:return t.hp;case 3:return t.mp;default:if(i>=4&&i<=11)return t.param(i-4)}break;case 4:const s=self.$gameTroop.members()[e];if(s)switch(i){case 0:return s.hp;case 1:return s.mp;default:if(i>=2&&i<=9)return s.param(i-2)}break;case 5:const a=this.character(e);if(a)switch(i){case 0:return a.x;case 1:return a.y;case 2:return a.direction();case 3:return a.screenX();case 4:return a.screenY()}break;case 6:const r=self.$gameParty.members()[e];return r?r.actorId():0;case 7:switch(e){case 0:return self.$gameMap.mapId();case 1:return self.$gameParty.size();case 2:return self.$gameParty.gold();case 3:return self.$gameParty.steps();case 4:return self.$gameSystem.playtime();case 5:return self.$gameTimer.seconds();case 6:return self.$gameSystem.saveCount();case 7:return self.$gameSystem.battleCount();case 8:return self.$gameSystem.winCount();case 9:return self.$gameSystem.escapeCount()}}return 0}operateVariable(t,e,i){try{let s=self.$gameVariables.value(t);switch(e){case 0:self.$gameVariables.setValue(t,s=i);break;case 1:self.$gameVariables.setValue(t,s+i);break;case 2:self.$gameVariables.setValue(t,s-i);break;case 3:self.$gameVariables.setValue(t,s*i);break;case 4:self.$gameVariables.setValue(t,s/i);break;case 5:self.$gameVariables.setValue(t,s%i)}}catch(e){self.$gameVariables.setValue(t,0)}}command123(){if(this._eventId>0){const t=[this._mapId,this._eventId,this._params[0]];self.$gameSelfSwitches.setValue(t,0===this._params[1])}return!0}command124(){return 0===this._params[0]?self.$gameTimer.start(60*this._params[1]):self.$gameTimer.stop(),!0}command125(){const t=this.operateValue(this._params[0],this._params[1],this._params[2]);return self.$gameParty.gainGold(t),!0}command126(){const t=this.operateValue(this._params[1],this._params[2],this._params[3]);return self.$gameParty.gainItem(self.$dataItems[this._params[0]],t),!0}command127(){const t=this.operateValue(this._params[1],this._params[2],this._params[3]);return self.$gameParty.gainItem(self.$dataWeapons[this._params[0]],t,this._params[4]),!0}command128(){const t=this.operateValue(this._params[1],this._params[2],this._params[3]);return self.$gameParty.gainItem(self.$dataArmors[this._params[0]],t,this._params[4]),!0}command129(){return self.$gameActors.actor(this._params[0])&&(0===this._params[1]?(this._params[2]&&self.$gameActors.actor(this._params[0]).setup(this._params[0]),self.$gameParty.addActor(this._params[0])):self.$gameParty.removeActor(this._params[0])),!0}command132(){return self.$gameSystem.setBattleBgm(this._params[0]),!0}command133(){return self.$gameSystem.setVictoryMe(this._params[0]),!0}command134(){return 0===this._params[0]?self.$gameSystem.disableSave():self.$gameSystem.enableSave(),!0}command135(){return 0===this._params[0]?self.$gameSystem.disableMenu():self.$gameSystem.enableMenu(),!0}command136(){return 0===this._params[0]?self.$gameSystem.disableEncounter():self.$gameSystem.enableEncounter(),self.$gamePlayer.makeEncounterCount(),!0}command137(){return 0===this._params[0]?self.$gameSystem.disableFormation():self.$gameSystem.enableFormation(),!0}command138(){return self.$gameSystem.setWindowTone(this._params[0]),!0}command139(){return self.$gameSystem.setDefeatMe(this._params[0]),!0}command140(){const t=self.$gameMap.vehicle(this._params[0]);return t&&t.setBgm(this._params[1]),!0}command201(){if(!self.$gameParty.inBattle()&&!self.$gameMessage.isBusy()){let t,e,i;0===this._params[0]?(t=this._params[1],e=this._params[2],i=this._params[3]):(t=self.$gameVariables.value(this._params[1]),e=self.$gameVariables.value(this._params[2]),i=self.$gameVariables.value(this._params[3])),self.$gamePlayer.reserveTransfer(t,e,i,this._params[4],this._params[5]),this.setWaitMode("transfer"),this._index++}return!1}command202(){let t,e,i;0===this._params[1]?(t=this._params[2],e=this._params[3],i=this._params[4]):(t=self.$gameVariables.value(this._params[2]),e=self.$gameVariables.value(this._params[3]),i=self.$gameVariables.value(this._params[4]));const s=self.$gameMap.vehicle(this._params[0]);return s&&s.setLocation(t,e,i),!0}command203(){const t=this.character(this._params[0]);if(t){if(0===this._params[1])t.locate(this._params[2],this._params[3]);else if(1===this._params[1]){const e=self.$gameVariables.value(this._params[2]),i=self.$gameVariables.value(this._params[3]);t.locate(e,i)}else{const e=this.character(this._params[2]);e&&t.swap(e)}this._params[4]>0&&t.setDirection(this._params[4])}return!0}command204(){if(!self.$gameParty.inBattle()){if(self.$gameMap.isScrolling())return this.setWaitMode("scroll"),!1;self.$gameMap.startScroll(this._params[0],this._params[1],this._params[2])}return!0}command205(){if(self.$gameMap.refreshIfNeeded(),this._character=this.character(this._params[0]),this._character){this._character.forceMoveRoute(this._params[1]);const t=JsonEx.makeDeepCopy(this._eventInfo);t.line=this._index+1,this._character.setCallerEventInfo(t),this._params[1].wait&&this.setWaitMode("route")}return!0}command206(){return self.$gamePlayer.getOnOffVehicle(),!0}command211(){return self.$gamePlayer.setTransparent(0===this._params[0]),!0}command212(){return this._character=this.character(this._params[0]),this._character&&(this._character.requestAnimation(this._params[1]),this._params[2]&&this.setWaitMode("animation")),!0}command213(){return this._character=this.character(this._params[0]),this._character&&(this._character.requestBalloon(this._params[1]),this._params[2]&&this.setWaitMode("balloon")),!0}command214(){return this.isOnCurrentMap()&&this._eventId>0&&self.$gameMap.eraseEvent(this._eventId),!0}command216(){return 0===this._params[0]?self.$gamePlayer.showFollowers():self.$gamePlayer.hideFollowers(),self.$gamePlayer.refresh(),!0}command217(){return self.$gameParty.inBattle()||(self.$gamePlayer.gatherFollowers(),this.setWaitMode("gather")),!0}command221(){return self.$gameMessage.isBusy()||(self.$gameScreen.startFadeOut(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1}command222(){return self.$gameMessage.isBusy()||(self.$gameScreen.startFadeIn(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1}command223(){return self.$gameScreen.startTint(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0}command224(){return self.$gameScreen.startFlash(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0}command225(){return self.$gameScreen.startShake(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0}command230(){return this.wait(this._params[0]),!0}command231(){let t,e;return 0===this._params[3]?(t=this._params[4],e=this._params[5]):(t=self.$gameVariables.value(this._params[4]),e=self.$gameVariables.value(this._params[5])),self.$gameScreen.showPicture(this._params[0],this._params[1],this._params[2],t,e,this._params[6],this._params[7],this._params[8],this._params[9]),!0}command232(){let t,e;return 0===this._params[3]?(t=this._params[4],e=this._params[5]):(t=self.$gameVariables.value(this._params[4]),e=self.$gameVariables.value(this._params[5])),self.$gameScreen.movePicture(this._params[0],this._params[2],t,e,this._params[6],this._params[7],this._params[8],this._params[9],this._params[10]),this._params[11]&&this.wait(this._params[10]),!0}command233(){return self.$gameScreen.rotatePicture(this._params[0],this._params[1]),!0}command234(){return self.$gameScreen.tintPicture(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0}command235(){return self.$gameScreen.erasePicture(this._params[0]),!0}command236(){return self.$gameParty.inBattle()||(self.$gameScreen.changeWeather(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2])),!0}command241(){return AudioManager.playBgm(this._params[0]),!0}command242(){return AudioManager.fadeOutBgm(this._params[0]),!0}command243(){return self.$gameSystem.saveBgm(),!0}command244(){return self.$gameSystem.replayBgm(),!0}command245(){return AudioManager.playBgs(this._params[0]),!0}command246(){return AudioManager.fadeOutBgs(this._params[0]),!0}command249(){return AudioManager.playMe(this._params[0]),!0}command250(){return AudioManager.playSe(this._params[0]),!0}command251(){return AudioManager.stopSe(),!0}command261(){if(!self.$gameMessage.isBusy()){const t=this._params[0];if(t.length>0){const e=this.videoFileExt();Graphics$1.playVideo(`movies/${t}${e}`),this.setWaitMode("video")}this._index++}return!1}videoFileExt(){return Graphics$1.canPlayVideoType("video/webm")&&!Utils.isMobileDevice()?".webm":".mp4"}command281(){return 0===this._params[0]?self.$gameMap.enableNameDisplay():self.$gameMap.disableNameDisplay(),!0}command282(){const t=self.$dataTilesets[this._params[0]];return this._imageReservationId||(this._imageReservationId=Utils.generateRuntimeId()),!!t.tilesetNames.map((function(t){return ImageManager.reserveTileset(t,0,this._imageReservationId)}),this).every((t=>t.isReady()))&&(self.$gameMap.changeTileset(this._params[0]),ImageManager.releaseReservation(this._imageReservationId),this._imageReservationId=null,!0)}command283(){return self.$gameMap.changeBattleback(this._params[0],this._params[1]),!0}command284(){return self.$gameMap.changeParallax(this._params[0],this._params[1],this._params[2],this._params[3],this._params[4]),!0}command285(){let t,e,i;switch(0===this._params[2]?(t=this._params[3],e=this._params[4]):(t=self.$gameVariables.value(this._params[3]),e=self.$gameVariables.value(this._params[4])),this._params[1]){case 0:i=self.$gameMap.terrainTag(t,e);break;case 1:i=self.$gameMap.eventIdXy(t,e);break;case 2:case 3:case 4:case 5:i=self.$gameMap.tileId(t,e,this._params[1]-2);break;default:i=self.$gameMap.regionId(t,e)}return self.$gameVariables.setValue(this._params[0],i),!0}command301(){if(!self.$gameParty.inBattle()){let t;t=0===this._params[0]?this._params[1]:1===this._params[0]?self.$gameVariables.value(this._params[1]):self.$gamePlayer.makeEncounterTroopId(),self.$dataTroops[t]&&(BattleManager.setup(t,this._params[2],this._params[3]),BattleManager.setEventCallback((t=>{this._branch[this._indent]=t})),self.$gamePlayer.makeEncounterCount(),SceneManager.push(Scene_Battle))}return!0}command601(){return 0!==this._branch[this._indent]&&this.skipBranch(),!0}command602(){return 1!==this._branch[this._indent]&&this.skipBranch(),!0}command603(){return 2!==this._branch[this._indent]&&this.skipBranch(),!0}command302(){if(!self.$gameParty.inBattle()){const t=[this._params];for(;605===this.nextEventCode();)this._index++,t.push(this.currentCommand().parameters);SceneManager.push(Scene_Shop),SceneManager.prepareNextScene(t,this._params[4])}return!0}command303(){return self.$gameParty.inBattle()||self.$dataActors[this._params[0]]&&(SceneManager.push(Scene_Name),SceneManager.prepareNextScene(this._params[0],this._params[1])),!0}command311(){const t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],(e=>{this.changeHp(e,t,this._params[5])})),!0}command312(){const t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],(e=>{e.gainMp(t)})),!0}command326(){const t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],(e=>{e.gainTp(t)})),!0}command313(){return this.iterateActorEx(this._params[0],this._params[1],(t=>{const e=t.isDead();0===this._params[2]?t.addState(this._params[3]):t.removeState(this._params[3]),t.isDead()&&!e&&t.performCollapse(),t.clearResult()})),!0}command314(){return this.iterateActorEx(this._params[0],this._params[1],(t=>{t.recoverAll()})),!0}command315(){const t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],(e=>{e.changeExp(e.currentExp()+t,this._params[5])})),!0}command316(){const t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],(e=>{e.changeLevel(e.level+t,this._params[5])})),!0}command317(){const t=this.operateValue(this._params[3],this._params[4],this._params[5]);return this.iterateActorEx(this._params[0],this._params[1],(e=>{e.addParam(this._params[2],t)})),!0}command318(){return this.iterateActorEx(this._params[0],this._params[1],(t=>{0===this._params[2]?t.learnSkill(this._params[3]):t.forgetSkill(this._params[3])})),!0}command319(){const t=self.$gameActors.actor(this._params[0]);return t&&t.changeEquipById(this._params[1],this._params[2]),!0}command320(){const t=self.$gameActors.actor(this._params[0]);return t&&t.setName(this._params[1]),!0}command321(){const t=self.$gameActors.actor(this._params[0]);return t&&self.$dataClasses[this._params[1]]&&t.changeClass(this._params[1],this._params[2]),!0}command322(){const t=self.$gameActors.actor(this._params[0]);return t&&(t.setCharacterImage(this._params[1],this._params[2]),t.setFaceImage(this._params[3],this._params[4]),t.setBattlerImage(this._params[5])),self.$gamePlayer.refresh(),!0}command323(){const t=self.$gameMap.vehicle(this._params[0]);return t&&t.setImage(this._params[1],this._params[2]),!0}command324(){const t=self.$gameActors.actor(this._params[0]);return t&&t.setNickname(this._params[1]),!0}command325(){const t=self.$gameActors.actor(this._params[0]);return t&&t.setProfile(this._params[1]),!0}command331(){const t=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],(e=>{this.changeHp(e,t,this._params[4])})),!0}command332(){const t=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],(e=>{e.gainMp(t)})),!0}command342(){const t=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],(e=>{e.gainTp(t)})),!0}command333(){return this.iterateEnemyIndex(this._params[0],(t=>{const e=t.isDead();0===this._params[1]?t.addState(this._params[2]):t.removeState(this._params[2]),t.isDead()&&!e&&t.performCollapse(),t.clearResult()})),!0}command334(){return this.iterateEnemyIndex(this._params[0],(t=>{t.recoverAll()})),!0}command335(){return this.iterateEnemyIndex(this._params[0],(t=>{t.appear(),self.$gameTroop.makeUniqueNames()})),!0}command336(){return this.iterateEnemyIndex(this._params[0],(t=>{t.transform(this._params[1]),self.$gameTroop.makeUniqueNames()})),!0}command337(){return 1==this._params[2]?this.iterateEnemyIndex(-1,(t=>{t.isAlive()&&t.startAnimation(this._params[1],!1,0)})):this.iterateEnemyIndex(this._params[0],(t=>{t.isAlive()&&t.startAnimation(this._params[1],!1,0)})),!0}command339(){return this.iterateBattler(this._params[0],this._params[1],(t=>{t.isDeathStateAffected()||(t.forceAction(this._params[2],this._params[3]),BattleManager.forceAction(t),this.setWaitMode("action"))})),!0}command340(){return BattleManager.abort(),!0}command351(){return self.$gameParty.inBattle()||(SceneManager.push(Scene_Menu),Window_MenuCommand.initCommandPosition()),!0}command352(){return self.$gameParty.inBattle()||SceneManager.push(Scene_Save),!0}command353(){return SceneManager.goto(Scene_Gameover),!0}command354(){return SceneManager.goto(Scene_Title),!0}command355(){const startLine=this._index+1;let script=`${this.currentCommand().parameters[0]}\n`;for(;655===this.nextEventCode();)this._index++,script+=`${this.currentCommand().parameters[0]}\n`;const endLine=this._index+1;try{eval(script)}catch(t){throw t.line=`${startLine}-${endLine}`,t.eventCommand="script",t.content=script,t}return!0}command356(){const t=this._params[0].split(" "),e=t.shift();try{this.pluginCommand(e,t)}catch(t){throw t.eventCommand="plugin_command",t.content=this._params[0],t}return!0}pluginCommand(t,e){}static requestImagesByPluginCommand(t,e){}static requestImagesForCommand({parameters:t,code:e}){const i=t;switch(e){case 101:ImageManager.requestFace(i[0]);break;case 129:const t=self.$gameActors.actor(i[0]);if(t&&0===i[1]){const e=t.characterName();ImageManager.requestCharacter(e)}break;case 205:i[1]&&i[1].list.forEach((({parameters:t,code:e})=>{const i=t;e===Game_Character.ROUTE_CHANGE_IMAGE&&ImageManager.requestCharacter(i[0])}));break;case 212:case 337:if(i[1]){const t=self.$dataAnimations[i[1]],e=t.animation1Name,s=t.animation2Name,a=t.animation1Hue,r=t.animation2Hue;ImageManager.requestAnimation(e,a),ImageManager.requestAnimation(s,r)}break;case 216:0===i[0]&&self.$gamePlayer.followers().forEach((t=>{const e=t.characterName();ImageManager.requestCharacter(e)}));break;case 231:ImageManager.requestPicture(i[1]);break;case 282:self.$dataTilesets[i[0]].tilesetNames.forEach((t=>{ImageManager.requestTileset(t)}));break;case 283:self.$gameParty.inBattle()&&(ImageManager.requestBattleback1(i[0]),ImageManager.requestBattleback2(i[1]));break;case 284:self.$gameParty.inBattle()||ImageManager.requestParallax(i[0]);break;case 322:ImageManager.requestCharacter(i[1]),ImageManager.requestFace(i[3]),ImageManager.requestSvActor(i[5]);break;case 323:self.$gameMap.vehicle(i[0])&&ImageManager.requestCharacter(i[1]);break;case 336:const e=self.$dataEnemies[i[1]],s=e.battlerName,a=e.battlerHue;self.$gameSystem.isSideView()?ImageManager.requestSvEnemy(s,a):ImageManager.requestEnemy(s,a);break;case 356:const r=i[0].split(" "),n=r.shift();Game_Interpreter.requestImagesByPluginCommand(n,r)}}static requestImagesByChildEvent({parameters:t},e){const i=t,s=self.$dataCommonEvents[i[0]];s&&(e||(e=[]),e.contains(i[0])||(e.push(i[0]),Game_Interpreter.requestImages(s.list,e)))}static requestImages(t,e){if(!t)return;const i=t.length;for(let s=0;s<i;s+=1){const i=t[s];117===i.code?Game_Interpreter.requestImagesByChildEvent(i,e):Game_Interpreter.requestImagesForCommand(i)}}}class Game_Troop extends Game_Unit{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._interpreter=new Game_Interpreter,this.clear()}isEventRunning(){return this._interpreter.isRunning()}updateInterpreter(){this._interpreter.update()}turnCount(){return this._turnCount}members(){return this._enemies}clear(){this._interpreter.clear(),this._troopId=0,this._eventFlags={},this._enemies=[],this._turnCount=0,this._namesCount={}}troop(){return self.$dataTroops[this._troopId]}setup(t){this.clear(),this._troopId=t,this._enemies=[],this.troop().members.forEach((function(t){if(self.$dataEnemies[t.enemyId]){const e=t.enemyId,i=t.x,s=t.y,a=new Game_Enemy(e,i,s);t.hidden&&a.hide(),this._enemies.push(a)}}),this),this.makeUniqueNames()}makeUniqueNames(){const t=this.letterTable();this.members().forEach((function(e){if(e.isAlive()&&e.isLetterEmpty()){const i=e.originalName(),s=this._namesCount[i]||0;e.setLetter(t[s%t.length]),this._namesCount[i]=s+1}}),this),this.members().forEach((function(t){const e=t.originalName();this._namesCount[e]>=2&&t.setPlural(!0)}),this)}letterTable(){return self.$gameSystem.isCJK()?Game_Troop.LETTER_TABLE_FULL:Game_Troop.LETTER_TABLE_HALF}enemyNames(){const t=[];return this.members().forEach((e=>{const i=e.originalName();e.isAlive()&&!t.contains(i)&&t.push(i)})),t}meetsConditions({conditions:t}){const e=t;if(!(e.turnEnding||e.turnValid||e.enemyValid||e.actorValid||e.switchValid))return!1;if(e.turnEnding&&!BattleManager.isTurnEnd())return!1;if(e.turnValid){const t=this._turnCount,i=e.turnA,s=e.turnB;if(0===s&&t!==i)return!1;if(s>0&&(t<1||t<i||t%s!=i%s))return!1}if(e.enemyValid){const t=self.$gameTroop.members()[e.enemyIndex];if(!t||100*t.hpRate()>e.enemyHp)return!1}if(e.actorValid){const t=self.$gameActors.actor(e.actorId);if(!t||100*t.hpRate()>e.actorHp)return!1}return!(e.switchValid&&!self.$gameSwitches.value(e.switchId))}setupBattleEvent(){if(!this._interpreter.isRunning()){if(this._interpreter.setupReservedCommonEvent())return;const t=this.troop().pages;for(let e=0;e<t.length;e++){const i=t[e];if(this.meetsConditions(i)&&!this._eventFlags[e]){this._interpreter.setup(i.list),this._interpreter.setEventInfo({eventType:"battle_event",troopId:this._troopId,page:e+1}),i.span<=1&&(this._eventFlags[e]=!0);break}}}}increaseTurn(){this.troop().pages.forEach((({span:t},e)=>{1===t&&(this._eventFlags[e]=!1)})),this._turnCount++}expTotal(){return this.deadMembers().reduce(((t,e)=>t+e.exp()),0)}goldTotal(){return this.deadMembers().reduce(((t,e)=>t+e.gold()),0)*this.goldRate()}goldRate(){return self.$gameParty.hasGoldDouble()?2:1}makeDropItems(){return this.deadMembers().reduce(((t,e)=>t.concat(e.makeDropItems())),[])}}Game_Troop.LETTER_TABLE_HALF=[" A"," B"," C"," D"," E"," F"," G"," H"," I"," J"," K"," L"," M"," N"," O"," P"," Q"," R"," S"," T"," U"," V"," W"," X"," Y"," Z"],Game_Troop.LETTER_TABLE_FULL=["","","","","","","","","","","","","","","","","","","","","","","","","",""];class Game_CommonEvent{constructor(...t){this.initialize(...t)}initialize(t){this._commonEventId=t,this.refresh()}event(){return self.$dataCommonEvents[this._commonEventId]}list(){return this.event().list}refresh(){this.isActive()?this._interpreter||(this._interpreter=new Game_Interpreter):this._interpreter=null}isActive(){const t=this.event();return 2===t.trigger&&self.$gameSwitches.value(t.switchId)}update(){this._interpreter&&(this._interpreter.isRunning()||(this._interpreter.setup(this.list()),this._interpreter.setEventInfo({eventType:"common_event",commonEventId:this._commonEventId})),this._interpreter.update())}}class Game_Vehicle extends Game_Character{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this._type=t,this.resetDirection(),this.initMoveSpeed(),this.loadSystemSettings()}initMembers(){super.initMembers(),this._type="",this._mapId=0,this._altitude=0,this._driving=!1,this._bgm=null}isBoat(){return"boat"===this._type}isShip(){return"ship"===this._type}isAirship(){return"airship"===this._type}resetDirection(){this.setDirection(4)}initMoveSpeed(){this.isBoat()?this.setMoveSpeed(4):this.isShip()?this.setMoveSpeed(5):this.isAirship()&&this.setMoveSpeed(6)}vehicle(){return this.isBoat()?self.$dataSystem.boat:this.isShip()?self.$dataSystem.ship:this.isAirship()?self.$dataSystem.airship:null}loadSystemSettings(){const t=this.vehicle();this._mapId=t.startMapId,this.setPosition(t.startX,t.startY),this.setImage(t.characterName,t.characterIndex)}refresh(){this._driving?(this._mapId=self.$gameMap.mapId(),this.syncWithPlayer()):this._mapId===self.$gameMap.mapId()&&this.locate(this.x,this.y),this.isAirship()?this.setPriorityType(this._driving?2:0):this.setPriorityType(1),this.setWalkAnime(this._driving),this.setStepAnime(this._driving),this.setTransparent(this._mapId!==self.$gameMap.mapId())}setLocation(t,e,i){this._mapId=t,this.setPosition(e,i),this.refresh()}pos(t,e){return this._mapId===self.$gameMap.mapId()&&Game_Character.prototype.pos.call(this,t,e)}isMapPassable(t,e,i){const s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i);return this.isBoat()?self.$gameMap.isBoatPassable(s,a):this.isShip()?self.$gameMap.isShipPassable(s,a):!!this.isAirship()}getOn(){this._driving=!0,this.setWalkAnime(!0),this.setStepAnime(!0),self.$gameSystem.saveWalkingBgm(),this.playBgm()}getOff(){this._driving=!1,this.setWalkAnime(!1),this.setStepAnime(!1),this.resetDirection(),self.$gameSystem.replayWalkingBgm()}setBgm(t){this._bgm=t}playBgm(){AudioManager.playBgm(this._bgm||this.vehicle().bgm)}syncWithPlayer(){this.copyPosition(self.$gamePlayer),this.refreshBushDepth()}screenY(){return Game_Character.prototype.screenY.call(this)-this._altitude}shadowX(){return this.screenX()}shadowY(){return this.screenY()+this._altitude}shadowOpacity(){return 255*this._altitude/this.maxAltitude()}canMove(){return!this.isAirship()||this.isHighest()}update(){super.update(),this.isAirship()&&this.updateAirship()}updateAirship(){this.updateAirshipAltitude(),this.setStepAnime(this.isHighest()),this.setPriorityType(this.isLowest()?0:2)}updateAirshipAltitude(){this._driving&&!this.isHighest()&&this._altitude++,this._driving||this.isLowest()||this._altitude--}maxAltitude(){return 48}isLowest(){return this._altitude<=0}isHighest(){return this._altitude>=this.maxAltitude()}isTakeoffOk(){return self.$gamePlayer.areFollowersGathered()}isLandOk(t,e,i){if(this.isAirship()){if(!self.$gameMap.isAirshipLandOk(t,e))return!1;if(self.$gameMap.eventsXy(t,e).length>0)return!1}else{const s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i);if(!self.$gameMap.isValid(s,a))return!1;if(!self.$gameMap.isPassable(s,a,this.reverseDir(i)))return!1;if(this.isCollidedWithCharacters(s,a))return!1}return!0}}class Game_Event extends Game_Character{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(),this._mapId=t,this._eventId=e,this.locate(this.event().x,this.event().y),this.refresh()}initMembers(){super.initMembers(),this._moveType=0,this._trigger=0,this._starting=!1,this._erased=!1,this._pageIndex=-2,this._originalPattern=1,this._originalDirection=2,this._prelockDirection=0,this._locked=!1}eventId(){return this._eventId}event(){return self.$dataMap.events[this._eventId]}page(){return this.event().pages[this._pageIndex]}list(){return this.page().list}isCollidedWithCharacters(t,e){return Game_Character.prototype.isCollidedWithCharacters.call(this,t,e)||this.isCollidedWithPlayerCharacters(t,e)}isCollidedWithEvents(t,e){return self.$gameMap.eventsXyNt(t,e).length>0}isCollidedWithPlayerCharacters(t,e){return this.isNormalPriority()&&self.$gamePlayer.isCollided(t,e)}lock(){this._locked||(this._prelockDirection=this.direction(),this.turnTowardPlayer(),this._locked=!0)}unlock(){this._locked&&(this._locked=!1,this.setDirection(this._prelockDirection))}updateStop(){this._locked&&this.resetStopCount(),super.updateStop(),this.isMoveRouteForcing()||this.updateSelfMovement()}updateSelfMovement(){if(!this._locked&&this.isNearTheScreen()&&this.checkStop(this.stopCountThreshold()))switch(this._moveType){case 1:this.moveTypeRandom();break;case 2:this.moveTypeTowardPlayer();break;case 3:this.moveTypeCustom()}}stopCountThreshold(){return 30*(5-this.moveFrequency())}moveTypeRandom(){switch(Math.randomInt(6)){case 0:case 1:this.moveRandom();break;case 2:case 3:case 4:this.moveForward();break;case 5:this.resetStopCount()}}moveTypeTowardPlayer(){if(this.isNearThePlayer())switch(Math.randomInt(6)){case 0:case 1:case 2:case 3:this.moveTowardPlayer();break;case 4:this.moveRandom();break;case 5:this.moveForward()}else this.moveRandom()}isNearThePlayer(){return Math.abs(this.deltaXFrom(self.$gamePlayer.x))+Math.abs(this.deltaYFrom(self.$gamePlayer.y))<20}moveTypeCustom(){this.updateRoutineMove()}isStarting(){return this._starting}clearStartingFlag(){this._starting=!1}isTriggerIn(t){return t.contains(this._trigger)}start(){const t=this.list();t&&t.length>1&&(this._starting=!0,this.isTriggerIn([0,1,2])&&this.lock())}erase(){this._erased=!0,this.refresh()}refresh(){const t=this._erased?-1:this.findProperPageIndex();this._pageIndex!==t&&(this._pageIndex=t,this.setupPage())}findProperPageIndex(){const t=this.event().pages;for(let e=t.length-1;e>=0;e--){const i=t[e];if(this.meetsConditions(i))return e}return-1}meetsConditions({conditions:t}){const e=t;if(e.switch1Valid&&!self.$gameSwitches.value(e.switch1Id))return!1;if(e.switch2Valid&&!self.$gameSwitches.value(e.switch2Id))return!1;if(e.variableValid&&self.$gameVariables.value(e.variableId)<e.variableValue)return!1;if(e.selfSwitchValid){const t=[this._mapId,this._eventId,e.selfSwitchCh];if(!0!==self.$gameSelfSwitches.value(t))return!1}if(e.itemValid){const t=self.$dataItems[e.itemId];if(!self.$gameParty.hasItem(t))return!1}if(e.actorValid){const t=self.$gameActors.actor(e.actorId);if(!self.$gameParty.members().contains(t))return!1}return!0}setupPage(){this._pageIndex>=0?this.setupPageSettings():this.clearPageSettings(),this.refreshBushDepth(),this.clearStartingFlag(),this.checkEventTriggerAuto()}clearPageSettings(){this.setImage("",0),this._moveType=0,this._trigger=null,this._interpreter=null,this.setThrough(!0)}setupPageSettings(){const t=this.page(),e=t.image;e.tileId>0?this.setTileImage(e.tileId):this.setImage(e.characterName,e.characterIndex),this._originalDirection!==e.direction&&(this._originalDirection=e.direction,this._prelockDirection=0,this.setDirectionFix(!1),this.setDirection(e.direction)),this._originalPattern!==e.pattern&&(this._originalPattern=e.pattern,this.setPattern(e.pattern)),this.setMoveSpeed(t.moveSpeed),this.setMoveFrequency(t.moveFrequency),this.setPriorityType(t.priorityType),this.setWalkAnime(t.walkAnime),this.setStepAnime(t.stepAnime),this.setDirectionFix(t.directionFix),this.setThrough(t.through),this.setMoveRoute(t.moveRoute),this._moveType=t.moveType,this._trigger=t.trigger,4===this._trigger?this._interpreter=new Game_Interpreter:this._interpreter=null}isOriginalPattern(){return this.pattern()===this._originalPattern}resetPattern(){this.setPattern(this._originalPattern)}checkEventTriggerTouch(t,e){self.$gameMap.isEventRunning()||2===this._trigger&&self.$gamePlayer.pos(t,e)&&!this.isJumping()&&this.isNormalPriority()&&this.start()}checkEventTriggerAuto(){3===this._trigger&&this.start()}update(){super.update(),this.checkEventTriggerAuto(),this.updateParallel()}updateParallel(){this._interpreter&&(this._interpreter.isRunning()||(this._interpreter.setup(this.list(),this._eventId),this._interpreter.setEventInfo(this.getEventInfo())),this._interpreter.update())}locate(t,e){super.locate(t,e),this._prelockDirection=0}forceMoveRoute(t){super.forceMoveRoute(t),this._prelockDirection=0}getEventInfo(){return{eventType:"map_event",mapId:this._mapId,mapEventId:this._eventId,page:this._pageIndex+1}}}class Game_Map{constructor(...t){this.initialize(...t)}initialize(){this._interpreter=new Game_Interpreter,this._mapId=0,this._tilesetId=0,this._events=[],this._commonEvents=[],this._vehicles=[],this._displayX=0,this._displayY=0,this._nameDisplay=!0,this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4,this._parallaxName="",this._parallaxZero=!1,this._parallaxLoopX=!1,this._parallaxLoopY=!1,this._parallaxSx=0,this._parallaxSy=0,this._parallaxX=0,this._parallaxY=0,this._battleback1Name=null,this._battleback2Name=null,this.createVehicles()}setup(t){if(!self.$dataMap)throw new Error("The map data is not available");this._mapId=t,this._tilesetId=self.$dataMap.tilesetId,this._displayX=0,this._displayY=0,this.refereshVehicles(),this.setupEvents(),this.setupScroll(),this.setupParallax(),this.setupBattleback(),this._needsRefresh=!1}isEventRunning(){return this._interpreter.isRunning()||this.isAnyEventStarting()}tileWidth(){return 48}tileHeight(){return 48}mapId(){return this._mapId}tilesetId(){return this._tilesetId}displayX(){return this._displayX}displayY(){return this._displayY}parallaxName(){return this._parallaxName}battleback1Name(){return this._battleback1Name}battleback2Name(){return this._battleback2Name}requestRefresh(t){this._needsRefresh=!0}isNameDisplayEnabled(){return this._nameDisplay}disableNameDisplay(){this._nameDisplay=!1}enableNameDisplay(){this._nameDisplay=!0}createVehicles(){this._vehicles=[],this._vehicles[0]=new Game_Vehicle("boat"),this._vehicles[1]=new Game_Vehicle("ship"),this._vehicles[2]=new Game_Vehicle("airship")}refereshVehicles(){this._vehicles.forEach((t=>{t.refresh()}))}vehicles(){return this._vehicles}vehicle(t){return 0===t||"boat"===t?this.boat():1===t||"ship"===t?this.ship():2===t||"airship"===t?this.airship():null}boat(){return this._vehicles[0]}ship(){return this._vehicles[1]}airship(){return this._vehicles[2]}setupEvents(){this._events=[];for(let t=0;t<self.$dataMap.events.length;t++)self.$dataMap.events[t]&&(this._events[t]=new Game_Event(this._mapId,t));this._commonEvents=this.parallelCommonEvents().map((({id:t})=>new Game_CommonEvent(t))),this.refreshTileEvents()}events(){return this._events.filter((t=>!!t))}event(t){return this._events[t]}eraseEvent(t){this._events[t].erase()}parallelCommonEvents(){return self.$dataCommonEvents.filter((t=>t&&2===t.trigger))}setupScroll(){this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4}setupParallax(){this._parallaxName=self.$dataMap.parallaxName||"",this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName),this._parallaxLoopX=self.$dataMap.parallaxLoopX,this._parallaxLoopY=self.$dataMap.parallaxLoopY,this._parallaxSx=self.$dataMap.parallaxSx,this._parallaxSy=self.$dataMap.parallaxSy,this._parallaxX=0,this._parallaxY=0}setupBattleback(){self.$dataMap.specifyBattleback?(this._battleback1Name=self.$dataMap.battleback1Name,this._battleback2Name=self.$dataMap.battleback2Name):(this._battleback1Name=null,this._battleback2Name=null)}setDisplayPos(t,e){if(this.isLoopHorizontal())this._displayX=t.mod(this.width()),this._parallaxX=t;else{const e=this.width()-this.screenTileX();this._displayX=e<0?e/2:t.clamp(0,e),this._parallaxX=this._displayX}if(this.isLoopVertical())this._displayY=e.mod(this.height()),this._parallaxY=e;else{const t=this.height()-this.screenTileY();this._displayY=t<0?t/2:e.clamp(0,t),this._parallaxY=this._displayY}}parallaxOx(){return this._parallaxZero?this._parallaxX*this.tileWidth():this._parallaxLoopX?this._parallaxX*this.tileWidth()/2:0}parallaxOy(){return this._parallaxZero?this._parallaxY*this.tileHeight():this._parallaxLoopY?this._parallaxY*this.tileHeight()/2:0}tileset(){return self.$dataTilesets[this._tilesetId]}tilesetFlags(){const t=this.tileset();return t?t.flags:[]}displayName(){return self.$dataMap.displayName}width(){return self.$dataMap.width}height(){return self.$dataMap.height}data(){return self.$dataMap.data}isLoopHorizontal(){return 2===self.$dataMap.scrollType||3===self.$dataMap.scrollType}isLoopVertical(){return 1===self.$dataMap.scrollType||3===self.$dataMap.scrollType}isDashDisabled(){return self.$dataMap.disableDashing}encounterList(){return self.$dataMap.encounterList}encounterStep(){return self.$dataMap.encounterStep}isOverworld(){return this.tileset()&&0===this.tileset().mode}screenTileX(){return Graphics$1.width/this.tileWidth()}screenTileY(){return Graphics$1.height/this.tileHeight()}adjustX(t){return this.isLoopHorizontal()&&t<this._displayX-(this.width()-this.screenTileX())/2?t-this._displayX+self.$dataMap.width:t-this._displayX}adjustY(t){return this.isLoopVertical()&&t<this._displayY-(this.height()-this.screenTileY())/2?t-this._displayY+self.$dataMap.height:t-this._displayY}roundX(t){return this.isLoopHorizontal()?t.mod(this.width()):t}roundY(t){return this.isLoopVertical()?t.mod(this.height()):t}xWithDirection(t,e){return t+(6===e?1:4===e?-1:0)}yWithDirection(t,e){return t+(2===e?1:8===e?-1:0)}roundXWithDirection(t,e){return this.roundX(t+(6===e?1:4===e?-1:0))}roundYWithDirection(t,e){return this.roundY(t+(2===e?1:8===e?-1:0))}deltaX(t,e){let i=t-e;return this.isLoopHorizontal()&&Math.abs(i)>this.width()/2&&(i<0?i+=this.width():i-=this.width()),i}deltaY(t,e){let i=t-e;return this.isLoopVertical()&&Math.abs(i)>this.height()/2&&(i<0?i+=this.height():i-=this.height()),i}distance(t,e,i,s){return Math.abs(this.deltaX(t,i))+Math.abs(this.deltaY(e,s))}canvasToMapX(t){const e=this.tileWidth(),i=this._displayX*e,s=Math.floor((i+t)/e);return this.roundX(s)}canvasToMapY(t){const e=this.tileHeight(),i=this._displayY*e,s=Math.floor((i+t)/e);return this.roundY(s)}autoplay(){self.$dataMap.autoplayBgm&&(self.$gamePlayer.isInVehicle()?self.$gameSystem.saveWalkingBgm2():AudioManager.playBgm(self.$dataMap.bgm)),self.$dataMap.autoplayBgs&&AudioManager.playBgs(self.$dataMap.bgs)}refreshIfNeeded(){this._needsRefresh&&this.refresh()}refresh(){this.events().forEach((t=>{t.refresh()})),this._commonEvents.forEach((t=>{t.refresh()})),this.refreshTileEvents(),this._needsRefresh=!1}refreshTileEvents(){this.tileEvents=this.events().filter((t=>t.isTile()))}eventsXy(t,e){return this.events().filter((i=>i.pos(t,e)))}eventsXyNt(t,e){return this.events().filter((i=>i.posNt(t,e)))}tileEventsXy(t,e){return this.tileEvents.filter((i=>i.posNt(t,e)))}eventIdXy(t,e){const i=this.eventsXy(t,e);return 0===i.length?0:i[0].eventId()}scrollDown(t){if(this.isLoopVertical())this._displayY+=t,this._displayY%=self.$dataMap.height,this._parallaxLoopY&&(this._parallaxY+=t);else if(this.height()>=this.screenTileY()){const e=this._displayY;this._displayY=Math.min(this._displayY+t,this.height()-this.screenTileY()),this._parallaxY+=this._displayY-e}}scrollLeft(t){if(this.isLoopHorizontal())this._displayX+=self.$dataMap.width-t,this._displayX%=self.$dataMap.width,this._parallaxLoopX&&(this._parallaxX-=t);else if(this.width()>=this.screenTileX()){const e=this._displayX;this._displayX=Math.max(this._displayX-t,0),this._parallaxX+=this._displayX-e}}scrollRight(t){if(this.isLoopHorizontal())this._displayX+=t,this._displayX%=self.$dataMap.width,this._parallaxLoopX&&(this._parallaxX+=t);else if(this.width()>=this.screenTileX()){const e=this._displayX;this._displayX=Math.min(this._displayX+t,this.width()-this.screenTileX()),this._parallaxX+=this._displayX-e}}scrollUp(t){if(this.isLoopVertical())this._displayY+=self.$dataMap.height-t,this._displayY%=self.$dataMap.height,this._parallaxLoopY&&(this._parallaxY-=t);else if(this.height()>=this.screenTileY()){const e=this._displayY;this._displayY=Math.max(this._displayY-t,0),this._parallaxY+=this._displayY-e}}isValid(t,e){return t>=0&&t<this.width()&&e>=0&&e<this.height()}checkPassage(t,e,i){const s=this.tilesetFlags(),a=this.allTiles(t,e);for(let t=0;t<a.length;t++){const e=s[a[t]];if(0==(16&e)){if(0==(e&i))return!0;if((e&i)===i)return!1}}return!1}tileId(t,e,i){const s=self.$dataMap.width,a=self.$dataMap.height;return self.$dataMap.data[(i*a+e)*s+t]||0}layeredTiles(t,e){const i=[];for(let s=0;s<4;s++)i.push(this.tileId(t,e,3-s));return i}allTiles(t,e){return this.tileEventsXy(t,e).map((t=>t.tileId())).concat(this.layeredTiles(t,e))}autotileType(t,e,i){const s=this.tileId(t,e,i);return s>=2048?Math.floor((s-2048)/48):-1}isPassable(t,e,i){return this.checkPassage(t,e,1<<i/2-1&15)}isBoatPassable(t,e){return this.checkPassage(t,e,512)}isShipPassable(t,e){return this.checkPassage(t,e,1024)}isAirshipLandOk(t,e){return this.checkPassage(t,e,2048)&&this.checkPassage(t,e,15)}checkLayeredTilesFlags(t,e,i){const s=this.tilesetFlags();return this.layeredTiles(t,e).some((t=>0!=(s[t]&i)))}isLadder(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,32)}isBush(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,64)}isCounter(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,128)}isDamageFloor(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,256)}terrainTag(t,e){if(this.isValid(t,e)){const i=this.tilesetFlags(),s=this.layeredTiles(t,e);for(let t=0;t<s.length;t++){const e=i[s[t]]>>12;if(e>0)return e}}return 0}regionId(t,e){return this.isValid(t,e)?this.tileId(t,e,5):0}startScroll(t,e,i){this._scrollDirection=t,this._scrollRest=e,this._scrollSpeed=i}isScrolling(){return this._scrollRest>0}update(t){this.refreshIfNeeded(),t&&this.updateInterpreter(),this.updateScroll(),this.updateEvents(),this.updateVehicles(),this.updateParallax()}updateScroll(){if(this.isScrolling()){const t=this._displayX,e=this._displayY;this.doScroll(this._scrollDirection,this.scrollDistance()),this._displayX===t&&this._displayY===e?this._scrollRest=0:this._scrollRest-=this.scrollDistance()}}scrollDistance(){return Math.pow(2,this._scrollSpeed)/256}doScroll(t,e){switch(t){case 2:this.scrollDown(e);break;case 4:this.scrollLeft(e);break;case 6:this.scrollRight(e);break;case 8:this.scrollUp(e)}}updateEvents(){this.events().forEach((t=>{t.update()})),this._commonEvents.forEach((t=>{t.update()}))}updateVehicles(){this._vehicles.forEach((t=>{t.update()}))}updateParallax(){this._parallaxLoopX&&(this._parallaxX+=this._parallaxSx/this.tileWidth()/2),this._parallaxLoopY&&(this._parallaxY+=this._parallaxSy/this.tileHeight()/2)}changeTileset(t){this._tilesetId=t,this.refresh()}changeBattleback(t,e){this._battleback1Name=t,this._battleback2Name=e}changeParallax(t,e,i,s,a){this._parallaxName=t,this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName),this._parallaxLoopX&&!e&&(this._parallaxX=0),this._parallaxLoopY&&!i&&(this._parallaxY=0),this._parallaxLoopX=e,this._parallaxLoopY=i,this._parallaxSx=s,this._parallaxSy=a}updateInterpreter(){for(;;){if(this._interpreter.update(),this._interpreter.isRunning())return;if(this._interpreter.eventId()>0&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear()),!this.setupStartingEvent())return}}unlockEvent(t){this._events[t]&&this._events[t].unlock()}setupStartingEvent(){return this.refreshIfNeeded(),!!(this._interpreter.setupReservedCommonEvent()||this.setupTestEvent()||this.setupStartingMapEvent()||this.setupAutorunCommonEvent())}setupTestEvent(){return!!self.$testEvent&&(this._interpreter.setup(self.$testEvent,0),this._interpreter.setEventInfo({eventType:"test_event"}),self.$testEvent=null,!0)}setupStartingMapEvent(){const t=this.events();for(const e of t)if(e.isStarting())return e.clearStartingFlag(),this._interpreter.setup(e.list(),e.eventId()),this._interpreter.setEventInfo(e.getEventInfo()),!0;return!1}setupAutorunCommonEvent(){for(let t=0;t<self.$dataCommonEvents.length;t++){const e=self.$dataCommonEvents[t];if(e&&1===e.trigger&&self.$gameSwitches.value(e.switchId))return this._interpreter.setup(e.list),this._interpreter.setEventInfo({eventType:"common_event",commonEventId:t}),!0}return!1}isAnyEventStarting(){return this.events().some((t=>t.isStarting()))}}class Game_Follower extends Game_Character{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this._memberIndex=t,this.setTransparent(self.$dataSystem.optTransparent),this.setThrough(!0)}refresh(){const t=this.isVisible()?this.actor().characterName():"",e=this.isVisible()?this.actor().characterIndex():0;this.setImage(t,e)}actor(){return self.$gameParty.battleMembers()[this._memberIndex]}isVisible(){return this.actor()&&self.$gamePlayer.followers().isVisible()}update(){super.update(),this.setMoveSpeed(self.$gamePlayer.realMoveSpeed()),this.setOpacity(self.$gamePlayer.opacity()),this.setBlendMode(self.$gamePlayer.blendMode()),this.setWalkAnime(self.$gamePlayer.hasWalkAnime()),this.setStepAnime(self.$gamePlayer.hasStepAnime()),this.setDirectionFix(self.$gamePlayer.isDirectionFixed()),this.setTransparent(self.$gamePlayer.isTransparent())}chaseCharacter({x:t,y:e}){const i=this.deltaXFrom(t),s=this.deltaYFrom(e);0!==i&&0!==s?this.moveDiagonally(i>0?4:6,s>0?8:2):0!==i?this.moveStraight(i>0?4:6):0!==s&&this.moveStraight(s>0?8:2),this.setMoveSpeed(self.$gamePlayer.realMoveSpeed())}}class Game_Followers{constructor(...t){this.initialize(...t)}initialize(){this._visible=self.$dataSystem.optFollowers,this._gathering=!1,this._data=[];for(let t=1;t<self.$gameParty.maxBattleMembers();t++)this._data.push(new Game_Follower(t))}isVisible(){return this._visible}show(){this._visible=!0}hide(){this._visible=!1}follower(t){return this._data[t]}forEach(t,e){this._data.forEach(t,e)}reverseEach(t,e){this._data.reverse(),this._data.forEach(t,e),this._data.reverse()}refresh(){this.forEach((t=>t.refresh()),this)}update(){this.areGathering()&&(this.areMoving()||this.updateMove(),this.areGathered()&&(this._gathering=!1)),this.forEach((t=>{t.update()}),this)}updateMove(){for(let t=this._data.length-1;t>=0;t--){const e=t>0?this._data[t-1]:self.$gamePlayer;this._data[t].chaseCharacter(e)}}jumpAll(){if(self.$gamePlayer.isJumping())for(const t of this._data){const e=self.$gamePlayer.deltaXFrom(t.x),i=self.$gamePlayer.deltaYFrom(t.y);t.jump(e,i)}}synchronize(t,e,i){this.forEach((s=>{s.locate(t,e),s.setDirection(i)}),this)}gather(){this._gathering=!0}areGathering(){return this._gathering}visibleFollowers(){return this._data.filter((t=>t.isVisible()),this)}areMoving(){return this.visibleFollowers().some((t=>t.isMoving()),this)}areGathered(){return this.visibleFollowers().every((t=>!t.isMoving()&&t.pos(self.$gamePlayer.x,self.$gamePlayer.y)),this)}isSomeoneCollided(t,e){return this.visibleFollowers().some((i=>i.pos(t,e)),this)}}class Game_Player extends Game_Character{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.setTransparent(self.$dataSystem.optTransparent)}initMembers(){super.initMembers(),this._vehicleType="walk",this._vehicleGettingOn=!1,this._vehicleGettingOff=!1,this._dashing=!1,this._needsMapReload=!1,this._transferring=!1,this._newMapId=0,this._newX=0,this._newY=0,this._newDirection=0,this._fadeType=0,this._followers=new Game_Followers,this._encounterCount=0}clearTransferInfo(){this._transferring=!1,this._newMapId=0,this._newX=0,this._newY=0,this._newDirection=0}followers(){return this._followers}refresh(){const t=self.$gameParty.leader(),e=t?t.characterName():"",i=t?t.characterIndex():0;this.setImage(e,i),this._followers.refresh()}isStopping(){return!this._vehicleGettingOn&&!this._vehicleGettingOff&&Game_Character.prototype.isStopping.call(this)}reserveTransfer(t,e,i,s,a){this._transferring=!0,this._newMapId=t,this._newX=e,this._newY=i,this._newDirection=s,this._fadeType=a}requestMapReload(){this._needsMapReload=!0}isTransferring(){return this._transferring}newMapId(){return this._newMapId}fadeType(){return this._fadeType}performTransfer(){this.isTransferring()&&(this.setDirection(this._newDirection),(this._newMapId!==self.$gameMap.mapId()||this._needsMapReload)&&(self.$gameMap.setup(this._newMapId),this._needsMapReload=!1),this.locate(this._newX,this._newY),this.refresh(),DataManager.autoSaveGame(),this.clearTransferInfo())}isMapPassable(t,e,i){const s=this.vehicle();return s?s.isMapPassable(t,e,i):Game_Character.prototype.isMapPassable.call(this,t,e,i)}vehicle(){return self.$gameMap.vehicle(this._vehicleType)}isInBoat(){return"boat"===this._vehicleType}isInShip(){return"ship"===this._vehicleType}isInAirship(){return"airship"===this._vehicleType}isInVehicle(){return this.isInBoat()||this.isInShip()||this.isInAirship()}isNormal(){return"walk"===this._vehicleType&&!this.isMoveRouteForcing()}isDashing(){return this._dashing}isDebugThrough(){return Input.isPressed("control")&&self.$gameTemp.isPlaytest()}isCollided(t,e){return!this.isThrough()&&(this.pos(t,e)||this._followers.isSomeoneCollided(t,e))}centerX(){return(Graphics$1.width/self.$gameMap.tileWidth()-1)/2}centerY(){return(Graphics$1.height/self.$gameMap.tileHeight()-1)/2}center(t,e){return self.$gameMap.setDisplayPos(t-this.centerX(),e-this.centerY())}locate(t,e){super.locate(t,e),this.center(t,e),this.makeEncounterCount(),this.isInVehicle()&&this.vehicle().refresh(),this._followers.synchronize(t,e,this.direction())}increaseSteps(){super.increaseSteps(),this.isNormal()&&self.$gameParty.increaseSteps()}makeEncounterCount(){const t=self.$gameMap.encounterStep();this._encounterCount=Math.randomInt(t)+Math.randomInt(t)+1}makeEncounterTroopId(){const t=[];let e=0;if(self.$gameMap.encounterList().forEach((function(i){this.meetsEncounterConditions(i)&&(t.push(i),e+=i.weight)}),this),e>0){let i=Math.randomInt(e);for(let e=0;e<t.length;e++)if(i-=t[e].weight,i<0)return t[e].troopId}return 0}meetsEncounterConditions({regionSet:t}){return 0===t.length||t.contains(this.regionId())}executeEncounter(){if(!self.$gameMap.isEventRunning()&&this._encounterCount<=0){this.makeEncounterCount();const t=this.makeEncounterTroopId();return!!self.$dataTroops[t]&&(BattleManager.setup(t,!0,!1),BattleManager.onEncounter(),!0)}return!1}startMapEvent(t,e,i,s){self.$gameMap.isEventRunning()||self.$gameMap.eventsXy(t,e).forEach((t=>{t.isTriggerIn(i)&&t.isNormalPriority()===s&&t.start()}))}moveByInput(){if(!this.isMoving()&&this.canMove()){let t=this.getInputDirection();if(t>0)self.$gameTemp.clearDestination();else if(self.$gameTemp.isDestinationValid()){const e=self.$gameTemp.destinationX(),i=self.$gameTemp.destinationY();t=this.findDirectionTo(e,i)}t>0&&this.executeMove(t)}}canMove(){return!(self.$gameMap.isEventRunning()||self.$gameMessage.isBusy()||this.isMoveRouteForcing()||this.areFollowersGathering()||this._vehicleGettingOn||this._vehicleGettingOff||this.isInVehicle()&&!this.vehicle().canMove())}getInputDirection(){return Input.dir4}executeMove(t){this.moveStraight(t)}update(t){const e=this.scrolledX(),i=this.scrolledY(),s=this.isMoving();this.updateDashing(),t&&this.moveByInput(),super.update(),this.updateScroll(e,i),this.updateVehicle(),this.isMoving()||this.updateNonmoving(s),this._followers.update()}updateDashing(){this.isMoving()||(!this.canMove()||this.isInVehicle()||self.$gameMap.isDashDisabled()?this._dashing=!1:this._dashing=this.isDashButtonPressed()||self.$gameTemp.isDestinationValid())}isDashButtonPressed(){const t=Input.isPressed("shift");return ConfigManager.alwaysDash?!t:t}updateScroll(t,e){const i=t,s=e,a=this.scrolledX(),r=this.scrolledY();r>s&&r>this.centerY()&&self.$gameMap.scrollDown(r-s),a<i&&a<this.centerX()&&self.$gameMap.scrollLeft(i-a),a>i&&a>this.centerX()&&self.$gameMap.scrollRight(a-i),r<s&&r<this.centerY()&&self.$gameMap.scrollUp(s-r)}updateVehicle(){this.isInVehicle()&&!this.areFollowersGathering()&&(this._vehicleGettingOn?this.updateVehicleGetOn():this._vehicleGettingOff?this.updateVehicleGetOff():this.vehicle().syncWithPlayer())}updateVehicleGetOn(){this.areFollowersGathering()||this.isMoving()||(this.setDirection(this.vehicle().direction()),this.setMoveSpeed(this.vehicle().moveSpeed()),this._vehicleGettingOn=!1,this.setTransparent(!0),this.isInAirship()&&this.setThrough(!0),this.vehicle().getOn())}updateVehicleGetOff(){!this.areFollowersGathering()&&this.vehicle().isLowest()&&(this._vehicleGettingOff=!1,this._vehicleType="walk",this.setTransparent(!1))}updateNonmoving(t){if(!self.$gameMap.isEventRunning()){if(t&&(self.$gameParty.onPlayerWalk(),this.checkEventTriggerHere([1,2]),self.$gameMap.setupStartingEvent()))return;if(this.triggerAction())return;t?this.updateEncounterCount():self.$gameTemp.clearDestination()}}triggerAction(){if(this.canMove()){if(this.triggerButtonAction())return!0;if(this.triggerTouchAction())return!0}return!1}triggerButtonAction(){if(Input.isTriggered("ok")){if(this.getOnOffVehicle())return!0;if(this.checkEventTriggerHere([0]),self.$gameMap.setupStartingEvent())return!0;if(this.checkEventTriggerThere([0,1,2]),self.$gameMap.setupStartingEvent())return!0}return!1}triggerTouchAction(){if(self.$gameTemp.isDestinationValid()){const t=this.direction(),e=this.x,i=this.y,s=self.$gameMap.roundXWithDirection(e,t),a=self.$gameMap.roundYWithDirection(i,t),r=self.$gameMap.roundXWithDirection(s,t),n=self.$gameMap.roundYWithDirection(a,t),h=self.$gameTemp.destinationX(),o=self.$gameTemp.destinationY();if(h===e&&o===i)return this.triggerTouchActionD1(e,i);if(h===s&&o===a)return this.triggerTouchActionD2(s,a);if(h===r&&o===n)return this.triggerTouchActionD3(s,a)}return!1}triggerTouchActionD1(t,e){return!!(self.$gameMap.airship().pos(t,e)&&TouchInput.isTriggered()&&this.getOnOffVehicle())||(this.checkEventTriggerHere([0]),self.$gameMap.setupStartingEvent())}triggerTouchActionD2(t,e){return!(!self.$gameMap.boat().pos(t,e)&&!self.$gameMap.ship().pos(t,e)||!TouchInput.isTriggered()||!this.getOnVehicle())||!(!this.isInBoat()&&!this.isInShip()||!TouchInput.isTriggered()||!this.getOffVehicle())||(this.checkEventTriggerThere([0,1,2]),self.$gameMap.setupStartingEvent())}triggerTouchActionD3(t,e){return self.$gameMap.isCounter(t,e)&&this.checkEventTriggerThere([0,1,2]),self.$gameMap.setupStartingEvent()}updateEncounterCount(){this.canEncounter()&&(this._encounterCount-=this.encounterProgressValue())}canEncounter(){return!self.$gameParty.hasEncounterNone()&&self.$gameSystem.isEncounterEnabled()&&!this.isInAirship()&&!this.isMoveRouteForcing()&&!this.isDebugThrough()}encounterProgressValue(){let t=self.$gameMap.isBush(this.x,this.y)?2:1;return self.$gameParty.hasEncounterHalf()&&(t*=.5),this.isInShip()&&(t*=.5),t}checkEventTriggerHere(t){this.canStartLocalEvents()&&this.startMapEvent(this.x,this.y,t,!1)}checkEventTriggerThere(t){if(this.canStartLocalEvents()){const e=this.direction(),i=this.x,s=this.y,a=self.$gameMap.roundXWithDirection(i,e),r=self.$gameMap.roundYWithDirection(s,e);if(this.startMapEvent(a,r,t,!0),!self.$gameMap.isAnyEventStarting()&&self.$gameMap.isCounter(a,r)){const i=self.$gameMap.roundXWithDirection(a,e),s=self.$gameMap.roundYWithDirection(r,e);this.startMapEvent(i,s,t,!0)}}}checkEventTriggerTouch(t,e){this.canStartLocalEvents()&&this.startMapEvent(t,e,[1,2],!0)}canStartLocalEvents(){return!this.isInAirship()}getOnOffVehicle(){return this.isInVehicle()?this.getOffVehicle():this.getOnVehicle()}getOnVehicle(){const t=this.direction(),e=this.x,i=this.y,s=self.$gameMap.roundXWithDirection(e,t),a=self.$gameMap.roundYWithDirection(i,t);return self.$gameMap.airship().pos(e,i)?this._vehicleType="airship":self.$gameMap.ship().pos(s,a)?this._vehicleType="ship":self.$gameMap.boat().pos(s,a)&&(this._vehicleType="boat"),this.isInVehicle()&&(this._vehicleGettingOn=!0,this.isInAirship()||this.forceMoveForward(),this.gatherFollowers()),this._vehicleGettingOn}getOffVehicle(){return this.vehicle().isLandOk(this.x,this.y,this.direction())&&(this.isInAirship()&&this.setDirection(2),this._followers.synchronize(this.x,this.y,this.direction()),this.vehicle().getOff(),this.isInAirship()||(this.forceMoveForward(),this.setTransparent(!1)),this._vehicleGettingOff=!0,this.setMoveSpeed(4),this.setThrough(!1),this.makeEncounterCount(),this.gatherFollowers()),this._vehicleGettingOff}forceMoveForward(){this.setThrough(!0),this.moveForward(),this.setThrough(!1)}isOnDamageFloor(){return self.$gameMap.isDamageFloor(this.x,this.y)&&!this.isInAirship()}moveStraight(t){this.canPass(this.x,this.y,t)&&this._followers.updateMove(),super.moveStraight(t)}moveDiagonally(t,e){this.canPassDiagonally(this.x,this.y,t,e)&&this._followers.updateMove(),super.moveDiagonally(t,e)}jump(t,e){super.jump(t,e),this._followers.jumpAll()}showFollowers(){this._followers.show()}hideFollowers(){this._followers.hide()}gatherFollowers(){this._followers.gather()}areFollowersGathering(){return this._followers.areGathering()}areFollowersGathered(){return this._followers.areGathered()}}class DataManager{constructor(){throw new Error("This is a static class")}static loadDatabase(){const t=this.isBattleTest()||this.isEventTest()?"Test_":"";for(let e=0;e<this._databaseFiles.length;e++){const i=this._databaseFiles[e].name,s=this._databaseFiles[e].src;this.loadDataFile(i,t+s)}this.isEventTest()&&this.loadDataFile("$testEvent",`${t}Event.json`)}static loadDataFile(t,e){const i=new XMLHttpRequest,s=`data/${e}`;i.open("GET",s),i.overrideMimeType("application/json"),i.onload=()=>{i.status<400&&(window[t]=JSON.parse(i.responseText),DataManager.onLoad(window[t]))},i.onerror=this._mapLoader||(()=>{DataManager._errorUrl=DataManager._errorUrl||s}),window[t]=null,i.send()}static isDatabaseLoaded(){this.checkError();for(let t=0;t<this._databaseFiles.length;t++)if(!window[this._databaseFiles[t].name])return!1;return!0}static loadMapData(t){if(t>0){const e="Map%1.json".format(t.padZero(3));this._mapLoader=ResourceHandler.createLoader(`data/${e}`,this.loadDataFile.bind(this,"$dataMap",e)),this.loadDataFile("$dataMap",e)}else this.makeEmptyMap()}static isMapLoaded(){return this.checkError(),!!self.$dataMap}static onLoad(t){let e;if(t===self.$dataMap?(this.extractMetadata(t),e=t.events):e=t,Array.isArray(e))for(const t of e)t&&void 0!==t.note&&this.extractMetadata(t);t===self.$dataSystem&&(Decrypter.hasEncryptedImages=!!t.hasEncryptedImages,Decrypter.hasEncryptedAudio=!!t.hasEncryptedAudio,Scene_Boot.loadSystemImages())}static setupNewGame(){this.createGameObjects(),this.selectSavefileForNewGame(),self.$gameParty.setupStartingMembers(),self.$gamePlayer.reserveTransfer(self.$dataSystem.startMapId,self.$dataSystem.startX,self.$dataSystem.startY),Graphics$1.frameCount=0,SceneManager.resetFrameCount()}static setupBattleTest(){this.createGameObjects(),self.$gameParty.setupBattleTest(),BattleManager.setup(self.$dataSystem.testTroopId,!0,!1),BattleManager.setBattleTest(!0),BattleManager.playBattleBgm()}static setupEventTest(){this.createGameObjects(),this.selectSavefileForNewGame(),self.$gameParty.setupStartingMembers(),self.$gamePlayer.reserveTransfer(-1,8,6),self.$gamePlayer.setTransparent(!1)}static loadGlobalInfo(){if(this._globalInfo)return this._globalInfo;let t;try{t=StorageManager.load(0)}catch(t){return[]}if(t){this._globalInfo=JSON.parse(t);for(let t=1;t<=this.maxSavefiles();t++)StorageManager.exists(t)||delete this._globalInfo[t];return this._globalInfo}return this._globalInfo=[],this._globalInfo}static saveGlobalInfo(t){this._globalInfo=null,StorageManager.save(0,JSON.stringify(t))}static isThisGameFile(t){const e=this.loadGlobalInfo();if(e&&e[t]){if(StorageManager.isLocalMode())return!0;{const i=e[t];return i.globalId===this._globalId&&i.title===self.$dataSystem.gameTitle}}return!1}static isAnySavefileExists(){const t=this.loadGlobalInfo();if(t)for(let e=1;e<t.length;e++)if(this.isThisGameFile(e))return!0;return!1}static latestSavefileId(){const t=this.loadGlobalInfo();let e=1,i=0;if(t)for(let s=1;s<t.length;s++)this.isThisGameFile(s)&&t[s].timestamp>i&&(i=t[s].timestamp,e=s);return e}static loadAllSavefileImages(){const t=this.loadGlobalInfo();if(t)for(let e=1;e<t.length;e++)if(this.isThisGameFile(e)){const i=t[e];this.loadSavefileImages(i)}}static saveGame(t){try{return StorageManager.backup(t),this.saveGameWithoutRescue(t)}catch(e){try{StorageManager.remove(t),StorageManager.restoreBackup(t)}catch(t){}return!1}}static loadGame(t){try{return this.loadGameWithoutRescue(t)}catch(t){return!1}}static loadSavefileInfo(t){const e=this.loadGlobalInfo();return e&&e[t]?e[t]:null}static lastAccessedSavefileId(){return this._lastAccessedId}static saveGameWithoutRescue(t){const e=JsonEx.stringify(this.makeSaveContents());e.length,StorageManager.save(t,e),this._lastAccessedId=t;const i=this.loadGlobalInfo()||[];return i[t]=this.makeSavefileInfo(),this.saveGlobalInfo(i),!0}static loadGameWithoutRescue(t){if(this.isThisGameFile(t)){const e=StorageManager.load(t);return this.createGameObjects(),this.extractSaveContents(JsonEx.parse(e)),this._lastAccessedId=t,!0}return!1}static selectSavefileForNewGame(){const t=this.loadGlobalInfo();if(this._lastAccessedId=1,t){const e=Math.max(0,t.length-1);if(e<this.maxSavefiles())this._lastAccessedId=e+1;else{let e=Number.MAX_VALUE;for(let i=1;i<t.length;i++){if(!t[i]){this._lastAccessedId=i;break}t[i].timestamp<e&&(e=t[i].timestamp,this._lastAccessedId=i)}}}}static makeSavefileInfo(){const t={};return t.globalId=this._globalId,t.title=self.$dataSystem.gameTitle,t.characters=self.$gameParty.charactersForSavefile(),t.faces=self.$gameParty.facesForSavefile(),t.playtime=self.$gameSystem.playtimeText(),t.timestamp=Date.now(),t}static setAutoSaveFileId(t){this._autoSaveFileId=t}static isAutoSaveFileId(t){return 0!==this._autoSaveFileId&&this._autoSaveFileId===t}static autoSaveGame(){0!==this._autoSaveFileId&&!this.isEventTest()&&self.$gameSystem.isSaveEnabled()&&(self.$gameSystem.onBeforeSave(),this.saveGame(this._autoSaveFileId)&&StorageManager.cleanBackup(this._autoSaveFileId))}static makeEmptyMap(){self.$dataMap={},self.$dataMap.data=[],self.$dataMap.events=[],self.$dataMap.width=100,self.$dataMap.height=100,self.$dataMap.scrollType=3}static extractMetadata(t){const e=/<([^<>:]+)(:?)([^>]*)>/g;for(t.meta={};;){const i=e.exec(t.note);if(!i)break;":"===i[2]?t.meta[i[1]]=i[3]:t.meta[i[1]]=!0}}static checkError(){if(DataManager._errorUrl)throw new Error(`Failed to load: ${DataManager._errorUrl}`)}static isBattleTest(){return Utils.isOptionValid("btest")}static isEventTest(){return Utils.isOptionValid("etest")}static isSkill(t){return t&&self.$dataSkills.contains(t)}static isItem(t){return t&&self.$dataItems.contains(t)}static isWeapon(t){return t&&self.$dataWeapons.contains(t)}static isArmor(t){return t&&self.$dataArmors.contains(t)}static createGameObjects(){self.$gameTemp=new Game_Temp,self.$gameSystem=new Game_System,self.$gameScreen=new Game_Screen,self.$gameTimer=new Game_Timer,self.$gameMessage=new Game_Message,self.$gameSwitches=new Game_Switches,self.$gameVariables=new Game_Variables,self.$gameSelfSwitches=new Game_SelfSwitches,self.$gameActors=new Game_Actors,self.$gameParty=new Game_Party,self.$gameTroop=new Game_Troop,self.$gameMap=new Game_Map,self.$gamePlayer=new Game_Player}static loadSavefileImages({characters:t,faces:e}){if(t)for(let e=0;e<t.length;e++)ImageManager.reserveCharacter(t[e][0]);if(e)for(let t=0;t<e.length;t++)ImageManager.reserveFace(e[t][0])}static maxSavefiles(){return this._maxSavefiles}static makeSaveContents(){const t={};return t.system=self.$gameSystem,t.screen=self.$gameScreen,t.timer=self.$gameTimer,t.switches=self.$gameSwitches,t.variables=self.$gameVariables,t.selfSwitches=self.$gameSelfSwitches,t.actors=self.$gameActors,t.party=self.$gameParty,t.map=self.$gameMap,t.player=self.$gamePlayer,t}static extractSaveContents(t){self.$gameSystem=t.system,self.$gameScreen=t.screen,self.$gameTimer=t.timer,self.$gameSwitches=t.switches,self.$gameVariables=t.variables,self.$gameSelfSwitches=t.selfSwitches,self.$gameActors=t.actors,self.$gameParty=t.party,self.$gameMap=t.map,self.$gamePlayer=t.player}}DataManager._globalId="RPGMV",DataManager._lastAccessedId=1,DataManager._errorUrl=null,DataManager._autoSaveFileId=0,DataManager._maxSavefiles=20,DataManager._databaseFiles=[{name:"$dataActors",src:"Actors.json"},{name:"$dataClasses",src:"Classes.json"},{name:"$dataSkills",src:"Skills.json"},{name:"$dataItems",src:"Items.json"},{name:"$dataWeapons",src:"Weapons.json"},{name:"$dataArmors",src:"Armors.json"},{name:"$dataEnemies",src:"Enemies.json"},{name:"$dataTroops",src:"Troops.json"},{name:"$dataStates",src:"States.json"},{name:"$dataAnimations",src:"Animations.json"},{name:"$dataTilesets",src:"Tilesets.json"},{name:"$dataCommonEvents",src:"CommonEvents.json"},{name:"$dataSystem",src:"System.json"},{name:"$dataMapInfos",src:"MapInfos.json"}];let $dataActors=null,$dataClasses=null,$dataSkills=null,$dataItems=null,$dataWeapons=null,$dataArmors=null,$dataEnemies=null,$dataTroops=null,$dataStates=null,$dataAnimations=null,$dataTilesets=null,$dataCommonEvents=null,$dataSystem=null,$dataMapInfos=null,$dataMap=null,$gameTemp=null,$gameSystem=null,$gameScreen=null,$gameTimer=null,$gameMessage=null,$gameSwitches=null,$gameVariables=null,$gameSelfSwitches=null,$gameActors=null,$gameParty=null,$gameTroop=null,$gameMap=null,$gamePlayer=null,$testEvent=null;((t,e,i)=>{t.$dataActors=$dataActors,t.$dataClasses=$dataClasses,t.$dataSkills=$dataSkills,t.$dataItems=$dataItems,t.$dataWeapons=$dataWeapons,t.$dataArmors=$dataArmors,t.$dataEnemies=$dataEnemies,t.$dataTroops=$dataTroops,t.$dataStates=$dataStates,t.$dataAnimations=$dataAnimations,t.$dataTilesets=$dataTilesets,t.$dataCommonEvents=$dataCommonEvents,t.$dataSystem=$dataSystem,t.$dataMapInfos=$dataMapInfos,t.$dataMap=$dataMap,t.$gameTemp=$gameTemp,t.$gameSystem=$gameSystem,t.$gameScreen=$gameScreen,t.$gameTimer=$gameTimer,t.$gameMessage=$gameMessage,t.$gameSwitches=$gameSwitches,t.$gameVariables=$gameVariables,t.$gameSelfSwitches=$gameSelfSwitches,t.$gameActors=$gameActors,t.$gameParty=$gameParty,t.$gameTroop=$gameTroop,t.$gameMap=$gameMap,t.$gamePlayer=$gamePlayer,t.$testEvent=$testEvent,t.Game_Temp=Game_Temp,t.Game_System=Game_System,t.Game_Timer=Game_Timer,t.Game_Message=Game_Message,t.Game_Switches=Game_Switches,t.Game_Variables=Game_Variables,t.Game_SelfSwitches=Game_SelfSwitches,t.Game_Screen=Game_Screen,t.Game_Picture=Game_Picture,t.Game_Item=Game_Item,t.Game_Action=Game_Action,t.Game_ActionResult=Game_ActionResult,t.Game_BattlerBase=Game_BattlerBase,t.Game_Battler=Game_Battler,t.Game_Actor=Game_Actor,t.Game_Enemy=Game_Enemy,t.Game_Actors=Game_Actors,t.Game_Unit=Game_Unit,t.Game_Party=Game_Party,t.Game_Troop=Game_Troop,t.Game_Map=Game_Map,t.Game_CommonEvent=Game_CommonEvent,t.Game_CharacterBase=Game_CharacterBase,t.Game_Character=Game_Character,t.Game_Player=Game_Player,t.Game_Follower=Game_Follower,t.Game_Followers=Game_Followers,t.Game_Vehicle=Game_Vehicle,t.Game_Event=Game_Event,t.Game_Interpreter=Game_Interpreter,t.Scene_Base=Scene_Base,t.Scene_Boot=Scene_Boot,t.Scene_Title=Scene_Title,t.Scene_Map=Scene_Map,t.Scene_MenuBase=Scene_MenuBase,t.Scene_Menu=Scene_Menu,t.Scene_ItemBase=Scene_ItemBase,t.Scene_Item=Scene_Item,t.Scene_Skill=Scene_Skill,t.Scene_Equip=Scene_Equip,t.Scene_Status=Scene_Status,t.Scene_Options=Scene_Options,t.Scene_File=Scene_File,t.Scene_Save=Scene_Save,t.Scene_Load=Scene_Load,t.Scene_GameEnd=Scene_GameEnd,t.Scene_Shop=Scene_Shop,t.Scene_Name=Scene_Name,t.Scene_Debug=Scene_Debug,t.Scene_Battle=Scene_Battle,t.Scene_Gameover=Scene_Gameover,t.Sprite_Base=Sprite_Base,t.Sprite_Button=Sprite_Button,t.Sprite_Character=Sprite_Character,t.Sprite_Battler=Sprite_Battler,t.Sprite_Actor=Sprite_Actor,t.Sprite_Enemy=Sprite_Enemy,t.Sprite_Animation=Sprite_Animation,t.Sprite_Damage=Sprite_Damage,t.Sprite_StateIcon=Sprite_StateIcon,t.Sprite_StateOverlay=Sprite_StateOverlay,t.Sprite_Weapon=Sprite_Weapon,t.Sprite_Balloon=Sprite_Balloon,t.Sprite_Picture=Sprite_Picture,t.Sprite_Timer=Sprite_Timer,t.Sprite_Destination=Sprite_Destination,t.Spriteset_Base=Spriteset_Base,t.Spriteset_Map=Spriteset_Map,t.Spriteset_Battle=Spriteset_Battle,t.Window_Base=Window_Base,t.Window_Selectable=Window_Selectable,t.Window_Command=Window_Command,t.Window_HorzCommand=Window_HorzCommand,t.Window_Help=Window_Help,t.Window_Gold=Window_Gold,t.Window_MenuCommand=Window_MenuCommand,t.Window_MenuStatus=Window_MenuStatus,t.Window_MenuActor=Window_MenuActor,t.Window_ItemCategory=Window_ItemCategory,t.Window_ItemList=Window_ItemList,t.Window_SkillType=Window_SkillType,t.Window_SkillStatus=Window_SkillStatus,t.Window_SkillList=Window_SkillList,t.Window_EquipStatus=Window_EquipStatus,t.Window_EquipCommand=Window_EquipCommand,t.Window_EquipSlot=Window_EquipSlot,t.Window_EquipItem=Window_EquipItem,t.Window_Status=Window_Status,t.Window_Options=Window_Options,t.Window_SavefileList=Window_SavefileList,t.Window_ShopCommand=Window_ShopCommand,t.Window_ShopBuy=Window_ShopBuy,t.Window_ShopSell=Window_ShopSell,t.Window_ShopNumber=Window_ShopNumber,t.Window_ShopStatus=Window_ShopStatus,t.Window_NameEdit=Window_NameEdit,t.Window_NameInput=Window_NameInput,t.Window_ChoiceList=Window_ChoiceList,t.Window_NumberInput=Window_NumberInput,t.Window_EventItem=Window_EventItem,t.Window_Message=Window_Message,t.Window_ScrollText=Window_ScrollText,t.Window_MapName=Window_MapName,t.Window_BattleLog=Window_BattleLog,t.Window_PartyCommand=Window_PartyCommand,t.Window_ActorCommand=Window_ActorCommand,t.Window_BattleStatus=Window_BattleStatus,t.Window_BattleActor=Window_BattleActor,t.Window_BattleEnemy=Window_BattleEnemy,t.Window_BattleSkill=Window_BattleSkill,t.Window_BattleItem=Window_BattleItem,t.Window_TitleCommand=Window_TitleCommand,t.Window_GameEnd=Window_GameEnd,t.Window_DebugRange=Window_DebugRange,t.Window_DebugEdit=Window_DebugEdit,t.ProgressWatcher=ProgressWatcher$1,t.Utils=Utils,t.CacheEntry=CacheEntry,t.CacheMap=CacheMap,t.ImageCache=ImageCache,t.RequestQueue=RequestQueue,t.Point=Point,t.Rectangle=Rectangle,t.Bitmap=Bitmap,t.BitmapPIXI=BitmapPIXI,t.Graphics=Graphics$1,t.Input=Input,t.TouchInput=TouchInput,t.Sprite=Sprite,t.Tilemap=Tilemap,t.ShaderTilemap=ShaderTilemap,t.TilingSprite=TilingSprite,t.ScreenSprite=ScreenSprite,t.WindowSkinCache=WindowSkinCache,t.Window=Window,t.WindowLayer=WindowLayer,t.Weather=Weather,t.ToneFilter=ToneFilter,t.ToneSprite=ToneSprite,t.Stage=Stage,t.WebAudio=WebAudio,t.JsonEx=JsonEx,t.Decrypter=Decrypter,t.ResourceHandler=ResourceHandler,t.DataManager=DataManager,t.ConfigManager=ConfigManager,t.StorageManager=StorageManager,t.ImageManager=ImageManager,t.AudioManager=AudioManager,t.SoundManager=SoundManager,t.TextManager=TextManager,t.SceneManager=SceneManager,t.BattleManager=BattleManager,t.PluginManager=PluginManager,PluginManager.setup($plugins);const s=()=>{e.body.classList.remove("is-loading"),i.settings.SCALE_MODE=i.SCALE_MODES.NEAREST,i.settings.ROUND_PIXELS=!0,i.settings.GC_MAX_IDLE=600,i.settings.MIPMAP_TEXTURES=i.MIPMAP_MODES.OFF,i.settings.RESOLUTION=window.devicePixelRatio,Utils.isMobileSafari()&&(i.settings.PRECISION_FRAGMENT=i.PRECISION.HIGH),SceneManager.run(Scene_Boot)};"complete"===e.readyState?s():window.addEventListener("load",s)})(self,document,PIXI)})();
