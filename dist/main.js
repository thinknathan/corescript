/*!
 * Part of RPG Maker MV CoreScript
 * @link https://github.com/thinknathan/corescript/blob/master/CONTRIBUTORS.md
 * @license https://github.com/thinknathan/corescript/blob/master/LICENSE 
 */
"use strict";(()=>{var qr=Object.defineProperty;var o=(n,t)=>qr(n,"name",{value:t,configurable:!0}),at=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});Number.prototype.clamp=function(n,t){return Math.min(Math.max(this,n),t)};Number.prototype.mod=function(n){return(this%n+n)%n};String.prototype.format=function(){let n=arguments;return this.replace(/%([0-9]+)/g,(t,e)=>n[Number(e)-1])};String.prototype.padZero=function(n){let t=this;for(;t.length<n;)t=`0${t}`;return t};Number.prototype.padZero=function(n){return String(this).padZero(n)};Object.defineProperties(Array.prototype,{equals:{enumerable:!1,value(n){if(!n||this.length!==n.length)return!1;for(let t=0;t<this.length;t++)if(this[t]instanceof Array&&n[t]instanceof Array){if(!this[t].equals(n[t]))return!1}else if(this[t]!==n[t])return!1;return!0}},clone:{enumerable:!1,value(){return this.slice(0)}},contains:{enumerable:!1,value(n){return this.includes(n)}}});String.prototype.contains=function(n){return this.includes(n)};Math.randomInt=n=>Math.floor(n*Math.random());var Pe=class{constructor(t,e,i){this.cache=t,this.key=e,this.item=i,this.cached=!1,this.touchTicks=0,this.touchSeconds=0,this.ttlTicks=0,this.ttlSeconds=0,this.freedByTTL=!1}free(t){this.freedByTTL=t||!1,this.cached&&(this.cached=!1,delete this.cache._inner[this.key])}allocate(){return this.cached||(this.cache._inner[this.key]=this,this.cached=!0),this.touch(),this}setTimeToLive(t,e){return this.ttlTicks=t||0,this.ttlSeconds=e||0,this}isStillAlive(){let t=this.cache;return(this.ttlTicks==0||this.touchTicks+this.ttlTicks<t.updateTicks)&&(this.ttlSeconds==0||this.touchSeconds+this.ttlSeconds<t.updateSeconds)}touch(){let t=this.cache;this.cached?(this.touchTicks=t.updateTicks,this.touchSeconds=t.updateSeconds):this.freedByTTL&&(this.freedByTTL=!1,t._inner[this.key]||(t._inner[this.key]=this))}};o(Pe,"CacheEntry");var Be=Pe;var Re=class{constructor(t){this.manager=t,this._inner={},this._lastRemovedEntries={},this.updateTicks=0,this.lastCheckTTL=0,this.delayCheckTTL=100,this.updateSeconds=Date.now()}checkTTL(){let t=this._inner,e=this._lastRemovedEntries;e||(e=[],this._lastRemovedEntries=e);for(let i in t){let s=t[i];s.isStillAlive()||e.push(s)}for(let i=0;i<e.length;i++)e[i].free(!0);e.length=0}getItem(t){let e=this._inner[t];return e?e.item:null}clear(){let t=Object.keys(this._inner);for(let e=0;e<t.length;e++)this._inner[t[e]].free()}setItem(t,e){return new Be(this,t,e).allocate()}update(t,e){this.updateTicks+=t,this.updateSeconds+=e,this.updateSeconds>=this.delayCheckTTL+this.lastCheckTTL&&(this.lastCheckTTL=this.updateSeconds,this.checkTTL())}};o(Re,"CacheMap");var $e=Re;var Qt=class{constructor(...t){this.initialize(...t)}initialize(){this._items={}}add(t,e){this._items[t]={bitmap:e,touch:Date.now(),key:t},this._truncateCache()}get(t){if(this._items[t]){let e=this._items[t];return e.touch=Date.now(),e.bitmap}return null}reserve(t,e,i){this._items[t]||(this._items[t]={bitmap:e,touch:Date.now(),key:t}),this._items[t].reservationId=i}releaseReservation(t){let e=this._items;Object.keys(e).map(i=>e[i]).forEach(i=>{i.reservationId===t&&delete i.reservationId})}_truncateCache(){let t=this._items,e=Qt.limit;Object.keys(t).map(i=>t[i]).sort((i,s)=>i.touch-s.touch).forEach(i=>{if(e>0||this._mustBeHeld(i)){let s=i.bitmap;e-=s.width*s.height}else delete t[i.key]})}_mustBeHeld({bitmap:t,reservationId:e}){return t.isRequestOnly()?!1:!!(e||!t.isReady())}isReady(){let t=this._items;return!Object.keys(t).some(e=>!t[e].bitmap.isRequestOnly()&&!t[e].bitmap.isReady())}getErrorBitmap(){let t=this._items,e=null;return Object.keys(t).some(i=>t[i].bitmap.isError()?(e=t[i].bitmap,!0):!1)?e:null}};o(Qt,"ImageCache");Qt.limit=10*1e3*1e3;var Ie=Qt;var Fe=class{constructor(...t){this.initialize(...t)}initialize(){this._queue=[]}enqueue(t,e){this._queue.push({key:t,value:e})}update(){if(this._queue.length===0)return;let t=this._queue[0];t.value.isRequestReady()?(this._queue.shift(),this._queue.length!==0&&this._queue[0].value.startRequest()):t.value.startRequest()}raisePriority(t){for(let e=0;e<this._queue.length;e++){let i=this._queue[e];if(i.key===t){this._queue.splice(e,1),this._queue.unshift(i);break}}}clear(){this._queue.splice(0)}};o(Fe,"RequestQueue");var De=Fe;var W=class{constructor(){throw new Error("This is a static class")}static isOptionValid(t){return!!(location.search.slice(1).split("&").contains(t)||typeof nw<"u"&&nw.App.argv.length>0&&nw.App.argv[0].split("&").contains(t))}static isNwjs(){if(typeof W._nwjs=="boolean")return W._nwjs;let t=typeof at=="function"&&typeof process=="object";return W._nwjs=t,t}static isTauri(){return!!window.__TAURI__}static isHighFps(){return W._fpsChecked?W._highFps:W.getFps()>=66}static getFps(){if(W._fpsChecked||W._fpsIsBusyCounting)return W._fps;{let t=0,e=0,i=0,s=o(a=>{if(e<=180){e++;let r=a-t;i+=1e3/r,t=a,requestAnimationFrame(s)}else W._fps!==1/0&&(W._fps=i/e,W._fps>=66&&(W._highFps=!0)),W._fpsChecked=!0,W._fpsIsBusyCounting=!1},"rafLoop");return requestAnimationFrame(a=>{t=a,requestAnimationFrame(s)}),W._fpsIsBusyCounting=!0,W._fps}}static isMobileDevice(){if(typeof W._mobileDevice=="boolean")return W._mobileDevice;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i,e=!!navigator.userAgent.match(t);return W._mobileDevice=e,e}static isMobileSafari(){if(typeof W._mobileSafari=="boolean")return W._mobileSafari;let t=navigator.userAgent,e=!!(t.match(/iPhone|iPad|iPod/)&&t.match(/AppleWebKit/)&&!t.match("CriOS"));return W._mobileSafari=e,e}static isAndroidChrome(){if(typeof W._androidChrome=="boolean")return W._androidChrome;let t=navigator.userAgent,e=!!(t.match(/Android/)&&t.match(/Chrome/));return W._androidChrome=e,e}static canReadGameFiles(){let t=document.getElementsByTagName("script"),e=t[t.length-1],i=new XMLHttpRequest;try{return i.open("GET",e.src),i.overrideMimeType("text/javascript"),i.send(),!0}catch{return!1}}static rgbToCssColor(t,e,i){return t=Math.round(t),e=Math.round(e),i=Math.round(i),`rgb(${t},${e},${i})`}static generateRuntimeId(){return W._id++}static isSupportPassiveEvent(){if(typeof W._supportPassiveEvent=="boolean")return W._supportPassiveEvent;let t=!1,e=Object.defineProperty({},"passive",{get(){t=!0}});return window.addEventListener("test",null,e),W._supportPassiveEvent=t,t}};o(W,"Utils");W.RPGMAKER_NAME="MV";W.RPGMAKER_VERSION="1.6.1";W.RPGMAKER_ENGINE="community-1.4";W._nwjs=null;W._highFps=!1;W._fps=60;W._fpsIsBusyCounting=!1;W._fpsChecked=!1;W._mobileDevice=null;W._mobileSafari=null;W._androidChrome=null;W._id=1;W._supportPassiveEvent=null;var I=W;var Z=class{constructor(){throw new Error("This is a static class")}static checkImgIgnore(t){for(let e=0;e<this._ignoreList.length;e++)if(t===this._ignoreList[e])return!0;return!1}static decryptImg(t,e){t=this.extToEncryptExt(t);let i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.send(),i.onload=function(){if(this.status<Z._xhrOk){let s=Z.decryptArrayBuffer(i.response);e._image.src=Z.createBlobUrl(s),e._image.addEventListener("load",e._loadListener=V.prototype._onLoad.bind(e)),e._image.addEventListener("error",e._errorListener=e._loader||V.prototype._onError.bind(e))}},i.onerror=()=>{e._loader?e._loader():e._onError()}}static decryptArrayBuffer(t){if(!t)return null;let e=new Uint8Array(t,0,this._headerlength),i,s=this.SIGNATURE+this.VER+this.REMAIN,a=new Uint8Array(16);for(i=0;i<this._headerlength;i++)a[i]=parseInt(`0x${s.substr(i*2,2)}`,16);for(i=0;i<this._headerlength;i++)if(e[i]!==a[i])throw new Error("Header is wrong");t=this.cutArrayHeader(t,Z._headerlength);let r=new DataView(t);if(this.readEncryptionkey(),t){let h=new Uint8Array(t);for(i=0;i<this._headerlength;i++)h[i]=h[i]^parseInt(Z._encryptionKey[i],16),r.setUint8(i,h[i])}return t}static readEncryptionkey(){this._encryptionKey=self.$dataSystem.encryptionKey.split(/(.{2})/).filter(Boolean)}static cutArrayHeader(t,e){t.slice(e)}static createBlobUrl(t){let e=new Blob([t]);return window.URL.createObjectURL(e)}static extToEncryptExt(t){let e=t.split(".").pop(),i=e;return e==="ogg"?i=".rpgmvo":e==="m4a"?i=".rpgmvm":e==="png"?i=".rpgmvp":i=e,t.slice(0,t.lastIndexOf(e)-1)+i}};o(Z,"Decrypter");Z.hasEncryptedImages=!1;Z.hasEncryptedAudio=!1;Z._requestImgFile=[];Z._headerlength=16;Z._xhrOk=400;Z._encryptionKey="";Z._ignoreList=["img/system/Window.png"];Z.SIGNATURE="5250474d56000000";Z.VER="000301";Z.REMAIN="0000000000";var ht=Z;var L=class{constructor(...t){this.initialize(...t)}initialize(t){L._initialized||L.initialize(),this.clear(),L._standAlone||(this._loader=ct.createLoader(t,this._load.bind(this,t),()=>{this._hasError=!0})),this._load(t),this._url=t}static initialize(t){return this._initialized||(t||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context}static canPlayOgg(){return this._initialized||this.initialize(),!!this._canPlayOgg}static canPlayM4a(){return this._initialized||this.initialize(),!!this._canPlayM4a}static setMasterVolume(t){this._masterVolume=t,this._masterGainNode&&this._masterGainNode.gain.setValueAtTime(this._masterVolume,this._context.currentTime)}static _createContext(){try{typeof AudioContext<"u"?this._context=new AudioContext:typeof webkitAudioContext<"u"&&(this._context=new webkitAudioContext)}catch{this._context=null}}static _detectCodecs(){let t=document.createElement("audio");t.canPlayType&&(this._canPlayOgg=t.canPlayType('audio/ogg; codecs="vorbis"'),this._canPlayM4a=t.canPlayType("audio/mp4"))}static _createMasterGainNode(){let t=L._context;t&&(this._masterGainNode=t.createGain(),this._masterGainNode.gain.setValueAtTime(this._masterVolume,t.currentTime),this._masterGainNode.connect(t.destination))}static _setupEventHandlers(){let t=o(()=>{let e=L._context;e&&e.state==="suspended"&&typeof e.resume=="function"?e.resume().then(()=>{L._onTouchStart()}):L._onTouchStart()},"resumeHandler");document.addEventListener("keydown",t),document.addEventListener("mousedown",t),document.addEventListener("touchend",t),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))}static _onTouchStart(){let t=L._context;t&&!this._unlocked&&(t.createBufferSource().start(0),this._unlocked=!0)}static _onVisibilityChange(){document.visibilityState==="hidden"?this._onHide():this._onShow()}static _onHide(){this._shouldMuteOnHide()&&this._fadeOut(1)}static _onShow(){this._shouldMuteOnHide()&&this._fadeIn(1)}static _fadeIn(t){if(this._masterGainNode){let e=this._masterGainNode.gain,i=L._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._masterVolume,i+t)}}static _fadeOut(t){if(this._masterGainNode){let e=this._masterGainNode.gain,i=L._context.currentTime;e.setValueAtTime(this._masterVolume,i),e.linearRampToValueAtTime(0,i+t)}}clear(){this.stop(),this._buffer=null,this._sourceNode=null,this._gainNode=null,this._pannerNode=null,this._totalTime=0,this._sampleRate=0,this._loopStart=0,this._loopLength=0,this._startTime=0,this._volume=1,this._pitch=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._hasError=!1,this._autoPlay=!1}get url(){return this._url}get volume(){return this._volume}set volume(t){this._volume=t,this._gainNode&&this._gainNode.gain.setValueAtTime(this._volume,L._context.currentTime)}get pitch(){return this._pitch}set pitch(t){this._pitch!==t&&(this._pitch=t,this.isPlaying()&&this.play(this._sourceNode.loop,0))}get pan(){return this._pan}set pan(t){this._pan=t,this._updatePanner()}isReady(){return!!this._buffer}isError(){return this._hasError}isPlaying(){return!!this._sourceNode}play(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):L._context&&(this._autoPlay=!0,this.addLoadListener(()=>{this._autoPlay&&this.play(t,e)}))}stop(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;this._stopListeners.length>0;)this._stopListeners.shift()()}fadeIn(t){if(this.isReady()){if(this._gainNode){let e=this._gainNode.gain,i=L._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._volume,i+t)}}else this._autoPlay&&this.addLoadListener(()=>{this.fadeIn(t)})}fadeOut(t){if(this._gainNode){let e=this._gainNode.gain,i=L._context.currentTime;e.setValueAtTime(this._volume,i),e.linearRampToValueAtTime(0,i+t)}this._autoPlay=!1}seek(){if(L._context){let t=(L._context.currentTime-this._startTime)*this._pitch;if(this._loopLength>0)for(;t>=this._loopStart+this._loopLength;)t-=this._loopLength;return t}else return 0}addLoadListener(t){this._loadListeners.push(t)}addStopListener(t){this._stopListeners.push(t)}_load(t){if(L._context){let e=new XMLHttpRequest;ht.hasEncryptedAudio&&(t=ht.extToEncryptExt(t)),e.open("GET",t),e.responseType="arraybuffer",e.onload=()=>{e.status<400&&this._onXhrLoad(e)},e.onerror=this._loader||(()=>{this._hasError=!0}),e.send()}}_onXhrLoad({response:t}){let e=t;ht.hasEncryptedAudio&&(e=ht.decryptArrayBuffer(e)),this._readLoopComments(new Uint8Array(e)),L._context.decodeAudioData(e,i=>{this._buffer=i,this._totalTime=i.duration,this._loopLength>0&&this._sampleRate>0?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()})}_startPlaying(t,e){if(this._loopLength>0)for(;e>=this._loopStart+this._loopLength;)e-=this._loopLength;this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=t,this._sourceNode.start(0,e),this._startTime=L._context.currentTime-e/this._pitch,this._createEndTimer()}_createNodes(){let t=L._context;this._sourceNode=t.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.setValueAtTime(this._pitch,t.currentTime),this._gainNode=t.createGain(),this._gainNode.gain.setValueAtTime(this._volume,t.currentTime),this._pannerNode=t.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()}_connectNodes(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(L._masterGainNode)}_removeNodes(){this._sourceNode&&(this._sourceNode.stop(0),this._sourceNode=null,this._gainNode=null,this._pannerNode=null)}_createEndTimer(){if(this._sourceNode&&!this._sourceNode.loop){let e=this._startTime+this._totalTime/this._pitch-L._context.currentTime;this._endTimer=setTimeout(()=>{this.stop()},e*1e3)}}_removeEndTimer(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)}_updatePanner(){if(this._pannerNode){let t=this._pan,e=1-Math.abs(t);this._pannerNode.setPosition(t,0,e)}}_onLoad(){for(;this._loadListeners.length>0;)this._loadListeners.shift()()}_readLoopComments(t){this._readOgg(t),this._readMp4(t)}_readOgg(t){let e=0;for(;e<t.length&&this._readFourCharacters(t,e)==="OggS";){e+=26;let i=!1,s=t[e++],a=[];for(let r=0;r<s;r++)a.push(t[e++]);for(let r=0;r<s;r++){if(this._readFourCharacters(t,e+1)==="vorb"){let h=t[e];if(h===1)this._sampleRate=this._readLittleEndian(t,e+12);else if(h===3){let c=0;for(;r<s&&(c+=a[r],!(a[r]<255));r++);this._readMetaData(t,e,c)}i=!0}e+=a[r]}if(!i)break}}_readMp4(t){if(this._readFourCharacters(t,4)==="ftyp"){let e=0;for(;e<t.length;){let i=this._readBigEndian(t,e),s=this._readFourCharacters(t,e+4);if(s==="moov")e+=8;else if(s==="mvhd"&&(this._sampleRate=this._readBigEndian(t,e+20)),(s==="udta"||s==="meta")&&this._readMetaData(t,e,i),e+=i,i<=1)break}}}_readMetaData(t,e,i){for(let s=e;s<e+i-10;s++)if(this._readFourCharacters(t,s)==="LOOP"){let a="";for(;t[s]>0;)a+=String.fromCharCode(t[s++]);if(a.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),a.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),a=="LOOPSTART"||a=="LOOPLENGTH"){let r="";for(s+=16;t[s]>0;)r+=String.fromCharCode(t[s++]);a=="LOOPSTART"?this._loopStart=parseInt(r):this._loopLength=parseInt(r)}}}_readLittleEndian(t,e){return t[e+3]*16777216+t[e+2]*65536+t[e+1]*256+t[e+0]}_readBigEndian(t,e){return t[e+0]*16777216+t[e+1]*65536+t[e+2]*256+t[e+3]}_readFourCharacters(t,e){let i="";for(let s=0;s<4;s++)i+=String.fromCharCode(t[e+s]);return i}static _shouldMuteOnHide(){return I.isMobileDevice()}};o(L,"WebAudio");L._standAlone=(n=>!n.ResourceHandler)(self);L._masterVolume=1;L._context=null;L._masterGainNode=null;L._initialized=!1;L._unlocked=!1;var zt=L;var q=class{constructor(){throw new Error("This is a static class")}static playBgm(t,e){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.stopBgm(),t.name&&(this._bgmBuffer=this.createBuffer("bgm",t.name),this.updateBgmParameters(t),this._meBuffer||this._bgmBuffer.play(!0,e||0))),this.updateCurrentBgm(t,e)}static playEncryptedBgm({name:t},e){let i=this.audioFileExt(),s=`${this._path}bgm/${encodeURIComponent(t)}${i}`;s=ht.extToEncryptExt(s)}static createDecryptBuffer(t,e,i){this._blobUrl=t,this._bgmBuffer=this.createBuffer("bgm",e.name),this.updateBgmParameters(e),this._meBuffer||this._bgmBuffer.play(!0,i||0),this.updateCurrentBgm(e,i)}static replayBgm(t){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.playBgm(t,t.pos),this._bgmBuffer&&this._bgmBuffer.fadeIn(this._replayFadeTime))}static isCurrentBgm({name:t}){return this._currentBgm&&this._bgmBuffer&&this._currentBgm.name===t}static updateBgmParameters(t){this.updateBufferParameters(this._bgmBuffer,this._bgmVolume,t)}static updateCurrentBgm({name:t,volume:e,pitch:i,pan:s},a){this._currentBgm={name:t,volume:e,pitch:i,pan:s,pos:a}}static stopBgm(){this._bgmBuffer&&(this._bgmBuffer.stop(),this._bgmBuffer=null,this._currentBgm=null)}static fadeOutBgm(t){this._bgmBuffer&&this._currentBgm&&(this._bgmBuffer.fadeOut(t),this._currentBgm=null)}static fadeInBgm(t){this._bgmBuffer&&this._currentBgm&&this._bgmBuffer.fadeIn(t)}static playBgs(t,e){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.stopBgs(),t.name&&(this._bgsBuffer=this.createBuffer("bgs",t.name),this.updateBgsParameters(t),this._bgsBuffer.play(!0,e||0))),this.updateCurrentBgs(t,e)}static replayBgs(t){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.playBgs(t,t.pos),this._bgsBuffer&&this._bgsBuffer.fadeIn(this._replayFadeTime))}static isCurrentBgs({name:t}){return this._currentBgs&&this._bgsBuffer&&this._currentBgs.name===t}static updateBgsParameters(t){this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,t)}static updateCurrentBgs({name:t,volume:e,pitch:i,pan:s},a){this._currentBgs={name:t,volume:e,pitch:i,pan:s,pos:a}}static stopBgs(){this._bgsBuffer&&(this._bgsBuffer.stop(),this._bgsBuffer=null,this._currentBgs=null)}static fadeOutBgs(t){this._bgsBuffer&&this._currentBgs&&(this._bgsBuffer.fadeOut(t),this._currentBgs=null)}static fadeInBgs(t){this._bgsBuffer&&this._currentBgs&&this._bgsBuffer.fadeIn(t)}static playMe(t){this.stopMe(),t.name&&(this._bgmBuffer&&this._currentBgm&&(this._currentBgm.pos=this._bgmBuffer.seek(),this._bgmBuffer.stop()),this._meBuffer=this.createBuffer("me",t.name),this.updateMeParameters(t),this._meBuffer.play(!1),this._meBuffer.addStopListener(this.stopMe.bind(this)))}static updateMeParameters(t){this.updateBufferParameters(this._meBuffer,this._meVolume,t)}static fadeOutMe(t){this._meBuffer&&this._meBuffer.fadeOut(t)}static stopMe(){this._meBuffer&&(this._meBuffer.stop(),this._meBuffer=null,this._bgmBuffer&&this._currentBgm&&!this._bgmBuffer.isPlaying()&&(this._bgmBuffer.play(!0,this._currentBgm.pos),this._bgmBuffer.fadeIn(this._replayFadeTime)))}static playSe(t){if(t.name){this._seBuffers=this._seBuffers.filter(i=>i.isPlaying());let e=this.createBuffer("se",t.name);this.updateSeParameters(e,t),e.play(!1),this._seBuffers.push(e)}}static updateSeParameters(t,e){this.updateBufferParameters(t,this._seVolume,e)}static stopSe(){this._seBuffers.forEach(t=>{t.stop()}),this._seBuffers=[]}static playStaticSe(t){if(t.name){this.loadStaticSe(t);for(let e of this._staticBuffers)if(e._reservedSeName===t.name){e.stop(),this.updateSeParameters(e,t),e.play(!1);break}}}static loadStaticSe(t){if(t.name&&!this.isStaticSe(t)){let e=this.createBuffer("se",t.name);e._reservedSeName=t.name,this._staticBuffers.push(e)}}static isStaticSe({name:t}){for(let e of this._staticBuffers)if(e._reservedSeName===t)return!0;return!1}static stopAll(){this.stopMe(),this.stopBgm(),this.stopBgs(),this.stopSe()}static saveBgm(){if(this._currentBgm){let t=this._currentBgm;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgmBuffer?this._bgmBuffer.seek():0}}else return this.makeEmptyAudioObject()}static saveBgs(){if(this._currentBgs){let t=this._currentBgs;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgsBuffer?this._bgsBuffer.seek():0}}else return this.makeEmptyAudioObject()}static createBuffer(t,e){let i=this.audioFileExt(),s=`${this._path+t}/${encodeURIComponent(e)}${i}`,a=new zt(s);return this._callCreationHook(a),a}static checkErrors(){this.checkWebAudioError(this._bgmBuffer),this.checkWebAudioError(this._bgsBuffer),this.checkWebAudioError(this._meBuffer),this._seBuffers.forEach(t=>{this.checkWebAudioError(t)}),this._staticBuffers.forEach(t=>{this.checkWebAudioError(t)})}static setCreationHook(t){this._creationHook=t}static _callCreationHook(t){this._creationHook&&this._creationHook(t)}static audioFileExt(){return zt.canPlayOgg()&&!I.isMobileDevice()?".ogg":".m4a"}static shouldUseHtml5Audio(){return!1}static checkWebAudioError(t){if(t&&t.isError())throw new Error(`Failed to load: ${t.url}`)}static makeEmptyAudioObject(){return{name:"",volume:0,pitch:0}}static updateBufferParameters(t,e,i){t&&i&&(t.volume=e*(i.volume||0)/1e4,t.pitch=(i.pitch||0)/100,t.pan=(i.pan||0)/100)}};o(q,"AudioManager");q._masterVolume=1;q._bgmVolume=100;q._bgsVolume=100;q._meVolume=100;q._seVolume=100;q._currentBgm=null;q._currentBgs=null;q._bgmBuffer=null;q._bgsBuffer=null;q._meBuffer=null;q._seBuffers=[];q._staticBuffers=[];q._replayFadeTime=.5;q._path="audio/";q._blobUrl=null;Object.defineProperty(q,"masterVolume",{get(){return this._masterVolume},set(n){this._masterVolume=n,zt.setMasterVolume(this._masterVolume),l.setVideoVolume(this._masterVolume)},configurable:!0});Object.defineProperty(q,"bgmVolume",{get(){return this._bgmVolume},set(n){this._bgmVolume=n,this.updateBgmParameters(this._currentBgm)},configurable:!0});Object.defineProperty(q,"bgsVolume",{get(){return this._bgsVolume},set(n){this._bgsVolume=n,this.updateBgsParameters(this._currentBgs)},configurable:!0});Object.defineProperty(q,"meVolume",{get(){return this._meVolume},set(n){this._meVolume=n,this.updateMeParameters(this._currentMe)},configurable:!0});Object.defineProperty(q,"seVolume",{get(){return this._seVolume},set(n){this._seVolume=n},configurable:!0});var b=q;var _t=class{constructor(){throw new Error("This is a static class")}static initialize(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()}static clear(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._pressedTime=0,this._dir4=0,this._dir8=0,this._preferredAxis="",this._date=0}static update(){this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null;for(let t in this._currentState)this._currentState[t]&&!this._previousState[t]&&(this._latestButton=t,this._pressedTime=0,this._date=Date.now()),this._previousState[t]=this._currentState[t];this._updateDirection()}static isPressed(t){return this._isEscapeCompatible(t)&&this.isPressed("escape")?!0:!!this._currentState[t]}static isTriggered(t){return this._isEscapeCompatible(t)&&this.isTriggered("escape")?!0:this._latestButton===t&&this._pressedTime===0}static isRepeated(t){return this._isEscapeCompatible(t)&&this.isRepeated("escape")?!0:this._latestButton===t&&(this._pressedTime===0||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval===0)}static isLongPressed(t){return this._isEscapeCompatible(t)&&this.isLongPressed("escape")?!0:this._latestButton===t&&this._pressedTime>=this.keyRepeatWait}static _setupEventHandlers(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))}static _onKeyDown(t){this._shouldPreventDefault(t.keyCode)&&t.preventDefault(),t.keyCode===144&&this.clear();let e=this.keyMapper[t.keyCode];ct.exists()&&e==="ok"?ct.retry():e&&(this._currentState[e]=!0)}static _onKeyUp({keyCode:t}){let e=this.keyMapper[t];e&&(this._currentState[e]=!1),t===0&&this.clear()}static _onLostFocus(){this.clear()}static _pollGamepads(){if(navigator.getGamepads){let t=navigator.getGamepads();if(t)for(let e of t)e&&e.connected&&this._updateGamepadState(e)}}static _updateGamepadState(t){let e=this._gamepadStates[t.index]||[],i=[],s=t.buttons,a=t.axes,r=.5;i[12]=!1,i[13]=!1,i[14]=!1,i[15]=!1;for(let h=0;h<s.length;h++)i[h]=s[h].pressed;a[1]<-r?i[12]=!0:a[1]>r&&(i[13]=!0),a[0]<-r?i[14]=!0:a[0]>r&&(i[15]=!0);for(let h=0;h<i.length;h++)if(i[h]!==e[h]){let c=this.gamepadMapper[h];c&&(this._currentState[c]=i[h])}this._gamepadStates[t.index]=i}static _updateDirection(){let t=this._signX(),e=this._signY();this._dir8=this._makeNumpadDirection(t,e),t!==0&&e!==0?this._preferredAxis==="x"?e=0:t=0:t!==0?this._preferredAxis="y":e!==0&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(t,e)}static _signX(){let t=0;return this.isPressed("left")&&t--,this.isPressed("right")&&t++,t}static _signY(){let t=0;return this.isPressed("up")&&t--,this.isPressed("down")&&t++,t}static _wrapNwjsAlert(){if(I.isNwjs()){let t=window.alert;window.alert=function(...e){let s=at("nw.gui").Window.get();t.apply(this,e),s.focus(),_t.clear()}}}static _shouldPreventDefault(t){switch(t){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1}static _makeNumpadDirection(t,e){return t!==0||e!==0?5-e*3+t:0}static _isEscapeCompatible(t){return t==="cancel"||t==="menu"}};o(_t,"Input");_t.keyRepeatWait=24;_t.keyRepeatInterval=6;_t.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"};_t.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"};Object.defineProperty(_t,"dir4",{get(){return this._dir4},configurable:!0});Object.defineProperty(_t,"dir8",{get(){return this._dir8},configurable:!0});Object.defineProperty(_t,"date",{get(){return this._date},configurable:!0});var x=_t;var Vt=class{constructor(){throw new Error("This is a static class")}static setup(t){t.forEach(function({status:e,name:i,parameters:s}){e&&!this._scripts.contains(i)&&(this.setParameters(i,s),this.loadScript(`${i}.js`),this._scripts.push(i))},this)}static checkErrors(){let t=this._errorUrls.shift();if(t)throw new Error(`Failed to load: ${t}`)}static parameters(t){return this._parameters[t.toLowerCase()]||{}}static setParameters(t,e){this._parameters[t.toLowerCase()]=e}static loadScript(t){let e=this._path+t,i=document.createElement("script");i.type="text/javascript",i.src=e,i.async=!1,i.onerror=this.onError.bind(this),i._url=e,document.body.appendChild(i)}static onError({target:t}){this._errorUrls.push(t._url)}};o(Vt,"PluginManager");Vt._path="js/plugins/";Vt._scripts=[];Vt._errorUrls=[];Vt._parameters={};var Me=Vt;var bt=class{constructor(){throw new Error("This is a static class")}static initialize(){this.clear(),this._setupEventHandlers()}static clear(){this._mousePressed=!1,this._screenPressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._triggered=!1,this._cancelled=!1,this._moved=!1,this._released=!1,this._wheelX=0,this._wheelY=0,this._x=0,this._y=0,this._date=0}static update(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++}static isPressed(){return this._mousePressed||this._screenPressed}static isTriggered(){return this._triggered}static isRepeated(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval===0)}static isLongPressed(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait}static isCancelled(){return this._cancelled}static isMoved(){return this._moved}static isReleased(){return this._released}static _setupEventHandlers(){let t=I.isSupportPassiveEvent();document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this),t?{passive:!1}:!1),document.addEventListener("touchstart",this._onTouchStart.bind(this),t?{passive:!1}:!1),document.addEventListener("touchmove",this._onTouchMove.bind(this),t?{passive:!1}:!1),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))}static _onMouseDown(t){t.button===0?this._onLeftButtonDown(t):t.button===1?this._onMiddleButtonDown(t):t.button===2&&this._onRightButtonDown(t)}static _onLeftButtonDown({pageX:t,pageY:e}){let i=l.pageToCanvasX(t),s=l.pageToCanvasY(e);l.isInsideCanvas(i,s)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(i,s))}static _onRightButtonDown({pageX:t,pageY:e}){let i=l.pageToCanvasX(t),s=l.pageToCanvasY(e);l.isInsideCanvas(i,s)&&this._onCancel(i,s)}static _onMouseMove({pageX:t,pageY:e}){if(this._mousePressed){let i=l.pageToCanvasX(t),s=l.pageToCanvasY(e);this._onMove(i,s)}}static _onMouseUp({button:t,pageX:e,pageY:i}){if(t===0){let s=l.pageToCanvasX(e),a=l.pageToCanvasY(i);this._mousePressed=!1,this._onRelease(s,a)}}static _onWheel(t){this._events.wheelX+=t.deltaX,this._events.wheelY+=t.deltaY,t.preventDefault()}static _onTouchStart(t){for(let e of t.changedTouches){let i=l.pageToCanvasX(e.pageX),s=l.pageToCanvasY(e.pageY);l.isInsideCanvas(i,s)&&(this._screenPressed=!0,this._pressedTime=0,t.touches.length>=2?this._onCancel(i,s):this._onTrigger(i,s),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()}static _onTouchMove({changedTouches:t}){for(let e of t){let i=l.pageToCanvasX(e.pageX),s=l.pageToCanvasY(e.pageY);this._onMove(i,s)}}static _onTouchEnd({changedTouches:t}){for(let e of t){let i=l.pageToCanvasX(e.pageX),s=l.pageToCanvasY(e.pageY);this._screenPressed=!1,this._onRelease(i,s)}}static _onTouchCancel(t){this._screenPressed=!1}static _onPointerDown(t){if(t.pointerType==="touch"&&!t.isPrimary){let e=l.pageToCanvasX(t.pageX),i=l.pageToCanvasY(t.pageY);l.isInsideCanvas(e,i)&&(this._onCancel(e,i),t.preventDefault())}}static _onLostFocus(){this.clear()}static _onTrigger(t,e){this._events.triggered=!0,this._x=t,this._y=e,this._date=Date.now()}static _onCancel(t,e){this._events.cancelled=!0,this._x=t,this._y=e}static _onMove(t,e){this._events.moved=!0,this._x=t,this._y=e}static _onRelease(t,e){this._events.released=!0,this._x=t,this._y=e}};o(bt,"TouchInput");bt.keyRepeatWait=24;bt.keyRepeatInterval=6;Object.defineProperty(bt,"wheelX",{get(){return this._wheelX},configurable:!0});Object.defineProperty(bt,"wheelY",{get(){return this._wheelY},configurable:!0});Object.defineProperty(bt,"x",{get(){return this._x},configurable:!0});Object.defineProperty(bt,"y",{get(){return this._y},configurable:!0});Object.defineProperty(bt,"date",{get(){return this._date},configurable:!0});bt._onMiddleButtonDown=n=>{};var k=bt;var K=class{constructor(){throw new Error("This is a static class")}static run(t){try{this.initialize(),this.goto(t),this.requestUpdate()}catch(e){this.catchException(e)}}static initialize(){this.initProgressWatcher(),this.initGraphics(),this.checkFileAccess(),this.initAudio(),this.initInput(),this.initNwjs(),this.checkPluginErrors(),this.setupErrorHandlers()}static initGraphics(){let t=this.preferableRendererType();l.initialize(this._screenWidth,this._screenHeight,t),l.boxWidth=this._boxWidth,l.boxHeight=this._boxHeight,l.setLoadingImage("img/system/Loading.png"),I.isOptionValid("showfps")&&l.showFps(),t==="webgl"&&this.checkWebGL()}static setupErrorHandlers(){window.addEventListener("error",this.onError.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this))}static frameCount(){return this._frameCount}static setFrameCount(t){this._frameCount=t}static resetFrameCount(){this._frameCount=0}static requestUpdate(){this._stopped||requestAnimationFrame(this.update.bind(this))}static update(){try{this.tickStart(),I.isMobileSafari()&&this.updateInputData(),this.updateManagers(),this.updateMain(),this.tickEnd()}catch(t){this.catchException(t)}}static onError({message:t,filename:e,lineno:i}){if(e||i)try{this.stop(),l.printError("Error",t),b.stopAll()}catch{}}static catchException(t){t instanceof Error?(l.printError(t.name,t.message),l.printErrorDetail(t)):l.printError("UnknownError",t),b.stopAll(),this.stop()}static updateMain(){if(I.isHighFps()){if(I.isMobileSafari())this.changeScene(),this.updateScene();else{let t=this._getTimeInMsWithoutMobileSafari();this._currentTime===void 0&&(this._currentTime=t);let e=(t-this._currentTime)/1e3;for(e>.25&&(e=.25),this._currentTime=t,this._accumulator+=e;this._accumulator>=this._deltaTime;)this.updateInputData(),this.changeScene(),this.updateScene(),this._accumulator-=this._deltaTime}this.renderScene(),this.requestUpdate()}else this.updateInputData(),this.changeScene(),this.updateScene(),this.renderScene(),this.requestUpdate()}static changeScene(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),this._scene=this._nextScene,this._scene&&(this._scene.attachReservation(),this._scene.create(),this._nextScene=null,this._sceneStarted=!1,this.onSceneCreate()),this._exiting&&this.terminate())}static updateScene(){this._scene&&(!this._sceneStarted&&this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart()),this.isCurrentSceneStarted()&&(this.updateFrameCount(),this._scene.update()))}static renderScene(){this.isCurrentSceneStarted()?l.render(this._scene):this._scene&&this.onSceneLoading()}static updateFrameCount(){this._frameCount++}static isSceneChanging(){return this._exiting||!!this._nextScene}static isCurrentSceneBusy(){return this._scene&&this._scene.isBusy()}static isCurrentSceneStarted(){return this._scene&&this._sceneStarted}static isNextScene(t){return this._nextScene&&this._nextScene.constructor===t}static isPreviousScene(t){return this._previousClass===t}static goto(t){t&&(this._nextScene=new t),this._scene&&this._scene.stop()}static push(t){this._stack.push(this._scene.constructor),this.goto(t)}static pop(){this._stack.length>0?this.goto(this._stack.pop()):this.exit()}static exit(){this.goto(null),this._exiting=!0}static clearStack(){this._stack=[]}static stop(){this._stopped=!0}static prepareNextScene(...t){this._nextScene.prepare(...t)}static snap(){return V.snap(this._scene)}static snapForBackground(){this._backgroundBitmap=this.snap(),this._backgroundBitmap.blur()}static backgroundBitmap(){return this._backgroundBitmap}static resume(){this._stopped=!1,this.requestUpdate(),I.isMobileSafari()||(this._currentTime=this._getTimeInMsWithoutMobileSafari(),this._accumulator=0)}static _getTimeInMsWithoutMobileSafari(){return performance.now()}static initProgressWatcher(){te.initialize()}static preferableRendererType(){return I.isOptionValid("canvas")?"canvas":I.isOptionValid("webgl")?"webgl":"auto"}static shouldUseCanvasRenderer(){return I.isMobileDevice()}static checkWebGL(){if(!l.hasWebGL())throw new Error("Your browser does not support WebGL.")}static checkFileAccess(){if(!I.canReadGameFiles())throw new Error("Your browser does not allow to read local files.")}static initAudio(){let t=I.isOptionValid("noaudio");if(!zt.initialize(t)&&!t)throw new Error("Your browser does not support Web Audio API.")}static initInput(){x.initialize(),k.initialize()}static initNwjs(){if(I.isNwjs()){let t=at("nw.gui"),e=t.Window.get();if(process.platform==="darwin"&&!e.menu){let i=new t.Menu({type:"menubar"}),s={hideEdit:!0,hideWindow:!0};i.createMacBuiltin("Game",s),e.menu=i}}}static checkPluginErrors(){Me.checkErrors()}static terminate(){window.close()}static onKeyDown({ctrlKey:t,altKey:e,keyCode:i}){if(!t&&!e)switch(i){case 116:I.isNwjs()&&location.reload();break;case 119:I.isNwjs()&&I.isOptionValid("test")&&at("nw.gui").Window.get().showDevTools();break}}static tickStart(){l.tickStart()}static tickEnd(){l.tickEnd()}static updateInputData(){x.update(),k.update()}static updateManagers(){p.update()}static onSceneCreate(){l.startLoading()}static onSceneStart(){l.callGC(),l.endLoading()}static onSceneLoading(){l.updateLoading()}};o(K,"SceneManager");K._scene=null;K._nextScene=null;K._stack=[];K._stopped=!1;K._sceneStarted=!1;K._exiting=!1;K._previousClass=null;K._backgroundBitmap=null;K._screenWidth=816;K._screenHeight=624;K._boxWidth=816;K._boxHeight=624;K._deltaTime=1/60;I.isMobileSafari()||(K._currentTime=K._getTimeInMsWithoutMobileSafari());K._accumulator=0;K._frameCount=0;var g=K;var re=class{constructor(){throw new Error("This is a static class")}static createLoader(t,e,i,s=this._defaultRetryInterval){let a=this._reloaders,r=0;return()=>{r<s.length?(setTimeout(e,s[r]),r++):(i&&i(),t&&(a.length===0&&(l.printLoadingError(t),g.stop()),a.push(()=>{r=0,e()})))}}static exists(){return this._reloaders.length>0}static retry(){this._reloaders.length>0&&(l.eraseLoadingError(),g.resume(),this._reloaders.forEach(t=>{t()}),this._reloaders.length=0)}};o(re,"ResourceHandler");re._reloaders=[];re._defaultRetryInterval=[500,1e3,3e3];var ct=re;var O=class{constructor(){throw new Error("This is a static class")}static initialize(t,e,i){this._width=t||800,this._height=e||600,this._rendererType=i||"auto",this._boxWidth=this._width,this._boxHeight=this._height,this._scale=1,this._realScale=1,this._errorShowed=!1,this._errorPrinter=null,this._canvas=null,this._video=null,this._videoUnlocked=!1,this._videoLoading=!1,this._upperCanvas=null,this._fpsMeter=null,this._modeBox=null,this._skipCount=0,this._maxSkip=3,this._rendered=!1,this._loadingImage=null,this._loadingCount=0,this._fpsMeterToggled=!1,this._stretchEnabled=this._defaultStretchMode(),this._canUseDifferenceBlend=!1,this._canUseSaturationBlend=!1,this._hiddenCanvas=null,this._app=null,this._testCanvasBlendModes(),this._modifyExistingElements(),this._updateRealScale(),this._createAllElements(),this._disableTextSelection(),this._disableContextMenu(),this._setupEventHandlers(),this._setupCssFontLoading(),this._setupProgress()}static canUseCssFontLoading(){return!!this._cssFontLoading}static render(t){t&&(this._app.stage=t)}static isWebGL(){return this._renderer&&this._renderer.type===PIXI.RENDERER_TYPE.WEBGL}static canUseDifferenceBlend(){return this._canUseDifferenceBlend}static canUseSaturationBlend(){return this._canUseSaturationBlend}static setLoadingImage(t){this._loadingImage=new Image,this._loadingImage.src=t}static setProgressEnabled(t){this._progressEnabled=t}static startLoading(){this._loadingCount=0,te.truncateProgress(),te.setProgressListener(this._updateProgressCount.bind(this)),this._progressTimeout=setTimeout(()=>{O._showProgress()},1500)}static _setupProgress(){this._progressElement=document.createElement("div"),this._progressElement.id="loading-progress",this._progressElement.width=600,this._progressElement.height=300,this._progressElement.style.visibility="hidden",this._barElement=document.createElement("div"),this._barElement.id="loading-bar",this._barElement.style.width="100%",this._barElement.style.height="10%",this._barElement.style.background="linear-gradient(to top, gray, lightgray)",this._barElement.style.border="5px solid white",this._barElement.style.borderRadius="15px",this._barElement.style.marginTop="40%",this._filledBarElement=document.createElement("div"),this._filledBarElement.id="loading-filled-bar",this._filledBarElement.style.width="0%",this._filledBarElement.style.height="100%",this._filledBarElement.style.background="linear-gradient(to top, lime, honeydew)",this._filledBarElement.style.borderRadius="10px",this._progressElement.appendChild(this._barElement),this._barElement.appendChild(this._filledBarElement),this._updateProgress(),document.body.appendChild(this._progressElement)}static _showProgress(){this._progressEnabled&&(this._progressElement.value=0,this._progressElement.style.visibility="visible",this._progressElement.style.zIndex=98)}static _hideProgress(){this._progressElement&&(this._progressElement.style.visibility="hidden"),clearTimeout(this._progressTimeout)}static _updateProgressCount(t,e){let i;e!==0?i=t/e*100:i=100,this._filledBarElement.style.width=`${i}%`}static _updateProgress(){this._centerElement(this._progressElement)}static updateLoading(){this._loadingCount++,this._paintUpperCanvas(),this._upperCanvas.style.opacity=1,this._updateProgress()}static endLoading(){this._clearUpperCanvas(),this._upperCanvas.style.opacity=0,this._hideProgress()}static printLoadingError(t){if(this._errorPrinter&&!this._errorShowed){this._updateErrorPrinter(),this._errorPrinter.innerHTML=this._makeErrorHtml("Loading Error",`Failed to load: ${t}`),this._errorPrinter.style.userSelect="text",this._errorPrinter.style.webkitUserSelect="text",this._errorPrinter.style.msUserSelect="text",this._errorPrinter.style.mozUserSelect="text",this._errorPrinter.oncontextmenu=null;let e=document.createElement("button");e.innerHTML="Retry",e.style.fontSize="24px",e.style.color="#ffffff",e.style.backgroundColor="#000000",e.addEventListener("touchstart",i=>{i.stopPropagation()}),e.addEventListener("click",i=>{ct.retry()}),this._errorPrinter.appendChild(e),this._loadingCount=-1/0}}static eraseLoadingError(){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML="",this._errorPrinter.style.userSelect="none",this._errorPrinter.style.webkitUserSelect="none",this._errorPrinter.style.msUserSelect="none",this._errorPrinter.style.mozUserSelect="none",this._errorPrinter.oncontextmenu=()=>!1,this._loadingCount=0)}static printError(t,e){this._errorShowed=!0,this._hideProgress(),this.hideFps(),this._errorPrinter&&(this._updateErrorPrinter(),this._errorPrinter.innerHTML=this._makeErrorHtml(t,e),this._errorPrinter.style.userSelect="text",this._errorPrinter.style.webkitUserSelect="text",this._errorPrinter.style.msUserSelect="text",this._errorPrinter.style.mozUserSelect="text",this._errorPrinter.oncontextmenu=null,this._errorMessage&&this._makeErrorMessage()),this._applyCanvasFilter(),this._clearUpperCanvas()}static printErrorDetail(t){if(this._errorPrinter&&this._showErrorDetail){let e=this._formatEventInfo(t),i=this._formatEventCommandInfo(t),s=i?`${e}, ${i}`:e,a=this._formatStackTrace(t);this._makeErrorDetail(s,a)}}static setErrorMessage(t){this._errorMessage=t}static setShowErrorDetail(t){this._showErrorDetail=t}static showFps(){this._fpsMeter&&(this._fpsMeter.extensions.pixi||this._fpsMeter.enableExtension("pixi",[PIXI,this._app]),document.body.appendChild(this._fpsMeter.dom),this._fpsMeter.show(!0))}static hideFps(){this._fpsMeter&&(document.body.contains(this._fpsMeter.dom)&&document.body.removeChild(this._fpsMeter.dom),this._fpsMeter.show(!1))}static loadFont(t,e){let i=document.createElement("style"),s=document.getElementsByTagName("head"),a=`@font-face { font-family: "${t}"; src: url("${e}"); }`;i.type="text/css",s.item(0).appendChild(i),i.sheet.insertRule(a,0),this._createFontLoader(t)}static isFontLoaded(t){if(O._cssFontLoading)return O._fontLoaded?O._fontLoaded.check(`10px "${t}"`):!1;{this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));let e=this._hiddenCanvas.getContext("2d"),i="abcdefghijklmnopqrstuvwxyz",s,a;return e.font=`40px ${t}, sans-serif`,s=e.measureText(i).width,e.font="40px sans-serif",a=e.measureText(i).width,s!==a}}static playVideo(t){this._videoLoader=ct.createLoader(null,this._playVideo.bind(this,t),this._onVideoError.bind(this)),this._playVideo(t)}static _playVideo(t){this._video.src=t,this._video.onloadeddata=this._onVideoLoad.bind(this),this._video.onerror=this._videoLoader,this._video.onended=this._onVideoEnd.bind(this),this._video.load(),this._videoLoading=!0}static isVideoPlaying(){return this._videoLoading||this._isVideoVisible()}static canPlayVideoType(t){return this._video&&this._video.canPlayType(t)}static setVideoVolume(t){this._videoVolume=t,this._video&&(this._video.volume=this._videoVolume)}static pageToCanvasX(t){if(this._canvas){let e=this._canvas.offsetLeft;return Math.round((t-e)/this._realScale)}else return 0}static pageToCanvasY(t){if(this._canvas){let e=this._canvas.offsetTop;return Math.round((t-e)/this._realScale)}else return 0}static isInsideCanvas(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height}static _createAllElements(){this._createErrorPrinter(),this._createCanvas(),this._createVideo(),this._createUpperCanvas(),this._createRenderer(),this._createPixiApp(),this._createFPSMeter(),this._createModeBox(),this._createGameFontLoader()}static _updateAllElements(){this._updateRealScale(),this._updateErrorPrinter(),this._updateCanvas(),this._updateVideo(),this._updateUpperCanvas(),this._updateRenderer(),this._paintUpperCanvas(),this._updateProgress()}static _updateRealScale(){if(this._stretchEnabled){let t=window.innerWidth/this._width,e=window.innerHeight/this._height;t>=1&&t-.01<=1&&(t=1),e>=1&&e-.01<=1&&(e=1),this._realScale=Math.min(t,e)}else this._realScale=this._scale}static _testCanvasBlendModes(){let t,e,i,s;t=document.createElement("canvas"),t.width=1,t.height=1,e=t.getContext("2d"),e.globalCompositeOperation="source-over",e.fillStyle="white",e.fillRect(0,0,1,1),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,1,1),i=e.getImageData(0,0,1,1),e.globalCompositeOperation="source-over",e.fillStyle="black",e.fillRect(0,0,1,1),e.globalCompositeOperation="saturation",e.fillStyle="white",e.fillRect(0,0,1,1),s=e.getImageData(0,0,1,1),this._canUseDifferenceBlend=i.data[0]===0,this._canUseSaturationBlend=s.data[0]===0}static _createErrorPrinter(){this._errorPrinter=document.createElement("p"),this._errorPrinter.id="ErrorPrinter",this._updateErrorPrinter(),document.body.appendChild(this._errorPrinter)}static _updateErrorPrinter(){this._errorPrinter.width=this._width*.9,this._errorShowed&&this._showErrorDetail?this._errorPrinter.height=this._height*.9:this._errorShowed&&this._errorMessage?this._errorPrinter.height=100:this._errorPrinter.height=40,this._errorPrinter.style.textAlign="center",this._errorPrinter.style.textShadow="1px 1px 3px #000",this._errorPrinter.style.fontSize="20px",this._errorPrinter.style.zIndex=99,this._centerElement(this._errorPrinter)}static _makeErrorMessage(){let t=document.createElement("div"),e=t.style;e.color="white",e.textAlign="left",e.fontSize="18px",t.innerHTML=`<hr>${this._errorMessage}`,this._errorPrinter.appendChild(t)}static _makeErrorDetail(t,e){let i=document.createElement("div"),s=i.style;s.color="white",s.textAlign="left",s.fontSize="18px",i.innerHTML=`<br><hr>${t}<br><br>${e}`,this._errorPrinter.appendChild(i)}static _createCanvas(){this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this._updateCanvas(),document.body.appendChild(this._canvas)}static _updateCanvas(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.zIndex=1,this._centerElement(this._canvas)}static _createVideo(){this._video=document.createElement("video"),this._video.id="GameVideo",this._video.style.opacity=0,this._video.setAttribute("playsinline",""),this._video.volume=this._videoVolume,this._updateVideo(),document.body.appendChild(this._video)}static _updateVideo(){this._video.width=this._width,this._video.height=this._height,this._video.style.zIndex=2,this._centerElement(this._video)}static _createUpperCanvas(){this._upperCanvas=document.createElement("canvas"),this._upperCanvas.id="UpperCanvas",this._updateUpperCanvas(),document.body.appendChild(this._upperCanvas)}static _updateUpperCanvas(){this._upperCanvas.width=this._width,this._upperCanvas.height=this._height,this._upperCanvas.style.zIndex=3,this._centerElement(this._upperCanvas)}static _clearUpperCanvas(){this._upperCanvas.getContext("2d").clearRect(0,0,this._width,this._height)}static _paintUpperCanvas(){if(this._clearUpperCanvas(),this._loadingImage&&this._loadingCount>=20){let t=this._upperCanvas.getContext("2d"),e=(this._width-this._loadingImage.width)/2,i=(this._height-this._loadingImage.height)/2,s=((this._loadingCount-20)/30).clamp(0,1);t.save(),t.globalAlpha=s,t.drawImage(this._loadingImage,e,i),t.restore()}}static _updateRenderer(){this._app&&this._app.renderer.resize(this._width,this._height)}static _createFPSMeter(){typeof GameStats=="function"&&(this._fpsMeter=new GameStats({autoPlace:!1}),this._fpsMeter.show(!1),this._fpsMeter.dom.style.zIndex=1)}static _createModeBox(){let t=document.createElement("div");t.id="modeTextBack",t.style.position="absolute",t.style.left="5px",t.style.top="5px",t.style.width="119px",t.style.height="58px",t.style.background="rgba(0,0,0,0.2)",t.style.zIndex=9,t.style.opacity=0;let e=document.createElement("div");e.id="modeText",e.style.position="absolute",e.style.left="0px",e.style.top="41px",e.style.width="119px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.color="white",e.style.textAlign="center",e.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)",e.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode",document.body.appendChild(t),t.appendChild(e),this._modeBox=t}static _createGameFontLoader(){this._createFontLoader("GameFont")}static _centerElement(t){let e=t.width*this._realScale,i=t.height*this._realScale;t.style.position="absolute",t.style.margin="auto",t.style.top=0,t.style.left=0,t.style.right=0,t.style.bottom=0,t.style.width=`${e}px`,t.style.height=`${i}px`}static _applyCanvasFilter(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")}static _onVideoLoad(){this._video.play(),this._updateVisibility(!0),this._videoLoading=!1}static _onVideoError(){this._updateVisibility(!1),this._videoLoading=!1}static _onVideoEnd(){this._updateVisibility(!1)}static _updateVisibility(t){this._video.style.opacity=t?1:0,this._canvas.style.opacity=t?0:1}static _isVideoVisible(){return this._video.style.opacity>0}static _setupEventHandlers(){window.addEventListener("resize",this._onWindowResize.bind(this)),document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keydown",this._onTouchEnd.bind(this)),document.addEventListener("mousedown",this._onTouchEnd.bind(this)),document.addEventListener("touchend",this._onTouchEnd.bind(this))}static _onWindowResize(){this._updateAllElements()}static _onKeyDown(t){if(!t.ctrlKey&&!t.altKey)switch(t.keyCode){case 113:t.preventDefault(),this._switchFPSMeter();break;case 114:t.preventDefault(),this._switchStretchMode();break;case 115:t.preventDefault(),this._switchFullScreen();break}}static _onTouchEnd(t){this._videoUnlocked||(this._video.play(),this._videoUnlocked=!0),this._isVideoVisible()&&this._video.paused&&this._video.play()}static _switchFPSMeter(){this._fpsMeter&&this._fpsMeterToggled?(this.hideFps(),this._fpsMeterToggled=!1):this._fpsMeter&&!this._fpsMeterToggled&&(this.showFps(),this._fpsMeterToggled=!0)}static _switchStretchMode(){this._stretchEnabled=!this._stretchEnabled,this._updateAllElements()}static _switchFullScreen(){this._isFullScreen()?this._cancelFullScreen():this._requestFullScreen()}static _onTick(t){this._fpsMeter&&this._fpsMeter.shown&&this._fpsMeter.begin(),this._app.stage&&this._app.render(),this._fpsMeter&&this._fpsMeter.shown&&this._fpsMeter.end()}static _createPixiApp(){let t={view:this._canvas,width:this._width,height:this._height,resolution:window.devicePixelRatio,powerPreference:"high-performance",autoStart:!0};try{this._app=new PIXI.Application(t),this._app.ticker.remove(this._app.render,this._app),this._app.ticker.add(this._onTick,this)}catch{this._app=null}}static _setupCssFontLoading(){O._cssFontLoading&&document.fonts.ready.then(t=>{O._fontLoaded=t}).catch(t=>{g.onError(t)})}static tickStart(){}static tickEnd(){}static hasWebGL(){if(typeof O._canWebGL=="boolean")return O._canWebGL;try{let t=document.createElement("canvas"),e=!!(t.getContext("webgl")||t.getContext("experimental-webgl"));return O._canWebGL=e,e}catch{return O._canWebGL=!1,!1}}static callGC(){O.isWebGL()&&O._renderer.textureGC.run()}static _makeErrorHtml(t,e){return`<font color="yellow"><b>${t}</b></font><br><font color="white">${decodeURIComponent(e)}</font><br>`}static _defaultStretchMode(){return I.isNwjs()||I.isMobileDevice()||I.isTauri()}static _modifyExistingElements(){let t=document.getElementsByTagName("*");for(let e=0;e<t.length;e++)t[e].style.zIndex>0&&(t[e].style.zIndex=0)}static _formatEventInfo(t){switch(String(t.eventType)){case"map_event":return"MapID: %1, MapEventID: %2, page: %3, line: %4".format(t.mapId,t.mapEventId,t.page,t.line);case"common_event":return"CommonEventID: %1, line: %2".format(t.commonEventId,t.line);case"battle_event":return"TroopID: %1, page: %2, line: %3".format(t.troopId,t.page,t.line);case"test_event":return"TestEvent, line: %1".format(t.line);default:return"No information"}}static _formatEventCommandInfo({eventCommand:t,content:e}){switch(String(t)){case"plugin_command":return`\u25C6Plugin Command: ${e}`;case"script":return`\u25C6Script: ${e}`;case"control_variables":return`\u25C6Control Variables: Script: ${e}`;case"conditional_branch_script":return`\u25C6If: Script: ${e}`;case"set_route_script":return`\u25C6Set Movement Route: \u25C7Script: ${e}`;case"auto_route_script":return`Autonomous Movement Custom Route: \u25C7Script: ${e}`;case"other":default:return""}}static _formatStackTrace({stack:t}){return decodeURIComponent((t||"").replace(/file:.*js\//g,"").replace(/http:.*js\//g,"").replace(/https:.*js\//g,"").replace(/chrome-extension:.*js\//g,"").replace(/\n/g,"<br>"))}static _createRenderer(){}static _createFontLoader(t){let e=document.createElement("div"),i=document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(i),document.body.appendChild(e)}static _disableTextSelection(){let t=document.body;t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.mozUserSelect="none"}static _disableContextMenu(){let t=document.body.getElementsByTagName("*"),e=o(()=>!1,"oncontextmenu");for(let i=0;i<t.length;i++)t[i].oncontextmenu=e}static _isFullScreen(){return document.fullscreenElement||document.mozFullScreen||document.webkitFullscreenElement||document.msFullscreenElement}static _requestFullScreen(){let t=document.body;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()}static _cancelFullScreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}};o(O,"Graphics");O._cssFontLoading=document.fonts&&document.fonts.ready&&document.fonts.ready.then;O._fontLoaded=null;O._videoVolume=1;Object.defineProperty(O,"app",{get(){return this._app},configurable:!0});Object.defineProperty(O,"_renderer",{get(){return this._app.renderer},configurable:!0});O.frameCount=0;O.BLEND_NORMAL=0;O.BLEND_ADD=1;O.BLEND_MULTIPLY=2;O.BLEND_SCREEN=3;O._canWebGL=null;Object.defineProperty(O,"width",{get(){return this._width},set(n){this._width!==n&&(this._width=n,this._updateAllElements())},configurable:!0});Object.defineProperty(O,"height",{get(){return this._height},set(n){this._height!==n&&(this._height=n,this._updateAllElements())},configurable:!0});Object.defineProperty(O,"boxWidth",{get(){return this._boxWidth},set(n){this._boxWidth=n},configurable:!0});Object.defineProperty(O,"boxHeight",{get(){return this._boxHeight},set(n){this._boxHeight=n},configurable:!0});Object.defineProperty(O,"scale",{get(){return this._scale},set(n){this._scale!==n&&(this._scale=n,this._updateAllElements())},configurable:!0});var l=O;var ne=class extends PIXI.Rectangle{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){PIXI.Rectangle.call(this,t,e,i,s)}};o(ne,"Rectangle");ne.emptyRectangle=new ne(0,0,0,0);var G=ne;var dt=class{constructor(...t){this.initialize(...t)}_createCanvas(t,e){if(this.__canvas=this.__canvas||document.createElement("canvas"),this.__context=this.__canvas.getContext("2d"),this.__canvas.width=Math.max(t||0,1),this.__canvas.height=Math.max(e||0,1),this._image){let i=Math.max(this._image.width||0,1),s=Math.max(this._image.height||0,1);this.__canvas.width=i,this.__canvas.height=s,this._createBaseTexture(this._canvas),this.__context.drawImage(this._image,0,0)}this._setDirty()}_createBaseTexture(t){this.__baseTexture=new PIXI.BaseTexture(t),this.__baseTexture.mipmap=!1,this.__baseTexture.width=t.width,this.__baseTexture.height=t.height,this._baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST}_clearImgInstance(){this._image.src="",this._image.onload=null,this._image.onerror=null,this._errorListener=null,this._loadListener=null,dt._reuseImages.push(this._image),this._image=null}_renewCanvas(){let t=this._image;t&&this.__canvas&&(this.__canvas.width<t.width||this.__canvas.height<t.height)&&this._createCanvas()}initialize(t,e){this._defer||this._createCanvas(t,e),this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._loadingState="none",this._decodeAfterRequest=!1,this.cacheEntry=null,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4}isReady(){return this._loadingState==="loaded"||this._loadingState==="none"}isError(){return this._loadingState==="error"}touch(){this.cacheEntry&&this.cacheEntry.touch()}get url(){return this._url}get baseTexture(){return this._baseTexture}get canvas(){return this._canvas}get context(){return this._context}get width(){return this.isReady()?this._image?this._image.width:this._canvas.width:0}get height(){return this.isReady()?this._image?this._image.height:this._canvas.height:0}get rect(){return new G(0,0,this.width,this.height)}get smooth(){return this._smooth}set smooth(t){this._smooth!==!1&&(this._smooth=!1)}get paintOpacity(){return this._paintOpacity}set paintOpacity(t){this._paintOpacity!==t&&(this._paintOpacity=t,this._context.globalAlpha=this._paintOpacity/255)}resize(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._canvas.width=t,this._canvas.height=e,this._baseTexture.width=t,this._baseTexture.height=e}blt({width:t,height:e,_canvas:i},s,a,r,h,c,d,u,f){u=u||r,f=f||h,s=Math.floor(s),a=Math.floor(a),r=Math.floor(r),h=Math.floor(h),c=Math.floor(c),d=Math.floor(d),u=Math.floor(u),f=Math.floor(f),s>=0&&a>=0&&r>0&&h>0&&u>0&&f>0&&s+r<=t&&a+h<=e&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(i,s,a,r,h,c,d,u,f),this._setDirty())}bltImage({width:t,height:e,_image:i},s,a,r,h,c,d,u,f){u=u||r,f=f||h,s>=0&&a>=0&&r>0&&h>0&&u>0&&f>0&&s+r<=t&&a+h<=e&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(i,s,a,r,h,c,d,u,f),this._setDirty())}getPixel(t,e){let i=this._context.getImageData(t,e,1,1).data,s="#";for(let a=0;a<3;a++)s+=i[a].toString(16).padZero(2);return s}getAlphaPixel(t,e){return this._context.getImageData(t,e,1,1).data[3]}clearRect(t,e,i,s){this._context.clearRect(t,e,i,s),this._setDirty()}clear(){this.clearRect(0,0,this.width,this.height)}fillRect(t,e,i,s,a){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),s=Math.floor(s);let r=this._context;r.save(),r.fillStyle=a,r.fillRect(t,e,i,s),r.restore(),this._setDirty()}fillAll(t){this.fillRect(0,0,this.width,this.height,t)}gradientFillRect(t,e,i,s,a,r,h){let c=this._context,d;h?d=c.createLinearGradient(t,e,t,e+s):d=c.createLinearGradient(t,e,t+i,e),d.addColorStop(0,a),d.addColorStop(1,r),c.save(),c.fillStyle=d,c.fillRect(t,e,i,s),c.restore(),this._setDirty()}drawCircle(t,e,i,s){t=Math.floor(t),e=Math.floor(e);let a=this._context;a.save(),a.fillStyle=s,a.beginPath(),a.arc(t,e,i,0,Math.PI*2,!1),a.fill(),a.restore(),this._setDirty()}drawText(t,e,i,s,a,r){if(t!==void 0){e=Math.floor(e),i=Math.floor(i),s=Math.floor(s)||4294967295,a=Math.floor(a);let h=e,c=i+a-Math.round((a-this.fontSize*.7)/2),d=this._context,u=d.globalAlpha;r==="center"&&(h+=s/2),r==="right"&&(h+=s),d.save(),d.font=this._makeFontNameText(),d.textAlign=r,d.textBaseline="alphabetic",d.globalAlpha=1,this._drawTextOutline(t,h,c,s),d.globalAlpha=u,this._drawTextBody(t,h,c,s),d.restore(),this._setDirty()}}drawSmallText(t,e,i,s,a,r){}measureTextWidth(t){let e=this._context;e.save(),e.font=this._makeFontNameText();let i=e.measureText(t).width;return e.restore(),i}adjustTone(t,e,i){if((t||e||i)&&this.width>0&&this.height>0){let s=this._context,a=s.getImageData(0,0,this.width,this.height),r=a.data;for(let h=0;h<r.length;h+=4)r[h+0]+=t,r[h+1]+=e,r[h+2]+=i;s.putImageData(a,0,0),this._setDirty()}}rotateHue(t){if(!t)return;function e(s,a,r){let h=Math.min(s,a,r),c=Math.max(s,a,r),d=0,u=0,f=(h+c)/2,y=c-h;return y>0&&(s===c?d=60*(((a-r)/y+6)%6):a===c?d=60*((r-s)/y+2):d=60*((s-a)/y+4),u=y/(255-Math.abs(2*f-255))),[d,u,f]}o(e,"rgbToHsl");function i(s,a,r){let h=(255-Math.abs(2*r-255))*a,c=h*(1-Math.abs(s/60%2-1)),d=r-h/2,u=h+d,f=c+d;return s<60?[u,f,d]:s<120?[f,u,d]:s<180?[d,u,f]:s<240?[d,f,u]:s<300?[f,d,u]:[u,d,f]}if(o(i,"hslToRgb"),t&&this.width>0&&this.height>0){t=(t%360+360)%360;let s=this._context,a=s.getImageData(0,0,this.width,this.height),r=a.data;for(let h=0;h<r.length;h+=4){let c=e(r[h+0],r[h+1],r[h+2]),d=(c[0]+t)%360,u=c[1],f=c[2],y=i(d,u,f);r[h+0]=y[0],r[h+1]=y[1],r[h+2]=y[2]}s.putImageData(a,0,0),this._setDirty()}}blur(){for(let t=0;t<2;t++){let e=this.width,i=this.height,s=this._canvas,a=this._context,r=document.createElement("canvas"),h=r.getContext("2d");r.width=e+2,r.height=i+2,h.drawImage(s,0,0,e,i,1,1,e,i),h.drawImage(s,0,0,e,1,1,0,e,1),h.drawImage(s,0,0,1,i,0,1,1,i),h.drawImage(s,0,i-1,e,1,1,i+1,e,1),h.drawImage(s,e-1,0,1,i,e+1,1,1,i),a.save(),a.fillStyle="black",a.fillRect(0,0,e,i),a.globalCompositeOperation="lighter",a.globalAlpha=1/9;for(let c=0;c<3;c++)for(let d=0;d<3;d++)a.drawImage(r,d,c,e,i,0,0,e,i);a.restore()}this._setDirty()}addLoadListener(t){this.isReady()?t(this):this._loadListeners.push(t)}_makeFontNameText(){return`${(this.fontItalic?"Italic ":"")+this.fontSize}px ${this.fontFace}`}_drawTextOutline(t,e,i,s){let a=this._context;a.strokeStyle=this.outlineColor,a.lineWidth=this.outlineWidth,a.lineJoin="round",a.strokeText(t,e,i,s)}_drawTextBody(t,e,i,s){let a=this._context;a.fillStyle=this.textColor,a.fillText(t,e,i,s)}_onLoad(){switch(this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._renewCanvas(),this._loadingState){case"requesting":this._loadingState="requestCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break;case"decrypting":window.URL.revokeObjectURL(this._image.src),this._loadingState="decryptCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break}}decode(){switch(this._loadingState){case"requestCompleted":case"decryptCompleted":this._loadingState="loaded",this.__canvas||this._createBaseTexture(this._image),this._setDirty(),this._callLoadListeners();break;case"requesting":case"decrypting":this._decodeAfterRequest=!0,this._loader||(this._loader=ct.createLoader(this._url,this._requestImage.bind(this,this._url),this._onError.bind(this)),this._image.removeEventListener("error",this._errorListener),this._image.addEventListener("error",this._errorListener=this._loader));break;case"pending":case"purged":case"error":this._decodeAfterRequest=!0,this._requestImage(this._url);break}}_callLoadListeners(){for(;this._loadListeners.length>0;)this._loadListeners.shift()(this)}_onError(){this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._loadingState="error"}_setDirty(){this._dirty=!0}checkDirty(){if(this._dirty){this._baseTexture.update();let t=this._baseTexture;setTimeout(()=>{t.update()},0),this._dirty=!1}}_requestImage(t){dt._reuseImages.length!==0?this._image=dt._reuseImages.pop():this._image=new Image,this._decodeAfterRequest&&!this._loader&&(this._loader=ct.createLoader(t,this._requestImage.bind(this,t),this._onError.bind(this))),this._url=t,this._loadingState="requesting",!ht.checkImgIgnore(t)&&ht.hasEncryptedImages?(this._loadingState="decrypting",ht.decryptImg(t,this)):(this._image.src=t,this._image.addEventListener("load",this._loadListener=dt.prototype._onLoad.bind(this)),this._image.addEventListener("error",this._errorListener=this._loader||dt.prototype._onError.bind(this)))}isRequestOnly(){return!(this._decodeAfterRequest||this.isReady())}isRequestReady(){return this._loadingState!=="pending"&&this._loadingState!=="requesting"&&this._loadingState!=="decrypting"}startRequest(){this._loadingState==="pending"&&(this._decodeAfterRequest=!1,this._requestImage(this._url))}static load(t){let e=Object.create(dt.prototype);return e._defer=!0,e.initialize(),e._decodeAfterRequest=!0,e._requestImage(t),e}static snap(t){let e=l.width,i=l.height,s=new dt(e,i),a=s._context,r=PIXI.RenderTexture.create({width:e,height:i});if(t){l._renderer.render(t,{renderTexture:r}),t.worldTransform.identity();let h=null;l.isWebGL()?h=l._renderer.plugins.extract.canvas(r):h=r.baseTexture._canvasRenderTarget.canvas,a.drawImage(h,0,0)}return r.destroy({destroyBase:!0}),s._setDirty(),s}static request(t){let e=Object.create(dt.prototype);return e._defer=!0,e.initialize(),e._url=t,e._loadingState="pending",e}};o(dt,"Bitmap");dt._reuseImages=[];Object.defineProperties(dt.prototype,{_canvas:{get(){return this.__canvas||this._createCanvas(),this.__canvas}},_context:{get(){return this.__context||this._createCanvas(),this.__context}},_baseTexture:{get(){return this.__baseTexture||this._createBaseTexture(this._image||this.__canvas),this.__baseTexture}}});var V=dt;var $t=class{constructor(){throw new Error("This is a static class")}static loadAnimation(t,e){return this.loadBitmap("img/animations/",t,e,!0)}static loadBattleback1(t,e){return this.loadBitmap("img/battlebacks1/",t,e,!0)}static loadBattleback2(t,e){return this.loadBitmap("img/battlebacks2/",t,e,!0)}static loadEnemy(t,e){return this.loadBitmap("img/enemies/",t,e,!0)}static loadCharacter(t,e){return this.loadBitmap("img/characters/",t,e,!1)}static loadFace(t,e){return this.loadBitmap("img/faces/",t,e,!0)}static loadParallax(t,e){return this.loadBitmap("img/parallaxes/",t,e,!0)}static loadPicture(t,e){return this.loadBitmap("img/pictures/",t,e,!0)}static loadSvActor(t,e){return this.loadBitmap("img/sv_actors/",t,e,!1)}static loadSvEnemy(t,e){return this.loadBitmap("img/sv_enemies/",t,e,!0)}static loadSystem(t,e){return this.loadBitmap("img/system/",t,e,!1)}static loadTileset(t,e){return this.loadBitmap("img/tilesets/",t,e,!1)}static loadTitle1(t,e){return this.loadBitmap("img/titles1/",t,e,!0)}static loadTitle2(t,e){return this.loadBitmap("img/titles2/",t,e,!0)}static loadBitmap(t,e,i,s){if(e){let a=`${t+encodeURIComponent(e)}.png`,r=this.loadNormalBitmap(a,i||0);return r.smooth=!1,r}else return this.loadEmptyBitmap()}static loadEmptyBitmap(){let t=this._imageCache.get("empty");return t||(t=new V,this._imageCache.add("empty",t),this._imageCache.reserve("empty",t,this._systemReservationId)),t}static loadNormalBitmap(t,e){let i=this._generateCacheKey(t,e),s=this._imageCache.get(i);return s?s.isReady()||s.decode():(s=V.load(t),this._callCreationHook(s),s.addLoadListener(()=>{s.rotateHue(e)}),this._imageCache.add(i,s)),s}static clear(){this._imageCache=new Ie}static isReady(){return this._imageCache.isReady()}static reserveAnimation(t,e,i){return this.reserveBitmap("img/animations/",t,e,!0,i)}static reserveBattleback1(t,e,i){return this.reserveBitmap("img/battlebacks1/",t,e,!0,i)}static reserveBattleback2(t,e,i){return this.reserveBitmap("img/battlebacks2/",t,e,!0,i)}static reserveEnemy(t,e,i){return this.reserveBitmap("img/enemies/",t,e,!0,i)}static reserveCharacter(t,e,i){return this.reserveBitmap("img/characters/",t,e,!1,i)}static reserveFace(t,e,i){return this.reserveBitmap("img/faces/",t,e,!0,i)}static reserveParallax(t,e,i){return this.reserveBitmap("img/parallaxes/",t,e,!0,i)}static reservePicture(t,e,i){return this.reserveBitmap("img/pictures/",t,e,!0,i)}static reserveSvActor(t,e,i){return this.reserveBitmap("img/sv_actors/",t,e,!1,i)}static reserveSvEnemy(t,e,i){return this.reserveBitmap("img/sv_enemies/",t,e,!0,i)}static reserveSystem(t,e,i){return this.reserveBitmap("img/system/",t,e,!1,i||this._systemReservationId)}static reserveTileset(t,e,i){return this.reserveBitmap("img/tilesets/",t,e,!1,i)}static reserveTitle1(t,e,i){return this.reserveBitmap("img/titles1/",t,e,!0,i)}static reserveTitle2(t,e,i){return this.reserveBitmap("img/titles2/",t,e,!0,i)}static reserveBitmap(t,e,i,s,a){if(e){let r=`${t+encodeURIComponent(e)}.png`,h=this.reserveNormalBitmap(r,i||0,a||this._defaultReservationId);return h.smooth=!1,h}else return this.loadEmptyBitmap()}static reserveNormalBitmap(t,e,i){let s=this.loadNormalBitmap(t,e);return this._imageCache.reserve(this._generateCacheKey(t,e),s,i),s}static releaseReservation(t){this._imageCache.releaseReservation(t)}static setDefaultReservationId(t){this._defaultReservationId=t}static requestAnimation(t,e){return this.requestBitmap("img/animations/",t,e,!0)}static requestBattleback1(t,e){return this.requestBitmap("img/battlebacks1/",t,e,!0)}static requestBattleback2(t,e){return this.requestBitmap("img/battlebacks2/",t,e,!0)}static requestEnemy(t,e){return this.requestBitmap("img/enemies/",t,e,!0)}static requestCharacter(t,e){return this.requestBitmap("img/characters/",t,e,!1)}static requestFace(t,e){return this.requestBitmap("img/faces/",t,e,!0)}static requestParallax(t,e){return this.requestBitmap("img/parallaxes/",t,e,!0)}static requestPicture(t,e){return this.requestBitmap("img/pictures/",t,e,!0)}static requestSvActor(t,e){return this.requestBitmap("img/sv_actors/",t,e,!1)}static requestSvEnemy(t,e){return this.requestBitmap("img/sv_enemies/",t,e,!0)}static requestSystem(t,e){return this.requestBitmap("img/system/",t,e,!1)}static requestTileset(t,e){return this.requestBitmap("img/tilesets/",t,e,!1)}static requestTitle1(t,e){return this.requestBitmap("img/titles1/",t,e,!0)}static requestTitle2(t,e){return this.requestBitmap("img/titles2/",t,e,!0)}static requestBitmap(t,e,i,s){if(e){let a=`${t+encodeURIComponent(e)}.png`,r=this.requestNormalBitmap(a,i||0);return r.smooth=!1,r}else return this.loadEmptyBitmap()}static requestNormalBitmap(t,e){let i=this._generateCacheKey(t,e),s=this._imageCache.get(i);return s?this._requestQueue.raisePriority(i):(s=V.request(t),this._callCreationHook(s),s.addLoadListener(()=>{s.rotateHue(e)}),this._imageCache.add(i,s),this._requestQueue.enqueue(i,s)),s}static update(){this._requestQueue.update()}static clearRequest(){this._requestQueue.clear()}static setCreationHook(t){this._creationHook=t}static _callCreationHook(t){this._creationHook&&this._creationHook(t)}static isObjectCharacter(t){let e=t.match(/^[\!\$]+/);return e&&e[0].contains("!")}static isBigCharacter(t){let e=t.match(/^[\!\$]+/);return e&&e[0].contains("$")}static isZeroParallax(t){return t.charAt(0)==="!"}static _generateCacheKey(t,e){return`${t}:${e}`}};o($t,"ImageManager");$t.cache=new $e($t);$t._imageCache=new Ie;$t._requestQueue=new De;$t._systemReservationId=I.generateRuntimeId();var p=$t;var Le=class{constructor(){throw new Error("This is a static class")}static initialize(){this.clearProgress(),p.setCreationHook(this._bitmapListener.bind(this)),b.setCreationHook(this._audioListener.bind(this))}static _bitmapListener(t){this._countLoading++,t.addLoadListener(()=>{this._countLoaded++,this._progressListener&&this._progressListener(this._countLoaded,this._countLoading)})}static _audioListener(t){this._countLoading++,t.addLoadListener(()=>{this._countLoaded++,this._progressListener&&this._progressListener(this._countLoaded,this._countLoading)})}static setProgressListener(t){this._progressListener=t}static clearProgress(){this._countLoading=0,this._countLoaded=0}static truncateProgress(){this._countLoaded&&(this._countLoading-=this._countLoaded,this._countLoaded=0)}};o(Le,"ProgressWatcher");var te=Le;var Oe=class extends PIXI.Point{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){PIXI.Point.call(this,t,e)}};o(Oe,"Point");var Wt=Oe;var Ne=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){PIXI.Container.call(this),t=Math.max(t||0,1),e=Math.max(e||0,1),this._width=t,this._height=e,this._paintOpacity=255,this.textPadding=2,this.wordWrap=!1,this.wordWrapWidth=0,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4,this.textCache=[],this.on("removed",this.onRemoveAsAChild)}onRemoveAsAChild(){this.textCache=[];for(let t=this.children.length-1;t>=0;t--)this.children[t].destroy({children:!0,texture:!0}),this.removeChild(this.children[t])}get paintOpacity(){return this._paintOpacity}set paintOpacity(t){this._paintOpacity!==t&&(this._paintOpacity=t)}get width(){return this._width}set width(t){this._width!==t&&(this._width=t)}get height(){return this._height}set height(t){this._height!==t&&(this._height=t)}resize(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._width=t,this._height=e}clear(){for(let t=this.children.length-1;t>=0;t--){if(this.children[t].isBitmapText){this.children[t].text="";continue}this.children[t].destroy({children:!0,texture:!0}),this.removeChild(this.children[t])}}clearRect(t,e,i,s){let a=this,r=[];this.children.forEach(h=>{h&&h.x>=t&&h.x<t+i&&h.y>=e&&h.y<e+s&&(h.isBitmapText?h.text="":r.push(h))}),r.forEach(h=>{h.destroy({children:!0,texture:!0}),a.removeChild(h)})}drawText(t,e,i,s,a,r){if(t===void 0)return;let h=this._paintOpacity/255;s=Math.floor(s)||4294967295,a=Math.floor(a),t=String(t),r==="center"?e=e+s/2:r==="right"&&(e=e+s),i=i+a-this.fontSize*1.25,e=Math.floor(e),i=Math.floor(i),this._updateExistingText(t,e,i,h)||this._drawNewText(t,e,i,h,s,a,r)}_updateExistingText(t,e,i,s){for(let a of this.textCache)if(a.x===e&&a.y===i){let r=PIXI.utils.string2hex(this.textColor);return a._tint!==r&&(a.tint=r),a.text!==t&&(a.text=t),a.alpha!==s&&(a.alpha=s),this.addChild(a),!0}return!1}_drawNewText(t,e,i,s,a,r,h){let c={fontFamily:this.fontFace,fontSize:this.fontSize,fill:16777215,lineHeight:r,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,padding:this.textPadding,fontStyle:this.fontItalic?"italic":"normal",stroke:this.outlineColor,strokeThickness:this.outlineWidth};PIXI.BitmapFont.available[c.fontFamily]||this._makeBitmapFont(c);let d=new PIXI.BitmapText(t,{fontName:c.fontFamily,fontSize:c.fontSize});!c.wordWrap&&d.width>a&&(d.scale.x=a/d.width),h==="center"?d.anchor.set(.5,0):h==="right"&&d.anchor.set(1,0),d&&(d.x=e,d.y=i,d.tint=PIXI.utils.string2hex(this.textColor),d.alpha=s,d.isBitmapText=!0,this.textCache.push(d),this.addChild(d))}_makeBitmapFont(t){let e={chars:[[" ","~"],"\u2192","\u2019"]};PIXI.BitmapFont.from(t.fontFamily,t,e)}measureTextWidth(t){t=String(t);let e=new PIXI.TextStyle({fontFamily:this.fontFace,fontSize:this.fontSize,padding:this.textPadding});return PIXI.TextMetrics.measureText(t,e).width}create9Slice(t,e,i,s,a,r,h,c,d){return new PIXI.NineSlicePlane(new PIXI.Texture(t,new PIXI.Rectangle(e,i,s,a)),r,h,c,d)}createTilingSprite(t,e,i,s,a,r,h){return new PIXI.TilingSprite(new PIXI.Texture(t,new PIXI.Rectangle(e,i,s,a)),r,h)}createCroppedSprite(t,e,i,s,a){return new PIXI.Sprite(new PIXI.Texture(t,new PIXI.Rectangle(e,i,s,a)))}blt({width:t,height:e,baseTexture:i},s,a,r,h,c,d,u,f){if(u=u||r,f=f||h,s=Math.floor(s),a=Math.floor(a),r=Math.floor(r),h=Math.floor(h),c=Math.floor(c),d=Math.floor(d),u=Math.floor(u),f=Math.floor(f),s>=0&&a>=0&&r>0&&h>0&&u>0&&f>0&&s+r<=t&&a+h<=e){let y=this.createCroppedSprite(i,s,a,r,h);if(y)return y.x=c,y.y=d,y.width=u,y.height=f,y.alpha=this._paintOpacity/255,this.addChild(y),y}}fillRect(t,e,i,s,a){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),s=Math.floor(s);let r=new PIXI.Graphics;return a=PIXI.utils.string2hex(a),r.beginFill(a),r.drawRect(0,0,i,s),r.endFill(),r&&(r.x=t,r.y=e,r.alpha=this._paintOpacity/255,this.addChild(r)),r}gradientFillRect(t,e,i,s,a,r,h){return this.fillRect(t,e,i,s,a)}drawCircle(t,e,i,s){t=Math.floor(t),e=Math.floor(e);let a=new PIXI.Graphics;return s=PIXI.utils.string2hex(s),a.beginFill(s),a.drawCircle(0,0,i),a.endFill(),a&&(a.x=t,a.y=e,a.alpha=this._paintOpacity/255,this.addChild(a)),a}};o(Ne,"BitmapPIXI");var qt=Ne;var Pt=class extends PIXI.Sprite{constructor(...t){super(),this.initialize(...t)}initialize(t){let e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,e),this.filters=null,this._bitmap=null,this._frame=new G,this._realFrame=new G,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._canvas=null,this._context=null,this._tintTexture=null,this._colorMatrixFilter=null,this.spriteId=Pt._counter++,this.opaque=!1,this.bitmap=t}get bitmap(){return this._bitmap}set bitmap(t){this._bitmap!==t&&(this._bitmap=t,t?(this._refreshFrame=!0,t.addLoadListener(this._onBitmapLoad.bind(this))):(this._refreshFrame=!1,this.texture.frame=G.emptyRectangle))}get width(){return this._frame.width}set width(t){this._frame.width=t,this._refresh()}get height(){return this._frame.height}set height(t){this._frame.height=t,this._refresh()}get opacity(){return this.alpha*255}set opacity(t){this.alpha=t.clamp(0,255)/255}update(){this.children.forEach(t=>{t.update&&t.update()})}move(t,e){this.x=t,this.y=e}setFrame(t,e,i,s){this._refreshFrame=!1;let a=this._frame;(t!==a.x||e!==a.y||i!==a.width||s!==a.height)&&(a.x=t,a.y=e,a.width=i,a.height=s,this._refresh())}getBlendColor(){return this._blendColor.clone()}setBlendColor(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._blendColor.equals(t)||(this._blendColor=t.clone(),this._refresh())}getColorTone(){return this._colorTone.clone()}setColorTone(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._colorTone.equals(t)||(this._colorTone=t.clone(),this._refresh())}_onBitmapLoad(t){t===this._bitmap&&this._refreshFrame&&this._bitmap&&(this._refreshFrame=!1,this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()}_refresh(){let t=Math.floor(this._frame.x),e=Math.floor(this._frame.y),i=Math.floor(this._frame.width),s=Math.floor(this._frame.height),a=this._bitmap?this._bitmap.width:0,r=this._bitmap?this._bitmap.height:0,h=t.clamp(0,a),c=e.clamp(0,r),d=(i-h+t).clamp(0,a-h),u=(s-c+e).clamp(0,r-c);this._realFrame.x=h,this._realFrame.y=c,this._realFrame.width=d,this._realFrame.height=u,this.pivot.x=t-h,this.pivot.y=e-c,d>0&&u>0?this._needsTint()?l.isWebGL()?(this._createTinterWebGL(),this._executeTintWebGL()):(this._createTinter(d,u),this._executeTint(h,c,d,u),this._tintTexture.update(),this.texture.baseTexture=this._tintTexture,this.texture.frame=new G(0,0,d,u)):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.frame=this._realFrame,this._clearTintWebGL()):this._bitmap?this.texture.frame=G.emptyRectangle:(this.texture.baseTexture.width=Math.max(this.texture.baseTexture.width,this._frame.x+this._frame.width),this.texture.baseTexture.height=Math.max(this.texture.baseTexture.height,this._frame.y+this._frame.height),this.texture.frame=this._frame),this.texture._updateID++}_isInBitmapRect(t,e,i,s){return this._bitmap&&t+i>0&&e+s>0&&t<this._bitmap.width&&e<this._bitmap.height}_needsTint(){let t=this._colorTone;return t[0]||t[1]||t[2]||t[3]||this._blendColor[3]>0}_createTinter(t,e){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=t,this._canvas.height=e,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=t,this._tintTexture.height=e,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode}_executeTint(t,e,i,s){let a=this._context,r=this._colorTone,h=this._blendColor;if(a.globalCompositeOperation="copy",a.drawImage(this._bitmap.canvas,t,e,i,s,0,0,i,s),r[0]||r[1]||r[2]||r[3]){if(l.canUseSaturationBlend()){let B=Math.max(0,r[3]);a.globalCompositeOperation="saturation",a.fillStyle=`rgba(255,255,255,${B/255})`,a.fillRect(0,0,i,s)}let y=Math.max(0,r[0]),P=Math.max(0,r[1]),$=Math.max(0,r[2]);if(a.globalCompositeOperation="lighter",a.fillStyle=I.rgbToCssColor(y,P,$),a.fillRect(0,0,i,s),l.canUseDifferenceBlend()){a.globalCompositeOperation="difference",a.fillStyle="white",a.fillRect(0,0,i,s);let B=Math.max(0,-r[0]),E=Math.max(0,-r[1]),F=Math.max(0,-r[2]);a.globalCompositeOperation="lighter",a.fillStyle=I.rgbToCssColor(B,E,F),a.fillRect(0,0,i,s),a.globalCompositeOperation="difference",a.fillStyle="white",a.fillRect(0,0,i,s)}}let c=Math.max(0,h[0]),d=Math.max(0,h[1]),u=Math.max(0,h[2]),f=Math.max(0,h[3]);a.globalCompositeOperation="source-atop",a.fillStyle=I.rgbToCssColor(c,d,u),a.globalAlpha=f/255,a.fillRect(0,0,i,s),a.globalCompositeOperation="destination-in",a.globalAlpha=1,a.drawImage(this._bitmap.canvas,t,e,i,s,0,0,i,s)}_createTinterWebGL(){this.filters||(this.filters=[]),this._colorMatrixFilter||(this._colorMatrixFilter=new PIXI.filters.ColorMatrixFilter,this.filters.push(this._colorMatrixFilter)),this._colorMatrixFilter.enabled=!0}_executeTintWebGL(){let t=this._blendColor,e=t[0]/255,i=t[1]/255,s=t[2]/255,a=t[3]/255;this._colorMatrixFilter.matrix=[e/64,0,0,0,e,0,i/64,0,0,i,0,0,s/64,0,s,0,0,0,1,0],this._colorMatrixFilter.alpha=a}_clearTintWebGL(){this._colorMatrixFilter&&(this._colorMatrixFilter.enabled=!1)}_renderCanvas(t){this.bitmap&&this.bitmap.touch(),!(this.bitmap&&!this.bitmap.isReady())&&this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)}_render(t){this.bitmap&&this.bitmap.touch(),!(this.bitmap&&!this.bitmap.isReady())&&this.texture.frame.width>0&&this.texture.frame.height>0&&(this._bitmap&&this._bitmap.checkDirty(),this._render_PIXI(t))}};o(Pt,"Sprite");Pt.voidFilter=new PIXI.filters.AlphaFilter;Pt._counter=0;Pt.prototype._renderCanvas_PIXI=PIXI.Sprite.prototype._renderCanvas;Pt.prototype._render_PIXI=PIXI.Sprite.prototype._render;var C=Pt;var R=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._margin=20,this._width=l.width+this._margin*2,this._height=l.height+this._margin*2,this._tileWidth=48,this._tileHeight=48,this._mapWidth=0,this._mapHeight=0,this._mapData=null,this._layerWidth=0,this._layerHeight=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Wt,this.flags=[],this.animationCount=0,this.horizontalWrap=!1,this.verticalWrap=!1,this._createLayers(),this.refresh()}get width(){return this._width}set width(t){this._width!==t&&(this._width=t,this._createLayers())}get height(){return this._height}set height(t){this._height!==t&&(this._height=t,this._createLayers())}get tileWidth(){return this._tileWidth}set tileWidth(t){this._tileWidth!==t&&(this._tileWidth=t,this._createLayers())}get tileHeight(){return this._tileHeight}set tileHeight(t){this._tileHeight!==t&&(this._tileHeight=t,this._createLayers())}setData(t,e,i){this._mapWidth=t,this._mapHeight=e,this._mapData=i}isReady(){for(let t=0;t<this.bitmaps.length;t++)if(this.bitmaps[t]&&!this.bitmaps[t].isReady())return!1;return!0}update(){this.animationCount++,this.animationFrame=Math.floor(this.animationCount/30),this.children.forEach(t=>{t.update&&t.update()});for(let t=0;t<this.bitmaps.length;t++)this.bitmaps[t]&&this.bitmaps[t].touch()}refresh(){this._lastTiles.length=0}refreshTileset(){}updateTransform(){let t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),s=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,s),(this._needsRepaint||this._lastAnimationFrame!==this.animationFrame||this._lastStartX!==i||this._lastStartY!==s)&&(this._frameUpdated=this._lastAnimationFrame!==this.animationFrame,this._lastAnimationFrame=this.animationFrame,this._lastStartX=i,this._lastStartY=s,this._paintAllTiles(i,s),this._needsRepaint=!1),this._sortChildren(),super.updateTransform()}_createLayers(){let t=this._width,e=this._height,i=this._margin,s=Math.ceil(t/this._tileWidth)+1,a=Math.ceil(e/this._tileHeight)+1,r=s*this._tileWidth,h=a*this._tileHeight;this._lowerBitmap=new V(r,h),this._upperBitmap=new V(r,h),this._layerWidth=r,this._layerHeight=h,this._lowerLayer=new C,this._lowerLayer.move(-i,-i,t,e),this._lowerLayer.z=0,this._upperLayer=new C,this._upperLayer.move(-i,-i,t,e),this._upperLayer.z=4;for(let c=0;c<4;c++)this._lowerLayer.addChild(new C(this._lowerBitmap)),this._upperLayer.addChild(new C(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)}_updateLayerPositions(t,e){let i=this._margin,s=Math.floor(this.origin.x),a=Math.floor(this.origin.y),r=(s-i).mod(this._layerWidth),h=(a-i).mod(this._layerHeight),c=this._layerWidth-r,d=this._layerHeight-h,u=this._width-c,f=this._height-d;for(let y=0;y<2;y++){let P;y===0?P=this._lowerLayer.children:P=this._upperLayer.children,P[0].move(0,0,c,d),P[0].setFrame(r,h,c,d),P[1].move(c,0,u,d),P[1].setFrame(0,h,u,d),P[2].move(0,d,c,f),P[2].setFrame(r,0,c,f),P[3].move(c,d,u,f),P[3].setFrame(0,0,u,f)}}_paintAllTiles(t,e){let i=Math.ceil(this._width/this._tileWidth)+1,s=Math.ceil(this._height/this._tileHeight)+1;for(let a=0;a<s;a++)for(let r=0;r<i;r++)this._paintTiles(t,e,r,a)}_paintTiles(t,e,i,s){let r=t+i,h=e+s,c=(r*this._tileWidth).mod(this._layerWidth),d=(h*this._tileHeight).mod(this._layerHeight),u=c/this._tileWidth,f=d/this._tileHeight,y=this._readMapData(r,h,0),P=this._readMapData(r,h,1),$=this._readMapData(r,h,2),B=this._readMapData(r,h,3),E=this._readMapData(r,h,4),F=this._readMapData(r,h-1,1),N=[],z=[];this._isHigherTile(y)?z.push(y):N.push(y),this._isHigherTile(P)?z.push(P):N.push(P),N.push(-E),this._isTableTile(F)&&!this._isTableTile(P)&&(R.isShadowingTile(y)||N.push(1e4+F)),this._isOverpassPosition(r,h)?(z.push($),z.push(B)):(this._isHigherTile($)?z.push($):N.push($),this._isHigherTile(B)?z.push(B):N.push(B));let st=this._readLastTiles(0,u,f);if(!N.equals(st)||R.isTileA1(y)&&this._frameUpdated){this._lowerBitmap.clearRect(c,d,this._tileWidth,this._tileHeight);for(let j of N)j<0?this._drawShadow(this._lowerBitmap,E,c,d):j>=1e4?this._drawTableEdge(this._lowerBitmap,F,c,d):this._drawTile(this._lowerBitmap,j,c,d);this._writeLastTiles(0,u,f,N)}let X=this._readLastTiles(1,u,f);if(!z.equals(X)){this._upperBitmap.clearRect(c,d,this._tileWidth,this._tileHeight);for(let j=0;j<z.length;j++)this._drawTile(this._upperBitmap,z[j],c,d);this._writeLastTiles(1,u,f,z)}}_readLastTiles(t,e,i){let s=this._lastTiles[t];if(s){let a=s[i];if(a){let r=a[e];if(r)return r}}return[]}_writeLastTiles(t,e,i,s){let a=this._lastTiles[t];a||(a=this._lastTiles[t]=[]);let r=a[i];r||(r=a[i]=[]),r[e]=s}_drawTile(t,e,i,s){R.isVisibleTile(e)&&(R.isAutotile(e)?this._drawAutotile(t,e,i,s):this._drawNormalTile(t,e,i,s))}_drawNormalTile(t,e,i,s){let a=0;R.isTileA5(e)?a=4:a=5+Math.floor(e/256);let r=this._tileWidth,h=this._tileHeight,c=(Math.floor(e/128)%2*8+e%8)*r,d=Math.floor(e%256/8)%16*h,u=this.bitmaps[a];u&&t.bltImage(u,c,d,r,h,i,s,r,h)}_drawAutotile(t,e,i,s){let a=R.FLOOR_AUTOTILE_TABLE,r=R.getAutotileKind(e),h=R.getAutotileShape(e),c=r%8,d=Math.floor(r/8),u=0,f=0,y=0,P=!1;if(R.isTileA1(e)){let E=[0,1,2,1][this.animationFrame%4];y=0,r===0?(u=E*2,f=0):r===1?(u=E*2,f=3):r===2?(u=6,f=0):r===3?(u=6,f=3):(u=Math.floor(c/4)*8,f=d*6+Math.floor(c/2)%2*3,r%2===0?u+=E*2:(u+=6,a=R.WATERFALL_AUTOTILE_TABLE,f+=this.animationFrame%3))}else R.isTileA2(e)?(y=1,u=c*2,f=(d-2)*3,P=this._isTableTile(e)):R.isTileA3(e)?(y=2,u=c*2,f=(d-6)*2,a=R.WALL_AUTOTILE_TABLE):R.isTileA4(e)&&(y=3,u=c*2,f=Math.floor((d-10)*2.5+(d%2===1?.5:0)),d%2===1&&(a=R.WALL_AUTOTILE_TABLE));let $=a[h],B=this.bitmaps[y];if($&&B){let E=this._tileWidth/2,F=this._tileHeight/2;for(let N=0;N<4;N++){let z=$[N][0],st=$[N][1],X=(u*2+z)*E,j=(f*2+st)*F,wt=i+N%2*E,yt=s+Math.floor(N/2)*F;if(P&&(st===1||st===5)){let At=z,Nt=3;st===1&&(At=[0,3,2,1][z]);let Ht=(u*2+At)*E,lt=(f*2+Nt)*F;t.bltImage(B,Ht,lt,E,F,wt,yt,E,F),yt+=F/2,t.bltImage(B,X,j,E,F/2,wt,yt,E,F/2)}else t.bltImage(B,X,j,E,F,wt,yt,E,F)}}}_drawTableEdge(t,e,i,s){if(R.isTileA2(e)){let a=R.FLOOR_AUTOTILE_TABLE,r=R.getAutotileKind(e),h=R.getAutotileShape(e),c=r%8,d=Math.floor(r/8),u=1,f=c*2,y=(d-2)*3,P=a[h];if(P){let $=this.bitmaps[u],B=this._tileWidth/2,E=this._tileHeight/2;for(let F=0;F<2;F++){let N=P[2+F][0],z=P[2+F][1],st=(f*2+N)*B,X=(y*2+z)*E+E/2,j=i+F%2*B,wt=s+Math.floor(F/2)*E;t.bltImage($,st,X,B,E/2,j,wt,B,E/2)}}}}_drawShadow(t,e,i,s){if(e&15){let a=this._tileWidth/2,r=this._tileHeight/2,h="rgba(0,0,0,0.5)";for(let c=0;c<4;c++)if(e&1<<c){let d=i+c%2*a,u=s+Math.floor(c/2)*r;t.fillRect(d,u,a,r,h)}}}_readMapData(t,e,i){if(this._mapData){let s=this._mapWidth,a=this._mapHeight;return this.horizontalWrap&&(t=t.mod(s)),this.verticalWrap&&(e=e.mod(a)),t>=0&&t<s&&e>=0&&e<a&&this._mapData[(i*a+e)*s+t]||0}else return 0}_isHigherTile(t){return this.flags[t]&16}_isTableTile(t){return R.isTileA2(t)&&this.flags[t]&128}_isOverpassPosition(t,e){return!1}_sortChildren(){this.children.sort(this._compareChildOrder.bind(this))}_compareChildOrder(t,e){return t.z===e.z?t.y===e.y?t.spriteId-e.spriteId:t.y-e.y:t.z-e.z}static isVisibleTile(t){return t>0&&t<this.TILE_ID_MAX}static isAutotile(t){return t>=this.TILE_ID_A1}static getAutotileKind(t){return Math.floor((t-this.TILE_ID_A1)/48)}static getAutotileShape(t){return(t-this.TILE_ID_A1)%48}static makeAutotileId(t,e){return this.TILE_ID_A1+t*48+e}static isSameKindTile(t,e){return this.isAutotile(t)&&this.isAutotile(e)?this.getAutotileKind(t)===this.getAutotileKind(e):t===e}static isTileA1(t){return t>=this.TILE_ID_A1&&t<this.TILE_ID_A2}static isTileA2(t){return t>=this.TILE_ID_A2&&t<this.TILE_ID_A3}static isTileA3(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4}static isTileA4(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX}static isTileA5(t){return t>=this.TILE_ID_A5&&t<this.TILE_ID_A1}static isWaterTile(t){return this.isTileA1(t)?!(t>=this.TILE_ID_A1+96&&t<this.TILE_ID_A1+192):!1}static isWaterfallTile(t){return t>=this.TILE_ID_A1+192&&t<this.TILE_ID_A2?this.getAutotileKind(t)%2===1:!1}static isGroundTile(t){return this.isTileA1(t)||this.isTileA2(t)||this.isTileA5(t)}static isShadowingTile(t){return this.isTileA3(t)||this.isTileA4(t)}static isRoofTile(t){return this.isTileA3(t)&&this.getAutotileKind(t)%16<8}static isWallTopTile(t){return this.isTileA4(t)&&this.getAutotileKind(t)%16<8}static isWallSideTile(t){return(this.isTileA3(t)||this.isTileA4(t))&&this.getAutotileKind(t)%16>=8}static isWallTile(t){return this.isWallTopTile(t)||this.isWallSideTile(t)}static isFloorTypeAutotile(t){return this.isTileA1(t)&&!this.isWaterfallTile(t)||this.isTileA2(t)||this.isWallTopTile(t)}static isWallTypeAutotile(t){return this.isRoofTile(t)||this.isWallSideTile(t)}static isWaterfallTypeAutotile(t){return this.isWaterfallTile(t)}};o(R,"Tilemap");R.TILE_ID_B=0;R.TILE_ID_C=256;R.TILE_ID_D=512;R.TILE_ID_E=768;R.TILE_ID_A5=1536;R.TILE_ID_A1=2048;R.TILE_ID_A2=2816;R.TILE_ID_A3=4352;R.TILE_ID_A4=5888;R.TILE_ID_MAX=8192;R.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]];R.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]];R.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]];var U=R;PIXI.tilemap.ZLayer=o(class ur extends PIXI.Container{constructor(t,e){super(),ur.prototype.__init.call(this),this.tilemap=t,this.z=e}__init(){this._lastAnimationFrame=-1}clear(){let t=this.children;for(let e=0;e<t.length;e++)t[e].clear();this._previousLayers=0}cacheIfDirty(t){let e=this.tilemap,i=this.children,s=this._previousLayers!==i.length;this._previousLayers=i.length;let a=this.canvasBuffer,r=this._tempRender;a||(a=this.canvasBuffer=document.createElement("canvas"),t.constructor.registerPlugin("tilemap",PIXI.tilemap.CanvasTileRenderer),r=this._tempRender=new t.constructor({width:100,height:100,view:a}),r.context=r.rootContext,r.plugins.tilemap.dontUseTransform=!0),(a.width!==e._layerWidth||a.height!==e._layerHeight)&&(a.width=e._layerWidth,a.height=e._layerHeight,s=!0);let h;if(!s){for(h=0;h<i.length;h++)if(i[h].isModified(this._lastAnimationFrame!==e.animationFrame)){s=!0;break}}if(this._lastAnimationFrame=e.animationFrame,s)for(e._hackRenderer&&e._hackRenderer(r),r.context.clearRect(0,0,a.width,a.height),h=0;h<i.length;h++)i[h].clearModify(),i[h].renderCanvas(r);for(this.layerTransform=this.worldTransform,h=0;h<i.length;h++){this.layerTransform=i[h].worldTransform;break}}renderCanvas(t){this.cacheIfDirty(t);let e=this.layerTransform;t.context.setTransform(e.a,e.b,e.c,e.d,e.tx*t.resolution,e.ty*t.resolution),t.context.drawImage(this.canvasBuffer,0,0)}},"ZLayer");var He=class extends U{constructor(...t){super(...t),this.roundPixels=!0}_hackRenderer(t){let e=this.animationFrame%4;return e==3&&(e=1),t.plugins.tilemap.tileAnim[0]=e*this._tileWidth,t.plugins.tilemap.tileAnim[1]=this.animationFrame%3*this._tileHeight,t}renderCanvas(t){this._hackRenderer(t),PIXI.Container.prototype.renderCanvas.call(this,t)}render(t){this._hackRenderer(t),PIXI.Container.prototype.render.call(this,t)}refresh(){this._lastBitmapLength!==this.bitmaps.length&&(this._lastBitmapLength=this.bitmaps.length,this.refreshTileset()),this._needsRepaint=!0}refreshTileset(){let t=this.bitmaps.map(e=>e._baseTexture?new PIXI.Texture(e._baseTexture):e);this.lowerLayer.setBitmaps(t),this.upperLayer.setBitmaps(t)}updateTransform(){let t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),s=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,s),(this._needsRepaint||this._lastStartX!==i||this._lastStartY!==s)&&(this._lastStartX=i,this._lastStartY=s,this._paintAllTiles(i,s),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)}_createLayers(){this._needsRepaint=!0,this.lowerZLayer||(this.addChild(this.lowerZLayer=new PIXI.tilemap.ZLayer(this,0)),this.addChild(this.upperZLayer=new PIXI.tilemap.ZLayer(this,4)),this.lowerZLayer.addChild(this.lowerLayer=new PIXI.tilemap.CompositeRectTileLayer(0,[],!1)),this.lowerLayer.shadowColor=new Float32Array([0,0,0,.5]),this.upperZLayer.addChild(this.upperLayer=new PIXI.tilemap.CompositeRectTileLayer(4,[],!1)))}_updateLayerPositions(t,e){let i=Math.floor(this.origin.x),s=Math.floor(this.origin.y);this.lowerZLayer.position.x=t*this._tileWidth-i,this.lowerZLayer.position.y=e*this._tileHeight-s,this.upperZLayer.position.x=t*this._tileWidth-i,this.upperZLayer.position.y=e*this._tileHeight-s}_paintAllTiles(t,e){this.lowerZLayer.clear(),this.upperZLayer.clear();let i=Math.ceil(this._width/this._tileWidth)+1,s=Math.ceil(this._height/this._tileHeight)+1;for(let a=0;a<s;a++)for(let r=0;r<i;r++)this._paintTiles(t,e,r,a)}_paintTiles(t,e,i,s){let a=t+i,r=e+s,h=i*this._tileWidth,c=s*this._tileHeight,d=this._readMapData(a,r,0),u=this._readMapData(a,r,1),f=this._readMapData(a,r,2),y=this._readMapData(a,r,3),P=this._readMapData(a,r,4),$=this._readMapData(a,r-1,1),B=this.lowerLayer.children[0],E=this.upperLayer.children[0];this._isHigherTile(d)?this._drawTile(E,d,h,c):this._drawTile(B,d,h,c),this._isHigherTile(u)?this._drawTile(E,u,h,c):this._drawTile(B,u,h,c),this._isTableTile($)&&!this._isTableTile(u)&&(U.isShadowingTile(d)||this._drawTableEdge(B,$,h,c)),this._isOverpassPosition(a,r)?(this._drawTile(E,f,h,c),this._drawTile(E,y,h,c)):(this._isHigherTile(f)?this._drawTile(E,f,h,c):this._drawTile(B,f,h,c),this._isHigherTile(y)?this._drawTile(E,y,h,c):this._drawTile(B,y,h,c))}_drawTile(t,e,i,s){U.isVisibleTile(e)&&(U.isAutotile(e)?this._drawAutotile(t,e,i,s):this._drawNormalTile(t,e,i,s))}_drawNormalTile(t,e,i,s){let a=0;U.isTileA5(e)?a=4:a=5+Math.floor(e/256);let r=this._tileWidth,h=this._tileHeight,c=(Math.floor(e/128)%2*8+e%8)*r,d=Math.floor(e%256/8)%16*h;t.addRect(a,c,d,i,s,r,h)}_drawAutotile(t,e,i,s){let a=U.FLOOR_AUTOTILE_TABLE,r=U.getAutotileKind(e),h=U.getAutotileShape(e),c=r%8,d=Math.floor(r/8),u=0,f=0,y=0,P=!1,$=0,B=0;U.isTileA1(e)?(y=0,r===0?($=2,f=0):r===1?($=2,f=3):r===2?(u=6,f=0):r===3?(u=6,f=3):(u=Math.floor(c/4)*8,f=d*6+Math.floor(c/2)%2*3,r%2===0?$=2:(u+=6,a=U.WATERFALL_AUTOTILE_TABLE,B=1))):U.isTileA2(e)?(y=1,u=c*2,f=(d-2)*3,P=this._isTableTile(e)):U.isTileA3(e)?(y=2,u=c*2,f=(d-6)*2,a=U.WALL_AUTOTILE_TABLE):U.isTileA4(e)&&(y=3,u=c*2,f=Math.floor((d-10)*2.5+(d%2===1?.5:0)),d%2===1&&(a=U.WALL_AUTOTILE_TABLE));let E=a[h],F=this._tileWidth/2,N=this._tileHeight/2;for(let z=0;z<4;z++){let st=E[z][0],X=E[z][1],j=(u*2+st)*F,wt=(f*2+X)*N,yt=i+z%2*F,At=s+Math.floor(z/2)*N;if(P&&(X===1||X===5)){let Nt=st,Ht=3;X===1&&(Nt=(4-st)%4);let lt=(u*2+Nt)*F,Vr=(f*2+Ht)*N;t.addRect(y,lt,Vr,yt,At,F,N,$,B),t.addRect(y,j,wt,yt,At+N/2,F,N/2,$,B)}else t.addRect(y,j,wt,yt,At,F,N,$,B)}}_drawTableEdge(t,e,i,s){if(U.isTileA2(e)){let a=U.FLOOR_AUTOTILE_TABLE,r=U.getAutotileKind(e),h=U.getAutotileShape(e),c=r%8,d=Math.floor(r/8),u=1,f=c*2,y=(d-2)*3,P=a[h],$=this._tileWidth/2,B=this._tileHeight/2;for(let E=0;E<2;E++){let F=P[2+E][0],N=P[2+E][1],z=(f*2+F)*$,st=(y*2+N)*B+B/2,X=i+E%2*$,j=s+Math.floor(E/2)*B;t.addRect(u,z,st,X,j,$,B/2)}}}_drawShadow(t,e,i,s){}};o(He,"ShaderTilemap");PIXI.CanvasRenderer&&PIXI.CanvasRenderer.registerPlugin("tilemap",PIXI.tilemap.CanvasTileRenderer);PIXI.tilemap.Constant.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;PIXI.tilemap.Constant.DO_CLEAR=!0;PIXI.tilemap.Constant.boundCountPerBuffer=4;PIXI.tilemap.Constant.maxTextures=4;var ze=He;var ee=class extends PIXI.TilingSprite{constructor(...t){super(...t),this.initialize(...t)}initialize(t){let e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.TilingSprite.call(this,e),this._bitmap=null,this._width=0,this._height=0,this._frame=new G,this.spriteId=C._counter++,this.origin=new Wt,this.bitmap=t}_renderCanvas(t){this._bitmap&&this._bitmap.touch(),this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)}get bitmap(){return this._bitmap}set bitmap(t){this._bitmap!==t&&(this._bitmap=t,this._bitmap?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.frame=G.emptyRectangle)}get opacity(){return this.alpha*255}set opacity(t){this.alpha=t.clamp(0,255)/255}update(){this.children.forEach(t=>{t.update&&t.update()})}move(t,e,i,s){this.x=t||0,this.y=e||0,this._width=i||0,this._height=s||0}setFrame(t,e,i,s){this._frame.x=t,this._frame.y=e,this._frame.width=i,this._frame.height=s,this._refresh()}updateTransform(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.updateTransformTS()}_onBitmapLoad(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()}_refresh(){let t=this._frame.clone();t.width===0&&t.height===0&&this._bitmap&&(t.width=this._bitmap.width,t.height=this._bitmap.height),this.texture.frame=t,this.texture._updateID++,this.tilingTexture=null}_render(t){this._bitmap&&(this._bitmap.touch(),this._bitmap.checkDirty()),this._render_PIXI(t)}};o(ee,"TilingSprite");ee.prototype._renderCanvas_PIXI=PIXI.TilingSprite.prototype._renderCanvas;ee.prototype._render_PIXI=PIXI.TilingSprite.prototype._render;ee.prototype.updateTransformTS=PIXI.TilingSprite.prototype.updateTransform;var Ut=ee;var oe=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._graphics=new PIXI.Graphics,this.addChild(this._graphics),this.opacity=0,this._red=-1,this._green=-1,this._blue=-1,this._colorText="",this.setBlack()}get opacity(){return this.alpha*255}set opacity(t){this.alpha=t.clamp(0,255)/255}get anchor(){return oe.warnYep(),this.scale.x=1,this.scale.y=1,{x:0,y:0}}set anchor(t){this.alpha=t.clamp(0,255)/255}get blendMode(){return this._graphics.blendMode}set blendMode(t){this._graphics.blendMode=t}setBlack(){this.setColor(0,0,0)}setWhite(){this.setColor(255,255,255)}setColor(t,e,i){if(this._red!==t||this._green!==e||this._blue!==i){t=Math.round(t||0).clamp(0,255),e=Math.round(e||0).clamp(0,255),i=Math.round(i||0).clamp(0,255),this._red=t,this._green=e,this._blue=i,this._colorText=I.rgbToCssColor(t,e,i);let s=this._graphics;s.clear();let a=t<<16|e<<8|i;s.beginFill(a,1),s.drawRect(-l.width*5,-l.height*5,l.width*10,l.height*10)}}};o(oe,"ScreenSprite");var St=oe;var xt=class{constructor(){throw new Error("This is a static class")}static setItem(t,e,i){xt._cache[t]||(xt._cache[t]={}),xt._cache[t][i]=e}static getItem(t,e){return!xt._cache[t]||!xt._cache[t][e]?!1:xt._cache[t][e]}};o(xt,"WindowSkinCache");xt._cache={};var Ee=xt;var Ve=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._isWindow=!0,this._windowskin=null,this._width=0,this._height=0,this._cursorRect=new G,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowSpriteContainer=null,this._windowBackSprite=null,this._windowCursorSprite=null,this._windowFrameSprite=null,this._windowContentsSprite=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Wt,this.active=!0,this.downArrowVisible=!1,this.upArrowVisible=!1,this.pause=!1}get windowskin(){return this._windowskin}set windowskin(t){this._windowskin!==t&&(this._windowskin=t,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))}get contents(){return this._windowContentsSprite.children[0]}set contents(t){let e=this._windowContentsSprite.children[0];e&&this._windowContentsSprite.removeChild(e),this._windowContentsSprite.addChild(t)}get width(){return this._width}set width(t){this._width=t,this._refreshAllParts()}get height(){return this._height}set height(t){this._height=t,this._refreshAllParts()}get padding(){return this._padding}set padding(t){this._padding=t,this._refreshAllParts()}get margin(){return this._margin}set margin(t){this._margin=t,this._refreshAllParts()}get opacity(){return this._windowSpriteContainer.alpha*255}set opacity(t){this._windowSpriteContainer.alpha=t.clamp(0,255)/255}get backOpacity(){return this._windowBackSprite.alpha*255}set backOpacity(t){this._windowBackSprite.alpha=t.clamp(0,255)/255}get contentsOpacity(){return this._windowContentsSprite.alpha*255}set contentsOpacity(t){this._windowContentsSprite.alpha=t.clamp(0,255)/255}get openness(){return this._openness}set openness(t){this._openness!==t&&(this._openness=t.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))}update(){this.active&&this._animationCount++,this.children.forEach(t=>{t.update&&t.update()})}move(t,e,i,s){this.x=Math.floor(t||0),this.y=Math.floor(e||0),(this._width!==i||this._height!==s)&&(this._width=Math.floor(i||0),this._height=Math.floor(s||0),this._refreshAllParts())}isOpen(){return this._openness>=255}isClosed(){return this._openness<=0}setCursorRect(t,e,i,s){let a=Math.floor(t||0),r=Math.floor(e||0),h=Math.floor(i||0),c=Math.floor(s||0),d=this._cursorRect;(d.x!==a||d.y!==r||d.width!==h||d.height!==c)&&(this._cursorRect.x=a,this._cursorRect.y=r,this._cursorRect.width=h,this._cursorRect.height=c,this._refreshCursor())}setTone(t,e,i){let s=this._colorTone;t=t/255,e=e/255,i=i/255,t<0&&(t=0),e<0&&(e=0),i<0&&(i=0),(t!==s[0]||e!==s[1]||i!==s[2])&&(this._colorTone=[t,e,i],this._refreshBack())}addChildToBack(t){let e=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(t,e+1)}updateTransform(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),super.updateTransform()}_createAllParts(){this._windowSpriteContainer=new PIXI.Container,this._windowBackSprite=new qt,this._windowCursorSprite=new qt,this._windowFrameSprite=new PIXI.Container,this._windowContentsSprite=new C,this._downArrowSprite=new C,this._upArrowSprite=new C,this._windowPauseSignSprite=new C,this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)}_onWindowskinLoad(){this._refreshAllParts()}_refreshAllParts(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()}_refreshBack(){let t=this._margin,e=this._width-t*2,i=this._height-t*2,s=PIXI.utils.rgb2hex(this._colorTone);e>0&&i>0&&this._windowskin&&!this._windowBackSprite._setupComplete&&(this._windowBackSprite.blt(this._windowskin,0,0,96,96,0,0,e,i),this._windowBackSprite.addChild(this._windowBackSprite.createTilingSprite(this._windowskin.baseTexture,0,96,96,96,e,i)),this._windowBackSprite._setupComplete=!0),this._windowBackSprite.width=e,this._windowBackSprite.height=i,this._windowBackSprite.x=t,this._windowBackSprite.y=t,this._windowBackSprite.children.forEach(a=>{a&&(a.width=e,a.height=i,a.tint=s)})}_refreshFrame(){let t=this._width,e=this._height,i=24;if(t>0&&e>0&&this._windowskin&&!this._windowFrameSprite._setupComplete){let s,a=Ee.getItem(this._windowskin._url,"frame");if(a)s=a;else{let r=new qt,h=this._windowskin,c=96,d=96;r.blt(h,c+i,0+0,c-i*2,i,i,0,t-i*2,i),r.blt(h,c+i,0+d-i,c-i*2,i,i,e-i,t-i*2,i),r.blt(h,c+0,0+i,i,c-i*2,0,i,i,e-i*2),r.blt(h,c+d-i,0+i,i,c-i*2,t-i,i,i,e-i*2),r.blt(h,c+0,0+0,i,i,0,0,i,i),r.blt(h,c+d-i,0+0,i,i,t-i,0,i,i),r.blt(h,c+0,0+d-i,i,i,0,e-i,i,i),r.blt(h,c+d-i,0+d-i,i,i,t-i,e-i,i,i),s=l._renderer.generateTexture(r),r.destroy({children:!0,texture:!0}),Ee.setItem(this._windowskin._url,s,"frame")}this._windowFramePlane=new PIXI.NineSlicePlane(s,12,12,12,12),this._windowFrameSprite.addChild(this._windowFramePlane),this._windowFrameSprite._setupComplete=!0}this._windowFrameSprite._setupComplete&&(this._windowFramePlane.width=t,this._windowFramePlane.height=e)}_refreshCursor(){let t=this._padding,e=this._cursorRect.x+t-this.origin.x,i=this._cursorRect.y+t-this.origin.y,s=this._cursorRect.width,a=this._cursorRect.height;s>0&&a>0&&this._windowskin&&!this._windowCursorSprite._setupComplete&&(this._windowCursorPlane=this._windowCursorSprite.create9Slice(this._windowskin.baseTexture,96,96,48,48,12,12,12,12),this._windowCursorSprite.addChild(this._windowCursorPlane),this._windowCursorSprite._setupComplete=!0),this._windowCursorPlane&&(this._windowCursorPlane.x=e,this._windowCursorPlane.y=i,this._windowCursorPlane.width=s,this._windowCursorPlane.height=a)}_refreshContents(){this._windowContentsSprite.move(this.padding,this.padding),this._windowContentsSprite.children.length&&this._windowContentsSprite.children[0].clear()}_refreshArrows(){let t=this._width,e=this._height,i=24,s=i/2,a=96+i,r=0+i;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(a+s,r+s+i,i,s),this._downArrowSprite.move(t/2,e-s),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(a+s,r,i,s),this._upArrowSprite.move(t/2,s)}_refreshPauseSign(){this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(144,96,24,24),this._windowPauseSignSprite.alpha=0}_updateCursor(){let t=this._animationCount%40,e=this.contentsOpacity;this.active&&(t<20?e-=t*8:e-=(40-t)*8),this._windowCursorSprite.alpha=e/255,this._windowCursorSprite.visible=this.isOpen()}_updateContents(){let t=this._width-this._padding*2,e=this._height-this._padding*2;t>0&&e>0?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,t,e),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1}_updateArrows(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible}_updatePauseSign(){let t=this._windowPauseSignSprite,e=Math.floor(this._animationCount/16)%2,i=Math.floor(this._animationCount/16/2)%2,s=144,a=96,r=24;this.pause?t.alpha<1&&(t.alpha=Math.min(t.alpha+.1,1)):t.alpha=0,t.setFrame(s+e*r,a+i*r,r,r),t.visible=this.isOpen()}};o(Ve,"Window");var qe=Ve;var ie=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._width=0,this._height=0,this.on("removed",this.onRemoveAsAChild)}onRemoveAsAChild(){this.removeChildren()}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}move(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}update(){this.children.forEach(t=>{t.update&&t.update()})}};o(ie,"WindowLayer");ie.voidFilter=new PIXI.filters.AlphaFilter;ie.prototype.render=PIXI.Container.prototype.render;ie.prototype.renderCanvas=PIXI.Container.prototype.renderCanvas;var Ue=ie;var Xe=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this._width=l.width,this._height=l.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Wt}update(){this._updateDimmer(),this._updateAllSprites()}_createBitmaps(){this._rainBitmap=new V(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new V(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new V(9,9),this._snowBitmap.drawCircle(4,4,4,"white")}_createDimmer(){this._dimmerSprite=new St,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)}_updateDimmer(){this._dimmerSprite.opacity=Math.floor(this.power*6)}_updateAllSprites(){let t=Math.floor(this.power*10);for(;this._sprites.length<t;)this._addSprite();for(;this._sprites.length>t;)this._removeSprite();this._sprites.forEach(function(e){this._updateSprite(e),e.x=e.ax-this.origin.x,e.y=e.ay-this.origin.y},this)}_addSprite(){let t=new C(this.viewport);t.opacity=0,this._sprites.push(t),this.addChild(t)}_removeSprite(){this.removeChild(this._sprites.pop())}_updateSprite(t){switch(this.type){case"rain":this._updateRainSprite(t);break;case"storm":this._updateStormSprite(t);break;case"snow":this._updateSnowSprite(t);break}t.opacity<40&&this._rebornSprite(t)}_updateRainSprite(t){t.bitmap=this._rainBitmap,t.rotation=Math.PI/16,t.ax-=6*Math.sin(t.rotation),t.ay+=6*Math.cos(t.rotation),t.opacity-=6}_updateStormSprite(t){t.bitmap=this._stormBitmap,t.rotation=Math.PI/8,t.ax-=8*Math.sin(t.rotation),t.ay+=8*Math.cos(t.rotation),t.opacity-=8}_updateSnowSprite(t){t.bitmap=this._snowBitmap,t.rotation=Math.PI/16,t.ax-=3*Math.sin(t.rotation),t.ay+=3*Math.cos(t.rotation),t.opacity-=3}_rebornSprite(t){t.ax=Math.randomInt(l.width+100)-100+this.origin.x,t.ay=Math.randomInt(l.height+200)-200+this.origin.y,t.opacity=160+Math.randomInt(60)}};o(Xe,"Weather");var Ge=Xe;var Ye=class extends PIXI.filters.ColorMatrixFilter{constructor(){super()}adjustHue(t){this.hue(t,!0)}adjustSaturation(t){t=(t||0).clamp(-255,255)/255,this.saturate(t,!0)}adjustTone(t,e,i){if(t=(t||0).clamp(-255,255)/255,e=(e||0).clamp(-255,255)/255,i=(i||0).clamp(-255,255)/255,t!==0||e!==0||i!==0){let s=[1,0,0,t,0,0,1,0,e,0,0,0,1,i,0,0,0,0,1,0];this._loadMatrix(s,!0)}}};o(Ye,"ToneFilter");var je=Ye;var Ke=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this.clear()}clear(){this._red=0,this._green=0,this._blue=0,this._gray=0}setTone(t,e,i,s){this._red=Math.round(t||0).clamp(-255,255),this._green=Math.round(e||0).clamp(-255,255),this._blue=Math.round(i||0).clamp(-255,255),this._gray=Math.round(s||0).clamp(0,255)}_renderCanvas(t){if(this.visible){let e=t.context,i=this.worldTransform,s=t.resolution,a=l.width,r=l.height;e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx*s,i.ty*s),l.canUseSaturationBlend()&&this._gray>0&&(e.globalCompositeOperation="saturation",e.globalAlpha=this._gray/255,e.fillStyle="#ffffff",e.fillRect(0,0,a,r)),e.globalAlpha=1;let h=Math.max(0,this._red),c=Math.max(0,this._green),d=Math.max(0,this._blue);if((h||c||d)&&(e.globalCompositeOperation="lighter",e.fillStyle=I.rgbToCssColor(h,c,d),e.fillRect(0,0,a,r)),l.canUseDifferenceBlend()){let u=Math.max(0,-this._red),f=Math.max(0,-this._green),y=Math.max(0,-this._blue);(u||f||y)&&(e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,a,r),e.globalCompositeOperation="lighter",e.fillStyle=I.rgbToCssColor(u,f,y),e.fillRect(0,0,a,r),e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,a,r))}e.restore()}}_render(t){}};o(Ke,"ToneSprite");var Ze=Ke;var Je=class extends PIXI.Container{constructor(...t){super(...t),this.initialize(...t)}initialize(){PIXI.Container.call(this),this.interactive=!1}};o(Je,"Stage");var Qe=Je;var It=class{constructor(){throw new Error("This is a static class")}static stringify(t){let e=[];It._id=1;let i=JSON.stringify(this._encode(t,e,0));return this._cleanMetadata(t),this._restoreCircularReference(e),i}static parse(t){let e=[],i={},s=this._decode(JSON.parse(t),e,i);return this._cleanMetadata(s),this._linkCircularReference(s,e,i),s}static makeDeepCopy(t){return this.parse(this.stringify(t))}static _encode(t,e,i=0){if(++i>=this.maxDepth)throw new Error("Object too deep");let s=Object.prototype.toString.call(t);if(s==="[object Object]"||s==="[object Array]"){t["@c"]=It._generateId();let a=this._getConstructorName(t);a!=="Object"&&a!=="Array"&&(t["@"]=a);for(let r in t)(!t.hasOwnProperty||t.hasOwnProperty(r))&&!r.match(/^@./)&&(t[r]&&typeof t[r]=="object"?t[r]["@c"]?(e.push([r,t,t[r]]),t[r]={"@r":t[r]["@c"]}):(t[r]=this._encode(t[r],e,i+1),t[r]instanceof Array&&(e.push([r,t,t[r]]),t[r]={"@c":t[r]["@c"],"@a":t[r]})):t[r]=this._encode(t[r],e,i+1))}return i--,t}static _decode(t,e,i){let s=Object.prototype.toString.call(t);if(s==="[object Object]"||s==="[object Array]"){if(i[t["@c"]]=t,t["@"]===null)t=this._resetPrototype(t,null);else if(t["@"]){let a=window[t["@"]];a&&(t=this._resetPrototype(t,a.prototype))}for(let a in t)if(!t.hasOwnProperty||t.hasOwnProperty(a)){if(t[a]&&t[a]["@a"]){let r=t[a]["@a"];r["@c"]=t[a]["@c"],t[a]=r}t[a]&&t[a]["@r"]&&e.push([a,t,t[a]["@r"]]),t[a]=this._decode(t[a],e,i)}}return t}static _generateId(){return It._id++}static _restoreCircularReference(t){t.forEach(e=>{let i=e[0],s=e[1],a=e[2];s[i]=a})}static _linkCircularReference(t,e,i){e.forEach(s=>{let a=s[0],r=s[1],h=s[2];r[a]=i[h]})}static _cleanMetadata(t){t&&(delete t["@"],delete t["@c"],typeof t=="object"&&Object.keys(t).forEach(e=>{let i=t[e];typeof i=="object"&&It._cleanMetadata(i)}))}static _getConstructorName({constructor:t}){if(!t)return null;let e=t.name;return e===void 0&&(e=/^\s*function\s*([A-Za-z0-9_$]*)/.exec(t)[1]),e}static _resetPrototype(t,e){if(Object.setPrototypeOf!==void 0&&typeof e=="object")Object.setPrototypeOf(t,e);else if("__proto__"in t)t.__proto__=e;else{let i=Object.create(e);for(let s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);t=i}return t}};o(It,"JsonEx");It.maxDepth=100;It._id=1;var Ft=It;var ke=class{constructor(){throw new Error("This is a static class")}static setupWorker(){let t=new Worker("js/game_storage_worker.js");this._worker=new Comlink.wrap(t)}static worker(){return this._worker}static _createWorkerData(t,e){return{webKey:this.isLocalMode()?null:this.webStorageKey(t),id:t,data:e}}static async compress(t){return(await this.worker().compress(this._createWorkerData(null,t))).result}static async decompress(t){return(await this.worker().decompress(Comlink.transfer(this._createWorkerData(null,t),[t.buffer]))).result}static save(t,e){this.isLocalMode()?this.saveToLocalFile(t,e):this.saveToWebStorage(t,e)}static async load(t){return this.isLocalMode()?await this.loadFromLocalFile(t):await this.loadFromWebStorage(t)}static async exists(t){return this.isLocalMode()?this.localFileExists(t):await this.webStorageExists(t)}static remove(t){this.isLocalMode()&&this.removeLocalFile(t)}static async backup(t){if(this.isLocalMode()){if(await this.exists(t)){let e=await this.loadFromLocalFile(t),i=await this.compress(e),s=at("fs"),a=this.localFileDirectoryPath(),r=`${this.localFilePath(t)}.bak`;s.existsSync(a)||s.mkdirSync(a),s.writeFileSync(r,i)}}else this.worker().backupSave(this._createWorkerData(t))}static backupExists(t){if(this.isLocalMode())return this.localFileBackupExists(t)}static cleanBackup(t){if(this.isLocalMode()&&this.backupExists(t)){let e=at("fs"),i=this.localFilePath(t);e.unlinkSync(`${i}.bak`)}}static async restoreBackup(t){if(this.isLocalMode()&&this.backupExists(t)){let e=await this.loadFromLocalBackupFile(t),i=await this.compress(e),s=at("fs"),a=this.localFileDirectoryPath(),r=this.localFilePath(t);s.existsSync(a)||s.mkdirSync(a),s.writeFileSync(r,i),s.unlinkSync(`${r}.bak`)}}static async saveToLocalFile(t,e){let i=await this.compress(e),s=at("fs"),a=this.localFileDirectoryPath(),r=this.localFilePath(t);s.existsSync(a)||s.mkdirSync(a),s.writeFileSync(r,i)}static async loadFromLocalFile(t){let e=at("fs"),i=this.localFilePath(t);if(!e.existsSync(i))return null;let s=await e.promises.readFile(i);return await this.decompress(s)}static async loadFromLocalBackupFile(t){let e=at("fs"),i=`${this.localFilePath(t)}.bak`;if(!e.existsSync(i))return null;let s=await e.promises.readFile(i);return await this.decompress(s)}static localFileBackupExists(t){return at("fs").existsSync(`${this.localFilePath(t)}.bak`)}static localFileExists(t){return at("fs").existsSync(this.localFilePath(t))}static removeLocalFile(t){let e=at("fs"),i=this.localFilePath(t);e.existsSync(i)&&e.unlinkSync(i)}static saveToWebStorage(t,e){this.worker().makeSave(this._createWorkerData(t,e))}static async loadFromWebStorage(t){return(await this.worker().loadSave(this._createWorkerData(t))).result}static async webStorageExists(t){return(await this.worker().checkSaveExists(this._createWorkerData(t))).result}static localFileDirectoryPath(){let t=at("path"),e=t.dirname(process.mainModule.filename);return this.canMakeWwwSaveDirectory()?t.join(e,"save/"):t.join(t.dirname(e),"save/")}static localFilePath(t){let e="";return t<0?e="config.rpgsave":t===0?e="global.rpgsave":e="file%1.rpgsave".format(t),this.localFileDirectoryPath()+e}static canMakeWwwSaveDirectory(){if(this._canMakeWwwSaveDirectory===void 0){let t=at("fs"),e=at("path"),i=e.dirname(process.mainModule.filename),s=e.join(i,"testDirectory/");try{t.mkdirSync(s),t.rmdirSync(s),this._canMakeWwwSaveDirectory=!0}catch{this._canMakeWwwSaveDirectory=!1}}return this._canMakeWwwSaveDirectory}static isLocalMode(){return I.isNwjs()}static uniqueKey(){return"RPGMV"}static webStorageKey(t){return t<0?this.uniqueKey()+" Config":t===0?this.uniqueKey()+" Global":this.uniqueKey()+" File%1".format(t)}};o(ke,"GameStorageManager");ke.setupWorker();var et=ke;var _=class{constructor(){throw new Error("This is a static class")}static basic(t){return self.$dataSystem.terms.basic[t]||""}static param(t){return self.$dataSystem.terms.params[t]||""}static command(t){return self.$dataSystem.terms.commands[t]||""}static message(t){return self.$dataSystem.terms.messages[t]||""}static getter(t,e){return{get(){return this[t](e)},configurable:!0}}};o(_,"TextManager");Object.defineProperty(_,"currencyUnit",{get(){return self.$dataSystem.currencyUnit},configurable:!0});Object.defineProperties(_,{level:_.getter("basic",0),levelA:_.getter("basic",1),hp:_.getter("basic",2),hpA:_.getter("basic",3),mp:_.getter("basic",4),mpA:_.getter("basic",5),tp:_.getter("basic",6),tpA:_.getter("basic",7),exp:_.getter("basic",8),expA:_.getter("basic",9),fight:_.getter("command",0),escape:_.getter("command",1),attack:_.getter("command",2),guard:_.getter("command",3),item:_.getter("command",4),skill:_.getter("command",5),equip:_.getter("command",6),status:_.getter("command",7),formation:_.getter("command",8),save:_.getter("command",9),gameEnd:_.getter("command",10),options:_.getter("command",11),weapon:_.getter("command",12),armor:_.getter("command",13),keyItem:_.getter("command",14),equip2:_.getter("command",15),optimize:_.getter("command",16),clear:_.getter("command",17),newGame:_.getter("command",18),continue_:_.getter("command",19),toTitle:_.getter("command",21),cancel:_.getter("command",22),buy:_.getter("command",24),sell:_.getter("command",25),alwaysDash:_.getter("message","alwaysDash"),commandRemember:_.getter("message","commandRemember"),bgmVolume:_.getter("message","bgmVolume"),bgsVolume:_.getter("message","bgsVolume"),meVolume:_.getter("message","meVolume"),seVolume:_.getter("message","seVolume"),possession:_.getter("message","possession"),expTotal:_.getter("message","expTotal"),expNext:_.getter("message","expNext"),saveMessage:_.getter("message","saveMessage"),loadMessage:_.getter("message","loadMessage"),file:_.getter("message","file"),partyName:_.getter("message","partyName"),emerge:_.getter("message","emerge"),preemptive:_.getter("message","preemptive"),surprise:_.getter("message","surprise"),escapeStart:_.getter("message","escapeStart"),escapeFailure:_.getter("message","escapeFailure"),victory:_.getter("message","victory"),defeat:_.getter("message","defeat"),obtainExp:_.getter("message","obtainExp"),obtainGold:_.getter("message","obtainGold"),obtainItem:_.getter("message","obtainItem"),levelUp:_.getter("message","levelUp"),obtainSkill:_.getter("message","obtainSkill"),useItem:_.getter("message","useItem"),criticalToEnemy:_.getter("message","criticalToEnemy"),criticalToActor:_.getter("message","criticalToActor"),actorDamage:_.getter("message","actorDamage"),actorRecovery:_.getter("message","actorRecovery"),actorGain:_.getter("message","actorGain"),actorLoss:_.getter("message","actorLoss"),actorDrain:_.getter("message","actorDrain"),actorNoDamage:_.getter("message","actorNoDamage"),actorNoHit:_.getter("message","actorNoHit"),enemyDamage:_.getter("message","enemyDamage"),enemyRecovery:_.getter("message","enemyRecovery"),enemyGain:_.getter("message","enemyGain"),enemyLoss:_.getter("message","enemyLoss"),enemyDrain:_.getter("message","enemyDrain"),enemyNoDamage:_.getter("message","enemyNoDamage"),enemyNoHit:_.getter("message","enemyNoHit"),evasion:_.getter("message","evasion"),magicEvasion:_.getter("message","magicEvasion"),magicReflection:_.getter("message","magicReflection"),counterAttack:_.getter("message","counterAttack"),substitute:_.getter("message","substitute"),buffAdd:_.getter("message","buffAdd"),debuffAdd:_.getter("message","debuffAdd"),buffRemove:_.getter("message","buffRemove"),actionFailure:_.getter("message","actionFailure")});var m=_;var ti=class{constructor(){throw new Error("This is a static class")}static preloadImportantSounds(){this.loadSystemSound(0),this.loadSystemSound(1),this.loadSystemSound(2),this.loadSystemSound(3)}static playCursor(){this.playSystemSound(0)}static playOk(){this.playSystemSound(1)}static playCancel(){this.playSystemSound(2)}static playBuzzer(){this.playSystemSound(3)}static playEquip(){this.playSystemSound(4)}static playSave(){this.playSystemSound(5)}static playLoad(){this.playSystemSound(6)}static playBattleStart(){this.playSystemSound(7)}static playEscape(){this.playSystemSound(8)}static playEnemyAttack(){this.playSystemSound(9)}static playEnemyDamage(){this.playSystemSound(10)}static playEnemyCollapse(){this.playSystemSound(11)}static playBossCollapse1(){this.playSystemSound(12)}static playBossCollapse2(){this.playSystemSound(13)}static playActorDamage(){this.playSystemSound(14)}static playActorCollapse(){this.playSystemSound(15)}static playRecovery(){this.playSystemSound(16)}static playMiss(){this.playSystemSound(17)}static playEvasion(){this.playSystemSound(18)}static playMagicEvasion(){this.playSystemSound(19)}static playReflection(){this.playSystemSound(20)}static playShop(){this.playSystemSound(21)}static playUseItem(){this.playSystemSound(22)}static playUseSkill(){this.playSystemSound(23)}static loadSystemSound(t){self.$dataSystem&&b.loadStaticSe(self.$dataSystem.sounds[t])}static playSystemSound(t){self.$dataSystem&&b.playStaticSe(self.$dataSystem.sounds[t])}};o(ti,"SoundManager");var S=ti;var ei=class{constructor(...t){this.initialize(...t)}initialize(t){this._dataClass="",this._itemId=0,t&&this.setObject(t)}isSkill(){return this._dataClass==="skill"}isItem(){return this._dataClass==="item"}isUsableItem(){return this.isSkill()||this.isItem()}isWeapon(){return this._dataClass==="weapon"}isArmor(){return this._dataClass==="armor"}isEquipItem(){return this.isWeapon()||this.isArmor()}isNull(){return this._dataClass===""}itemId(){return this._itemId}object(){return this.isSkill()?self.$dataSkills[this._itemId]:this.isItem()?self.$dataItems[this._itemId]:this.isWeapon()?self.$dataWeapons[this._itemId]:this.isArmor()?self.$dataArmors[this._itemId]:null}setObject(t){w.isSkill(t)?this._dataClass="skill":w.isItem(t)?this._dataClass="item":w.isWeapon(t)?this._dataClass="weapon":w.isArmor(t)?this._dataClass="armor":this._dataClass="",this._itemId=t?t.id:0}setEquip(t,e){this._dataClass=t?"weapon":"armor",this._itemId=e}};o(ei,"Game_Item");var Bt=ei;var A=class{constructor(...t){this.initialize(...t)}initialize(t,e){this._subjectActorId=0,this._subjectEnemyIndex=-1,this._forcing=e||!1,this.setSubject(t),this.clear()}clear(){this._item=new Bt,this._targetIndex=-1}setSubject(t){t.isActor()?(this._subjectActorId=t.actorId(),this._subjectEnemyIndex=-1):(this._subjectEnemyIndex=t.index(),this._subjectActorId=0)}subject(){return this._subjectActorId>0?self.$gameActors.actor(this._subjectActorId):self.$gameTroop.members()[this._subjectEnemyIndex]}friendsUnit(){return this.subject().friendsUnit()}opponentsUnit(){return this.subject().opponentsUnit()}setEnemyAction(t){t?this.setSkill(t.skillId):this.clear()}setAttack(){this.setSkill(this.subject().attackSkillId())}setGuard(){this.setSkill(this.subject().guardSkillId())}setSkill(t){this._item.setObject(self.$dataSkills[t])}setItem(t){this._item.setObject(self.$dataItems[t])}setItemObject(t){this._item.setObject(t)}setTarget(t){this._targetIndex=t}item(){return this._item.object()}isSkill(){return this._item.isSkill()}isItem(){return this._item.isItem()}numRepeats(){let t=this.item().repeats;return this.isAttack()&&(t+=this.subject().attackTimesAdd()),Math.floor(t)}checkItemScope(t){return t.contains(this.item().scope)}isForOpponent(){return this.checkItemScope([1,2,3,4,5,6])}isForFriend(){return this.checkItemScope([7,8,9,10,11])}isForDeadFriend(){return this.checkItemScope([9,10])}isForUser(){return this.checkItemScope([11])}isForOne(){return this.checkItemScope([1,3,7,9,11])}isForRandom(){return this.checkItemScope([3,4,5,6])}isForAll(){return this.checkItemScope([2,8,10])}needsSelection(){return this.checkItemScope([1,7,9])}numTargets(){return this.isForRandom()?this.item().scope-2:0}checkDamageType(t){return t.contains(this.item().damage.type)}isHpEffect(){return this.checkDamageType([1,3,5])}isMpEffect(){return this.checkDamageType([2,4,6])}isDamage(){return this.checkDamageType([1,2])}isRecover(){return this.checkDamageType([3,4])}isDrain(){return this.checkDamageType([5,6])}isHpRecover(){return this.checkDamageType([3])}isMpRecover(){return this.checkDamageType([4])}isCertainHit(){return this.item().hitType===A.HITTYPE_CERTAIN}isPhysical(){return this.item().hitType===A.HITTYPE_PHYSICAL}isMagical(){return this.item().hitType===A.HITTYPE_MAGICAL}isAttack(){return this.item()===self.$dataSkills[this.subject().attackSkillId()]}isGuard(){return this.item()===self.$dataSkills[this.subject().guardSkillId()]}isMagicSkill(){return this.isSkill()?self.$dataSystem.magicSkills.contains(this.item().stypeId):!1}decideRandomTarget(){let t;this.isForDeadFriend()?t=this.friendsUnit().randomDeadTarget():this.isForFriend()?t=this.friendsUnit().randomTarget():t=this.opponentsUnit().randomTarget(),t?this._targetIndex=t.index():this.clear()}setConfusion(){this.setAttack()}prepare(){this.subject().isConfused()&&!this._forcing&&this.setConfusion()}isValid(){return this._forcing&&this.item()||this.subject().canUse(this.item())}speed(){let t=this.subject().agi,e=t+Math.randomInt(Math.floor(5+t/4));return this.item()&&(e+=this.item().speed),this.isAttack()&&(e+=this.subject().attackSpeed()),e}makeTargets(){let t=[];return!this._forcing&&this.subject().isConfused()?t=[this.confusionTarget()]:this.isForOpponent()?t=this.targetsForOpponents():this.isForFriend()&&(t=this.targetsForFriends()),this.repeatTargets(t)}repeatTargets(t){let e=[],i=this.numRepeats();for(let s of t)if(s)for(let a=0;a<i;a++)e.push(s);return e}confusionTarget(){switch(this.subject().confusionLevel()){case 1:return this.opponentsUnit().randomTarget();case 2:return Math.randomInt(2)===0?this.opponentsUnit().randomTarget():this.friendsUnit().randomTarget();default:return this.friendsUnit().randomTarget()}}targetsForOpponents(){let t=[],e=this.opponentsUnit();if(this.isForRandom())for(let i=0;i<this.numTargets();i++)t.push(e.randomTarget());else this.isForOne()?this._targetIndex<0?t.push(e.randomTarget()):t.push(e.smoothTarget(this._targetIndex)):t=e.aliveMembers();return t}targetsForFriends(){let t=[],e=this.friendsUnit();return this.isForUser()?[this.subject()]:(this.isForDeadFriend()?this.isForOne()?t.push(e.smoothDeadTarget(this._targetIndex)):t=e.deadMembers():this.isForOne()?this._targetIndex<0?t.push(e.randomTarget()):t.push(e.smoothTarget(this._targetIndex)):t=e.aliveMembers(),t)}evaluate(){let t=0;return this.itemTargetCandidates().forEach(function(e){let i=this.evaluateWithTarget(e);this.isForAll()?t+=i:i>t&&(t=i,this._targetIndex=e.index())},this),t*=this.numRepeats(),t>0&&(t+=Math.random()),t}itemTargetCandidates(){return this.isValid()?this.isForOpponent()?this.opponentsUnit().aliveMembers():this.isForUser()?[this.subject()]:this.isForDeadFriend()?this.friendsUnit().deadMembers():this.friendsUnit().aliveMembers():[]}evaluateWithTarget(t){if(this.isHpEffect()){let e=this.makeDamageValue(t,!1);return this.isForOpponent()?e/Math.max(t.hp,1):Math.min(-e,t.mhp-t.hp)/t.mhp}}testApply(t){return this.isForDeadFriend()===t.isDead()&&(self.$gameParty.inBattle()||this.isForOpponent()||this.isHpRecover()&&t.hp<t.mhp||this.isMpRecover()&&t.mp<t.mmp||this.hasItemAnyValidEffects(t))}hasItemAnyValidEffects(t){return this.item().effects.some(function(e){return this.testItemEffect(t,e)},this)}testItemEffect(t,{code:e,value1:i,value2:s,dataId:a}){switch(e){case A.EFFECT_RECOVER_HP:return t.hp<t.mhp||i<0||s<0;case A.EFFECT_RECOVER_MP:return t.mp<t.mmp||i<0||s<0;case A.EFFECT_ADD_STATE:return!t.isStateAffected(a);case A.EFFECT_REMOVE_STATE:return t.isStateAffected(a);case A.EFFECT_ADD_BUFF:return!t.isMaxBuffAffected(a);case A.EFFECT_ADD_DEBUFF:return!t.isMaxDebuffAffected(a);case A.EFFECT_REMOVE_BUFF:return t.isBuffAffected(a);case A.EFFECT_REMOVE_DEBUFF:return t.isDebuffAffected(a);case A.EFFECT_LEARN_SKILL:return t.isActor()&&!t.isLearnedSkill(a);default:return!0}}itemCnt(t){return this.isPhysical()&&t.canMove()?t.cnt:0}itemMrf({mrf:t}){return this.isMagical()?t:0}itemHit(t){return this.isPhysical()?this.item().successRate*.01*this.subject().hit:this.item().successRate*.01}itemEva({eva:t,mev:e}){return this.isPhysical()?t:this.isMagical()?e:0}itemCri({cev:t}){return this.item().damage.critical?this.subject().cri*(1-t):0}apply(t){let e=t.result();if(this.subject().clearResult(),e.clear(),e.used=this.testApply(t),e.missed=this.processItemHitFormula(e,t),e.evaded=this.processItemEvaFormula(e,t),e.physical=this.isPhysical(),e.drain=this.isDrain(),e.isHit()){if(this.item().damage.type>0){e.critical=this.processItemCriFormula(e,t);let i=this.makeDamageValue(t,e.critical);this.executeDamage(t,i),this.subject().onApplyDamage(this,t,i),t.onReceiveDamage(this,this.subject(),i),e.critical&&(this.subject().onApplyCritical(this,t,i),t.onReceiveCritical(this,this.subject(),i))}this.item().effects.forEach(function(i){this.applyItemEffect(t,i)},this),this.applyItemUserEffect(t)}else this.subject().onHitAction(this,t),t.onEvadeAction(this,this.subject())}processItemHitFormula(t,e){return t.used&&Math.random()>=this.itemHit(e)}processItemEvaFormula(t,e){return!t.missed&&Math.random()<this.itemEva(e)}processItemCriFormula(t,e){return Math.random()<this.itemCri(e)}makeDamageValue(t,e){let i=this.item(),s=this.evalDamageFormula(t),a=this.processElementalDamage(i,s,t,e);return this.isPhysical()&&(a=this.processPhysicalDamage(i,a,t,e)),this.isMagical()&&(a=this.processMagicalDamage(i,a,t,e)),s<0&&(a=this.processRecoveryDamage(i,a,t,e)),e&&(a=this.processCriticalDamage(i,a,t,e)),a=this.processVarianceDamage(i,a,t,e),a=this.processGuardDamage(i,a,t,e),a=this.processDamageEnd(i,a,t,e),a}processElementalDamage(t,e,i,s){return e*this.calcElementRate(i)}processPhysicalDamage(t,e,i,s){return e*=i.pdr}processMagicalDamage(t,e,i,s){return e*=i.mdr}processRecoveryDamage(t,e,i,s){return e*=i.rec}processCriticalDamage(t,e,i,s){return this.applyCritical(e)}processVarianceDamage(t,e,i,s){return this.applyVariance(e,t.damage.variance)}processGuardDamage(t,e,i,s){return this.applyGuard(e,i)}processDamageEnd(t,e,i,s){return Math.round(e)}evalDamageFormula(t){try{let e=this.item(),i=this.subject(),s=t,a=self.$gameVariables._data,r=self.$gameSwitches._data,h=[3,4].contains(e.damage.type)?-1:1,c=this,d=new Function("{ context, item, a, b, v, s }","return "+e.damage.formula)({context:c,item:e,a:i,b:s,v:a,s:r}),u=Math.max(d,0)*h;return isNaN(u)&&(u=0),u}catch{return 0}}calcElementRate(t){return this.item().damage.elementId<0?this.elementsMaxRate(t,this.subject().attackElements()):t.elementRate(this.item().damage.elementId)}elementsMaxRate(t,e){return e.length>0?Math.max.apply(null,e.map(i=>t.elementRate(i),this)):1}applyCritical(t){return t*3}applyVariance(t,e){let i=Math.floor(Math.max(Math.abs(t)*e/100,0)),s=Math.randomInt(i+1)+Math.randomInt(i+1)-i;return t>=0?t+s:t-s}applyGuard(t,e){return t/(t>0&&e.isGuard()?2*e.grd:1)}executeDamage(t,e){let i=t.result();e===0&&(i.critical=!1),this.isHpEffect()&&this.executeHpDamage(t,e),this.isMpEffect()&&this.executeMpDamage(t,e)}executeHpDamage(t,e){this.isDrain()&&(e=Math.min(t.hp,e)),this.makeSuccess(t),t.gainHp(-e),e>0&&t.onDamage(e),this.gainDrainedHp(e)}executeMpDamage(t,e){this.isMpRecover()||(e=Math.min(t.mp,e)),e!==0&&this.makeSuccess(t),t.gainMp(-e),this.gainDrainedMp(e)}gainDrainedHp(t){if(this.isDrain()){let e=this.subject();this._reflectionTarget!==void 0&&(e=this._reflectionTarget),e.gainHp(t)}}gainDrainedMp(t){if(this.isDrain()){let e=this.subject();this._reflectionTarget!==void 0&&(e=this._reflectionTarget),e.gainMp(t)}}applyItemEffect(t,e){switch(e.code){case A.EFFECT_RECOVER_HP:this.itemEffectRecoverHp(t,e);break;case A.EFFECT_RECOVER_MP:this.itemEffectRecoverMp(t,e);break;case A.EFFECT_GAIN_TP:this.itemEffectGainTp(t,e);break;case A.EFFECT_ADD_STATE:this.itemEffectAddState(t,e);break;case A.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(t,e);break;case A.EFFECT_ADD_BUFF:this.itemEffectAddBuff(t,e);break;case A.EFFECT_ADD_DEBUFF:this.itemEffectAddDebuff(t,e);break;case A.EFFECT_REMOVE_BUFF:this.itemEffectRemoveBuff(t,e);break;case A.EFFECT_REMOVE_DEBUFF:this.itemEffectRemoveDebuff(t,e);break;case A.EFFECT_SPECIAL:this.itemEffectSpecial(t,e);break;case A.EFFECT_GROW:this.itemEffectGrow(t,e);break;case A.EFFECT_LEARN_SKILL:this.itemEffectLearnSkill(t,e);break;case A.EFFECT_COMMON_EVENT:this.itemEffectCommonEvent(t,e);break}}itemEffectRecoverHp(t,{value1:e,value2:i}){let s=(t.mhp*e+i)*t.rec;this.isItem()&&(s*=this.subject().pha),s=Math.floor(s),s!==0&&(t.gainHp(s),this.makeSuccess(t))}itemEffectRecoverMp(t,{value1:e,value2:i}){let s=(t.mmp*e+i)*t.rec;this.isItem()&&(s*=this.subject().pha),s=Math.floor(s),s!==0&&(t.gainMp(s),this.makeSuccess(t))}itemEffectGainTp(t,{value1:e}){let i=Math.floor(e);i!==0&&(t.gainTp(i),this.makeSuccess(t))}itemEffectAddState(t,e){e.dataId===0?this.itemEffectAddAttackState(t,e):this.itemEffectAddNormalState(t,e)}itemEffectAddAttackState(t,{value1:e}){this.subject().attackStates().forEach(i=>{let s=e;s*=t.stateRate(i),s*=this.subject().attackStatesRate(i),s*=this.lukEffectRate(t),Math.random()<s&&(t.addState(i,this.subject()),this.makeSuccess(t))},t)}itemEffectAddNormalState(t,{value1:e,dataId:i}){let s=e;this.isCertainHit()||(s*=t.stateRate(i),s*=this.lukEffectRate(t)),Math.random()<s&&(t.addState(i,this.subject()),this.makeSuccess(t))}itemEffectRemoveState(t,{value1:e,dataId:i}){let s=e;Math.random()<s&&(t.removeState(i),this.makeSuccess(t))}itemEffectAddBuff(t,{dataId:e,value1:i}){t.addBuff(e,i),this.makeSuccess(t)}itemEffectAddDebuff(t,{dataId:e,value1:i}){let s=t.debuffRate(e)*this.lukEffectRate(t);Math.random()<s&&(t.addDebuff(e,i),this.makeSuccess(t))}itemEffectRemoveBuff(t,{dataId:e}){t.isBuffAffected(e)&&(t.removeBuff(e),this.makeSuccess(t))}itemEffectRemoveDebuff(t,{dataId:e}){t.isDebuffAffected(e)&&(t.removeBuff(e),this.makeSuccess(t))}itemEffectSpecial(t,{dataId:e}){e===A.SPECIAL_EFFECT_ESCAPE&&(t.escape(),this.makeSuccess(t))}itemEffectGrow(t,{dataId:e,value1:i}){t.addParam(e,Math.floor(i)),this.makeSuccess(t)}itemEffectLearnSkill(t,{dataId:e}){t.isActor()&&(t.learnSkill(e),this.makeSuccess(t))}itemEffectCommonEvent(t,e){}makeSuccess(t){t.result().success=!0}applyItemUserEffect(t){let e=Math.floor(this.item().tpGain*this.subject().tcr);this.subject().gainSilentTp(e)}lukEffectRate({luk:t}){return Math.max(1+(this.subject().luk-t)*.001,0)}applyGlobal(){this.item().effects.forEach(({code:t,dataId:e})=>{t===A.EFFECT_COMMON_EVENT&&self.$gameTemp.reserveCommonEvent(e)},this)}};o(A,"Game_Action");A.EFFECT_RECOVER_HP=11;A.EFFECT_RECOVER_MP=12;A.EFFECT_GAIN_TP=13;A.EFFECT_ADD_STATE=21;A.EFFECT_REMOVE_STATE=22;A.EFFECT_ADD_BUFF=31;A.EFFECT_ADD_DEBUFF=32;A.EFFECT_REMOVE_BUFF=33;A.EFFECT_REMOVE_DEBUFF=34;A.EFFECT_SPECIAL=41;A.EFFECT_GROW=42;A.EFFECT_LEARN_SKILL=43;A.EFFECT_COMMON_EVENT=44;A.SPECIAL_EFFECT_ESCAPE=0;A.HITTYPE_CERTAIN=0;A.HITTYPE_PHYSICAL=1;A.HITTYPE_MAGICAL=2;var mt=A;var ii=class extends Qe{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._active=!1,this._fadeSign=0,this._fadeDuration=0,this._fadeSprite=null,this._imageReservationId=I.generateRuntimeId()}attachReservation(){p.setDefaultReservationId(this._imageReservationId)}detachReservation(){p.releaseReservation(this._imageReservationId)}create(){}isActive(){return this._active}isReady(){return p.isReady()}start(){this._active=!0}update(){this.updateFade(),this.updateChildren()}stop(){this._active=!1}isBusy(){return this._fadeDuration>0}terminate(){}createWindowLayer(){let t=l.boxWidth,e=l.boxHeight,i=(l.width-t)/2,s=(l.height-e)/2;this._windowLayer=new Ue,this._windowLayer.move(i,s,t,e),this.addChild(this._windowLayer)}addWindow(t){this._windowLayer.addChild(t)}startFadeIn(t,e){this.createFadeSprite(e),this._fadeSign=1,this._fadeDuration=t||30,this._fadeSprite.opacity=255}startFadeOut(t,e){this.createFadeSprite(e),this._fadeSign=-1,this._fadeDuration=t||30,this._fadeSprite.opacity=0}createFadeSprite(t){this._fadeSprite||(this._fadeSprite=new St,this.addChild(this._fadeSprite)),t?this._fadeSprite.setWhite():this._fadeSprite.setBlack()}updateFade(){if(this._fadeDuration>0){let t=this._fadeDuration;this._fadeSign>0?this._fadeSprite.opacity-=this._fadeSprite.opacity/t:this._fadeSprite.opacity+=(255-this._fadeSprite.opacity)/t,this._fadeDuration--}}updateChildren(){this.children.forEach(t=>{t.update&&t.update()})}popScene(){g.pop()}checkGameover(){self.$gameParty.isAllDead()&&g.goto(Tt)}fadeOutAll(){let t=this.slowFadeSpeed()/60;b.fadeOutBgm(t),b.fadeOutBgs(t),b.fadeOutMe(t),this.startFadeOut(this.slowFadeSpeed())}fadeSpeed(){return 24}slowFadeSpeed(){return this.fadeSpeed()*2}};o(ii,"Scene_Base");var it=ii;var si=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this._pictureId=t,this._pictureName="",this.update()}picture(){return self.$gameScreen.picture(this._pictureId)}update(){super.update(),this.updateBitmap(),this.visible&&(this.updateOrigin(),this.updatePosition(),this.updateScale(),this.updateTone(),this.updateOther())}updateBitmap(){let t=this.picture();if(t){let e=t.name();this._pictureName!==e&&(this._pictureName=e,this.loadBitmap()),this.visible=!0}else this._pictureName="",this.bitmap=null,this.visible=!1}updateOrigin(){this.picture().origin()===0?(this.anchor.x=0,this.anchor.y=0):(this.anchor.x=.5,this.anchor.y=.5)}updatePosition(){let t=this.picture();this.x=Math.floor(t.x()),this.y=Math.floor(t.y())}updateScale(){let t=this.picture();this.scale.x=t.scaleX()/100,this.scale.y=t.scaleY()/100}updateTone(){let t=this.picture();t.tone()?this.setColorTone(t.tone()):this.setColorTone([0,0,0,0])}updateOther(){let t=this.picture();this.opacity=t.opacity(),this.blendMode=t.blendMode(),this.rotation=t.angle()*Math.PI/180}loadBitmap(){this.bitmap=p.loadPicture(this._pictureName)}};o(si,"Sprite_Picture");var ai=si;var ri=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._seconds=0,this.createBitmap(),this.update()}createBitmap(){this.bitmap=new V(96,48),this.bitmap.fontSize=32}update(){super.update(),this.updateBitmap(),this.updatePosition(),this.updateVisibility()}updateBitmap(){this._seconds!==self.$gameTimer.seconds()&&(this._seconds=self.$gameTimer.seconds(),this.redraw())}redraw(){let t=this.timerText(),e=this.bitmap.width,i=this.bitmap.height;this.bitmap.clear(),this.bitmap.drawText(t,0,0,e,i,"center")}timerText(){let t=Math.floor(this._seconds/60)%60,e=this._seconds%60;return`${t.padZero(2)}:${e.padZero(2)}`}updatePosition(){this.x=l.width-this.bitmap.width,this.y=0}updateVisibility(){this.visible=self.$gameTimer.isWorking()}};o(ri,"Sprite_Timer");var ni=ri;var oi=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.setFrame(0,0,l.width,l.height),this._tone=[0,0,0,0],this.opaque=!0,this.createLowerLayer(),this.createToneChanger(),this.createUpperLayer(),this.update()}createLowerLayer(){this.createBaseSprite()}createUpperLayer(){this.createPictures(),this.createTimer(),this.createScreenSprites()}update(){super.update(),this.updateScreenSprites(),this.updateToneChanger(),this.updatePosition()}createBaseSprite(){this._baseSprite=new C,this._baseSprite.setFrame(0,0,this.width,this.height),this._blackScreen=new St,this._blackScreen.opacity=255,this.addChild(this._baseSprite),this._baseSprite.addChild(this._blackScreen)}createToneChanger(){l.isWebGL()?this.createWebGLToneChanger():this.createCanvasToneChanger()}createWebGLToneChanger(){let e=l.width+96,i=l.height+48*2;this._toneFilter=new je,this._toneFilter.enabled=!1,this._baseSprite.filters=[this._toneFilter],this._baseSprite.filterArea=new G(-48,-48,e,i)}createCanvasToneChanger(){this._toneSprite=new Ze,this.addChild(this._toneSprite)}createPictures(){let t=l.boxWidth,e=l.boxHeight,i=(l.width-t)/2,s=(l.height-e)/2;this._pictureContainer=new C,this._pictureContainer.setFrame(i,s,t,e);for(let a=1;a<=self.$gameScreen.maxPictures();a++)this._pictureContainer.addChild(new ai(a));this.addChild(this._pictureContainer)}createTimer(){this._timerSprite=new ni,this.addChild(this._timerSprite)}createScreenSprites(){this._flashSprite=new St,this._fadeSprite=new St,this.addChild(this._flashSprite),this.addChild(this._fadeSprite)}updateScreenSprites(){let t=self.$gameScreen.flashColor();this._flashSprite.setColor(t[0],t[1],t[2]),this._flashSprite.opacity=t[3],this._fadeSprite.opacity=255-self.$gameScreen.brightness()}updateToneChanger(){let t=self.$gameScreen.tone();this._tone.equals(t)||(this._tone=t.clone(),l.isWebGL()?this.updateWebGLToneChanger():this.updateCanvasToneChanger())}updateWebGLToneChanger(){let t=this._tone;this._toneFilter.reset(),t[0]||t[1]||t[2]||t[3]?(this._toneFilter.enabled=!0,this._toneFilter.adjustTone(t[0],t[1],t[2]),this._toneFilter.adjustSaturation(-t[3])):this._toneFilter.enabled=!1}updateCanvasToneChanger(){let t=this._tone;this._toneSprite.setTone(t[0],t[1],t[2],t[3])}updatePosition(){let t=self.$gameScreen,e=t.zoomScale();this.scale.x=e,this.scale.y=e,this.x=Math.round(-t.zoomX()*(e-1)),this.y=Math.round(-t.zoomY()*(e-1)),this.x+=Math.round(t.shake())}};o(oi,"Spriteset_Base");var he=oi;var gt=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._reduceArtifacts=!0,this.initMembers()}initMembers(){this._target=null,this._animation=null,this._mirror=!1,this._delay=0,this._rate=4,this._duration=0,this._flashColor=[0,0,0,0],this._flashDuration=0,this._screenFlashDuration=0,this._hidingDuration=0,this._bitmap1=null,this._bitmap2=null,this._cellSprites=[],this._screenFlashSprite=null,this._duplicated=!1,this.z=8}setup(t,e,i,s){this._target=t,this._animation=e,this._mirror=i,this._delay=s,this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())}remove(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())}setupRate(){this._rate=4}setupDuration(){this._duration=this._animation.frames.length*this._rate+1}update(){super.update(),this.updateMain(),this.updateFlash(),this.updateScreenFlash(),this.updateHiding(),gt._checker1={},gt._checker2={}}updateFlash(){if(this._flashDuration>0){let t=this._flashDuration--;this._flashColor[3]*=(t-1)/t,this._target.setBlendColor(this._flashColor)}}updateScreenFlash(){if(this._screenFlashDuration>0){let t=this._screenFlashDuration--;this._screenFlashSprite&&(this._screenFlashSprite.x=-this.absoluteX(),this._screenFlashSprite.y=-this.absoluteY(),this._screenFlashSprite.opacity*=(t-1)/t,this._screenFlashSprite.visible=this._screenFlashDuration>0)}}absoluteX(){let t=0,e=this;for(;e;)t+=e.x,e=e.parent;return t}absoluteY(){let t=0,e=this;for(;e;)t+=e.y,e=e.parent;return t}updateHiding(){this._hidingDuration>0&&(this._hidingDuration--,this._hidingDuration===0&&this._target.show())}isPlaying(){return this._duration>0}loadBitmaps(){let t=this._animation.animation1Name,e=this._animation.animation2Name,i=this._animation.animation1Hue,s=this._animation.animation2Hue;this._bitmap1=p.loadAnimation(t,i),this._bitmap2=p.loadAnimation(e,s)}isReady(){return this._bitmap1&&this._bitmap1.isReady()&&this._bitmap2&&this._bitmap2.isReady()}createSprites(){gt._checker2[this._animation]||(this.createCellSprites(),this._animation.position===3&&(gt._checker2[this._animation]=!0),this.createScreenFlashSprite()),gt._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,this._animation.position===3&&(gt._checker1[this._animation]=!0))}createCellSprites(){this._cellSprites=[];for(let t=0;t<16;t++){let e=new C;e.anchor.x=.5,e.anchor.y=.5,this._cellSprites.push(e),this.addChild(e)}}createScreenFlashSprite(){this._screenFlashSprite=new St,this.addChild(this._screenFlashSprite)}updateMain(){this.isPlaying()&&this.isReady()&&(this._delay>0?this._delay--:(this._duration--,this.updatePosition(),this._duration%this._rate===0&&this.updateFrame()))}updatePosition(){if(this._animation.position===3)this.x=this.parent.width/2,this.y=this.parent.height/2;else{let t=this._target.parent,e=t?t.parent:null;this.x=this._target.x,this.y=this._target.y,this.parent===e&&(this.x+=t.x,this.y+=t.y),this._animation.position===0?this.y-=this._target.height:this._animation.position===1&&(this.y-=this._target.height/2)}}updateFrame(){if(this._duration>0){let t=this.currentFrameIndex();this.updateAllCellSprites(this._animation.frames[t]),this._animation.timings.forEach(function(e){e.frame===t&&this.processTimingData(e)},this)}}currentFrameIndex(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)}updateAllCellSprites(t){this._cellSprites.forEach((e,i)=>{i<t.length?this.updateCellSprite(e,t[i]):e.visible=!1})}updateCellSprite(t,e){let i=e[0];if(i>=0){let s=i%5*192,a=Math.floor(i%100/5)*192,r=this._mirror;t.bitmap=i<100?this._bitmap1:this._bitmap2,t.setFrame(s,a,192,192),t.x=e[1],t.y=e[2],t.rotation=e[4]*Math.PI/180,t.scale.x=e[3]/100,e[5]&&(t.scale.x*=-1),r&&(t.x*=-1,t.rotation*=-1,t.scale.x*=-1),t.scale.y=e[3]/100,t.opacity=e[6],t.blendMode=e[7],t.visible=!0}else t.visible=!1}processTimingData({flashDuration:t,flashScope:e,flashColor:i,se:s}){let a=t*this._rate;switch(e){case 1:this.startFlash(i,a);break;case 2:this.startScreenFlash(i,a);break;case 3:this.startHiding(a);break}!this._duplicated&&s&&b.playSe(s)}startFlash(t,e){this._flashColor=t.clone(),this._flashDuration=e}startScreenFlash(t,e){this._screenFlashDuration=e,this._screenFlashSprite&&(this._screenFlashSprite.setColor(t[0],t[1],t[2]),this._screenFlashSprite.opacity=t[3])}startHiding(t){this._hidingDuration=t,this._target.hide()}};o(gt,"Sprite_Animation");gt._checker1={};gt._checker2={};var hi=gt;var li=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._animationSprites=[],this._effectTarget=this,this._hiding=!1}update(){super.update(),this.updateVisibility(),this.updateAnimationSprites()}hide(){this._hiding=!0,this.updateVisibility()}show(){this._hiding=!1,this.updateVisibility()}updateVisibility(){this.visible=!this._hiding}updateAnimationSprites(){if(this._animationSprites.length>0){let t=this._animationSprites.clone();this._animationSprites=[];for(let e of t)e.isPlaying()?this._animationSprites.push(e):e.remove()}}startAnimation(t,e,i){let s=new hi;s.setup(this._effectTarget,t,e,i),this.parent.addChild(s),this._animationSprites.push(s)}isAnimationPlaying(){return this._animationSprites.length>0}};o(li,"Sprite_Base");var pt=li;var ci=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._duration=90,this._flashColor=[0,0,0,0],this._flashDuration=0,this._damageBitmap=p.loadSystem("Damage")}setup(t){let e=t.result();e.missed||e.evaded?this.createMiss():e.hpAffected?this.createDigits(0,e.hpDamage):t.isAlive()&&e.mpDamage!==0&&this.createDigits(2,e.mpDamage),e.critical&&this.setupCriticalEffect()}setupCriticalEffect(){this._flashColor=[255,0,0,160],this._flashDuration=60}digitWidth(){return this._damageBitmap?this._damageBitmap.width/10:0}digitHeight(){return this._damageBitmap?this._damageBitmap.height/5:0}createMiss(){let t=this.digitWidth(),e=this.digitHeight(),i=this.createChildSprite();i.setFrame(0,4*e,4*t,e),i.dy=0}createDigits(t,e){let i=Math.abs(e).toString(),s=t+(e<0?1:0),a=this.digitWidth(),r=this.digitHeight();for(let h=0;h<i.length;h++){let c=this.createChildSprite(),d=Number(i[h]);c.setFrame(d*a,s*r,a,r),c.x=(h-(i.length-1)/2)*a,c.dy=-h}}createChildSprite(){let t=new C;return t.bitmap=this._damageBitmap,t.anchor.x=.5,t.anchor.y=1,t.y=-40,t.ry=t.y,this.addChild(t),t}update(){if(super.update(),this._duration>0){this._duration--;for(let t=0;t<this.children.length;t++)this.updateChild(this.children[t])}this.updateFlash(),this.updateOpacity()}updateChild(t){t.dy+=.5,t.ry+=t.dy,t.ry>=0&&(t.ry=0,t.dy*=-.6),t.y=Math.round(t.ry),t.setBlendColor(this._flashColor)}updateFlash(){if(this._flashDuration>0){let t=this._flashDuration--;this._flashColor[3]*=(t-1)/t}}updateOpacity(){this._duration<10&&(this.opacity=255*this._duration/10)}isPlaying(){return this._duration>0}};o(ci,"Sprite_Damage");var di=ci;var mi=class extends pt{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this.initMembers(),this.setBattler(t)}initMembers(){this.anchor.x=.5,this.anchor.y=1,this._battler=null,this._damages=[],this._homeX=0,this._homeY=0,this._offsetX=0,this._offsetY=0,this._targetOffsetX=NaN,this._targetOffsetY=NaN,this._movementDuration=0,this._selectionEffectCount=0}setBattler(t){this._battler=t}setHome(t,e){this._homeX=t,this._homeY=e,this.updatePosition()}update(){super.update(),this._battler?(this.updateMain(),this.updateAnimation(),this.updateDamagePopup(),this.updateSelectionEffect()):this.bitmap=null}updateVisibility(){super.updateVisibility(),(!this._battler||!this._battler.isSpriteVisible())&&(this.visible=!1)}updateMain(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame()),this.updateMove(),this.updatePosition()}updateBitmap(){}updateFrame(){}updateMove(){if(this._movementDuration>0){let t=this._movementDuration;this._offsetX=(this._offsetX*(t-1)+this._targetOffsetX)/t,this._offsetY=(this._offsetY*(t-1)+this._targetOffsetY)/t,this._movementDuration--,this._movementDuration===0&&this.onMoveEnd()}}updatePosition(){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY}updateAnimation(){this.setupAnimation()}updateDamagePopup(){if(this.setupDamagePopup(),this._damages.length>0){for(let t=0;t<this._damages.length;t++)this._damages[t].update();this._damages[0].isPlaying()||(this.parent.removeChild(this._damages[0]),this._damages.shift())}}updateSelectionEffect(){let t=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%30<15?t.setBlendColor([255,255,255,64]):t.setBlendColor([0,0,0,0])):this._selectionEffectCount>0&&(this._selectionEffectCount=0,t.setBlendColor([0,0,0,0]))}setupAnimation(){for(;this._battler.isAnimationRequested();){let t=this._battler.shiftAnimation(),e=self.$dataAnimations[t.animationId],i=t.mirror,s=e.position===3?0:t.delay;this.startAnimation(e,i,s);for(let a of this._animationSprites)a.visible=this._battler.isSpriteVisible()}}setupDamagePopup(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){let t=new di;t.x=this.x+this.damageOffsetX(),t.y=this.y+this.damageOffsetY(),t.setup(this._battler),this._damages.push(t),this.parent.addChild(t)}this._battler.clearDamagePopup(),this._battler.clearResult()}}damageOffsetX(){return 0}damageOffsetY(){return 0}startMove(t,e,i){(this._targetOffsetX!==t||this._targetOffsetY!==e)&&(this._targetOffsetX=t,this._targetOffsetY=e,this._movementDuration=i,i===0&&(this._offsetX=t,this._offsetY=e))}onMoveEnd(){}isEffecting(){return!1}isMoving(){return this._movementDuration>0}inHomePosition(){return this._offsetX===0&&this._offsetY===0}};o(mi,"Sprite_Battler");var le=mi;var Dt=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers(),this.loadBitmap()}initMembers(){this._battler=null,this._iconIndex=0,this._animationCount=0,this._animationIndex=0,this.anchor.x=.5,this.anchor.y=.5}loadBitmap(){this.bitmap=p.loadSystem("IconSet"),this.setFrame(0,0,0,0)}setup(t){this._battler=t}update(){super.update(),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updateIcon(),this.updateFrame(),this._animationCount=0)}animationWait(){return 40}updateIcon(){let t=[];this._battler&&this._battler.isAlive()&&(t=this._battler.allIcons()),t.length>0?(this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0),this._iconIndex=t[this._animationIndex]):(this._animationIndex=0,this._iconIndex=0)}updateFrame(){let t=Dt._iconWidth,e=Dt._iconHeight,i=this._iconIndex%16*t,s=Math.floor(this._iconIndex/16)*e;this.setFrame(i,s,t,e)}};o(Dt,"Sprite_StateIcon");Dt._iconWidth=32;Dt._iconHeight=32;var ui=Dt;var pi=class extends le{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(t)}initMembers(){super.initMembers(),this._enemy=null,this._appeared=!1,this._battlerName="",this._battlerHue=0,this._effectType=null,this._effectDuration=0,this._shake=0,this.createStateIconSprite()}createStateIconSprite(){this._stateIconSprite=new ui,this.addChild(this._stateIconSprite)}setBattler(t){super.setBattler(t),this._enemy=t,this.setHome(t.screenX(),t.screenY()),this._stateIconSprite.setup(t)}update(){super.update(),this._enemy&&(this.updateEffect(),this.updateStateSprite())}updateBitmap(){super.updateBitmap();let t=this._enemy.battlerName(),e=this._enemy.battlerHue();(this._battlerName!==t||this._battlerHue!==e)&&(this._battlerName=t,this._battlerHue=e,this.loadBitmap(t,e),this.initVisibility())}loadBitmap(t,e){self.$gameSystem.isSideView()?this.bitmap=p.loadSvEnemy(t,e):this.bitmap=p.loadEnemy(t,e)}updateFrame(){super.updateFrame();let t=this.bitmap.height;this._effectType==="bossCollapse"&&(t=this._effectDuration),this.setFrame(0,0,this.bitmap.width,t)}updatePosition(){super.updatePosition(),this.x+=this._shake}updateStateSprite(){this._stateIconSprite.y=-Math.round((this.bitmap.height+40)*.9),this._stateIconSprite.y<20-this.y&&(this._stateIconSprite.y=20-this.y)}initVisibility(){this._appeared=this._enemy.isAlive(),this._appeared||(this.opacity=0)}setupEffect(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect()),!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")}startEffect(t){switch(this._effectType=t,this._effectType){case"appear":this.startAppear();break;case"disappear":this.startDisappear();break;case"whiten":this.startWhiten();break;case"blink":this.startBlink();break;case"collapse":this.startCollapse();break;case"bossCollapse":this.startBossCollapse();break;case"instantCollapse":this.startInstantCollapse();break}this.revertToNormal()}startAppear(){this._effectDuration=16,this._appeared=!0}startDisappear(){this._effectDuration=32,this._appeared=!1}startWhiten(){this._effectDuration=16}startBlink(){this._effectDuration=20}startCollapse(){this._effectDuration=32,this._appeared=!1}startBossCollapse(){this._effectDuration=this.bitmap.height,this._appeared=!1}startInstantCollapse(){this._effectDuration=16,this._appeared=!1}updateEffect(){if(this.setupEffect(),this._effectDuration>0){switch(this._effectDuration--,this._effectType){case"whiten":this.updateWhiten();break;case"blink":this.updateBlink();break;case"appear":this.updateAppear();break;case"disappear":this.updateDisappear();break;case"collapse":this.updateCollapse();break;case"bossCollapse":this.updateBossCollapse();break;case"instantCollapse":this.updateInstantCollapse();break}this._effectDuration===0&&(this._effectType=null)}}isEffecting(){return this._effectType!==null}revertToNormal(){this._shake=0,this.blendMode=0,this.opacity=255,this.setBlendColor([0,0,0,0])}updateWhiten(){let t=128-(16-this._effectDuration)*10;this.setBlendColor([255,255,255,t])}updateBlink(){this.opacity=this._effectDuration%10<5?255:0}updateAppear(){this.opacity=(16-this._effectDuration)*16}updateDisappear(){this.opacity=256-(32-this._effectDuration)*10}updateCollapse(){this.blendMode=l.BLEND_ADD,this.setBlendColor([255,128,128,128]),this.opacity*=this._effectDuration/(this._effectDuration+1)}updateBossCollapse(){this._shake=this._effectDuration%2*4-2,this.blendMode=l.BLEND_ADD,this.opacity*=this._effectDuration/(this._effectDuration+1),this.setBlendColor([255,255,255,255-this.opacity]),this._effectDuration%20===19&&S.playBossCollapse2()}updateInstantCollapse(){this.opacity=0}damageOffsetX(){return 0}damageOffsetY(){return-8}};o(pi,"Sprite_Enemy");var fi=pi;var _i=class extends pt{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers()}initMembers(){this._weaponImageId=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1,this.x=-16}setup(t){this._weaponImageId=t,this._animationCount=0,this._pattern=0,this.loadBitmap(),this.updateFrame()}update(){super.update(),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)}animationWait(){return 12}updatePattern(){this._pattern++,this._pattern>=3&&(this._weaponImageId=0)}loadBitmap(){let t=Math.floor((this._weaponImageId-1)/12)+1;t>=1?this.bitmap=p.loadSystem(`Weapons${t}`):this.bitmap=p.loadSystem("")}updateFrame(){if(this._weaponImageId>0){let t=(this._weaponImageId-1)%12,e=96,i=64,s=(Math.floor(t/6)*3+this._pattern)*e,a=Math.floor(t%6)*i;this.setFrame(s,a,e,i)}else this.setFrame(0,0,0,0)}isPlaying(){return this._weaponImageId>0}};o(_i,"Sprite_Weapon");var gi=_i;var wi=class extends pt{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers(),this.loadBitmap()}initMembers(){this._battler=null,this._overlayIndex=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1}loadBitmap(){this.bitmap=p.loadSystem("States"),this.setFrame(0,0,0,0)}setup(t){this._battler=t}update(){super.update(),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)}animationWait(){return 8}updatePattern(){this._pattern++,this._pattern%=8,this._battler&&(this._overlayIndex=this._battler.stateOverlayIndex())}updateFrame(){if(this._overlayIndex>0){let i=this._pattern*96,s=(this._overlayIndex-1)*96;this.setFrame(i,s,96,96)}else this.setFrame(0,0,0,0)}};o(wi,"Sprite_StateOverlay");var yi=wi;var Xt=class extends le{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(t),this.moveToStartPosition()}initMembers(){super.initMembers(),this._battlerName="",this._motion=null,this._motionCount=0,this._pattern=0,this.createShadowSprite(),this.createWeaponSprite(),this.createMainSprite(),this.createStateSprite()}createMainSprite(){this._mainSprite=new pt,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=1,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite}createShadowSprite(){this._shadowSprite=new C,this._shadowSprite.bitmap=p.loadSystem("Shadow2"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=.5,this._shadowSprite.y=-2,this.addChild(this._shadowSprite)}createWeaponSprite(){this._weaponSprite=new gi,this.addChild(this._weaponSprite)}createStateSprite(){this._stateSprite=new yi,this.addChild(this._stateSprite)}setBattler(t){super.setBattler(t),t!==this._actor&&(this._actor=t,t&&this.setActorHome(t.index()),this.startEntryMotion(),this._stateSprite.setup(t))}moveToStartPosition(){this.startMove(300,0,0)}setActorHome(t){this.setHome(600+t*32,280+t*48)}update(){super.update(),this.updateShadow(),this._actor&&this.updateMotion()}updateShadow(){this._shadowSprite.visible=!!this._actor}updateMain(){super.updateMain(),this._actor.isSpriteVisible()&&!this.isMoving()&&this.updateTargetPosition()}setupMotion(){this._actor.isMotionRequested()&&(this.startMotion(this._actor.motionType()),this._actor.clearMotion())}setupWeaponAnimation(){this._actor.isWeaponAnimationRequested()&&(this._weaponSprite.setup(this._actor.weaponImageId()),this._actor.clearWeaponAnimation())}startMotion(t){let e=Xt.MOTIONS[t];this._motion!==e&&(this._motion=e,this._motionCount=0,this._pattern=0)}updateTargetPosition(){this._actor.isInputting()||this._actor.isActing()?this.stepForward():this._actor.canMove()&&v.isEscaped()?this.retreat():this.inHomePosition()||this.stepBack()}updateBitmap(){super.updateBitmap();let t=this._actor.battlerName();this._battlerName!==t&&(this._battlerName=t,this._mainSprite.bitmap=p.loadSvActor(t))}updateFrame(){super.updateFrame();let t=this._mainSprite.bitmap;if(t){let e=this._motion?this._motion.index:0,i=this._pattern<3?this._pattern:1,s=t.width/9,a=t.height/6,r=Math.floor(e/6)*3+i,h=e%6;this._mainSprite.setFrame(r*s,h*a,s,a)}}updateMove(){let t=this._mainSprite.bitmap;(!t||t.isReady())&&super.updateMove()}updateMotion(){this.setupMotion(),this.setupWeaponAnimation(),this._actor.isMotionRefreshRequested()&&(this.refreshMotion(),this._actor.clearMotion()),this.updateMotionCount()}updateMotionCount(){this._motion&&++this._motionCount>=this.motionSpeed()&&(this._motion.loop?this._pattern=(this._pattern+1)%4:this._pattern<2?this._pattern++:this.refreshMotion(),this._motionCount=0)}motionSpeed(){return 12}refreshMotion(){let t=this._actor,e=Xt.MOTIONS.guard;if(t){if(this._motion===e&&!v.isInputting())return;let i=t.stateMotionIndex();t.isInputting()||t.isActing()?this.startMotion("walk"):i===3?this.startMotion("dead"):i===2?this.startMotion("sleep"):t.isChanting()?this.startMotion("chant"):t.isGuard()||t.isGuardWaiting()?this.startMotion("guard"):i===1?this.startMotion("abnormal"):t.isDying()?this.startMotion("dying"):t.isUndecided()?this.startMotion("walk"):this.startMotion("wait")}}startEntryMotion(){this._actor&&this._actor.canMove()?(this.startMotion("walk"),this.startMove(0,0,30)):this.isMoving()||(this.refreshMotion(),this.startMove(0,0,0))}stepForward(){this.startMove(-48,0,12)}stepBack(){this.startMove(0,0,12)}retreat(){this.startMove(300,0,30)}onMoveEnd(){super.onMoveEnd(),v.isBattleEnd()||this.refreshMotion()}damageOffsetX(){return-32}damageOffsetY(){return 0}};o(Xt,"Sprite_Actor");Xt.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}};var bi=Xt;var Si=class extends he{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._battlebackLocated=!1}createLowerLayer(){super.createLowerLayer(),this.createBackground(),this.createBattleField(),this.createBattleback(),this.createEnemies(),this.createActors()}createBackground(){this._backgroundSprite=new C,this._backgroundSprite.bitmap=g.backgroundBitmap(),this._baseSprite.addChild(this._backgroundSprite)}update(){super.update(),this.updateActors(),this.updateBattleback()}createBattleField(){let t=l.boxWidth,e=l.boxHeight,i=(l.width-t)/2,s=(l.height-e)/2;this._battleField=new C,this._battleField.setFrame(i,s,t,e),this._battleField.x=i,this._battleField.y=s,this._baseSprite.addChild(this._battleField)}createBattleback(){let e=-this._battleField.x-32,i=-this._battleField.y-32,s=l.width+32*2,a=l.height+32*2;this._back1Sprite=new Ut,this._back2Sprite=new Ut,this._back1Sprite.bitmap=this.battleback1Bitmap(),this._back2Sprite.bitmap=this.battleback2Bitmap(),this._back1Sprite.move(e,i,s,a),this._back2Sprite.move(e,i,s,a),this._battleField.addChild(this._back1Sprite),this._battleField.addChild(this._back2Sprite)}updateBattleback(){this._battlebackLocated||(this.locateBattleback(),this._battlebackLocated=!0)}locateBattleback(){let t=this._battleField.width,e=this._battleField.height,i=this._back1Sprite,s=this._back2Sprite;i.origin.x=i.x+(i.bitmap.width-t)/2,s.origin.x=i.y+(s.bitmap.width-t)/2,self.$gameSystem.isSideView()&&(i.origin.y=i.x+i.bitmap.height-e,s.origin.y=i.y+s.bitmap.height-e)}battleback1Bitmap(){return p.loadBattleback1(this.battleback1Name())}battleback2Bitmap(){return p.loadBattleback2(this.battleback2Name())}battleback1Name(){return v.isBattleTest()?self.$dataSystem.battleback1Name:self.$gameMap.battleback1Name()?self.$gameMap.battleback1Name():self.$gameMap.isOverworld()?this.overworldBattleback1Name():""}battleback2Name(){return v.isBattleTest()?self.$dataSystem.battleback2Name:self.$gameMap.battleback2Name()?self.$gameMap.battleback2Name():self.$gameMap.isOverworld()?this.overworldBattleback2Name():""}overworldBattleback1Name(){return self.$gameMap.battleback1Name()===""?"":self.$gamePlayer.isInVehicle()?this.shipBattleback1Name():this.normalBattleback1Name()}overworldBattleback2Name(){return self.$gameMap.battleback2Name()===""?"":self.$gamePlayer.isInVehicle()?this.shipBattleback2Name():this.normalBattleback2Name()}normalBattleback1Name(){return this.terrainBattleback1Name(this.autotileType(1))||this.terrainBattleback1Name(this.autotileType(0))||this.defaultBattleback1Name()}normalBattleback2Name(){return this.terrainBattleback2Name(this.autotileType(1))||this.terrainBattleback2Name(this.autotileType(0))||this.defaultBattleback2Name()}terrainBattleback1Name(t){switch(t){case 24:case 25:return"Wasteland";case 26:case 27:return"DirtField";case 32:case 33:return"Desert";case 34:return"Lava1";case 35:return"Lava2";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp";default:return null}}terrainBattleback2Name(t){switch(t){case 20:case 21:return"Forest";case 22:case 30:case 38:return"Cliff";case 24:case 25:case 26:case 27:return"Wasteland";case 32:case 33:return"Desert";case 34:case 35:return"Lava";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp"}}defaultBattleback1Name(){return"Grassland"}defaultBattleback2Name(){return"Grassland"}shipBattleback1Name(){return"Ship"}shipBattleback2Name(){return"Ship"}autotileType(t){return self.$gameMap.autotileType(self.$gamePlayer.x,self.$gamePlayer.y,t)}createEnemies(){let t=self.$gameTroop.members(),e=[];for(let i=0;i<t.length;i++)e[i]=new fi(t[i]);e.sort(this.compareEnemySprite.bind(this));for(let i=0;i<e.length;i++)this._battleField.addChild(e[i]);this._enemySprites=e}compareEnemySprite(t,e){return t.y!==e.y?t.y-e.y:t.spriteId-e.spriteId}createActors(){this._actorSprites=[];for(let t=0;t<self.$gameParty.maxBattleMembers();t++)this._actorSprites[t]=new bi,this._battleField.addChild(this._actorSprites[t])}updateActors(){let t=self.$gameParty.battleMembers();for(let e=0;e<this._actorSprites.length;e++)this._actorSprites[e].setBattler(t[e])}battlerSprites(){return this._enemySprites.concat(this._actorSprites)}isAnimationPlaying(){return this.battlerSprites().some(t=>t.isAnimationPlaying())}isEffecting(){return this.battlerSprites().some(t=>t.isEffecting())}isAnyoneMoving(){return this.battlerSprites().some(t=>t.isMoving())}isBusy(){return this.isAnimationPlaying()||this.isAnyoneMoving()}};o(Si,"Spriteset_Battle");var xi=Si;var tt=class extends qe{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(),this.loadWindowskin(),this.move(t,e,i,s),this.updatePadding(),this.updateBackOpacity(),this.updateTone(),this.createContents(),this._opening=!1,this._closing=!1,this._dimmerSprite=null}lineHeight(){return 36}standardFontFace(){return self.$gameSystem.isChinese()?"SimHei, Heiti TC, sans-serif":self.$gameSystem.isKorean()?"Dotum, AppleGothic, sans-serif":"GameFont"}standardFontSize(){return 28}standardPadding(){return 18}textPadding(){return 6}standardBackOpacity(){return 192}loadWindowskin(){this.windowskin=p.loadSystem("Window")}updatePadding(){this.padding=this.standardPadding()}updateBackOpacity(){this.backOpacity=this.standardBackOpacity()}contentsWidth(){return this.width-this.standardPadding()*2}contentsHeight(){return this.height-this.standardPadding()*2}fittingHeight(t){return t*this.lineHeight()+this.standardPadding()*2}updateTone(){let t=self.$gameSystem.windowTone();this.setTone(t[0],t[1],t[2])}createContents(){this.contents?this.contents.clear():(this.contents=new qt(this.contentsWidth(),this.contentsHeight()),this._windowContentsSprite.addChild(this.contents)),this.resetFontSettings()}resetFontSettings(){this.contents.fontFace=this.standardFontFace(),this.contents.fontSize=this.standardFontSize(),this.resetTextColor()}resetTextColor(){this.changeTextColor(this.normalColor())}update(){super.update(),this.updateTone(),this.updateOpen(),this.updateClose(),this.updateBackgroundDimmer()}updateOpen(){this._opening&&(this.openness+=32,this.isOpen()&&(this._opening=!1))}updateClose(){this._closing&&(this.openness-=32,this.isClosed()&&(this._closing=!1))}open(){this.isOpen()||(this._opening=!0),this._closing=!1}close(){this.isClosed()||(this._closing=!0),this._opening=!1}isOpening(){return this._opening}isClosing(){return this._closing}show(){this.visible=!0}hide(){this.visible=!1}activate(){this.active=!0}deactivate(){this.active=!1}textColor(t){let e=96+t%8*12+6,i=144+Math.floor(t/8)*12+6;return this.windowskin?this.windowskin.getPixel(e,i):"0x000000"}normalColor(){return this.textColor(0)}systemColor(){return this.textColor(16)}crisisColor(){return this.textColor(17)}deathColor(){return this.textColor(18)}gaugeBackColor(){return this.textColor(19)}hpGaugeColor1(){return this.textColor(20)}hpGaugeColor2(){return this.textColor(21)}mpGaugeColor1(){return this.textColor(22)}mpGaugeColor2(){return this.textColor(23)}mpCostColor(){return this.textColor(23)}powerUpColor(){return this.textColor(24)}powerDownColor(){return this.textColor(25)}tpGaugeColor1(){return this.textColor(28)}tpGaugeColor2(){return this.textColor(29)}tpCostColor(){return this.textColor(29)}pendingColor(){return this.windowskin.getPixel(120,120)}translucentOpacity(){return 160}changeTextColor(t){this.contents.textColor=t}changePaintOpacity(t){this.contents.paintOpacity=t?255:this.translucentOpacity()}drawText(t,e,i,s,a){this.contents.drawText(t,e,i,s,this.lineHeight(),a)}textWidth(t){return this.contents.measureTextWidth(t)}drawTextEx(t,e,i){if(t){let s={index:0,x:e,y:i,left:e};for(s.text=this.convertEscapeCharacters(t),s.height=this.calcTextHeight(s,!1),this.resetFontSettings();s.index<s.text.length;)this.processCharacter(s);return s.x-e}else return 0}convertEscapeCharacters(t){return t=t.replace(/\\/g,"\x1B"),t=t.replace(/\x1b\x1b/g,"\\"),t=t.replace(/\x1bV\[(\d+)\]/gi,function(...e){return self.$gameVariables.value(parseInt(e[1]))}.bind(this)),t=t.replace(/\x1bV\[(\d+)\]/gi,function(...e){return self.$gameVariables.value(parseInt(e[1]))}.bind(this)),t=t.replace(/\x1bN\[(\d+)\]/gi,function(...e){return this.actorName(parseInt(e[1]))}.bind(this)),t=t.replace(/\x1bP\[(\d+)\]/gi,function(...e){return this.partyMemberName(parseInt(e[1]))}.bind(this)),t=t.replace(/\x1bG/gi,m.currencyUnit),t}actorName(t){let e=t>=1?self.$gameActors.actor(t):null;return e?e.name():""}partyMemberName(t){let e=t>=1?self.$gameParty.members()[t-1]:null;return e?e.name():""}processCharacter(t){switch(t.text[t.index]){case`
`:this.processNewLine(t);break;case"\f":this.processNewPage(t);break;case"\x1B":this.processEscapeCharacter(this.obtainEscapeCode(t),t);break;default:this.processNormalCharacter(t);break}}processNormalCharacter(t){let e=t.text[t.index++],i=this.textWidth(e);this.contents.drawText(e,t.x,t.y,i*2,t.height),t.x+=i}processNewLine(t){t.x=t.left,t.y+=t.height,t.height=this.calcTextHeight(t,!1),t.index++}processNewPage(t){t.index++}obtainEscapeCode(t){t.index++;let i=/^[\$\.\|\^!><\{\}\\]|^[A-Z]+/i.exec(t.text.slice(t.index));return i?(t.index+=i[0].length,i[0].toUpperCase()):""}obtainEscapeParam(t){let e=/^\[\d+\]/.exec(t.text.slice(t.index));return e?(t.index+=e[0].length,parseInt(e[0].slice(1))):""}processEscapeCharacter(t,e){switch(t){case"C":this.changeTextColor(this.textColor(this.obtainEscapeParam(e)));break;case"I":this.processDrawIcon(this.obtainEscapeParam(e),e);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller();break}}processDrawIcon(t,e){this.drawIcon(t,e.x+2,e.y+2),e.x+=tt._iconWidth+4}makeFontBigger(){this.contents.fontSize<=96&&(this.contents.fontSize+=12)}makeFontSmaller(){this.contents.fontSize>=24&&(this.contents.fontSize-=12)}calcTextHeight({text:t,index:e},i){let s=this.contents.fontSize,a=0,r=t.slice(e).split(`
`),h=i?r.length:1;for(let c=0;c<h;c++){let d=this.contents.fontSize,u=/\x1b[\{\}]/g;for(;;){let f=u.exec(r[c]);if(f)f[0]==="\x1B{"&&this.makeFontBigger(),f[0]==="\x1B}"&&this.makeFontSmaller(),d<this.contents.fontSize&&(d=this.contents.fontSize);else break}a+=d+8}return this.contents.fontSize=s,a}drawIcon(t,e,i){let s=p.loadSystem("IconSet"),a=tt._iconWidth,r=tt._iconHeight,h=t%16*a,c=Math.floor(t/16)*r;this.contents.blt(s,h,c,a,r,e,i)}drawFace(t,e,i,s,a=tt._faceWidth,r=tt._faceHeight){let h=p.loadFace(t),c=tt._faceWidth,d=tt._faceHeight,u=Math.min(a,c),f=Math.min(r,d),y=Math.floor(i+Math.max(a-c,0)/2),P=Math.floor(s+Math.max(r-d,0)/2),$=e%4*c+(c-u)/2,B=Math.floor(e/4)*d+(d-f)/2;this.contents.blt(h,$,B,u,f,y,P)}drawCharacter(t,e,i,s){let a=p.loadCharacter(t),r=p.isBigCharacter(t),h=a.width/(r?3:12),c=a.height/(r?4:8),d=r?0:e,u=(d%4*3+1)*h,f=Math.floor(d/4)*4*c;this.contents.blt(a,u,f,h,c,i-h/2,s-c)}drawGauge(t,e,i,s,a,r){let h=Math.floor(i*s),c=e+this.lineHeight()-8;this.contents.fillRect(t,c,i,6,this.gaugeBackColor()),this.contents.gradientFillRect(t,c,h,6,a,r)}hpColor(t){return t.isDead()?this.deathColor():t.isDying()?this.crisisColor():this.normalColor()}mpColor(t){return this.normalColor()}tpColor(t){return this.normalColor()}drawActorCharacter(t,e,i){this.drawCharacter(t.characterName(),t.characterIndex(),e,i)}drawActorFace(t,e,i,s,a){this.drawFace(t.faceName(),t.faceIndex(),e,i,s,a)}drawActorName(t,e,i,s=168){this.changeTextColor(this.hpColor(t)),this.drawText(t.name(),e,i,s)}drawActorClass(t,e,i,s=168){this.resetTextColor(),this.drawText(t.currentClass().name,e,i,s)}drawActorNickname(t,e,i,s=270){this.resetTextColor(),this.drawText(t.nickname(),e,i,s)}drawActorLevel({level:t},e,i){this.changeTextColor(this.systemColor()),this.drawText(m.levelA,e,i,48),this.resetTextColor(),this.drawText(t,e+84,i,36,"right")}drawActorIcons(t,e,i,s=144){let a=t.allIcons().slice(0,Math.floor(s/tt._iconWidth));for(let r=0;r<a.length;r++)this.drawIcon(a[r],e+tt._iconWidth*r,i+2)}drawCurrentAndMax(t,e,i,s,a,r,h){let c=this.textWidth("HP"),d=this.textWidth("0000"),u=this.textWidth("/"),f=i+a-d,y=f-u,P=y-d;P>=i+c?(this.changeTextColor(r),this.drawText(t,P,s,d,"right"),this.changeTextColor(h),this.drawText("/",y,s,u,"right"),this.drawText(e,f,s,d,"right")):(this.changeTextColor(r),this.drawText(t,f,s,d,"right"))}drawActorHp(t,e,i,s=186){let a=this.hpGaugeColor1(),r=this.hpGaugeColor2();this.drawGauge(e,i,s,t.hpRate(),a,r),this.changeTextColor(this.systemColor()),this.drawText(m.hpA,e,i,44),this.drawCurrentAndMax(t.hp,t.mhp,e,i,s,this.hpColor(t),this.normalColor())}drawActorMp(t,e,i,s=186){let a=this.mpGaugeColor1(),r=this.mpGaugeColor2();this.drawGauge(e,i,s,t.mpRate(),a,r),this.changeTextColor(this.systemColor()),this.drawText(m.mpA,e,i,44),this.drawCurrentAndMax(t.mp,t.mmp,e,i,s,this.mpColor(t),this.normalColor())}drawActorTp(t,e,i,s=96){let a=this.tpGaugeColor1(),r=this.tpGaugeColor2();this.drawGauge(e,i,s,t.tpRate(),a,r),this.changeTextColor(this.systemColor()),this.drawText(m.tpA,e,i,44),this.changeTextColor(this.tpColor(t)),this.drawText(t.tp,e+s-64,i,64,"right")}drawActorSimpleStatus(t,e,i,s){let a=this.lineHeight(),r=e+180,h=Math.min(200,s-180-this.textPadding());this.drawActorName(t,e,i),this.drawActorLevel(t,e,i+a*1),this.drawActorIcons(t,e,i+a*2),this.drawActorClass(t,r,i),this.drawActorHp(t,r,i+a*1,h),this.drawActorMp(t,r,i+a*2,h)}drawItemName(t,e,i,s=312){if(t){let a=tt._iconWidth+4;this.resetTextColor(),this.drawIcon(t.iconIndex,e+2,i+2),this.drawText(t.name,e+a,i,s-a)}}drawCurrencyValue(t,e,i,s,a){let r=Math.min(80,this.textWidth(e));this.resetTextColor(),this.drawText(t,i,s,a-r-6,"right"),this.changeTextColor(this.systemColor()),this.drawText(e,i+a-r,s,r,"right")}paramchangeTextColor(t){return t>0?this.powerUpColor():t<0?this.powerDownColor():this.normalColor()}setBackgroundType(t){t===0?this.opacity=255:this.opacity=0,t===1?this.showBackgroundDimmer():this.hideBackgroundDimmer()}showBackgroundDimmer(){this._dimmerSprite||(this._dimmerSprite=new C,this._dimmerSprite.bitmap=new V(0,0),this.addChildToBack(this._dimmerSprite));let t=this._dimmerSprite.bitmap;(t.width!==this.width||t.height!==this.height)&&this.refreshDimmerBitmap(),this._dimmerSprite.visible=!0,this.updateBackgroundDimmer()}hideBackgroundDimmer(){this._dimmerSprite&&(this._dimmerSprite.visible=!1)}updateBackgroundDimmer(){this._dimmerSprite&&(this._dimmerSprite.opacity=this.openness)}refreshDimmerBitmap(){if(this._dimmerSprite){let t=this._dimmerSprite.bitmap,e=this.width,i=this.height,s=this.padding,a=this.dimColor1(),r=this.dimColor2();t.resize(e,i),t.gradientFillRect(0,0,e,s,r,a,!0),t.fillRect(0,s,e,i-s*2,a),t.gradientFillRect(0,i-s,e,s,a,r,!0),this._dimmerSprite.setFrame(0,0,e,i)}}dimColor1(){return"rgba(0, 0, 0, 0.6)"}dimColor2(){return"rgba(0, 0, 0, 0)"}canvasToLocalX(t){let e=this;for(;e;)t-=e.x,e=e.parent;return t}canvasToLocalY(t){let e=this;for(;e;)t-=e.y,e=e.parent;return t}reserveFaceImages(){self.$gameParty.members().forEach(t=>{p.reserveFace(t.faceName())},this)}};o(tt,"Window_Base");tt._iconWidth=32;tt._iconHeight=32;tt._faceWidth=144;tt._faceHeight=144;var H=tt;var Ti=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t){let e=l.boxWidth,i=this.fittingHeight(t||2);super.initialize(0,0,e,i),this._text=""}setText(t){this._text!==t&&(this._text=t,this.refresh())}clear(){this.setText("")}setItem(t){this.setText(t?t.description:"")}refresh(){this.contents.clear(),this.drawTextEx(this._text,this.textPadding(),0)}};o(Ti,"Window_Help");var Gt=Ti;var vi=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){let i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh()}windowWidth(){return 240}windowHeight(){return this.fittingHeight(1)}refresh(){let t=this.textPadding(),e=this.contents.width-this.textPadding()*2;this.contents.clear(),this.drawCurrencyValue(this.value(),this.currencyUnit(),t,0,e)}value(){return self.$gameParty.gold()}currencyUnit(){return m.currencyUnit}open(){this.refresh(),super.open()}};o(vi,"Window_Gold");var Yt=vi;var Ci=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._index=-1,this._cursorFixed=!1,this._cursorAll=!1,this._stayCount=0,this._helpWindow=null,this._handlers={},this._touching=!1,this._scrollX=0,this._scrollY=0,this.deactivate()}index(){return this._index}cursorFixed(){return this._cursorFixed}setCursorFixed(t){this._cursorFixed=t}cursorAll(){return this._cursorAll}setCursorAll(t){this._cursorAll=t}maxCols(){return 1}maxItems(){return 0}spacing(){return 12}itemWidth(){return Math.floor((this.width-this.padding*2+this.spacing())/this.maxCols()-this.spacing())}itemHeight(){return this.lineHeight()}maxRows(){return Math.max(Math.ceil(this.maxItems()/this.maxCols()),1)}activate(){super.activate(),this.reselect()}deactivate(){super.deactivate(),this.reselect()}select(t){this._index=t,this._stayCount=0,this.ensureCursorVisible(),this.updateCursor(),this.callUpdateHelp()}deselect(){this.select(-1)}reselect(){this.select(this._index)}row(){return Math.floor(this.index()/this.maxCols())}topRow(){return Math.floor(this._scrollY/this.itemHeight())}maxTopRow(){return Math.max(0,this.maxRows()-this.maxPageRows())}setTopRow(t){let e=t.clamp(0,this.maxTopRow())*this.itemHeight();this._scrollY!==e&&(this._scrollY=e,this.refresh(),this.updateCursor())}resetScroll(){this.setTopRow(0)}maxPageRows(){let t=this.height-this.padding*2;return Math.floor(t/this.itemHeight())}maxPageItems(){return this.maxPageRows()*this.maxCols()}isHorizontal(){return this.maxPageRows()===1}bottomRow(){return Math.max(0,this.topRow()+this.maxPageRows()-1)}setBottomRow(t){this.setTopRow(t-(this.maxPageRows()-1))}topIndex(){return this.topRow()*this.maxCols()}itemRect(t){let e=new G,i=this.maxCols();return e.width=this.itemWidth(),e.height=this.itemHeight(),e.x=t%i*(e.width+this.spacing())-this._scrollX,e.y=Math.floor(t/i)*e.height-this._scrollY,e}itemRectForText(t){let e=this.itemRect(t);return e.x+=this.textPadding(),e.width-=this.textPadding()*2,e}setHelpWindow(t){this._helpWindow=t,this.callUpdateHelp()}showHelpWindow(){this._helpWindow&&this._helpWindow.show()}hideHelpWindow(){this._helpWindow&&this._helpWindow.hide()}setHandler(t,e){this._handlers[t]=e}isHandled(t){return!!this._handlers[t]}callHandler(t){this.isHandled(t)&&this._handlers[t]()}isOpenAndActive(){return this.isOpen()&&this.active}isCursorMovable(){return this.isOpenAndActive()&&!this._cursorFixed&&!this._cursorAll&&this.maxItems()>0}cursorDown(t){let e=this.index(),i=this.maxItems(),s=this.maxCols();(e<i-s||t&&s===1)&&this.select((e+s)%i)}cursorUp(t){let e=this.index(),i=this.maxItems(),s=this.maxCols();(e>=s||t&&s===1)&&this.select((e-s+i)%i)}cursorRight(t){let e=this.index(),i=this.maxItems();this.maxCols()>=2&&(e<i-1||t&&this.isHorizontal())&&this.select((e+1)%i)}cursorLeft(t){let e=this.index(),i=this.maxItems();this.maxCols()>=2&&(e>0||t&&this.isHorizontal())&&this.select((e-1+i)%i)}cursorPagedown(){let t=this.index(),e=this.maxItems();this.topRow()+this.maxPageRows()<this.maxRows()&&(this.setTopRow(this.topRow()+this.maxPageRows()),this.select(Math.min(t+this.maxPageItems(),e-1)))}cursorPageup(){let t=this.index();this.topRow()>0&&(this.setTopRow(this.topRow()-this.maxPageRows()),this.select(Math.max(t-this.maxPageItems(),0)))}scrollDown(){this.topRow()+1<this.maxRows()&&this.setTopRow(this.topRow()+1)}scrollUp(){this.topRow()>0&&this.setTopRow(this.topRow()-1)}update(){super.update(),this.updateArrows(),this.processCursorMove(),this.processHandling(),this.processWheel(),this.processTouch(),this._stayCount++}updateArrows(){let t=this.topRow(),e=this.maxTopRow();this.downArrowVisible=e>0&&t<e,this.upArrowVisible=t>0}processCursorMove(){if(this.isCursorMovable()){let t=this.index();x.isRepeated("down")&&this.cursorDown(x.isTriggered("down")),x.isRepeated("up")&&this.cursorUp(x.isTriggered("up")),x.isRepeated("right")&&this.cursorRight(x.isTriggered("right")),x.isRepeated("left")&&this.cursorLeft(x.isTriggered("left")),!this.isHandled("pagedown")&&x.isTriggered("pagedown")&&this.cursorPagedown(),!this.isHandled("pageup")&&x.isTriggered("pageup")&&this.cursorPageup(),this.index()!==t&&S.playCursor()}}processHandling(){this.isOpenAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()?this.processCancel():this.isHandled("pagedown")&&x.isTriggered("pagedown")?this.processPagedown():this.isHandled("pageup")&&x.isTriggered("pageup")&&this.processPageup())}processWheel(){this.isOpenAndActive()&&(k.wheelY>=20&&this.scrollDown(),k.wheelY<=-20&&this.scrollUp())}processTouch(){this.isOpenAndActive()?(k.isTriggered()&&this.isTouchedInsideFrame()?(this._touching=!0,this.onTouch(!0)):k.isCancelled()&&this.isCancelEnabled()&&this.processCancel(),this._touching&&(k.isPressed()?this.onTouch(!1):this._touching=!1)):this._touching=!1}isTouchedInsideFrame(){let t=this.canvasToLocalX(k.x),e=this.canvasToLocalY(k.y);return t>=0&&e>=0&&t<this.width&&e<this.height}onTouch(t){let e=this.index(),i=this.canvasToLocalX(k.x),s=this.canvasToLocalY(k.y),a=this.hitTest(i,s);a>=0?a===this.index()?t&&this.isTouchOkEnabled()&&this.processOk():this.isCursorMovable()&&this.select(a):this._stayCount>=10&&(s<this.padding?this.cursorUp():s>=this.height-this.padding&&this.cursorDown()),this.index()!==e&&S.playCursor()}hitTest(t,e){if(this.isContentsArea(t,e)){let i=t-this.padding,s=e-this.padding,a=this.topIndex();for(let r=0;r<this.maxPageItems();r++){let h=a+r;if(h<this.maxItems()){let c=this.itemRect(h),d=c.x+c.width,u=c.y+c.height;if(i>=c.x&&s>=c.y&&i<d&&s<u)return h}}}return-1}isContentsArea(t,e){let i=this.padding,s=this.padding,a=this.width-this.padding,r=this.height-this.padding;return t>=i&&e>=s&&t<a&&e<r}isTouchOkEnabled(){return this.isOkEnabled()}isOkEnabled(){return this.isHandled("ok")}isCancelEnabled(){return this.isHandled("cancel")}isOkTriggered(){return x.isRepeated("ok")}isCancelTriggered(){return x.isRepeated("cancel")}processOk(){this.isCurrentItemEnabled()?(this.playOkSound(),this.updateInputData(),this.deactivate(),this.callOkHandler()):this.playBuzzerSound()}playOkSound(){S.playOk()}playBuzzerSound(){S.playBuzzer()}callOkHandler(){this.callHandler("ok")}processCancel(){S.playCancel(),this.updateInputData(),this.deactivate(),this.callCancelHandler()}callCancelHandler(){this.callHandler("cancel")}processPageup(){S.playCursor(),this.updateInputData(),this.deactivate(),this.callHandler("pageup")}processPagedown(){S.playCursor(),this.updateInputData(),this.deactivate(),this.callHandler("pagedown")}updateInputData(){x.update(),k.update()}updateCursor(){if(this._cursorAll){let t=this.maxRows()*this.itemHeight();this.setCursorRect(0,0,this.contents.width,t),this.setTopRow(0)}else if(this.isCursorVisible()){let t=this.itemRect(this.index());this.setCursorRect(t.x,t.y,t.width,t.height)}else this.setCursorRect(0,0,0,0)}isCursorVisible(){let t=this.row();return t>=this.topRow()&&t<=this.bottomRow()}ensureCursorVisible(){let t=this.row();t<this.topRow()?this.setTopRow(t):t>this.bottomRow()&&this.setBottomRow(t)}callUpdateHelp(){this.active&&this._helpWindow&&this.updateHelp()}updateHelp(){this._helpWindow.clear()}setHelpWindowItem(t){this._helpWindow&&this._helpWindow.setItem(t)}isCurrentItemEnabled(){return!0}drawAllItems(){let t=this.topIndex();for(let e=0;e<this.maxPageItems();e++){let i=t+e;i<this.maxItems()&&this.drawItem(i)}}drawItem(t){}clearItem(t){let e=this.itemRect(t);this.contents.clearRect(e.x,e.y,e.width,e.height)}redrawItem(t){t>=0&&(this.clearItem(t),this.drawItem(t))}redrawCurrentItem(){this.redrawItem(this.index())}refresh(){this.contents&&(this.contents.clear(),this.drawAllItems())}};o(Ci,"Window_Selectable");var D=Ci;var Ii=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this.clearCommandList(),this.makeCommandList();let i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh(),this.select(0),this.activate()}windowWidth(){return 240}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return Math.ceil(this.maxItems()/this.maxCols())}maxItems(){return this._list.length}clearCommandList(){this._list=[]}makeCommandList(){}addCommand(t,e,i,s){i===void 0&&(i=!0),s===void 0&&(s=null),this._list.push({name:t,symbol:e,enabled:i,ext:s})}commandName(t){return this._list[t].name}commandSymbol(t){return this._list[t].symbol}isCommandEnabled(t){return this._list[t].enabled}currentData(){return this.index()>=0?this._list[this.index()]:null}isCurrentItemEnabled(){return this.currentData()?this.currentData().enabled:!1}currentSymbol(){return this.currentData()?this.currentData().symbol:null}currentExt(){return this.currentData()?this.currentData().ext:null}findSymbol(t){for(let e=0;e<this._list.length;e++)if(this._list[e].symbol===t)return e;return-1}selectSymbol(t){let e=this.findSymbol(t);e>=0?this.select(e):this.select(0)}findExt(t){for(let e=0;e<this._list.length;e++)if(this._list[e].ext===t)return e;return-1}selectExt(t){let e=this.findExt(t);e>=0?this.select(e):this.select(0)}drawItem(t){let e=this.itemRectForText(t),i=this.itemTextAlign();this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(t)),this.drawText(this.commandName(t),e.x,e.y,e.width,i)}itemTextAlign(){return"left"}isOkEnabled(){return!0}callOkHandler(){let t=this.currentSymbol();this.isHandled(t)?this.callHandler(t):this.isHandled("ok")?super.callOkHandler():this.activate()}refresh(){this.clearCommandList(),this.makeCommandList(),this.createContents(),super.refresh()}};o(Ii,"Window_Command");var J=Ii;var Mi=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(t){this._messageWindow=t,super.initialize(0,0),this.openness=0,this.deactivate(),this._background=0}start(){this.updatePlacement(),this.updateBackground(),this.refresh(),this.selectDefault(),this.open(),this.activate()}selectDefault(){this.select(self.$gameMessage.choiceDefaultType())}updatePlacement(){let t=self.$gameMessage.choicePositionType(),e=this._messageWindow.y;switch(this.width=this.windowWidth(),this.height=this.windowHeight(),t){case 0:this.x=0;break;case 1:this.x=(l.boxWidth-this.width)/2;break;case 2:this.x=l.boxWidth-this.width;break}e>=l.boxHeight/2?this.y=e-this.height:this.y=e+this._messageWindow.height}updateBackground(){this._background=self.$gameMessage.choiceBackground(),this.setBackgroundType(this._background)}windowWidth(){let t=this.maxChoiceWidth()+this.padding*2;return Math.min(t,l.boxWidth)}numVisibleRows(){let t=this._messageWindow.y,e=this._messageWindow.height,i=l.boxHeight/2,a=self.$gameMessage.choices().length,r=8;return t<i&&t+e>i&&(r=4),a>r&&(a=r),a}maxChoiceWidth(){let t=96,e=self.$gameMessage.choices();for(let i=0;i<e.length;i++){let s=this.textWidthEx(e[i])+this.textPadding()*2;t<s&&(t=s)}return t}textWidthEx(t){return this.drawTextEx(t,0,this.contents.height)}contentsHeight(){return this.maxItems()*this.itemHeight()}makeCommandList(){let t=self.$gameMessage.choices();for(let e=0;e<t.length;e++)this.addCommand(t[e],"choice")}drawItem(t){let e=this.itemRectForText(t);this.drawTextEx(this.commandName(t),e.x,e.y)}isCancelEnabled(){return self.$gameMessage.choiceCancelType()!==-1}isOkTriggered(){return x.isTriggered("ok")}callOkHandler(){self.$gameMessage.onChoice(this.index()),this._messageWindow.terminateMessage(),this.close()}callCancelHandler(){self.$gameMessage.onChoice(self.$gameMessage.choiceCancelType()),this._messageWindow.terminateMessage(),this.close()}};o(Mi,"Window_ChoiceList");var Ei=Mi;var ki=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._touching=!1,this._coldFrame=null,this._hotFrame=null,this._clickHandler=null}update(){super.update(),this.updateFrame(),this.processTouch()}updateFrame(){let t;this._touching?t=this._hotFrame:t=this._coldFrame,t&&this.setFrame(t.x,t.y,t.width,t.height)}setColdFrame(t,e,i,s){this._coldFrame=new G(t,e,i,s)}setHotFrame(t,e,i,s){this._hotFrame=new G(t,e,i,s)}setClickHandler(t){this._clickHandler=t}callClickHandler(){this._clickHandler&&this._clickHandler()}processTouch(){this.isActive()?(k.isTriggered()&&this.isButtonTouched()&&(this._touching=!0),this._touching&&(k.isReleased()||!this.isButtonTouched())&&(this._touching=!1,k.isReleased()&&this.callClickHandler())):this._touching=!1}isActive(){let t=this;for(;t;){if(!t.visible)return!1;t=t.parent}return!0}isButtonTouched(){let t=this.canvasToLocalX(k.x),e=this.canvasToLocalY(k.y);return t>=0&&e>=0&&t<this.width&&e<this.height}canvasToLocalX(t){let e=this;for(;e;)t-=e.x,e=e.parent;return t}canvasToLocalY(t){let e=this;for(;e;)t-=e.y,e=e.parent;return t}};o(ki,"Sprite_Button");var ce=ki;var Ai=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t){this._messageWindow=t,super.initialize(0,0,0,0),this._number=0,this._maxDigits=1,this.openness=0,this.createButtons(),this.deactivate()}start(){this._maxDigits=self.$gameMessage.numInputMaxDigits(),this._number=self.$gameVariables.value(self.$gameMessage.numInputVariableId()),this._number=this._number.clamp(0,Math.pow(10,this._maxDigits)-1),this.updatePlacement(),this.placeButtons(),this.updateButtonsVisiblity(),this.createContents(),this.refresh(),this.open(),this.activate(),this.select(0)}updatePlacement(){let t=this._messageWindow.y,e=8;this.width=this.windowWidth(),this.height=this.windowHeight(),this.x=(l.boxWidth-this.width)/2,t>=l.boxHeight/2?this.y=t-this.height-e:this.y=t+this._messageWindow.height+e}windowWidth(){return this.maxCols()*this.itemWidth()+this.padding*2}windowHeight(){return this.fittingHeight(1)}maxCols(){return this._maxDigits}maxItems(){return this._maxDigits}spacing(){return 0}itemWidth(){return 32}createButtons(){let t=p.loadSystem("ButtonSet"),e=48,i=48;this._buttons=[];for(let s=0;s<3;s++){let a=new ce,r=e*[1,2,4][s],h=e*(s===2?2:1);a.bitmap=t,a.setColdFrame(r,0,h,i),a.setHotFrame(r,i,h,i),a.visible=!1,this._buttons.push(a),this.addChild(a)}this._buttons[0].setClickHandler(this.onButtonDown.bind(this)),this._buttons[1].setClickHandler(this.onButtonUp.bind(this)),this._buttons[2].setClickHandler(this.onButtonOk.bind(this))}placeButtons(){let t=this._buttons.length,e=16,i=-e;for(let a=0;a<t;a++)i+=this._buttons[a].width+e;let s=(this.width-i)/2;for(let a=0;a<t;a++){let r=this._buttons[a];r.x=s,r.y=this.buttonY(),s+=r.width+e}}updateButtonsVisiblity(){k.date>x.date?this.showButtons():this.hideButtons()}showButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!0}hideButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!1}buttonY(){return this._messageWindow.y>=l.boxHeight/2?0-this._buttons[0].height-8:this.height+8}update(){super.update(),this.processDigitChange()}processDigitChange(){this.isOpenAndActive()&&(x.isRepeated("up")?this.changeDigit(!0):x.isRepeated("down")&&this.changeDigit(!1))}changeDigit(t){let e=this.index(),i=Math.pow(10,this._maxDigits-1-e),s=Math.floor(this._number/i)%10;this._number-=s*i,t?s=(s+1)%10:s=(s+9)%10,this._number+=s*i,this.refresh(),S.playCursor()}isTouchOkEnabled(){return!1}isOkEnabled(){return!0}isCancelEnabled(){return!1}isOkTriggered(){return x.isTriggered("ok")}processOk(){S.playOk(),self.$gameVariables.setValue(self.$gameMessage.numInputVariableId(),this._number),this._messageWindow.terminateMessage(),this.updateInputData(),this.deactivate(),this.close()}drawItem(t){let e=this.itemRect(t),i="center",a=this._number.padZero(this._maxDigits).slice(t,t+1);this.resetTextColor(),this.drawText(a,e.x,e.y,e.width,i)}onButtonUp(){this.changeDigit(!0)}onButtonDown(){this.changeDigit(!1)}onButtonOk(){this.processOk(),this.hideButtons()}};o(Ai,"Window_NumberInput");var Wi=Ai;var Pi=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._category="none",this._data=[]}setCategory(t){this._category!==t&&(this._category=t,this.refresh(),this.resetScroll())}maxCols(){return 2}spacing(){return 48}maxItems(){return this._data?this._data.length:1}item(){let t=this.index();return this._data&&t>=0?this._data[t]:null}isCurrentItemEnabled(){return this.isEnabled(this.item())}includes(t){switch(this._category){case"item":return w.isItem(t)&&t.itypeId===1;case"weapon":return w.isWeapon(t);case"armor":return w.isArmor(t);case"keyItem":return w.isItem(t)&&t.itypeId===2;default:return!1}}needsNumber(){return!0}isEnabled(t){return self.$gameParty.canUse(t)}makeItemList(){this._data=self.$gameParty.allItems().filter(function(t){return this.includes(t)},this),this.includes(null)&&this._data.push(null)}selectLast(){let t=this._data.indexOf(self.$gameParty.lastItem());this.select(t>=0?t:0)}drawItem(t){let e=this._data[t];if(e){let i=this.numberWidth(),s=this.itemRect(t);s.width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,s.x,s.y,s.width-i),this.drawItemNumber(e,s.x,s.y,s.width),this.changePaintOpacity(1)}}numberWidth(){return this.textWidth("000")}drawItemNumber(t,e,i,s){this.needsNumber()&&(this.drawText(":",e,i,s-this.textWidth("00"),"right"),this.drawText(self.$gameParty.numItems(t),e,i,s,"right"))}updateHelp(){this.setHelpWindowItem(this.item())}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}};o(Pi,"Window_ItemList");var vt=Pi;var Bi=class extends vt{constructor(...t){super(...t),this.initialize(...t)}initialize(t){this._messageWindow=t;let e=l.boxWidth,i=this.windowHeight();super.initialize(0,0,e,i),this.openness=0,this.deactivate(),this.setHandler("ok",this.onOk.bind(this)),this.setHandler("cancel",this.onCancel.bind(this))}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 4}start(){this.refresh(),this.updatePlacement(),this.select(0),this.open(),this.activate()}updatePlacement(){this._messageWindow.y>=l.boxHeight/2?this.y=0:this.y=l.boxHeight-this.height}includes(t){let e=self.$gameMessage.itemChoiceItypeId();return w.isItem(t)&&t.itypeId===e}isEnabled(t){return!0}onOk(){let t=this.item(),e=t?t.id:0;self.$gameVariables.setValue(self.$gameMessage.itemChoiceVariableId(),e),this._messageWindow.terminateMessage(),this.close()}onCancel(){self.$gameVariables.setValue(self.$gameMessage.itemChoiceVariableId(),0),this._messageWindow.terminateMessage(),this.close()}};o(Bi,"Window_EventItem");var Ri=Bi;var $i=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=this.windowWidth(),e=this.windowHeight(),i=(l.boxWidth-t)/2;super.initialize(i,0,t,e),this.openness=0,this.initMembers(),this.createSubWindows(),this.updatePlacement()}initMembers(){this._imageReservationId=I.generateRuntimeId(),this._background=0,this._positionType=2,this._waitCount=0,this._faceBitmap=null,this._textState=null,this.clearFlags()}subWindows(){return[this._goldWindow,this._choiceWindow,this._numberWindow,this._itemWindow]}createSubWindows(){this._goldWindow=new Yt(0,0),this._goldWindow.x=l.boxWidth-this._goldWindow.width,this._goldWindow.openness=0,this._choiceWindow=new Ei(this),this._numberWindow=new Wi(this),this._itemWindow=new Ri(this)}windowWidth(){return l.boxWidth}windowHeight(){return this.fittingHeight(this.numVisibleRows())}clearFlags(){this._showFast=!1,this._lineShowFast=!1,this._pauseSkip=!1,this._textSpeed=0,this._textSpeedCount=0}numVisibleRows(){return 4}update(){for(this.checkToNotClose(),super.update();!this.isOpening()&&!this.isClosing();){if(this.updateWait())return;if(this.updateLoading())return;if(this.updateInput())return;if(this.updateMessage())return;if(this.canStart())this.startMessage();else{this.startInput();return}}}checkToNotClose(){this.isClosing()&&this.isOpen()&&this.doesContinue()&&this.open()}canStart(){return self.$gameMessage.hasText()&&!self.$gameMessage.scrollMode()}startMessage(){this._textState={},this._textState.index=0,this._textState.text=this.convertEscapeCharacters(self.$gameMessage.allText()),this.newPage(this._textState),this.updatePlacement(),this.updateBackground(),this.open()}updatePlacement(){this._positionType=self.$gameMessage.positionType(),this.y=this._positionType*(l.boxHeight-this.height)/2,this._goldWindow.y=this.y>0?0:l.boxHeight-this._goldWindow.height}updateBackground(){this._background=self.$gameMessage.background(),this.setBackgroundType(this._background)}terminateMessage(){this.close(),this._goldWindow.close(),self.$gameMessage.clear()}updateWait(){return this._waitCount>0?(this._waitCount--,!0):!1}updateLoading(){return this._faceBitmap?this._faceBitmap.isReady()?(this.drawMessageFace(),this._faceBitmap=null,!1):!0:!1}updateInput(){return this.isAnySubWindowActive()?!0:this.pause?(this.isTriggered()&&(x.update(),this.pause=!1,this._textState||this.terminateMessage()),!0):!1}isAnySubWindowActive(){return this._choiceWindow.active||this._numberWindow.active||this._itemWindow.active}updateMessage(){if(this._textState){for(;!this.isEndOfText(this._textState);){if(this.needsNewPage(this._textState)&&this.newPage(this._textState),this.updateShowFast(),!this._showFast&&!this._lineShowFast&&this._textSpeedCount<this._textSpeed){this._textSpeedCount++;break}if(this._textSpeedCount=0,this.processCharacter(this._textState),!this._showFast&&!this._lineShowFast&&this._textSpeed!==-1||this.pause||this._waitCount>0)break}return this.isEndOfText(this._textState)&&this.onEndOfText(),!0}else return!1}onEndOfText(){this.startInput()||(this._pauseSkip?this.terminateMessage():this.startPause()),this._textState=null}startInput(){return self.$gameMessage.isChoice()?(this._choiceWindow.start(),!0):self.$gameMessage.isNumberInput()?(this._numberWindow.start(),!0):self.$gameMessage.isItemChoice()?(this._itemWindow.start(),!0):!1}isTriggered(){return x.isRepeated("ok")||x.isRepeated("cancel")||k.isRepeated()}doesContinue(){return self.$gameMessage.hasText()&&!self.$gameMessage.scrollMode()&&!this.areSettingsChanged()}areSettingsChanged(){return this._background!==self.$gameMessage.background()||this._positionType!==self.$gameMessage.positionType()}updateShowFast(){this.isTriggered()&&(this._showFast=!0)}newPage(t){this.contents.clear(),this.resetFontSettings(),this.clearFlags(),this.loadMessageFace(),t.x=this.newLineX(),t.y=0,t.left=this.newLineX(),t.height=this.calcTextHeight(t,!1)}loadMessageFace(){this._faceBitmap=p.reserveFace(self.$gameMessage.faceName(),0,this._imageReservationId)}drawMessageFace(){this.drawFace(self.$gameMessage.faceName(),self.$gameMessage.faceIndex(),0,0),p.releaseReservation(this._imageReservationId)}newLineX(){return self.$gameMessage.faceName()===""?0:168}processNewLine(t){this._lineShowFast=!1,super.processNewLine(t),this.needsNewPage(t)&&this.startPause()}processNewPage(t){super.processNewPage(t),t.text[t.index]===`
`&&t.index++,t.y=this.contents.height,this.startPause()}isEndOfText({index:t,text:e}){return t>=e.length}needsNewPage(t){return!this.isEndOfText(t)&&t.y+t.height>this.contents.height}processEscapeCharacter(t,e){switch(t){case"$":this._goldWindow.open();break;case".":this.startWait(15);break;case"|":this.startWait(60);break;case"!":this.startPause();break;case">":this._lineShowFast=!0;break;case"<":this._lineShowFast=!1;break;case"^":this._pauseSkip=!0;break;case"S":this._textSpeed=this.obtainEscapeParam(e)-1;break;default:super.processEscapeCharacter(t,e);break}}startWait(t){this._waitCount=t}startPause(){this.startWait(10),this.pause=!0}};o($i,"Window_Message");var de=$i;var Fi=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=l.boxWidth,e=l.boxHeight;super.initialize(0,0,t,e),this.opacity=0,this.hide(),this._text="",this._allTextHeight=0}update(){super.update(),self.$gameMessage.scrollMode()&&(this._text&&this.updateMessage(),!this._text&&self.$gameMessage.hasText()&&this.startMessage())}startMessage(){this._text=self.$gameMessage.allText(),this.refresh(),this.show()}refresh(){let t={index:0};t.text=this.convertEscapeCharacters(this._text),this.resetFontSettings(),this._allTextHeight=this.calcTextHeight(t,!0),this.createContents(),this.origin.y=-this.height,this.drawTextEx(this._text,this.textPadding(),1)}contentsHeight(){return Math.max(this._allTextHeight,1)}updateMessage(){this.origin.y+=this.scrollSpeed(),this.origin.y>=this.contents.height&&this.terminateMessage()}scrollSpeed(){let t=self.$gameMessage.scrollSpeed()/2;return this.isFastForward()&&(t*=this.fastForwardRate()),t}isFastForward(){return self.$gameMessage.scrollNoFast()?!1:x.isPressed("ok")||x.isPressed("shift")||k.isPressed()}fastForwardRate(){return 3}terminateMessage(){this._text=null,self.$gameMessage.clear(),this.hide()}};o(Fi,"Window_ScrollText");var me=Fi;var Di=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=this.windowWidth(),e=this.windowHeight();super.initialize(0,0,t,e),this.opacity=0,this._lines=[],this._methods=[],this._waitCount=0,this._waitMode="",this._baseLineStack=[],this._spriteset=null,this.createBackBitmap(),this.createBackSprite(),this.refresh()}setSpriteset(t){this._spriteset=t}windowWidth(){return l.boxWidth}windowHeight(){return this.fittingHeight(this.maxLines())}maxLines(){return 10}createBackBitmap(){this._backBitmap=new V(this.width,this.height)}createBackSprite(){this._backSprite=new C,this._backSprite.bitmap=this._backBitmap,this._backSprite.y=this.y,this.addChildToBack(this._backSprite)}numLines(){return this._lines.length}messageSpeed(){return 16}isBusy(){return this._waitCount>0||this._waitMode||this._methods.length>0}update(){this.updateWait()||this.callNextMethod()}updateWait(){return this.updateWaitCount()||this.updateWaitMode()}updateWaitCount(){return this._waitCount>0?(this._waitCount-=this.isFastForward()?3:1,this._waitCount<0&&(this._waitCount=0),!0):!1}updateWaitMode(){let t=!1;switch(this._waitMode){case"effect":t=this._spriteset.isEffecting();break;case"movement":t=this._spriteset.isAnyoneMoving();break}return t||(this._waitMode=""),t}setWaitMode(t){this._waitMode=t}callNextMethod(){if(this._methods.length>0){let t=this._methods.shift();if(t.name&&this[t.name])this[t.name](...t.params);else throw new Error(`Method not found: ${t.name}`)}}isFastForward(){return x.isLongPressed("ok")||x.isPressed("shift")||k.isLongPressed()}push(t){let e=Array.prototype.slice.call(arguments,1);this._methods.push({name:t,params:e})}clear(){this._lines=[],this._baseLineStack=[],this.refresh()}wait(){this._waitCount=this.messageSpeed()}waitForEffect(){this.setWaitMode("effect")}waitForMovement(){this.setWaitMode("movement")}addText(t){this._lines.push(t),this.refresh(),this.wait()}pushBaseLine(){this._baseLineStack.push(this._lines.length)}popBaseLine(){let t=this._baseLineStack.pop();for(;this._lines.length>t;)this._lines.pop()}waitForNewLine(){let t=0;this._baseLineStack.length>0&&(t=this._baseLineStack[this._baseLineStack.length-1]),this._lines.length>t&&this.wait()}popupDamage(t){t.startDamagePopup()}performActionStart(t,e){t.performActionStart(e)}performAction(t,e){t.performAction(e)}performActionEnd(t){t.performActionEnd()}performDamage(t){t.performDamage()}performMiss(t){t.performMiss()}performRecovery(t){t.performRecovery()}performEvasion(t){t.performEvasion()}performMagicEvasion(t){t.performMagicEvasion()}performCounter(t){t.performCounter()}performReflection(t){t.performReflection()}performSubstitute(t,e){t.performSubstitute(e)}performCollapse(t){t.performCollapse()}showAnimation(t,e,i){i<0?this.showAttackAnimation(t,e):this.showNormalAnimation(e,i)}showAttackAnimation(t,e){t.isActor()?this.showActorAttackAnimation(t,e):this.showEnemyAttackAnimation(t,e)}showActorAttackAnimation(t,e){this.showNormalAnimation(e,t.attackAnimationId1(),!1),this.showNormalAnimation(e,t.attackAnimationId2(),!0)}showEnemyAttackAnimation(t,e){S.playEnemyAttack()}showNormalAnimation(t,e,i){if(self.$dataAnimations[e]){let a=this.animationBaseDelay(),r=this.animationNextDelay();t.forEach(h=>{h.startAnimation(e,i,a),a+=r})}}animationBaseDelay(){return 8}animationNextDelay(){return 12}refresh(){this.drawBackground(),this.contents.clear();for(let t=0;t<this._lines.length;t++)this.drawLineText(t)}drawBackground(){let t=this.backRect(),e=this.backColor();this._backBitmap.clear(),this._backBitmap.paintOpacity=this.backPaintOpacity(),this._backBitmap.fillRect(t.x,t.y,t.width,t.height,e),this._backBitmap.paintOpacity=255}backRect(){return{x:0,y:this.padding,width:this.width,height:this.numLines()*this.lineHeight()}}backColor(){return"#000000"}backPaintOpacity(){return 64}drawLineText(t){let e=this.itemRectForText(t);this.contents.clearRect(e.x,e.y,e.width,e.height),this.drawTextEx(this._lines[t],e.x,e.y,e.width)}startTurn(){this.push("wait")}startAction(t,e,i){let s=e.item();this.push("performActionStart",t,e),this.push("waitForMovement"),this.push("performAction",t,e),this.push("showAnimation",t,i.clone(),s.animationId),this.displayAction(t,s)}endAction(t){this.push("waitForNewLine"),this.push("clear"),this.push("performActionEnd",t)}displayCurrentState(t){let e=t.mostImportantStateText();e&&(this.push("addText",t.name()+e),this.push("wait"),this.push("clear"))}displayRegeneration(t){this.push("popupDamage",t)}displayAction(t,e){let i=this._methods.length;w.isSkill(e)?(e.message1&&this.push("addText",t.name()+e.message1.format(e.name)),e.message2&&this.push("addText",e.message2.format(e.name))):this.push("addText",m.useItem.format(t.name(),e.name)),this._methods.length===i&&this.push("wait")}displayCounter(t){this.push("performCounter",t),this.push("addText",m.counterAttack.format(t.name()))}displayReflection(t){this.push("performReflection",t),this.push("addText",m.magicReflection.format(t.name()))}displaySubstitute(t,e){let i=t.name();this.push("performSubstitute",t,e),this.push("addText",m.substitute.format(i,e.name()))}displayActionResults(t,e){e.result().used&&(this.push("pushBaseLine"),this.displayCritical(e),this.push("popupDamage",e),this.push("popupDamage",t),this.displayDamage(e),this.displayAffectedStatus(e),this.displayFailure(e),this.push("waitForNewLine"),this.push("popBaseLine"))}displayFailure(t){t.result().isHit()&&!t.result().success&&this.push("addText",m.actionFailure.format(t.name()))}displayCritical(t){t.result().critical&&(t.isActor()?this.push("addText",m.criticalToActor):this.push("addText",m.criticalToEnemy))}displayDamage(t){t.result().missed?this.displayMiss(t):t.result().evaded?this.displayEvasion(t):(this.displayHpDamage(t),this.displayMpDamage(t),this.displayTpDamage(t))}displayMiss(t){let e;t.result().physical?(e=t.isActor()?m.actorNoHit:m.enemyNoHit,this.push("performMiss",t)):e=m.actionFailure,this.push("addText",e.format(t.name()))}displayEvasion(t){let e;t.result().physical?(e=m.evasion,this.push("performEvasion",t)):(e=m.magicEvasion,this.push("performMagicEvasion",t)),this.push("addText",e.format(t.name()))}displayHpDamage(t){t.result().hpAffected&&(t.result().hpDamage>0&&!t.result().drain&&this.push("performDamage",t),t.result().hpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeHpDamageText(t)))}displayMpDamage(t){t.isAlive()&&t.result().mpDamage!==0&&(t.result().mpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeMpDamageText(t)))}displayTpDamage(t){t.isAlive()&&t.result().tpDamage!==0&&(t.result().tpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeTpDamageText(t)))}displayAffectedStatus(t){t.result().isStatusAffected()&&(this.push("pushBaseLine"),this.displayChangedStates(t),this.displayChangedBuffs(t),this.push("waitForNewLine"),this.push("popBaseLine"))}displayAutoAffectedStatus(t){t.result().isStatusAffected()&&(this.displayAffectedStatus(t,null),this.push("clear"))}displayChangedStates(t){this.displayAddedStates(t),this.displayRemovedStates(t)}displayAddedStates(t){t.result().addedStateObjects().forEach(function({message1:e,message2:i,id:s}){let a=t.isActor()?e:i;s===t.deathStateId()&&this.push("performCollapse",t),a&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",t.name()+a),this.push("waitForEffect"))},this)}displayRemovedStates(t){t.result().removedStateObjects().forEach(function({message4:e}){e&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",t.name()+e))},this)}displayChangedBuffs(t){let e=t.result();this.displayBuffs(t,e.addedBuffs,m.buffAdd),this.displayBuffs(t,e.addedDebuffs,m.debuffAdd),this.displayBuffs(t,e.removedBuffs,m.buffRemove)}displayBuffs(t,e,i){e.forEach(function(s){this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",i.format(t.name(),m.param(s)))},this)}makeHpDamageText(t){let e=t.result(),i=e.hpDamage,s=t.isActor(),a;return i>0&&e.drain?(a=s?m.actorDrain:m.enemyDrain,a.format(t.name(),m.hp,i)):i>0?(a=s?m.actorDamage:m.enemyDamage,a.format(t.name(),i)):i<0?(a=s?m.actorRecovery:m.enemyRecovery,a.format(t.name(),m.hp,-i)):(a=s?m.actorNoDamage:m.enemyNoDamage,a.format(t.name()))}makeMpDamageText(t){let e=t.result(),i=e.mpDamage,s=t.isActor(),a;return i>0&&e.drain?(a=s?m.actorDrain:m.enemyDrain,a.format(t.name(),m.mp,i)):i>0?(a=s?m.actorLoss:m.enemyLoss,a.format(t.name(),m.mp,i)):i<0?(a=s?m.actorRecovery:m.enemyRecovery,a.format(t.name(),m.mp,-i)):""}makeTpDamageText(t){let i=t.result().tpDamage,s=t.isActor(),a;return i>0?(a=s?m.actorLoss:m.enemyLoss,a.format(t.name(),m.tp,i)):i<0?(a=s?m.actorGain:m.enemyGain,a.format(t.name(),m.tp,-i)):""}};o(Di,"Window_BattleLog");var Li=Di;var Oi=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=l.boxHeight-this.windowHeight();super.initialize(0,t),this.openness=0,this.deactivate()}windowWidth(){return 192}numVisibleRows(){return 4}makeCommandList(){this.addCommand(m.fight,"fight"),this.addCommand(m.escape,"escape",v.canEscape())}setup(){this.clearCommandList(),this.makeCommandList(),this.refresh(),this.select(0),this.activate(),this.open()}};o(Oi,"Window_PartyCommand");var Ni=Oi;var Mt=class{constructor(){throw new Error("This is a static class")}static async load(){let t,e={};try{t=await et.load(-1)}catch{}t&&(e=JSON.parse(t)),this.applyData(e),this._isConfigLoaded=!0}static isConfigLoaded(){return this._isConfigLoaded}static async save(){await et.save(-1,JSON.stringify(this.makeData()))}static makeData(){let t={};return t.alwaysDash=this.alwaysDash,t.commandRemember=this.commandRemember,t.bgmVolume=this.bgmVolume,t.bgsVolume=this.bgsVolume,t.meVolume=this.meVolume,t.seVolume=this.seVolume,t}static applyData(t){this.alwaysDash=this.readFlag(t,"alwaysDash"),this.commandRemember=this.readFlag(t,"commandRemember"),this.bgmVolume=this.readVolume(t,"bgmVolume"),this.bgsVolume=this.readVolume(t,"bgsVolume"),this.meVolume=this.readVolume(t,"meVolume"),this.seVolume=this.readVolume(t,"seVolume")}static readFlag(t,e){return!!t[e]}static readVolume(t,e){let i=t[e];return i!==void 0?Number(i).clamp(0,100):100}};o(Mt,"ConfigManager");Mt._isConfigLoaded=!1;Mt.alwaysDash=!1;Mt.commandRemember=!1;Object.defineProperty(Mt,"bgmVolume",{get(){return b._bgmVolume},set(n){b.bgmVolume=n},configurable:!0});Object.defineProperty(Mt,"bgsVolume",{get(){return b.bgsVolume},set(n){b.bgsVolume=n},configurable:!0});Object.defineProperty(Mt,"meVolume",{get(){return b.meVolume},set(n){b.meVolume=n},configurable:!0});Object.defineProperty(Mt,"seVolume",{get(){return b.seVolume},set(n){b.seVolume=n},configurable:!0});var ut=Mt;var Hi=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=l.boxHeight-this.windowHeight();super.initialize(0,t),this.openness=0,this.deactivate(),this._actor=null}windowWidth(){return 192}numVisibleRows(){return 4}makeCommandList(){this._actor&&(this.addAttackCommand(),this.addSkillCommands(),this.addGuardCommand(),this.addItemCommand())}addAttackCommand(){this.addCommand(m.attack,"attack",this._actor.canAttack())}addSkillCommands(){let t=this._actor.addedSkillTypes();t.sort((e,i)=>e-i),t.forEach(function(e){let i=self.$dataSystem.skillTypes[e];this.addCommand(i,"skill",!0,e)},this)}addGuardCommand(){this.addCommand(m.guard,"guard",this._actor.canGuard())}addItemCommand(){this.addCommand(m.item,"item")}setup(t){this._actor=t,this.clearCommandList(),this.makeCommandList(),this.refresh(),this.selectLast(),this.activate(),this.open()}processOk(){this._actor&&(ut.commandRemember?this._actor.setLastCommandSymbol(this.currentSymbol()):this._actor.setLastCommandSymbol("")),super.processOk()}selectLast(){if(this.select(0),this._actor&&ut.commandRemember){let t=this._actor.lastCommandSymbol();if(this.selectSymbol(t),t==="skill"){let e=this._actor.lastBattleSkill();e&&this.selectExt(e.stypeId)}}}};o(Hi,"Window_ActorCommand");var zi=Hi;var Vi=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=this.windowWidth(),e=this.windowHeight(),i=l.boxWidth-t,s=l.boxHeight-e;super.initialize(i,s,t,e),this.refresh(),this.openness=0}windowWidth(){return l.boxWidth-192}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 4}maxItems(){return self.$gameParty.battleMembers().length}refresh(){this.contents.clear(),this.drawAllItems()}drawItem(t){let e=self.$gameParty.battleMembers()[t];this.drawBasicArea(this.basicAreaRect(t),e),this.drawGaugeArea(this.gaugeAreaRect(t),e)}basicAreaRect(t){let e=this.itemRectForText(t);return e.width-=this.gaugeAreaWidth()+15,e}gaugeAreaRect(t){let e=this.itemRectForText(t);return e.x+=e.width-this.gaugeAreaWidth(),e.width=this.gaugeAreaWidth(),e}gaugeAreaWidth(){return 330}drawBasicArea({x:t,y:e,width:i},s){this.drawActorName(s,t+0,e,150),this.drawActorIcons(s,t+156,e,i-156)}drawGaugeArea(t,e){self.$dataSystem.optDisplayTp?this.drawGaugeAreaWithTp(t,e):this.drawGaugeAreaWithoutTp(t,e)}drawGaugeAreaWithTp({x:t,y:e},i){this.drawActorHp(i,t+0,e,108),this.drawActorMp(i,t+123,e,96),this.drawActorTp(i,t+234,e,96)}drawGaugeAreaWithoutTp({x:t,y:e},i){this.drawActorHp(i,t+0,e,201),this.drawActorMp(i,t+216,e,114)}};o(Vi,"Window_BattleStatus");var ue=Vi;var qi=class extends ue{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(),this.x=t,this.y=e,this.openness=255,this.hide()}show(){this.select(0),super.show()}hide(){super.hide(),self.$gameParty.select(null)}select(t){super.select(t),self.$gameParty.select(this.actor())}actor(){return self.$gameParty.members()[this.index()]}};o(qi,"Window_BattleActor");var Ui=qi;var Xi=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this._enemies=[];let i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh(),this.hide()}windowWidth(){return l.boxWidth-192}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 4}maxCols(){return 2}maxItems(){return this._enemies.length}enemy(){return this._enemies[this.index()]}enemyIndex(){let t=this.enemy();return t?t.index():-1}drawItem(t){this.resetTextColor();let e=this._enemies[t].name(),i=this.itemRectForText(t);this.drawText(e,i.x,i.y,i.width)}show(){this.refresh(),this.select(0),super.show()}hide(){super.hide(),self.$gameTroop.select(null)}refresh(){this._enemies=self.$gameTroop.aliveMembers(),super.refresh()}select(t){super.select(t),self.$gameTroop.select(this.enemy())}};o(Xi,"Window_BattleEnemy");var Gi=Xi;var Yi=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null,this._stypeId=0,this._data=[]}setActor(t){this._actor!==t&&(this._actor=t,this.refresh(),this.resetScroll())}setStypeId(t){this._stypeId!==t&&(this._stypeId=t,this.refresh(),this.resetScroll())}maxCols(){return 2}spacing(){return 48}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}isCurrentItemEnabled(){return this.isEnabled(this._data[this.index()])}includes(t){return t&&t.stypeId===this._stypeId}isEnabled(t){return this._actor&&this._actor.canUse(t)}makeItemList(){this._actor?this._data=this._actor.skills().filter(function(t){return this.includes(t)},this):this._data=[]}selectLast(){let t;self.$gameParty.inBattle()?t=this._actor.lastBattleSkill():t=this._actor.lastMenuSkill();let e=this._data.indexOf(t);this.select(e>=0?e:0)}drawItem(t){let e=this._data[t];if(e){let i=this.costWidth(),s=this.itemRect(t);s.width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,s.x,s.y,s.width-i),this.drawSkillCost(e,s.x,s.y,s.width),this.changePaintOpacity(1)}}costWidth(){return this.textWidth("000")}drawSkillCost(t,e,i,s){this._actor.skillTpCost(t)>0?(this.changeTextColor(this.tpCostColor()),this.drawText(this._actor.skillTpCost(t),e,i,s,"right")):this._actor.skillMpCost(t)>0&&(this.changeTextColor(this.mpCostColor()),this.drawText(this._actor.skillMpCost(t),e,i,s,"right"))}updateHelp(){this.setHelpWindowItem(this.item())}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}};o(Yi,"Window_SkillList");var pe=Yi;var ji=class extends pe{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this.hide()}show(){this.selectLast(),this.showHelpWindow(),super.show()}hide(){this.hideHelpWindow(),super.hide()}};o(ji,"Window_BattleSkill");var Ki=ji;var Zi=class extends vt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this.hide()}includes(t){return self.$gameParty.canUse(t)}show(){this.selectLast(),this.showHelpWindow(),super.show()}hide(){this.hideHelpWindow(),super.hide()}};o(Zi,"Window_BattleItem");var Ji=Zi;var Qi=class extends it{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createDisplayObjects()}start(){super.start(),this.startFadeIn(this.fadeSpeed(),!1),v.playBattleBgm(),v.startBattle()}update(){let t=this.isActive();self.$gameTimer.update(t),self.$gameScreen.update(),this.updateStatusWindow(),this.updateWindowPositions(),t&&!this.isBusy()&&this.updateBattleProcess(),super.update()}updateBattleProcess(){(!this.isAnyInputWindowActive()||v.isAborting()||v.isBattleEnd())&&(v.update(),this.changeInputWindow())}isAnyInputWindowActive(){return this._partyCommandWindow.active||this._actorCommandWindow.active||this._skillWindow.active||this._itemWindow.active||this._actorWindow.active||this._enemyWindow.active}changeInputWindow(){v.isInputting()?v.actor()?this.startActorCommandSelection():this.startPartyCommandSelection():this.endCommandSelection()}stop(){super.stop(),this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):this.startFadeOut(this.fadeSpeed(),!1),this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()}terminate(){super.terminate(),self.$gameParty.onBattleEnd(),self.$gameTroop.onBattleEnd(),b.stopMe(),p.clearRequest()}needsSlowFadeOut(){return g.isNextScene(ft)||g.isNextScene(Tt)}updateStatusWindow(){self.$gameMessage.isBusy()?(this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()):this.isActive()&&!this._messageWindow.isClosing()&&this._statusWindow.open()}updateWindowPositions(){let t=0;v.isInputting()?t=this._partyCommandWindow.width:t=this._partyCommandWindow.width/2,this._statusWindow.x<t&&(this._statusWindow.x+=16,this._statusWindow.x>t&&(this._statusWindow.x=t)),this._statusWindow.x>t&&(this._statusWindow.x-=16,this._statusWindow.x<t&&(this._statusWindow.x=t))}createDisplayObjects(){this.createSpriteset(),this.createWindowLayer(),this.createAllWindows(),v.setLogWindow(this._logWindow),v.setStatusWindow(this._statusWindow),v.setSpriteset(this._spriteset),this._logWindow.setSpriteset(this._spriteset)}createSpriteset(){this._spriteset=new xi,this.addChild(this._spriteset)}createAllWindows(){this.createLogWindow(),this.createStatusWindow(),this.createPartyCommandWindow(),this.createActorCommandWindow(),this.createHelpWindow(),this.createSkillWindow(),this.createItemWindow(),this.createActorWindow(),this.createEnemyWindow(),this.createMessageWindow(),this.createScrollTextWindow()}createLogWindow(){this._logWindow=new Li,this.addWindow(this._logWindow)}createStatusWindow(){this._statusWindow=new ue,this.addWindow(this._statusWindow)}createPartyCommandWindow(){this._partyCommandWindow=new Ni,this._partyCommandWindow.setHandler("fight",this.commandFight.bind(this)),this._partyCommandWindow.setHandler("escape",this.commandEscape.bind(this)),this._partyCommandWindow.deselect(),this.addWindow(this._partyCommandWindow)}createActorCommandWindow(){this._actorCommandWindow=new zi,this._actorCommandWindow.setHandler("attack",this.commandAttack.bind(this)),this._actorCommandWindow.setHandler("skill",this.commandSkill.bind(this)),this._actorCommandWindow.setHandler("guard",this.commandGuard.bind(this)),this._actorCommandWindow.setHandler("item",this.commandItem.bind(this)),this._actorCommandWindow.setHandler("cancel",this.selectPreviousCommand.bind(this)),this.addWindow(this._actorCommandWindow)}createHelpWindow(){this._helpWindow=new Gt,this._helpWindow.visible=!1,this.addWindow(this._helpWindow)}createSkillWindow(){let t=this._helpWindow.y+this._helpWindow.height,e=this._statusWindow.y-t;this._skillWindow=new Ki(0,t,l.boxWidth,e),this._skillWindow.setHelpWindow(this._helpWindow),this._skillWindow.setHandler("ok",this.onSkillOk.bind(this)),this._skillWindow.setHandler("cancel",this.onSkillCancel.bind(this)),this.addWindow(this._skillWindow)}createItemWindow(){let t=this._helpWindow.y+this._helpWindow.height,e=this._statusWindow.y-t;this._itemWindow=new Ji(0,t,l.boxWidth,e),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this.addWindow(this._itemWindow)}createActorWindow(){this._actorWindow=new Ui(0,this._statusWindow.y),this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)}createEnemyWindow(){this._enemyWindow=new Gi(0,this._statusWindow.y),this._enemyWindow.x=l.boxWidth-this._enemyWindow.width,this._enemyWindow.setHandler("ok",this.onEnemyOk.bind(this)),this._enemyWindow.setHandler("cancel",this.onEnemyCancel.bind(this)),this.addWindow(this._enemyWindow)}createMessageWindow(){this._messageWindow=new de,this.addWindow(this._messageWindow),this._messageWindow.subWindows().forEach(function(t){this.addWindow(t)},this)}createScrollTextWindow(){this._scrollTextWindow=new me,this.addWindow(this._scrollTextWindow)}refreshStatus(){this._statusWindow.refresh()}startPartyCommandSelection(){this.refreshStatus(),this._statusWindow.deselect(),this._statusWindow.open(),this._actorCommandWindow.close(),this._partyCommandWindow.setup()}commandFight(){this.selectNextCommand()}commandEscape(){v.processEscape(),this.changeInputWindow()}startActorCommandSelection(){this._statusWindow.select(v.actor().index()),this._partyCommandWindow.close(),this._actorCommandWindow.setup(v.actor())}commandAttack(){v.inputtingAction().setAttack(),this.selectEnemySelection()}commandSkill(){this._skillWindow.setActor(v.actor()),this._skillWindow.setStypeId(this._actorCommandWindow.currentExt()),this._skillWindow.refresh(),this._skillWindow.show(),this._skillWindow.activate()}commandGuard(){v.inputtingAction().setGuard(),this.selectNextCommand()}commandItem(){this._itemWindow.refresh(),this._itemWindow.show(),this._itemWindow.activate()}selectNextCommand(){v.selectNextCommand(),this.changeInputWindow()}selectPreviousCommand(){v.selectPreviousCommand(),this.changeInputWindow()}selectActorSelection(){this._actorWindow.refresh(),this._actorWindow.show(),this._actorWindow.activate()}onActorOk(){v.inputtingAction().setTarget(this._actorWindow.index()),this._actorWindow.hide(),this._skillWindow.hide(),this._itemWindow.hide(),this.selectNextCommand()}onActorCancel(){switch(this._actorWindow.hide(),this._actorCommandWindow.currentSymbol()){case"skill":this._skillWindow.show(),this._skillWindow.activate();break;case"item":this._itemWindow.show(),this._itemWindow.activate();break}}selectEnemySelection(){this._enemyWindow.refresh(),this._enemyWindow.show(),this._enemyWindow.select(0),this._enemyWindow.activate()}onEnemyOk(){v.inputtingAction().setTarget(this._enemyWindow.enemyIndex()),this._enemyWindow.hide(),this._skillWindow.hide(),this._itemWindow.hide(),this.selectNextCommand()}onEnemyCancel(){switch(this._enemyWindow.hide(),this._actorCommandWindow.currentSymbol()){case"attack":this._actorCommandWindow.activate();break;case"skill":this._skillWindow.show(),this._skillWindow.activate();break;case"item":this._itemWindow.show(),this._itemWindow.activate();break}}onSkillOk(){let t=this._skillWindow.item();v.inputtingAction().setSkill(t.id),v.actor().setLastBattleSkill(t),this.onSelectAction()}onSkillCancel(){this._skillWindow.hide(),this._actorCommandWindow.activate()}onItemOk(){let t=this._itemWindow.item();v.inputtingAction().setItem(t.id),self.$gameParty.setLastItem(t),this.onSelectAction()}onItemCancel(){this._itemWindow.hide(),this._actorCommandWindow.activate()}onSelectAction(){let t=v.inputtingAction();this._skillWindow.hide(),this._itemWindow.hide(),t.needsSelection()?t.isForOpponent()?this.selectEnemySelection():this.selectActorSelection():this.selectNextCommand()}endCommandSelection(){this._partyCommandWindow.close(),this._actorCommandWindow.close(),this._statusWindow.deselect()}};o(Qi,"Scene_Battle");var Ct=Qi;var ts=class extends it{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createBackground(),this.updateActor(),this.createWindowLayer()}actor(){return this._actor}updateActor(){this._actor=self.$gameParty.menuActor()}createBackground(){this._backgroundSprite=new C,this._backgroundSprite.bitmap=g.backgroundBitmap(),this.addChild(this._backgroundSprite)}setBackgroundOpacity(t){this._backgroundSprite.opacity=t}createHelpWindow(){this._helpWindow=new Gt,this.addWindow(this._helpWindow)}nextActor(){self.$gameParty.makeMenuActorNext(),this.updateActor(),this.onActorChange()}previousActor(){self.$gameParty.makeMenuActorPrevious(),this.updateActor(),this.onActorChange()}onActorChange(){}};o(ts,"Scene_MenuBase");var Y=ts;var jt=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(t,e),this.selectLast()}static initCommandPosition(){this._lastCommandSymbol=null}windowWidth(){return 240}numVisibleRows(){return this.maxItems()}makeCommandList(){this.addMainCommands(),this.addFormationCommand(),this.addOriginalCommands(),this.addOptionsCommand(),this.addSaveCommand(),this.addGameEndCommand()}addMainCommands(){let t=this.areMainCommandsEnabled();this.needsCommand("item")&&this.addCommand(m.item,"item",t),this.needsCommand("skill")&&this.addCommand(m.skill,"skill",t),this.needsCommand("equip")&&this.addCommand(m.equip,"equip",t),this.needsCommand("status")&&this.addCommand(m.status,"status",t)}addFormationCommand(){if(this.needsCommand("formation")){let t=this.isFormationEnabled();this.addCommand(m.formation,"formation",t)}}addOriginalCommands(){}addOptionsCommand(){if(this.needsCommand("options")){let t=this.isOptionsEnabled();this.addCommand(m.options,"options",t)}}addSaveCommand(){if(this.needsCommand("save")){let t=this.isSaveEnabled();this.addCommand(m.save,"save",t)}}addGameEndCommand(){let t=this.isGameEndEnabled();this.addCommand(m.gameEnd,"gameEnd",t)}needsCommand(t){let e=self.$dataSystem.menuCommands;if(e)switch(t){case"item":return e[0];case"skill":return e[1];case"equip":return e[2];case"status":return e[3];case"formation":return e[4];case"save":return e[5]}return!0}areMainCommandsEnabled(){return self.$gameParty.exists()}isFormationEnabled(){return self.$gameParty.size()>=2&&self.$gameSystem.isFormationEnabled()}isOptionsEnabled(){return!0}isSaveEnabled(){return!w.isEventTest()&&self.$gameSystem.isSaveEnabled()}isGameEndEnabled(){return!0}processOk(){jt._lastCommandSymbol=this.currentSymbol(),super.processOk()}selectLast(){this.selectSymbol(jt._lastCommandSymbol)}};o(jt,"Window_MenuCommand");jt._lastCommandSymbol=null;var Kt=jt;var es=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){let i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this._formationMode=!1,this._pendingIndex=-1,this.refresh()}windowWidth(){return l.boxWidth-240}windowHeight(){return l.boxHeight}maxItems(){return self.$gameParty.size()}itemHeight(){let t=this.height-this.padding*2;return Math.floor(t/this.numVisibleRows())}numVisibleRows(){return 4}loadImages(){self.$gameParty.members().forEach(t=>{p.reserveFace(t.faceName())},this)}drawItem(t){this.drawItemBackground(t),this.drawItemImage(t),this.drawItemStatus(t)}drawItemBackground(t){if(t===this._pendingIndex){let e=this.itemRect(t),i=this.pendingColor();this.changePaintOpacity(!1),this.contents.fillRect(e.x,e.y,e.width,e.height,i),this.changePaintOpacity(!0)}}drawItemImage(t){let e=self.$gameParty.members()[t],i=this.itemRect(t);this.changePaintOpacity(e.isBattleMember()),this.drawActorFace(e,i.x+1,i.y+1,H._faceWidth,H._faceHeight),this.changePaintOpacity(!0)}drawItemStatus(t){let e=self.$gameParty.members()[t],i=this.itemRect(t),s=i.x+162,a=i.y+i.height/2-this.lineHeight()*1.5,r=i.width-s-this.textPadding();this.drawActorSimpleStatus(e,s,a,r)}processOk(){super.processOk(),self.$gameParty.setMenuActor(self.$gameParty.members()[this.index()])}isCurrentItemEnabled(){if(this._formationMode){let t=self.$gameParty.members()[this.index()];return t&&t.isFormationChangeOk()}else return!0}selectLast(){this.select(self.$gameParty.menuActor().index()||0)}formationMode(){return this._formationMode}setFormationMode(t){this._formationMode=t}pendingIndex(){return this._pendingIndex}setPendingIndex(t){let e=this._pendingIndex;this._pendingIndex=t,this.redrawItem(this._pendingIndex),this.redrawItem(e)}};o(es,"Window_MenuStatus");var fe=es;var is=class extends fe{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.hide()}processOk(){this.cursorAll()||self.$gameParty.setTargetActor(self.$gameParty.members()[this.index()]),this.callOkHandler()}selectLast(){this.select(self.$gameParty.targetActor().index()||0)}selectForItem(t){let e=self.$gameParty.menuActor(),i=new mt(e);i.setItemObject(t),this.setCursorFixed(!1),this.setCursorAll(!1),i.isForUser()?w.isSkill(t)?(this.setCursorFixed(!0),this.select(e.index())):this.selectLast():i.isForAll()?(this.setCursorAll(!0),this.select(0)):this.selectLast()}};o(is,"Window_MenuActor");var ss=is;var as=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create()}createActorWindow(){this._actorWindow=new ss,this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)}item(){return this._itemWindow.item()}user(){return null}isCursorLeft(){return this._itemWindow.index()%2===0}showSubWindow(t){t.x=this.isCursorLeft()?l.boxWidth-t.width:0,t.show(),t.activate()}hideSubWindow(t){t.hide(),t.deactivate(),this.activateItemWindow()}onActorOk(){this.canUse()?this.useItem():S.playBuzzer()}onActorCancel(){this.hideSubWindow(this._actorWindow)}action(){let t=new mt(this.user());return t.setItemObject(this.item()),t}determineItem(){this.action().isForFriend()?(this.showSubWindow(this._actorWindow),this._actorWindow.selectForItem(this.item())):(this.useItem(),this.activateItemWindow())}useItem(){this.playSeForItem(),this.user().useItem(this.item()),this.applyItem(),this.checkCommonEvent(),this.checkGameover(),this._actorWindow.refresh()}activateItemWindow(){this._itemWindow.refresh(),this._itemWindow.activate()}itemTargetActors(){let t=this.action();return t.isForFriend()?t.isForAll()?self.$gameParty.members():[self.$gameParty.members()[this._actorWindow.index()]]:[]}canUse(){let t=this.user();return t?t.canUse(this.item())&&this.isItemEffectsValid():!1}isItemEffectsValid(){let t=this.action();return this.itemTargetActors().some(e=>t.testApply(e),this)}applyItem(){let t=this.action();this.itemTargetActors().forEach(i=>{let s=t.numRepeats();for(let a=0;a<s;a++)t.apply(i)}),t.applyGlobal()}checkCommonEvent(){self.$gameTemp.isCommonEventReserved()&&g.goto(Rt)}};o(as,"Scene_ItemBase");var _e=as;var rs=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(t,e)}numVisibleRows(){return 1}maxCols(){return 4}itemTextAlign(){return"center"}};o(rs,"Window_HorzCommand");var Zt=rs;var ns=class extends Zt{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0)}windowWidth(){return l.boxWidth}maxCols(){return 4}update(){super.update(),this._itemWindow&&this._itemWindow.setCategory(this.currentSymbol())}makeCommandList(){this.addCommand(m.item,"item"),this.addCommand(m.weapon,"weapon"),this.addCommand(m.armor,"armor"),this.addCommand(m.keyItem,"keyItem")}setItemWindow(t){this._itemWindow=t}};o(ns,"Window_ItemCategory");var ge=ns;var os=class extends _e{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createHelpWindow(),this.createCategoryWindow(),this.createItemWindow(),this.createActorWindow()}createCategoryWindow(){this._categoryWindow=new ge,this._categoryWindow.setHelpWindow(this._helpWindow),this._categoryWindow.y=this._helpWindow.height,this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this)),this._categoryWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._categoryWindow)}createItemWindow(){let t=this._categoryWindow.y+this._categoryWindow.height,e=l.boxHeight-t;this._itemWindow=new vt(0,t,l.boxWidth,e),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this.addWindow(this._itemWindow),this._categoryWindow.setItemWindow(this._itemWindow)}user(){let t=self.$gameParty.movableMembers(),e=t[0],i=0;for(let s=0;s<t.length;s++)t[s].pha>i&&(i=t[s].pha,e=t[s]);return e}onCategoryOk(){this._itemWindow.activate(),this._itemWindow.selectLast()}onItemOk(){self.$gameParty.setLastItem(this.item()),this.determineItem()}onItemCancel(){this._itemWindow.deselect(),this._categoryWindow.activate()}playSeForItem(){S.playUseItem()}useItem(){super.useItem(),this._itemWindow.redrawCurrentItem()}};o(os,"Scene_Item");var hs=os;var ls=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(t,e),this._actor=null}windowWidth(){return 240}setActor(t){this._actor!==t&&(this._actor=t,this.refresh(),this.selectLast())}numVisibleRows(){return 4}makeCommandList(){if(this._actor){let t=this._actor.addedSkillTypes();t.sort((e,i)=>e-i),t.forEach(function(e){let i=self.$dataSystem.skillTypes[e];this.addCommand(i,"skill",!0,e)},this)}}update(){super.update(),this._skillWindow&&this._skillWindow.setStypeId(this.currentExt())}setSkillWindow(t){this._skillWindow=t}selectLast(){let t=this._actor.lastMenuSkill();t?this.selectExt(t.stypeId):this.select(0)}};o(ls,"Window_SkillType");var cs=ls;var ds=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}refresh(){if(this.contents.clear(),this._actor){let t=this.width-this.padding*2,e=this.height-this.padding*2,i=e/2-this.lineHeight()*1.5,s=t-162-this.textPadding();this.drawActorFace(this._actor,0,0,144,e),this.drawActorSimpleStatus(this._actor,162,i,s)}}};o(ds,"Window_SkillStatus");var ms=ds;var us=class extends _e{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createHelpWindow(),this.createSkillTypeWindow(),this.createStatusWindow(),this.createItemWindow(),this.createActorWindow()}start(){super.start(),this.refreshActor()}createSkillTypeWindow(){let t=this._helpWindow.height;this._skillTypeWindow=new cs(0,t),this._skillTypeWindow.setHelpWindow(this._helpWindow),this._skillTypeWindow.setHandler("skill",this.commandSkill.bind(this)),this._skillTypeWindow.setHandler("cancel",this.popScene.bind(this)),this._skillTypeWindow.setHandler("pagedown",this.nextActor.bind(this)),this._skillTypeWindow.setHandler("pageup",this.previousActor.bind(this)),this.addWindow(this._skillTypeWindow)}createStatusWindow(){let t=this._skillTypeWindow.width,e=this._helpWindow.height,i=l.boxWidth-t,s=this._skillTypeWindow.height;this._statusWindow=new ms(t,e,i,s),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)}createItemWindow(){let e=this._statusWindow.y+this._statusWindow.height,i=l.boxWidth,s=l.boxHeight-e;this._itemWindow=new pe(0,e,i,s),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this._skillTypeWindow.setSkillWindow(this._itemWindow),this.addWindow(this._itemWindow)}refreshActor(){let t=this.actor();this._skillTypeWindow.setActor(t),this._statusWindow.setActor(t),this._itemWindow.setActor(t)}user(){return this.actor()}commandSkill(){this._itemWindow.activate(),this._itemWindow.selectLast()}onItemOk(){this.actor().setLastMenuSkill(this.item()),this.determineItem()}onItemCancel(){this._itemWindow.deselect(),this._skillTypeWindow.activate()}playSeForItem(){S.playUseSkill()}useItem(){super.useItem(),this._statusWindow.refresh(),this._itemWindow.refresh()}onActorChange(){this.refreshActor(),this._skillTypeWindow.activate()}};o(us,"Scene_Skill");var ps=us;var fs=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){let i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this._actor=null,this._tempActor=null,this.refresh()}windowWidth(){return 312}windowHeight(){return this.fittingHeight(this.numVisibleRows())}numVisibleRows(){return 7}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}refresh(){if(this.contents.clear(),this._actor){this.drawActorName(this._actor,this.textPadding(),0);for(let t=0;t<6;t++)this.drawItem(0,this.lineHeight()*(1+t),2+t)}}setTempActor(t){this._tempActor!==t&&(this._tempActor=t,this.refresh())}drawItem(t,e,i){this.drawParamName(t+this.textPadding(),e,i),this._actor&&this.drawCurrentParam(t+140,e,i),this.drawRightArrow(t+188,e),this._tempActor&&this.drawNewParam(t+222,e,i)}drawParamName(t,e,i){this.changeTextColor(this.systemColor()),this.drawText(m.param(i),t,e,120)}drawCurrentParam(t,e,i){this.resetTextColor(),this.drawText(this._actor.param(i),t,e,48,"right")}drawRightArrow(t,e){this.changeTextColor(this.systemColor()),this.drawText("\u2192",t,e,32,"center")}drawNewParam(t,e,i){let s=this._tempActor.param(i),a=s-this._actor.param(i);this.changeTextColor(this.paramchangeTextColor(a)),this.drawText(s,t,e,48,"right")}};o(fs,"Window_EquipStatus");var _s=fs;var gs=class extends Zt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){this._windowWidth=i,super.initialize(t,e)}windowWidth(){return this._windowWidth}maxCols(){return 3}makeCommandList(){this.addCommand(m.equip2,"equip"),this.addCommand(m.optimize,"optimize"),this.addCommand(m.clear,"clear")}};o(gs,"Window_EquipCommand");var ws=gs;var ys=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null,this.refresh()}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}update(){super.update(),this._itemWindow&&this._itemWindow.setSlotId(this.index())}maxItems(){return this._actor?this._actor.equipSlots().length:0}item(){return this._actor?this._actor.equips()[this.index()]:null}drawItem(t){if(this._actor){let e=this.itemRectForText(t);this.changeTextColor(this.systemColor()),this.changePaintOpacity(this.isEnabled(t)),this.drawText(this.slotName(t),e.x,e.y,138,this.lineHeight()),this.drawItemName(this._actor.equips()[t],e.x+138,e.y),this.changePaintOpacity(!0)}}slotName(t){let e=this._actor.equipSlots();return this._actor?self.$dataSystem.equipTypes[e[t]]:""}isEnabled(t){return this._actor?this._actor.isEquipChangeOk(t):!1}isCurrentItemEnabled(){return this.isEnabled(this.index())}setStatusWindow(t){this._statusWindow=t,this.callUpdateHelp()}setItemWindow(t){this._itemWindow=t}updateHelp(){super.updateHelp(),this.setHelpWindowItem(this.item()),this._statusWindow&&this._statusWindow.setTempActor(null)}};o(ys,"Window_EquipSlot");var bs=ys;var Ss=class extends vt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._actor=null,this._slotId=0}setActor(t){this._actor!==t&&(this._actor=t,this.refresh(),this.resetScroll())}setSlotId(t){this._slotId!==t&&(this._slotId=t,this.refresh(),this.resetScroll())}includes(t){return t===null?!0:this._slotId<0||t.etypeId!==this._actor.equipSlots()[this._slotId]?!1:this._actor.canEquip(t)}isEnabled(t){return!0}selectLast(){}setStatusWindow(t){this._statusWindow=t,this.callUpdateHelp()}updateHelp(){if(super.updateHelp(),this._actor&&this._statusWindow){let t=Ft.makeDeepCopy(this._actor);t.forceChangeEquip(this._slotId,this.item()),this._statusWindow.setTempActor(t)}}playOkSound(){}};o(Ss,"Window_EquipItem");var xs=Ss;var Ts=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createHelpWindow(),this.createStatusWindow(),this.createCommandWindow(),this.createSlotWindow(),this.createItemWindow(),this.refreshActor()}createStatusWindow(){this._statusWindow=new _s(0,this._helpWindow.height),this.addWindow(this._statusWindow)}createCommandWindow(){let t=this._statusWindow.width,e=this._helpWindow.height,i=l.boxWidth-this._statusWindow.width;this._commandWindow=new ws(t,e,i),this._commandWindow.setHelpWindow(this._helpWindow),this._commandWindow.setHandler("equip",this.commandEquip.bind(this)),this._commandWindow.setHandler("optimize",this.commandOptimize.bind(this)),this._commandWindow.setHandler("clear",this.commandClear.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this._commandWindow.setHandler("pagedown",this.nextActor.bind(this)),this._commandWindow.setHandler("pageup",this.previousActor.bind(this)),this.addWindow(this._commandWindow)}createSlotWindow(){let t=this._statusWindow.width,e=this._commandWindow.y+this._commandWindow.height,i=l.boxWidth-this._statusWindow.width,s=this._statusWindow.height-this._commandWindow.height;this._slotWindow=new bs(t,e,i,s),this._slotWindow.setHelpWindow(this._helpWindow),this._slotWindow.setStatusWindow(this._statusWindow),this._slotWindow.setHandler("ok",this.onSlotOk.bind(this)),this._slotWindow.setHandler("cancel",this.onSlotCancel.bind(this)),this.addWindow(this._slotWindow)}createItemWindow(){let e=this._statusWindow.y+this._statusWindow.height,i=l.boxWidth,s=l.boxHeight-e;this._itemWindow=new xs(0,e,i,s),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setStatusWindow(this._statusWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this._slotWindow.setItemWindow(this._itemWindow),this.addWindow(this._itemWindow)}refreshActor(){let t=this.actor();this._statusWindow.setActor(t),this._slotWindow.setActor(t),this._itemWindow.setActor(t)}commandEquip(){this._slotWindow.activate(),this._slotWindow.select(0)}commandOptimize(){S.playEquip(),this.actor().optimizeEquipments(),this._statusWindow.refresh(),this._slotWindow.refresh(),this._commandWindow.activate()}commandClear(){S.playEquip(),this.actor().clearEquipments(),this._statusWindow.refresh(),this._slotWindow.refresh(),this._commandWindow.activate()}onSlotOk(){this._itemWindow.activate(),this._itemWindow.select(0)}onSlotCancel(){this._slotWindow.deselect(),this._commandWindow.activate()}onItemOk(){S.playEquip(),this.actor().changeEquip(this._slotWindow.index(),this._itemWindow.item()),this._slotWindow.activate(),this._slotWindow.refresh(),this._itemWindow.deselect(),this._itemWindow.refresh(),this._statusWindow.refresh()}onItemCancel(){this._slotWindow.activate(),this._itemWindow.deselect()}onActorChange(){this.refreshActor(),this._commandWindow.activate()}};o(Ts,"Scene_Equip");var vs=Ts;var Cs=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=l.boxWidth,e=l.boxHeight;super.initialize(0,0,t,e),this._actor=null,this.refresh(),this.activate()}setActor(t){this._actor!==t&&(this._actor=t,this.refresh())}refresh(){if(this.contents.clear(),this._actor){let t=this.lineHeight();this.drawBlock1(t*0),this.drawHorzLine(t*1),this.drawBlock2(t*2),this.drawHorzLine(t*6),this.drawBlock3(t*7),this.drawHorzLine(t*13),this.drawBlock4(t*14)}}drawBlock1(t){this.drawActorName(this._actor,6,t),this.drawActorClass(this._actor,192,t),this.drawActorNickname(this._actor,432,t)}drawBlock2(t){this.drawActorFace(this._actor,12,t),this.drawBasicInfo(204,t),this.drawExpInfo(456,t)}drawBlock3(t){this.drawParameters(48,t),this.drawEquipments(432,t)}drawBlock4(t){this.drawProfile(6,t)}drawHorzLine(t){let e=t+this.lineHeight()/2-1;this.contents.paintOpacity=48,this.contents.fillRect(0,e,this.contentsWidth(),2,this.lineColor()),this.contents.paintOpacity=255}lineColor(){return this.normalColor()}drawBasicInfo(t,e){let i=this.lineHeight();this.drawActorLevel(this._actor,t,e+i*0),this.drawActorIcons(this._actor,t,e+i*1),this.drawActorHp(this._actor,t,e+i*2),this.drawActorMp(this._actor,t,e+i*3)}drawParameters(t,e){let i=this.lineHeight();for(let s=0;s<6;s++){let a=s+2,r=e+i*s;this.changeTextColor(this.systemColor()),this.drawText(m.param(a),t,r,160),this.resetTextColor(),this.drawText(this._actor.param(a),t+160,r,60,"right")}}drawExpInfo(t,e){let i=this.lineHeight(),s=m.expTotal.format(m.exp),a=m.expNext.format(m.level),r=this._actor.currentExp(),h=this._actor.nextRequiredExp();this._actor.isMaxLevel()&&(r="-------",h="-------"),this.changeTextColor(this.systemColor()),this.drawText(s,t,e+i*0,270),this.drawText(a,t,e+i*2,270),this.resetTextColor(),this.drawText(r,t,e+i*1,270,"right"),this.drawText(h,t,e+i*3,270,"right")}drawEquipments(t,e){let i=this._actor.equips(),s=Math.min(i.length,this.maxEquipmentLines());for(let a=0;a<s;a++)this.drawItemName(i[a],t,e+this.lineHeight()*a)}drawProfile(t,e){this.drawTextEx(this._actor.profile(),t,e)}maxEquipmentLines(){return 6}};o(Cs,"Window_Status");var Is=Cs;var Ms=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this._statusWindow=new Is,this._statusWindow.setHandler("cancel",this.popScene.bind(this)),this._statusWindow.setHandler("pagedown",this.nextActor.bind(this)),this._statusWindow.setHandler("pageup",this.previousActor.bind(this)),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)}start(){super.start(),this.refreshActor()}refreshActor(){let t=this.actor();this._statusWindow.setActor(t)}onActorChange(){this.refreshActor(),this._statusWindow.activate()}};o(Ms,"Scene_Status");var Es=Ms;var ks=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.updatePlacement()}windowWidth(){return 400}windowHeight(){return this.fittingHeight(Math.min(this.numVisibleRows(),12))}updatePlacement(){this.x=(l.boxWidth-this.width)/2,this.y=(l.boxHeight-this.height)/2}makeCommandList(){this.addGeneralOptions(),this.addVolumeOptions()}addGeneralOptions(){this.addCommand(m.alwaysDash,"alwaysDash"),this.addCommand(m.commandRemember,"commandRemember")}addVolumeOptions(){this.addCommand(m.bgmVolume,"bgmVolume"),this.addCommand(m.bgsVolume,"bgsVolume"),this.addCommand(m.meVolume,"meVolume"),this.addCommand(m.seVolume,"seVolume")}drawItem(t){let e=this.itemRectForText(t),i=this.statusWidth(),s=e.width-i;this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(t)),this.drawText(this.commandName(t),e.x,e.y,s,"left"),this.drawText(this.statusText(t),e.x+s,e.y,i,"right")}statusWidth(){return 120}statusText(t){let e=this.commandSymbol(t),i=this.getConfigValue(e);return this.isVolumeSymbol(e)?this.volumeStatusText(i):this.booleanStatusText(i)}isVolumeSymbol(t){return t.contains("Volume")}booleanStatusText(t){return t?"ON":"OFF"}volumeStatusText(t){return`${t}%`}processOk(){let t=this.index(),e=this.commandSymbol(t),i=this.getConfigValue(e);this.isVolumeSymbol(e)?(i+=this.volumeOffset(),i>100&&(i=0),i=i.clamp(0,100),this.changeValue(e,i)):this.changeValue(e,!i)}cursorRight(t){let e=this.index(),i=this.commandSymbol(e),s=this.getConfigValue(i);this.isVolumeSymbol(i)?(s+=this.volumeOffset(),s=s.clamp(0,100),this.changeValue(i,s)):this.changeValue(i,!0)}cursorLeft(t){let e=this.index(),i=this.commandSymbol(e),s=this.getConfigValue(i);this.isVolumeSymbol(i)?(s-=this.volumeOffset(),s=s.clamp(0,100),this.changeValue(i,s)):this.changeValue(i,!1)}volumeOffset(){return 20}changeValue(t,e){this.getConfigValue(t)!==e&&(this.setConfigValue(t,e),this.redrawItem(this.findSymbol(t)),S.playCursor())}getConfigValue(t){return ut[t]}setConfigValue(t,e){ut[t]=e}};o(ks,"Window_Options");var As=ks;var Ws=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createOptionsWindow()}terminate(){super.terminate(),ut.save()}createOptionsWindow(){this._optionsWindow=new As,this._optionsWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._optionsWindow)}};o(Ws,"Scene_Options");var we=Ws;var Ps=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._validItems=[];for(let a=0;a<this.maxItems()+1;a++)w.isThisGameFile(a).then(r=>{this._validItems[a]=r});this.activate(),this._mode=null}setMode(t){this._mode=t}isReady(){return this._validItems.length>=this.maxItems()}maxItems(){return w.maxSavefiles()}maxVisibleItems(){return 5}itemHeight(){let t=this.height-this.padding*2;return Math.floor(t/this.maxVisibleItems())}drawItem(t){let e=t+1,i=this._validItems[e];w.loadSavefileInfo(e).then(s=>{let a=this.itemRectForText(t);this.resetTextColor(),this._mode==="load"&&this.changePaintOpacity(i),this.drawFileId(e,a.x,a.y),s&&(this.changePaintOpacity(i),this.drawContents(s,a,i),this.changePaintOpacity(!0))})}drawFileId(t,e,i){w.isAutoSaveFileId(t)?(this._mode==="save"&&this.changePaintOpacity(!1),this.drawText(`${m.file} ${t}(Auto)`,e,i,180)):this.drawText(`${m.file} ${t}`,e,i,180)}drawContents(t,{y:e,height:i,width:s,x:a},r){let h=e+i;s>=420&&(this.drawGameTitle(t,a+192,e,s-192),r&&this.drawPartyCharacters(t,a+220,h-4));let c=this.lineHeight(),d=h-c;d>=c&&this.drawPlaytime(t,a,d,s)}drawGameTitle({title:t},e,i,s){t&&this.drawText(t,e,i,s)}drawPartyCharacters({characters:t},e,i){t&&t.forEach((s,a)=>{this.drawCharacter(s[0],s[1],e+a*48,i)})}drawPlaytime({playtime:t},e,i,s){t&&this.drawText(t,e,i,s,"right")}playOkSound(){}};o(Ps,"Window_SavefileList");var Bs=Ps;var Rs=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._hasfirstSavefileIndex=!1}create(){super.create(),w.loadAllSavefileImages().then(()=>{this.createHelpWindow(),this.createListWindow()})}start(){super.start(),this._listWindow.refresh()}savefileId(){return this._listWindow.index()+1}createHelpWindow(){this._helpWindow=new Gt(1),this._helpWindow.setText(this.helpWindowText()),this.addWindow(this._helpWindow)}createListWindow(){let e=this._helpWindow.height,i=l.boxWidth,s=l.boxHeight-e;this._listWindow=new Bs(0,e,i,s),this._listWindow.setHandler("ok",this.onSavefileOk.bind(this)),this._listWindow.setHandler("cancel",this.popScene.bind(this)),this._listWindow.setMode(this.mode()),this._listWindow.refresh(),this.addWindow(this._listWindow),this.firstSavefileIndex().then(a=>{this._listWindow.select(a),this._listWindow.setTopRow(a-2),this._hasfirstSavefileIndex=!0})}mode(){return null}activateListWindow(){this._listWindow.activate()}helpWindowText(){return""}async firstSavefileIndex(){return 0}isReady(){return super.isReady()&&this._hasfirstSavefileIndex&&this._listWindow&&this._listWindow.isReady()}onSavefileOk(){}};o(Rs,"Scene_File");var ye=Rs;var $s=class extends ye{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}mode(){return"save"}helpWindowText(){return m.saveMessage}async firstSavefileIndex(){return await w.lastAccessedSavefileId()-1}onSavefileOk(){if(w.isAutoSaveFileId(this.savefileId())){this.onSaveFailure();return}super.onSavefileOk(),self.$gameSystem.onBeforeSave(),w.saveGame(this.savefileId()).then(t=>{t?this.onSaveSuccess():this.onSaveFailure()})}onSaveSuccess(){S.playSave(),et.cleanBackup(this.savefileId()),this.popScene()}onSaveFailure(){S.playBuzzer(),this.activateListWindow()}};o($s,"Scene_Save");var be=$s;var Fs=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.updatePlacement(),this.openness=0,this.open()}windowWidth(){return 240}updatePlacement(){this.x=(l.boxWidth-this.width)/2,this.y=(l.boxHeight-this.height)/2}makeCommandList(){this.addCommand(m.toTitle,"toTitle"),this.addCommand(m.cancel,"cancel")}};o(Fs,"Window_GameEnd");var Ds=Fs;var Ls=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createCommandWindow()}stop(){super.stop(),this._commandWindow.close()}createBackground(){super.createBackground(),this.setBackgroundOpacity(128)}createCommandWindow(){this._commandWindow=new Ds,this._commandWindow.setHandler("toTitle",this.commandToTitle.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)}commandToTitle(){this.fadeOutAll(),g.goto(ft)}};o(Ls,"Scene_GameEnd");var Os=Ls;var Ns=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createCommandWindow(),this.createGoldWindow(),this.createStatusWindow()}start(){super.start(),this._statusWindow.refresh()}createCommandWindow(){this._commandWindow=new Kt(0,0),this._commandWindow.setHandler("item",this.commandItem.bind(this)),this._commandWindow.setHandler("skill",this.commandPersonal.bind(this)),this._commandWindow.setHandler("equip",this.commandPersonal.bind(this)),this._commandWindow.setHandler("status",this.commandPersonal.bind(this)),this._commandWindow.setHandler("formation",this.commandFormation.bind(this)),this._commandWindow.setHandler("options",this.commandOptions.bind(this)),this._commandWindow.setHandler("save",this.commandSave.bind(this)),this._commandWindow.setHandler("gameEnd",this.commandGameEnd.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)}createGoldWindow(){this._goldWindow=new Yt(0,0),this._goldWindow.y=l.boxHeight-this._goldWindow.height,this.addWindow(this._goldWindow)}createStatusWindow(){this._statusWindow=new fe(this._commandWindow.width,0),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)}commandItem(){g.push(hs)}commandPersonal(){this._statusWindow.setFormationMode(!1),this._statusWindow.selectLast(),this._statusWindow.activate(),this._statusWindow.setHandler("ok",this.onPersonalOk.bind(this)),this._statusWindow.setHandler("cancel",this.onPersonalCancel.bind(this))}commandFormation(){this._statusWindow.setFormationMode(!0),this._statusWindow.selectLast(),this._statusWindow.activate(),this._statusWindow.setHandler("ok",this.onFormationOk.bind(this)),this._statusWindow.setHandler("cancel",this.onFormationCancel.bind(this))}commandOptions(){g.push(we)}commandSave(){g.push(be)}commandGameEnd(){g.push(Os)}onPersonalOk(){switch(this._commandWindow.currentSymbol()){case"skill":g.push(ps);break;case"equip":g.push(vs);break;case"status":g.push(Es);break}}onPersonalCancel(){this._statusWindow.deselect(),this._commandWindow.activate()}onFormationOk(){let t=this._statusWindow.index(),e=this._statusWindow.pendingIndex();e>=0?(self.$gameParty.swapOrder(t,e),this._statusWindow.setPendingIndex(-1),this._statusWindow.redrawItem(t)):this._statusWindow.setPendingIndex(t),this._statusWindow.activate()}onFormationCancel(){this._statusWindow.pendingIndex()>=0?(this._statusWindow.setPendingIndex(-1),this._statusWindow.activate()):(this._statusWindow.deselect(),this._commandWindow.activate())}};o(Ns,"Scene_Menu");var Se=Ns;var Hs=class extends ye{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._loadSuccess=!1}terminate(){super.terminate(),this._loadSuccess&&self.$gameSystem.onAfterLoad()}mode(){return"load"}helpWindowText(){return m.loadMessage}async firstSavefileIndex(){return await w.latestSavefileId()-1}onSavefileOk(){super.onSavefileOk(),w.loadGame(this.savefileId()).then(t=>{t?this.onLoadSuccess():this.onLoadFailure()})}onLoadSuccess(){S.playLoad(),this.fadeOutAll(),this.reloadMapIfUpdated(),g.goto(Rt),this._loadSuccess=!0}onLoadFailure(){S.playBuzzer(),this.activateListWindow()}reloadMapIfUpdated(){self.$gameSystem.versionId()!==self.$dataSystem.versionId&&(self.$gamePlayer.reserveTransfer(self.$gameMap.mapId(),self.$gamePlayer.x,self.$gamePlayer.y),self.$gamePlayer.requestMapReload())}};o(Hs,"Scene_Load");var xe=Hs;var Et=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this._maxSwitches=Math.ceil((self.$dataSystem.switches.length-1)/10),this._maxVariables=Math.ceil((self.$dataSystem.variables.length-1)/10);let i=this.windowWidth(),s=this.windowHeight();super.initialize(t,e,i,s),this.refresh(),this.setTopRow(Et.lastTopRow),this.select(Et.lastIndex),this.activate()}windowWidth(){return 246}windowHeight(){return l.boxHeight}maxItems(){return this._maxSwitches+this._maxVariables}update(){super.update(),this._editWindow&&(this._editWindow.setMode(this.mode()),this._editWindow.setTopId(this.topId()))}mode(){return this.index()<this._maxSwitches?"switch":"variable"}topId(){let t=this.index();return t<this._maxSwitches?t*10+1:(t-this._maxSwitches)*10+1}refresh(){this.createContents(),this.drawAllItems()}drawItem(t){let e=this.itemRectForText(t),i,s;t<this._maxSwitches?(i=t*10+1,s="S"):(i=(t-this._maxSwitches)*10+1,s="V");let a=i+9;s+=` [${i.padZero(4)}-${a.padZero(4)}]`,this.drawText(s,e.x,e.y,e.width)}isCancelTriggered(){return D.prototype.isCancelTriggered()||x.isTriggered("debug")}processCancel(){super.processCancel(),Et.lastTopRow=this.topRow(),Et.lastIndex=this.index()}setEditWindow(t){this._editWindow=t}};o(Et,"Window_DebugRange");Et.lastTopRow=0;Et.lastIndex=0;var zs=Et;var Vs=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){let s=this.fittingHeight(10);super.initialize(t,e,i,s),this._mode="switch",this._topId=1,this.refresh()}maxItems(){return 10}refresh(){this.contents.clear(),this.drawAllItems()}drawItem(t){let e=this._topId+t,i=`${e.padZero(4)}:`,s=this.textWidth(i),a=this.textWidth("-00000000"),r=this.itemName(e),h=this.itemStatus(e),c=this.itemRectForText(t);this.resetTextColor(),this.drawText(i,c.x,c.y,c.width),c.x+=s,c.width-=s+a,this.drawText(r,c.x,c.y,c.width),this.drawText(h,c.x+c.width,c.y,a,"right")}itemName(t){return this._mode==="switch"?self.$dataSystem.switches[t]:self.$dataSystem.variables[t]}itemStatus(t){return this._mode==="switch"?self.$gameSwitches.value(t)?"[ON]":"[OFF]":String(self.$gameVariables.value(t))}setMode(t){this._mode!==t&&(this._mode=t,this.refresh())}setTopId(t){this._topId!==t&&(this._topId=t,this.refresh())}currentId(){return this._topId+this.index()}update(){super.update(),this.active&&(this._mode==="switch"?this.updateSwitch():this.updateVariable())}updateSwitch(){if(x.isRepeated("ok")){let t=this.currentId();S.playCursor(),self.$gameSwitches.setValue(t,!self.$gameSwitches.value(t)),this.redrawCurrentItem()}}updateVariable(){let t=this.currentId(),e=self.$gameVariables.value(t);typeof e=="number"&&(x.isRepeated("right")&&e++,x.isRepeated("left")&&e--,x.isRepeated("pagedown")&&(e+=10),x.isRepeated("pageup")&&(e-=10),self.$gameVariables.value(t)!==e&&(self.$gameVariables.setValue(t,e),S.playCursor(),this.redrawCurrentItem()))}};o(Vs,"Window_DebugEdit");var qs=Vs;var Us=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createRangeWindow(),this.createEditWindow(),this.createDebugHelpWindow()}createRangeWindow(){this._rangeWindow=new zs(0,0),this._rangeWindow.setHandler("ok",this.onRangeOk.bind(this)),this._rangeWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._rangeWindow)}createEditWindow(){let t=this._rangeWindow.width,e=l.boxWidth-t;this._editWindow=new qs(t,0,e),this._editWindow.setHandler("cancel",this.onEditCancel.bind(this)),this._rangeWindow.setEditWindow(this._editWindow),this.addWindow(this._editWindow)}createDebugHelpWindow(){let t=this._editWindow.x,e=this._editWindow.height,i=this._editWindow.width,s=l.boxHeight-e;this._debugHelpWindow=new H(t,e,i,s),this.addWindow(this._debugHelpWindow)}onRangeOk(){this._editWindow.activate(),this._editWindow.select(0),this.refreshHelpWindow()}onEditCancel(){this._rangeWindow.activate(),this._editWindow.deselect(),this.refreshHelpWindow()}refreshHelpWindow(){this._debugHelpWindow.contents.clear(),this._editWindow.active&&this._debugHelpWindow.drawTextEx(this.helpText(),4,0)}helpText(){return this._rangeWindow.mode()==="switch"?"Enter : ON / OFF":`Left     :  -1
Right    :  +1
Pageup   : -10
Pagedown : +10`}};o(Us,"Scene_Debug");var Xs=Us;var Gs=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(){let t=this.windowWidth(),e=this.windowHeight();super.initialize(0,0,t,e),this.opacity=0,this.contentsOpacity=0,this._showCount=0,this.refresh()}windowWidth(){return 360}windowHeight(){return this.fittingHeight(1)}update(){super.update(),this._showCount>0&&self.$gameMap.isNameDisplayEnabled()?(this.updateFadeIn(),this._showCount--):this.updateFadeOut()}updateFadeIn(){this.contentsOpacity+=16}updateFadeOut(){this.contentsOpacity-=16}open(){this.refresh(),this._showCount=150}close(){this._showCount=0}refresh(){if(this.contents.clear(),self.$gameMap.displayName()){let t=this.contentsWidth();this.drawBackground(0,0,t,this.lineHeight()),this.drawText(self.$gameMap.displayName(),0,0,t,"center")}}drawBackground(t,e,i,s){let a=this.dimColor1(),r=this.dimColor2();this.contents.gradientFillRect(t,e,i/2,s,r,a),this.contents.gradientFillRect(t+i/2,e,i/2,s,a,r)}};o(Gs,"Window_MapName");var Ys=Gs;var js=class extends pt{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.initMembers(),this.loadBitmap()}initMembers(){this._balloonId=0,this._duration=0,this.anchor.x=.5,this.anchor.y=1,this.z=7}loadBitmap(){this.bitmap=p.loadSystem("Balloon"),this.setFrame(0,0,0,0)}setup(t){this._balloonId=t,this._duration=8*this.speed()+this.waitTime()}update(){super.update(),this._duration>0&&(this._duration--,this._duration>0&&this.updateFrame())}updateFrame(){let i=this.frameIndex()*48,s=(this._balloonId-1)*48;this.setFrame(i,s,48,48)}speed(){return 8}waitTime(){return 12}frameIndex(){let t=(this._duration-this.waitTime())/this.speed();return 7-Math.max(Math.floor(t),0)}isPlaying(){return this._duration>0}};o(js,"Sprite_Balloon");var Ks=js;var Zs=class extends pt{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this.initMembers(),this.setCharacter(t)}initMembers(){this.anchor.x=.5,this.anchor.y=1,this._character=null,this._balloonDuration=0,this._tilesetId=0,this._upperBody=null,this._lowerBody=null}setCharacter(t){this._character=t}update(){super.update(),this.updateBitmap(),this.updateFrame(),this.updatePosition(),this.updateAnimation(),this.updateBalloon(),this.updateOther()}updateVisibility(){super.updateVisibility(),this._character.isTransparent()&&(this.visible=!1)}isTile(){return this._character.tileId>0}tilesetBitmap(t){let e=self.$gameMap.tileset(),i=5+Math.floor(t/256);return p.loadTileset(e.tilesetNames[i])}updateBitmap(){this.isImageChanged()&&(this._tilesetId=self.$gameMap.tilesetId(),this._tileId=this._character.tileId(),this._characterName=this._character.characterName(),this._characterIndex=this._character.characterIndex(),this._tileId>0?this.setTileBitmap():this.setCharacterBitmap())}isImageChanged(){return this._tilesetId!==self.$gameMap.tilesetId()||this._tileId!==this._character.tileId()||this._characterName!==this._character.characterName()||this._characterIndex!==this._character.characterIndex()}setTileBitmap(){this.bitmap=this.tilesetBitmap(this._tileId)}setCharacterBitmap(){this.bitmap=p.loadCharacter(this._characterName),this._isBigCharacter=p.isBigCharacter(this._characterName)}updateFrame(){this._tileId>0?this.updateTileFrame():this.updateCharacterFrame()}updateTileFrame(){let t=this.patternWidth(),e=this.patternHeight(),i=(Math.floor(this._tileId/128)%2*8+this._tileId%8)*t,s=Math.floor(this._tileId%256/8)%16*e;this.setFrame(i,s,t,e)}updateCharacterFrame(){let t=this.patternWidth(),e=this.patternHeight(),i=(this.characterBlockX()+this.characterPatternX())*t,s=(this.characterBlockY()+this.characterPatternY())*e;if(this.updateHalfBodySprites(),this._bushDepth>0){let a=this._bushDepth;this._upperBody.setFrame(i,s,t,e-a),this._lowerBody.setFrame(i,s+e-a,t,a),this.setFrame(i,s,0,e)}else this.setFrame(i,s,t,e)}characterBlockX(){return this._isBigCharacter?0:this._character.characterIndex()%4*3}characterBlockY(){if(this._isBigCharacter)return 0;{let t=this._character.characterIndex();return Math.floor(t/4)*4}}characterPatternX(){return this._character.pattern()}characterPatternY(){return(this._character.direction()-2)/2}patternWidth(){return this._tileId>0?self.$gameMap.tileWidth():this._isBigCharacter?this.bitmap.width/3:this.bitmap.width/12}patternHeight(){return this._tileId>0?self.$gameMap.tileHeight():this._isBigCharacter?this.bitmap.height/4:this.bitmap.height/8}updateHalfBodySprites(){this._bushDepth>0?(this.createHalfBodySprites(),this._upperBody.bitmap=this.bitmap,this._upperBody.visible=!0,this._upperBody.y=-this._bushDepth,this._lowerBody.bitmap=this.bitmap,this._lowerBody.visible=!0,this._upperBody.setBlendColor(this.getBlendColor()),this._lowerBody.setBlendColor(this.getBlendColor()),this._upperBody.setColorTone(this.getColorTone()),this._lowerBody.setColorTone(this.getColorTone())):this._upperBody&&(this._upperBody.visible=!1,this._lowerBody.visible=!1)}createHalfBodySprites(){this._upperBody||(this._upperBody=new C,this._upperBody.anchor.x=.5,this._upperBody.anchor.y=1,this.addChild(this._upperBody)),this._lowerBody||(this._lowerBody=new C,this._lowerBody.anchor.x=.5,this._lowerBody.anchor.y=1,this._lowerBody.opacity=128,this.addChild(this._lowerBody))}updatePosition(){this.x=this._character.screenX(),this.y=this._character.screenY(),this.z=this._character.screenZ()}updateAnimation(){this.setupAnimation(),this.isAnimationPlaying()||this._character.endAnimation(),this.isBalloonPlaying()||this._character.endBalloon()}updateOther(){this.opacity=this._character.opacity(),this.blendMode=this._character.blendMode(),this._bushDepth=this._character.bushDepth()}setupAnimation(){if(this._character.animationId()>0){let t=self.$dataAnimations[this._character.animationId()];this.startAnimation(t,!1,0),this._character.startAnimation()}}setupBalloon(){this._character.balloonId()>0&&(this.startBalloon(),this._character.startBalloon())}startBalloon(){this._balloonSprite||(this._balloonSprite=new Ks),this._balloonSprite.setup(this._character.balloonId()),this.parent.addChild(this._balloonSprite)}updateBalloon(){this.setupBalloon(),this._balloonSprite&&(this._balloonSprite.x=this.x,this._balloonSprite.y=this.y-this.height,this._balloonSprite.isPlaying()||this.endBalloon())}endBalloon(){this._balloonSprite&&(this.parent.removeChild(this._balloonSprite),this._balloonSprite=null)}isBalloonPlaying(){return!!this._balloonSprite}};o(Zs,"Sprite_Character");var se=Zs;var Js=class extends C{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.createBitmap(),this._frameCount=0}update(){super.update(),self.$gameTemp.isDestinationValid()?(this.updatePosition(),this.updateAnimation(),this.visible=!0):(this._frameCount=0,this.visible=!1)}createBitmap(){let t=self.$gameMap.tileWidth(),e=self.$gameMap.tileHeight();this.bitmap=new V(t,e),this.bitmap.fillAll("white"),this.anchor.x=.5,this.anchor.y=.5,this.blendMode=l.BLEND_ADD}updatePosition(){let t=self.$gameMap.tileWidth(),e=self.$gameMap.tileHeight(),i=self.$gameTemp.destinationX(),s=self.$gameTemp.destinationY();this.x=(self.$gameMap.adjustX(i)+.5)*t,this.y=(self.$gameMap.adjustY(s)+.5)*e}updateAnimation(){this._frameCount++,this._frameCount%=20,this.opacity=(20-this._frameCount)*6,this.scale.x=1+this._frameCount/20,this.scale.y=this.scale.x}};o(Js,"Sprite_Destination");var Qs=Js;var ta=class extends he{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}createLowerLayer(){super.createLowerLayer(),this.createParallax(),this.createTilemap(),this.createCharacters(),this.createShadow(),this.createDestination(),this.createWeather()}update(){super.update(),this.updateTileset(),this.updateParallax(),this.updateTilemap(),this.updateShadow(),this.updateWeather()}hideCharacters(){for(let t of this._characterSprites)t.isTile()||t.hide()}createParallax(){this._parallax=new Ut,this._parallax.move(0,0,l.width,l.height),this._baseSprite.addChild(this._parallax)}createTilemap(){l.isWebGL()?this._tilemap=new ze:this._tilemap=new U,this._tilemap.tileWidth=self.$gameMap.tileWidth(),this._tilemap.tileHeight=self.$gameMap.tileHeight(),this._tilemap.setData(self.$gameMap.width(),self.$gameMap.height(),self.$gameMap.data()),this._tilemap.horizontalWrap=self.$gameMap.isLoopHorizontal(),this._tilemap.verticalWrap=self.$gameMap.isLoopVertical(),this.loadTileset(),this._baseSprite.addChild(this._tilemap)}loadTileset(){if(this._tileset=self.$gameMap.tileset(),this._tileset){let t=this._tileset.tilesetNames;for(let i=0;i<t.length;i++)this._tilemap.bitmaps[i]=p.loadTileset(t[i]);let e=self.$gameMap.tilesetFlags();this._tilemap.refreshTileset(),this._tilemap.flags.equals(e)||this._tilemap.refresh(),this._tilemap.flags=e}}createCharacters(){this._characterSprites=[],self.$gameMap.events().forEach(function(t){this._characterSprites.push(new se(t))},this),self.$gameMap.vehicles().forEach(function(t){this._characterSprites.push(new se(t))},this),self.$gamePlayer.followers().reverseEach(function(t){this._characterSprites.push(new se(t))},this),this._characterSprites.push(new se(self.$gamePlayer));for(let t=0;t<this._characterSprites.length;t++)this._tilemap.addChild(this._characterSprites[t])}createShadow(){this._shadowSprite=new C,this._shadowSprite.bitmap=p.loadSystem("Shadow1"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=1,this._shadowSprite.z=6,this._tilemap.addChild(this._shadowSprite)}createDestination(){this._destinationSprite=new Qs,this._destinationSprite.z=9,this._tilemap.addChild(this._destinationSprite)}createWeather(){this._weather=new Ge,this.addChild(this._weather)}updateTileset(){this._tileset!==self.$gameMap.tileset()&&this.loadTileset()}_canvasReAddParallax(){let t=this._baseSprite.children.indexOf(this._parallax);this._baseSprite.removeChild(this._parallax),this._parallax=new Ut,this._parallax.move(0,0,l.width,l.height),this._parallax.bitmap=p.loadParallax(this._parallaxName),this._baseSprite.addChildAt(this._parallax,t)}updateParallax(){this._parallaxName!==self.$gameMap.parallaxName()&&(this._parallaxName=self.$gameMap.parallaxName(),this._parallax.bitmap&&l.isWebGL()!=!0?this._canvasReAddParallax():this._parallax.bitmap=p.loadParallax(this._parallaxName)),this._parallax.bitmap&&(this._parallax.origin.x=self.$gameMap.parallaxOx(),this._parallax.origin.y=self.$gameMap.parallaxOy())}updateTilemap(){this._tilemap.origin.x=self.$gameMap.displayX()*self.$gameMap.tileWidth(),this._tilemap.origin.y=self.$gameMap.displayY()*self.$gameMap.tileHeight(),this._tilemap.bitmaps&&!this.isTilesetReady&&this._tilemap.bitmaps.every(t=>t.isRequestReady())&&(this._tilemap.refresh(),this._tilemap.refreshTileset(),this.isTilesetReady=!0)}updateShadow(){let t=self.$gameMap.airship();this._shadowSprite.x=t.shadowX(),this._shadowSprite.y=t.shadowY(),this._shadowSprite.opacity=t.shadowOpacity()}updateWeather(){this._weather.type=self.$gameScreen.weatherType(),this._weather.power=self.$gameScreen.weatherPower(),this._weather.origin.x=self.$gameMap.displayX()*self.$gameMap.tileWidth(),this._weather.origin.y=self.$gameMap.displayY()*self.$gameMap.tileHeight()}};o(ta,"Spriteset_Map");var ea=ta;var Jt=class extends it{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._waitCount=0,this._encounterEffectDuration=0,this._mapLoaded=!1,this._touchCount=0}create(){super.create(),this._transfer=self.$gamePlayer.isTransferring();let t=this._transfer?self.$gamePlayer.newMapId():self.$gameMap.mapId();w.loadMapData(t)}isReady(){return!this._mapLoaded&&w.isMapLoaded()&&(this.onMapLoaded(),this._mapLoaded=!0),this._mapLoaded&&it.prototype.isReady.call(this)}onMapLoaded(){this._transfer&&self.$gamePlayer.performTransfer(),this.createDisplayObjects()}start(){super.start(),g.clearStack(),this._transfer?(this.fadeInForTransfer(),this._mapNameWindow.open(),self.$gameMap.autoplay()):this.needsFadeIn()&&this.startFadeIn(this.fadeSpeed(),!1),this.menuCalling=!1}update(){this.updateDestination(),this.updateMainMultiply(),this.isSceneChangeOk()?this.updateScene():g.isNextScene(Ct)&&this.updateEncounterEffect(),this.updateWaitCount(),super.update()}updateMainMultiply(){this.updateMain(),this.isFastForward()&&(this.isMapTouchOk()||this.updateDestination(),this.updateMain())}updateMain(){let t=this.isActive();self.$gameMap.update(t),self.$gamePlayer.update(t),self.$gameTimer.update(t),self.$gameScreen.update()}isFastForward(){return self.$gameMap.isEventRunning()&&!g.isSceneChanging()&&(x.isLongPressed("ok")||k.isLongPressed())}stop(){super.stop(),self.$gamePlayer.straighten(),this._mapNameWindow.close(),this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):g.isNextScene(Jt)?this.fadeOutForTransfer():g.isNextScene(Ct)&&this.launchBattle()}isBusy(){return this._messageWindow&&this._messageWindow.isClosing()||this._waitCount>0||this._encounterEffectDuration>0||it.prototype.isBusy.call(this)}terminate(){super.terminate(),g.isNextScene(Ct)?p.clearRequest():(this._spriteset.update(),this._mapNameWindow.hide(),g.snapForBackground()),g.isNextScene(Jt)&&p.clearRequest(),self.$gameScreen.clearZoom(),this.removeChild(this._fadeSprite),this.removeChild(this._mapNameWindow),this.removeChild(this._windowLayer),this.removeChild(this._spriteset)}needsFadeIn(){return g.isPreviousScene(Ct)||g.isPreviousScene(xe)}needsSlowFadeOut(){return g.isNextScene(ft)||g.isNextScene(Tt)}updateWaitCount(){return this._waitCount>0?(this._waitCount--,!0):!1}updateDestination(){this.isMapTouchOk()?this.processMapTouch():(self.$gameTemp.clearDestination(),this._touchCount=0)}isMapTouchOk(){return this.isActive()&&self.$gamePlayer.canMove()}processMapTouch(){if(k.isTriggered()||this._touchCount>0)if(k.isPressed()){if(this._touchCount===0||this._touchCount>=15){let t=self.$gameMap.canvasToMapX(k.x),e=self.$gameMap.canvasToMapY(k.y);self.$gameTemp.setDestination(t,e)}this._touchCount++}else this._touchCount=0}isSceneChangeOk(){return this.isActive()&&!self.$gameMessage.isBusy()}updateScene(){this.checkGameover(),g.isSceneChanging()||this.updateTransferPlayer(),g.isSceneChanging()||this.updateEncounter(),g.isSceneChanging()||this.updateCallMenu(),g.isSceneChanging()||this.updateCallDebug()}createDisplayObjects(){this.createSpriteset(),this.createMapNameWindow(),this.createWindowLayer(),this.createAllWindows()}createSpriteset(){this._spriteset=new ea,this.addChild(this._spriteset)}createAllWindows(){this.createMessageWindow(),this.createScrollTextWindow()}createMapNameWindow(){this._mapNameWindow=new Ys,this.addChild(this._mapNameWindow)}createMessageWindow(){this._messageWindow=new de,this.addWindow(this._messageWindow),this._messageWindow.subWindows().forEach(function(t){this.addWindow(t)},this)}createScrollTextWindow(){this._scrollTextWindow=new me,this.addWindow(this._scrollTextWindow)}updateTransferPlayer(){self.$gamePlayer.isTransferring()&&g.goto(Jt)}updateEncounter(){self.$gamePlayer.executeEncounter()&&g.push(Ct)}updateCallMenu(){this.isMenuEnabled()?(this.isMenuCalled()&&(this.menuCalling=!0),this.menuCalling&&!self.$gamePlayer.isMoving()&&this.callMenu()):this.menuCalling=!1}isMenuEnabled(){return self.$gameSystem.isMenuEnabled()&&!self.$gameMap.isEventRunning()}isMenuCalled(){return x.isTriggered("menu")||k.isCancelled()}callMenu(){S.playOk(),g.push(Se),Kt.initCommandPosition(),self.$gameTemp.clearDestination(),this._mapNameWindow.hide(),this._waitCount=2}updateCallDebug(){this.isDebugCalled()&&g.push(Xs)}isDebugCalled(){return x.isTriggered("debug")&&self.$gameTemp.isPlaytest()}fadeInForTransfer(){let t=self.$gamePlayer.fadeType();switch(t){case 0:case 1:this.startFadeIn(this.fadeSpeed(),t===1);break}}fadeOutForTransfer(){let t=self.$gamePlayer.fadeType();switch(t){case 0:case 1:this.startFadeOut(this.fadeSpeed(),t===1);break}}launchBattle(){v.saveBgmAndBgs(),this.stopAudioOnBattleStart(),S.playBattleStart(),this.startEncounterEffect(),this._mapNameWindow.hide()}stopAudioOnBattleStart(){b.isCurrentBgm(self.$gameSystem.battleBgm())||b.stopBgm(),b.stopBgs(),b.stopMe(),b.stopSe()}startEncounterEffect(){this._spriteset.hideCharacters(),this._encounterEffectDuration=this.encounterEffectSpeed()}updateEncounterEffect(){if(this._encounterEffectDuration>0){this._encounterEffectDuration--;let t=this.encounterEffectSpeed(),e=t-this._encounterEffectDuration,i=e/t,s=((i-1)*20*i+5)*i+1,a=self.$gamePlayer.screenX(),r=self.$gamePlayer.screenY()-24;e===2&&(self.$gameScreen.setZoom(a,r,1),this.snapForBattleBackground(),this.startFlashForEncounter(t/2)),self.$gameScreen.setZoom(a,r,s),e===Math.floor(t/6)&&this.startFlashForEncounter(t/2),e===Math.floor(t/2)&&(v.playBattleBgm(),this.startFadeOut(this.fadeSpeed()))}}snapForBattleBackground(){this._windowLayer.visible=!1,g.snapForBackground(),this._windowLayer.visible=!0}startFlashForEncounter(t){let e=[255,255,255,255];self.$gameScreen.startFlash(e,t)}encounterEffectSpeed(){return 60}};o(Jt,"Scene_Map");var Rt=Jt;var Lt=class extends J{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(0,0),this.updatePlacement(),this.openness=0,this.selectLast()}static initCommandPosition(){this._lastCommandSymbol=null}windowWidth(){return 240}updatePlacement(){this.x=(l.boxWidth-this.width)/2,this.y=l.boxHeight-this.height-96}makeCommandList(){this.addCommand(m.newGame,"newGame"),this.addCommand(m.continue_,"continue",this.isContinueEnabled()),this.addCommand(m.options,"options")}isContinueEnabled(){return w.isAnySavefileExists()}processOk(){Lt._lastCommandSymbol=this.currentSymbol(),super.processOk()}selectLast(){Lt._lastCommandSymbol?this.selectSymbol(Lt._lastCommandSymbol):this.isContinueEnabled()&&this.selectSymbol("continue")}};o(Lt,"Window_TitleCommand");Lt._lastCommandSymbol=null;var Te=Lt;var ia=class extends it{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.createBackground(),this.createForeground(),this.createWindowLayer(),this.createCommandWindow()}start(){super.start(),g.clearStack(),this.centerSprite(this._backSprite1),this.centerSprite(this._backSprite2),this.playTitleMusic(),this.startFadeIn(this.fadeSpeed(),!1)}update(){this.isBusy()||this._commandWindow.open(),super.update()}isBusy(){return this._commandWindow.isClosing()||it.prototype.isBusy.call(this)}terminate(){super.terminate(),g.snapForBackground()}createBackground(){this._backSprite1=new C(p.loadTitle1(self.$dataSystem.title1Name)),this._backSprite2=new C(p.loadTitle2(self.$dataSystem.title2Name)),this.addChild(this._backSprite1),this.addChild(this._backSprite2)}createForeground(){this._gameTitleSprite=new C(new V(l.width,l.height)),this.addChild(this._gameTitleSprite),self.$dataSystem.optDrawTitle&&this.drawGameTitle()}drawGameTitle(){let e=l.height/4,i=l.width-20*2,s=self.$dataSystem.gameTitle;this._gameTitleSprite.bitmap.outlineColor="black",this._gameTitleSprite.bitmap.outlineWidth=8,this._gameTitleSprite.bitmap.fontSize=72,this._gameTitleSprite.bitmap.drawText(s,20,e,i,48,"center")}centerSprite(t){t.x=l.width/2,t.y=l.height/2,t.anchor.x=.5,t.anchor.y=.5}createCommandWindow(){this._commandWindow=new Te,this._commandWindow.setHandler("newGame",this.commandNewGame.bind(this)),this._commandWindow.setHandler("continue",this.commandContinue.bind(this)),this._commandWindow.setHandler("options",this.commandOptions.bind(this)),this.addWindow(this._commandWindow)}commandNewGame(){w.setupNewGame(),this._commandWindow.close(),this.fadeOutAll(),g.goto(Rt)}commandContinue(){this._commandWindow.close(),g.push(xe)}commandOptions(){this._commandWindow.close(),g.push(we)}playTitleMusic(){b.playBgm(self.$dataSystem.titleBgm),b.stopBgs(),b.stopMe()}};o(ia,"Scene_Title");var ft=ia;var sa=class extends it{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}create(){super.create(),this.playGameoverMusic(),this.createBackground()}start(){super.start(),this.startFadeIn(this.slowFadeSpeed(),!1)}update(){this.isActive()&&!this.isBusy()&&this.isTriggered()&&this.gotoTitle(),super.update()}stop(){super.stop(),this.fadeOutAll()}terminate(){super.terminate(),b.stopAll()}playGameoverMusic(){b.stopBgm(),b.stopBgs(),b.playMe(self.$dataSystem.gameoverMe)}createBackground(){this._backSprite=new C,this._backSprite.bitmap=p.loadSystem("GameOver"),this.addChild(this._backSprite)}isTriggered(){return x.isTriggered("ok")||k.isTriggered()}gotoTitle(){g.goto(ft)}};o(sa,"Scene_Gameover");var Tt=sa;var aa=class{constructor(){throw new Error("This is a static class")}static setup(t,e,i){this.initMembers(),this._canEscape=e,this._canLose=i,self.$gameTroop.setup(t),self.$gameScreen.onBattleStart(),this.makeEscapeRatio()}static initMembers(){this._phase="init",this._canEscape=!1,this._canLose=!1,this._battleTest=!1,this._eventCallback=null,this._preemptive=!1,this._surprise=!1,this._actorIndex=-1,this._actionForcedBattler=null,this._mapBgm=null,this._mapBgs=null,this._actionBattlers=[],this._subject=null,this._action=null,this._targets=[],this._logWindow=null,this._statusWindow=null,this._spriteset=null,this._escapeRatio=0,this._escaped=!1,this._rewards={},this._turnForced=!1}static isBattleTest(){return this._battleTest}static setBattleTest(t){this._battleTest=t}static setEventCallback(t){this._eventCallback=t}static setLogWindow(t){this._logWindow=t}static setStatusWindow(t){this._statusWindow=t}static setSpriteset(t){this._spriteset=t}static onEncounter(){this._preemptive=Math.random()<this.ratePreemptive(),this._surprise=Math.random()<this.rateSurprise()&&!this._preemptive}static saveBgmAndBgs(){this._mapBgm=b.saveBgm(),this._mapBgs=b.saveBgs()}static replayBgmAndBgs(){this._mapBgm?b.replayBgm(this._mapBgm):b.stopBgm(),this._mapBgs&&b.replayBgs(this._mapBgs)}static makeEscapeRatio(){this._escapeRatio=.5*self.$gameParty.agility()/self.$gameTroop.agility()}static update(){if(!this.isBusy()&&!this.updateEvent())switch(this._phase){case"start":this.startInput();break;case"turn":this.updateTurn();break;case"action":this.updateAction();break;case"turnEnd":this.updateTurnEnd();break;case"battleEnd":this.updateBattleEnd();break}}static updateEvent(){switch(this._phase){case"start":case"turn":case"turnEnd":return this.isActionForced()?(this.processForcedAction(),!0):this.updateEventMain()}return this.checkAbort()}static updateEventMain(){return self.$gameTroop.updateInterpreter(),self.$gameParty.requestMotionRefresh(),!!(self.$gameTroop.isEventRunning()||this.checkBattleEnd()||(self.$gameTroop.setupBattleEvent(),self.$gameTroop.isEventRunning()||g.isSceneChanging()))}static isBusy(){return self.$gameMessage.isBusy()||this._spriteset.isBusy()||this._logWindow.isBusy()}static isInputting(){return this._phase==="input"}static isInTurn(){return this._phase==="turn"}static isTurnEnd(){return this._phase==="turnEnd"}static isAborting(){return this._phase==="aborting"}static isBattleEnd(){return this._phase==="battleEnd"}static canEscape(){return this._canEscape}static canLose(){return this._canLose}static isEscaped(){return this._escaped}static actor(){return this._actorIndex>=0?self.$gameParty.members()[this._actorIndex]:null}static clearActor(){this.changeActor(-1,"")}static changeActor(t,e){let i=this.actor();this._actorIndex=t;let s=this.actor();i&&i.setActionState(e),s&&s.setActionState("inputting")}static startBattle(){this._phase="start",self.$gameSystem.onBattleStart(),self.$gameParty.onBattleStart(),self.$gameTroop.onBattleStart(),this.displayStartMessages()}static displayStartMessages(){self.$gameTroop.enemyNames().forEach(t=>{self.$gameMessage.add(m.emerge.format(t))}),this._preemptive?self.$gameMessage.add(m.preemptive.format(self.$gameParty.name())):this._surprise&&self.$gameMessage.add(m.surprise.format(self.$gameParty.name()))}static startInput(){this._phase="input",self.$gameParty.makeActions(),self.$gameTroop.makeActions(),this.clearActor(),(this._surprise||!self.$gameParty.canInput())&&this.startTurn()}static inputtingAction(){let t=this.actor();return t?t.inputtingAction():null}static selectNextCommand(){do{let t=this.actor();if((!t||!t.selectNextCommand())&&(this.changeActor(this._actorIndex+1,"waiting"),this._actorIndex>=self.$gameParty.size())){this.startTurn();break}}while(!this.actor().canInput())}static selectPreviousCommand(){do{let t=this.actor();if((!t||!t.selectPreviousCommand())&&(this.changeActor(this._actorIndex-1,"undecided"),this._actorIndex<0))return}while(!this.actor().canInput())}static refreshStatus(){this._statusWindow.refresh()}static startTurn(){this._phase="turn",this.clearActor(),self.$gameTroop.increaseTurn(),this.makeActionOrders(),self.$gameParty.requestMotionRefresh(),this._logWindow.startTurn()}static updateTurn(){self.$gameParty.requestMotionRefresh(),this._subject||(this._subject=this.getNextSubject()),this._subject?this.processTurn():this.endTurn()}static processTurn(){let t=this._subject,e=t.currentAction();e?(e.prepare(),e.isValid()&&this.startAction(),t.removeCurrentAction()):(t.onAllActionsEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(t),this._logWindow.displayCurrentState(t),this._logWindow.displayRegeneration(t),this._subject=this.getNextSubject())}static endTurn(){this._phase="turnEnd",this._preemptive=!1,this._surprise=!1,this.allBattleMembers().forEach(function(t){t.onTurnEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(t),this._logWindow.displayRegeneration(t)},this),this.isForcedTurn()&&(this._turnForced=!1)}static isForcedTurn(){return this._turnForced}static updateTurnEnd(){this.startInput()}static getNextSubject(){for(;;){let t=this._actionBattlers.shift();if(!t)return null;if(t.isBattleMember()&&t.isAlive())return t}}static makeActionOrders(){let t=[];this._surprise||(t=t.concat(self.$gameParty.members())),this._preemptive||(t=t.concat(self.$gameTroop.members())),t.forEach(e=>{e.makeSpeed()}),t.sort((e,i)=>i.speed()-e.speed()),this._actionBattlers=t}static startAction(){let t=this._subject,e=t.currentAction(),i=e.makeTargets();this._phase="action",this._action=e,this._targets=i,t.useItem(e.item()),this._action.applyGlobal(),this.refreshStatus(),this._logWindow.startAction(t,e,i)}static updateAction(){let t=this._targets.shift();t?this.invokeAction(this._subject,t):this.endAction()}static endAction(){this._logWindow.endAction(this._subject),this._phase="turn"}static invokeAction(t,e){this._logWindow.push("pushBaseLine"),Math.random()<this._action.itemCnt(e)?this.invokeCounterAttack(t,e):Math.random()<this._action.itemMrf(e)?this.invokeMagicReflection(t,e):this.invokeNormalAction(t,e),t.setLastTarget(e),this._logWindow.push("popBaseLine"),this.refreshStatus()}static invokeNormalAction(t,e){let i=this.applySubstitute(e);this._action.apply(i),this._logWindow.displayActionResults(t,i)}static invokeCounterAttack(t,e){let i=new mt(e);i.setAttack(),i.apply(t),this._logWindow.displayCounter(e),this._logWindow.displayActionResults(e,t)}static invokeMagicReflection(t,e){this._action._reflectionTarget=e,this._logWindow.displayReflection(e),this._action.apply(t),this._logWindow.displayActionResults(e,t)}static applySubstitute(t){if(this.checkSubstitute(t)){let e=t.friendsUnit().substituteBattler();if(e&&t!==e)return this._logWindow.displaySubstitute(e,t),e}return t}static checkSubstitute(t){return t.isDying()&&!this._action.isCertainHit()}static isActionForced(){return!!this._actionForcedBattler}static forceAction(t){this._actionForcedBattler=t;let e=this._actionBattlers.indexOf(t);e>=0&&this._actionBattlers.splice(e,1)}static processForcedAction(){this._actionForcedBattler&&(this._turnForced=!0,this._subject=this._actionForcedBattler,this._actionForcedBattler=null,this.startAction(),this._subject.removeCurrentAction())}static abort(){this._phase="aborting"}static checkBattleEnd(){if(this._phase){if(this.checkAbort())return!0;if(self.$gameParty.isAllDead())return this.processDefeat(),!0;if(self.$gameTroop.isAllDead())return this.processVictory(),!0}return!1}static checkAbort(){return(self.$gameParty.isEmpty()||this.isAborting())&&(S.playEscape(),this._escaped=!0,this.processAbort()),!1}static processVictory(){self.$gameParty.removeBattleStates(),self.$gameParty.performVictory(),this.playVictoryMe(),this.replayBgmAndBgs(),this.makeRewards(),this.displayVictoryMessage(),this.displayRewards(),this.gainRewards(),this.endBattle(0)}static processEscape(){self.$gameParty.performEscape(),S.playEscape();let t=this.processEscapeFormula();return t?(this.displayEscapeSuccessMessage(),this._escaped=!0,this.processAbort()):(this.displayEscapeFailureMessage(),this._escapeRatio+=.1,self.$gameParty.clearActions(),this.startTurn()),t}static processEscapeFormula(){return this._preemptive?!0:Math.random()<this._escapeRatio}static processAbort(){self.$gameParty.removeBattleStates(),this.replayBgmAndBgs(),this.endBattle(1)}static processDefeat(){this.displayDefeatMessage(),this.playDefeatMe(),this._canLose?this.replayBgmAndBgs():b.stopBgm(),this.endBattle(2)}static endBattle(t){this._phase="battleEnd",this._eventCallback&&this._eventCallback(t),t===0?self.$gameSystem.onBattleWin():this._escaped&&self.$gameSystem.onBattleEscape()}static updateBattleEnd(){this.isBattleTest()?(b.stopBgm(),g.exit()):!this._escaped&&self.$gameParty.isAllDead()?this._canLose?(self.$gameParty.reviveBattleMembers(),g.pop()):g.goto(Tt):g.pop(),this._phase=null}static makeRewards(){this._rewards={},this._rewards.gold=self.$gameTroop.goldTotal(),this._rewards.exp=self.$gameTroop.expTotal(),this._rewards.items=self.$gameTroop.makeDropItems()}static displayRewards(){this.displayExp(),this.displayGold(),this.displayDropItems()}static displayExp(){let t=this._rewards.exp;if(t>0){let e=m.obtainExp.format(t,m.exp);self.$gameMessage.add(`\\.${e}`)}}static displayGold(){let t=this._rewards.gold;t>0&&self.$gameMessage.add(`\\.${m.obtainGold.format(t)}`)}static displayDropItems(){let t=this._rewards.items;t.length>0&&(self.$gameMessage.newPage(),t.forEach(({name:e})=>{self.$gameMessage.add(m.obtainItem.format(e))}))}static gainRewards(){this.gainExp(),this.gainGold(),this.gainDropItems()}static gainExp(){let t=this._rewards.exp;self.$gameParty.allMembers().forEach(e=>{e.gainExp(t)})}static gainGold(){self.$gameParty.gainGold(this._rewards.gold)}static gainDropItems(){this._rewards.items.forEach(e=>{self.$gameParty.gainItem(e,1)})}static ratePreemptive(){return self.$gameParty.ratePreemptive(self.$gameTroop.agility())}static rateSurprise(){return self.$gameParty.rateSurprise(self.$gameTroop.agility())}static playBattleBgm(){b.playBgm(self.$gameSystem.battleBgm()),b.stopBgs()}static playVictoryMe(){b.playMe(self.$gameSystem.victoryMe())}static playDefeatMe(){b.playMe(self.$gameSystem.defeatMe())}static allBattleMembers(){return self.$gameParty.members().concat(self.$gameTroop.members())}static displayVictoryMessage(){self.$gameMessage.add(m.victory.format(self.$gameParty.name()))}static displayDefeatMessage(){self.$gameMessage.add(m.defeat.format(self.$gameParty.name()))}static displayEscapeSuccessMessage(){self.$gameMessage.add(m.escapeStart.format(self.$gameParty.name()))}static displayEscapeFailureMessage(){self.$gameMessage.add(m.escapeStart.format(self.$gameParty.name())),self.$gameMessage.add(`\\.${m.escapeFailure}`)}};o(aa,"BattleManager");var v=aa;var ra=class extends it{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._startDate=Date.now()}create(){super.create(),w.loadDatabase(),w.loadGlobalInfo(),ut.load(),this.loadSystemWindowImage()}loadSystemWindowImage(){p.reserveSystem("Window")}isReady(){return it.prototype.isReady.call(this)?ut.isConfigLoaded()&&w.isGlobalInfoLoaded()&&w.isDatabaseLoaded()&&this.isGameFontLoaded():!1}isGameFontLoaded(){if(l.isFontLoaded("GameFont"))return!0;if(!l.canUseCssFontLoading()&&Date.now()-this._startDate>=6e4)throw new Error("Failed to load GameFont")}start(){super.start(),S.preloadImportantSounds(),w.isBattleTest()?(w.setupBattleTest(),g.goto(Ct)):w.isEventTest()?(w.setupEventTest(),g.goto(Rt)):(this.checkPlayerLocation(),w.setupNewGame(),g.goto(ft),Te.initCommandPosition()),this.updateDocumentTitle()}updateDocumentTitle(){document.title=self.$dataSystem.gameTitle}checkPlayerLocation(){if(self.$dataSystem.startMapId===0)throw new Error("Player's starting position is not set")}static loadSystemImages(){p.reserveSystem("IconSet"),p.reserveSystem("Balloon"),p.reserveSystem("Shadow1"),p.reserveSystem("Shadow2"),p.reserveSystem("Damage"),p.reserveSystem("States"),p.reserveSystem("Weapons1"),p.reserveSystem("Weapons2"),p.reserveSystem("Weapons3"),p.reserveSystem("ButtonSet")}};o(ra,"Scene_Boot");var Ae=ra;var na=class{constructor(...t){this.initialize(...t)}initialize(){this._isPlaytest=I.isOptionValid("test"),this._commonEventId=0,this._destinationX=null,this._destinationY=null}isPlaytest(){return this._isPlaytest}reserveCommonEvent(t){this._commonEventId=t}clearCommonEvent(){this._commonEventId=0}isCommonEventReserved(){return this._commonEventId>0}reservedCommonEvent(){return self.$dataCommonEvents[this._commonEventId]}reservedCommonEventId(){return this._commonEventId}setDestination(t,e){this._destinationX=t,this._destinationY=e}clearDestination(){this._destinationX=null,this._destinationY=null}isDestinationValid(){return this._destinationX!==null}destinationX(){return this._destinationX}destinationY(){return this._destinationY}};o(na,"Game_Temp");var oa=na;var ha=class{constructor(...t){this.initialize(...t)}initialize(){this._saveEnabled=!0,this._menuEnabled=!0,this._encounterEnabled=!0,this._formationEnabled=!0,this._battleCount=0,this._winCount=0,this._escapeCount=0,this._saveCount=0,this._versionId=0,this._framesOnSave=0,this._sceneFramesOnSave=0,this._bgmOnSave=null,this._bgsOnSave=null,this._windowTone=null,this._battleBgm=null,this._victoryMe=null,this._defeatMe=null,this._savedBgm=null,this._walkingBgm=null}isJapanese(){return self.$dataSystem.locale.match(/^ja/)}isChinese(){return self.$dataSystem.locale.match(/^zh/)}isKorean(){return self.$dataSystem.locale.match(/^ko/)}isCJK(){return self.$dataSystem.locale.match(/^(ja|zh|ko)/)}isRussian(){return self.$dataSystem.locale.match(/^ru/)}isSideView(){return self.$dataSystem.optSideView}isSaveEnabled(){return this._saveEnabled}disableSave(){this._saveEnabled=!1}enableSave(){this._saveEnabled=!0}isMenuEnabled(){return this._menuEnabled}disableMenu(){this._menuEnabled=!1}enableMenu(){this._menuEnabled=!0}isEncounterEnabled(){return this._encounterEnabled}disableEncounter(){this._encounterEnabled=!1}enableEncounter(){this._encounterEnabled=!0}isFormationEnabled(){return this._formationEnabled}disableFormation(){this._formationEnabled=!1}enableFormation(){this._formationEnabled=!0}battleCount(){return this._battleCount}winCount(){return this._winCount}escapeCount(){return this._escapeCount}saveCount(){return this._saveCount}versionId(){return this._versionId}windowTone(){return this._windowTone||self.$dataSystem.windowTone}setWindowTone(t){this._windowTone=t}battleBgm(){return this._battleBgm||self.$dataSystem.battleBgm}setBattleBgm(t){this._battleBgm=t}victoryMe(){return this._victoryMe||self.$dataSystem.victoryMe}setVictoryMe(t){this._victoryMe=t}defeatMe(){return this._defeatMe||self.$dataSystem.defeatMe}setDefeatMe(t){this._defeatMe=t}onBattleStart(){this._battleCount++}onBattleWin(){this._winCount++}onBattleEscape(){this._escapeCount++}onBeforeSave(){this._saveCount++,this._versionId=self.$dataSystem.versionId,this._framesOnSave=l.frameCount,this._sceneFramesOnSave=g.frameCount(),this._bgmOnSave=b.saveBgm(),this._bgsOnSave=b.saveBgs()}onAfterLoad(){l.frameCount=this._framesOnSave,g.setFrameCount(this._sceneFramesOnSave||this._framesOnSave),b.playBgm(this._bgmOnSave),b.playBgs(this._bgsOnSave)}playtime(){return Math.floor(g.frameCount()/60)}playtimeText(){let t=Math.floor(this.playtime()/60/60),e=Math.floor(this.playtime()/60)%60,i=this.playtime()%60;return`${t.padZero(2)}:${e.padZero(2)}:${i.padZero(2)}`}saveBgm(){this._savedBgm=b.saveBgm()}replayBgm(){this._savedBgm&&b.replayBgm(this._savedBgm)}saveWalkingBgm(){this._walkingBgm=b.saveBgm()}replayWalkingBgm(){this._walkingBgm&&b.playBgm(this._walkingBgm)}saveWalkingBgm2(){this._walkingBgm=self.$dataMap.bgm}};o(ha,"Game_System");var la=ha;var ca=class{constructor(...t){this.initialize(...t)}initialize(){this.initBasic(),this.initTarget(),this.initTone(),this.initRotation()}name(){return this._name}origin(){return this._origin}x(){return this._x}y(){return this._y}scaleX(){return this._scaleX}scaleY(){return this._scaleY}opacity(){return this._opacity}blendMode(){return this._blendMode}tone(){return this._tone}angle(){return this._angle}initBasic(){this._name="",this._origin=0,this._x=0,this._y=0,this._scaleX=100,this._scaleY=100,this._opacity=255,this._blendMode=0}initTarget(){this._targetX=this._x,this._targetY=this._y,this._targetScaleX=this._scaleX,this._targetScaleY=this._scaleY,this._targetOpacity=this._opacity,this._duration=0}initTone(){this._tone=null,this._toneTarget=null,this._toneDuration=0}initRotation(){this._angle=0,this._rotationSpeed=0}show(t,e,i,s,a,r,h,c){this._name=t,this._origin=e,this._x=i,this._y=s,this._scaleX=a,this._scaleY=r,this._opacity=h,this._blendMode=c,this.initTarget(),this.initTone(),this.initRotation()}move(t,e,i,s,a,r,h,c){this._origin=t,this._targetX=e,this._targetY=i,this._targetScaleX=s,this._targetScaleY=a,this._targetOpacity=r,this._blendMode=h,this._duration=c}rotate(t){this._rotationSpeed=t}tint(t,e){this._tone||(this._tone=[0,0,0,0]),this._toneTarget=t.clone(),this._toneDuration=e,this._toneDuration===0&&(this._tone=this._toneTarget.clone())}erase(){this._name="",this._origin=0,this.initTarget(),this.initTone(),this.initRotation()}update(){this.updateMove(),this.updateTone(),this.updateRotation()}updateMove(){if(this._duration>0){let t=this._duration;this._x=(this._x*(t-1)+this._targetX)/t,this._y=(this._y*(t-1)+this._targetY)/t,this._scaleX=(this._scaleX*(t-1)+this._targetScaleX)/t,this._scaleY=(this._scaleY*(t-1)+this._targetScaleY)/t,this._opacity=(this._opacity*(t-1)+this._targetOpacity)/t,this._duration--}}updateTone(){if(this._toneDuration>0){let t=this._toneDuration;for(let e=0;e<4;e++)this._tone[e]=(this._tone[e]*(t-1)+this._toneTarget[e])/t;this._toneDuration--}}updateRotation(){this._rotationSpeed!==0&&(this._angle+=this._rotationSpeed/2)}};o(ca,"Game_Picture");var da=ca;var ma=class{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this.clearFade(),this.clearTone(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.clearWeather(),this.clearPictures()}onBattleStart(){this.clearFade(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.eraseBattlePictures()}brightness(){return this._brightness}tone(){return this._tone}flashColor(){return this._flashColor}shake(){return this._shake}zoomX(){return this._zoomX}zoomY(){return this._zoomY}zoomScale(){return this._zoomScale}weatherType(){return this._weatherType}weatherPower(){return this._weatherPower}picture(t){let e=this.realPictureId(t);return this._pictures[e]}realPictureId(t){return self.$gameParty.inBattle()?t+this.maxPictures():t}clearFade(){this._brightness=255,this._fadeOutDuration=0,this._fadeInDuration=0}clearTone(){this._tone=[0,0,0,0],this._toneTarget=[0,0,0,0],this._toneDuration=0}clearFlash(){this._flashColor=[0,0,0,0],this._flashDuration=0}clearShake(){this._shakePower=0,this._shakeSpeed=0,this._shakeDuration=0,this._shakeDirection=1,this._shake=0}clearZoom(){this._zoomX=0,this._zoomY=0,this._zoomScale=1,this._zoomScaleTarget=1,this._zoomDuration=0}clearWeather(){this._weatherType="none",this._weatherPower=0,this._weatherPowerTarget=0,this._weatherDuration=0}clearPictures(){this._pictures=[]}eraseBattlePictures(){this._pictures=this._pictures.slice(0,this.maxPictures()+1)}maxPictures(){return 100}startFadeOut(t){this._fadeOutDuration=t,this._fadeInDuration=0}startFadeIn(t){this._fadeInDuration=t,this._fadeOutDuration=0}startTint(t,e){this._toneTarget=t.clone(),this._toneDuration=e,this._toneDuration===0&&(this._tone=this._toneTarget.clone())}startFlash(t,e){this._flashColor=t.clone(),this._flashDuration=e}startShake(t,e,i){this._shakePower=t,this._shakeSpeed=e,this._shakeDuration=i}startZoom(t,e,i,s){this._zoomX=t,this._zoomY=e,this._zoomScaleTarget=i,this._zoomDuration=s}setZoom(t,e,i){this._zoomX=t,this._zoomY=e,this._zoomScale=i}changeWeather(t,e,i){(t!=="none"||i===0)&&(this._weatherType=t),this._weatherPowerTarget=t==="none"?0:e,this._weatherDuration=i,i===0&&(this._weatherPower=this._weatherPowerTarget)}update(){this.updateFadeOut(),this.updateFadeIn(),this.updateTone(),this.updateFlash(),this.updateShake(),this.updateZoom(),this.updateWeather(),this.updatePictures()}updateFadeOut(){if(this._fadeOutDuration>0){let t=this._fadeOutDuration;this._brightness=this._brightness*(t-1)/t,this._fadeOutDuration--}}updateFadeIn(){if(this._fadeInDuration>0){let t=this._fadeInDuration;this._brightness=(this._brightness*(t-1)+255)/t,this._fadeInDuration--}}updateTone(){if(this._toneDuration>0){let t=this._toneDuration;for(let e=0;e<4;e++)this._tone[e]=(this._tone[e]*(t-1)+this._toneTarget[e])/t;this._toneDuration--}}updateFlash(){if(this._flashDuration>0){let t=this._flashDuration;this._flashColor[3]*=(t-1)/t,this._flashDuration--}}updateShake(){if(this._shakeDuration>0||this._shake!==0){let t=this._shakePower*this._shakeSpeed*this._shakeDirection/10;this._shakeDuration<=1&&this._shake*(this._shake+t)<0?this._shake=0:this._shake+=t,this._shake>this._shakePower*2&&(this._shakeDirection=-1),this._shake<-this._shakePower*2&&(this._shakeDirection=1),this._shakeDuration--}}updateZoom(){if(this._zoomDuration>0){let t=this._zoomDuration,e=this._zoomScaleTarget;this._zoomScale=(this._zoomScale*(t-1)+e)/t,this._zoomDuration--}}updateWeather(){if(this._weatherDuration>0){let t=this._weatherDuration,e=this._weatherPowerTarget;this._weatherPower=(this._weatherPower*(t-1)+e)/t,this._weatherDuration--,this._weatherDuration===0&&this._weatherPowerTarget===0&&(this._weatherType="none")}}updatePictures(){this._pictures.forEach(t=>{t&&t.update()})}startFlashForDamage(){this.startFlash([255,0,0,128],8)}showPicture(t,e,i,s,a,r,h,c,d){let u=this.realPictureId(t),f=new da;f.show(e,i,s,a,r,h,c,d),this._pictures[u]=f}movePicture(t,e,i,s,a,r,h,c,d){let u=this.picture(t);u&&u.move(e,i,s,a,r,h,c,d)}rotatePicture(t,e){let i=this.picture(t);i&&i.rotate(e)}tintPicture(t,e,i){let s=this.picture(t);s&&s.tint(e,i)}erasePicture(t){let e=this.realPictureId(t);this._pictures[e]=null}};o(ma,"Game_Screen");var ua=ma;var pa=class{constructor(...t){this.initialize(...t)}initialize(){this._frames=0,this._working=!1}update(t){t&&this._working&&this._frames>0&&(this._frames--,this._frames===0&&this.onExpire())}start(t){this._frames=t,this._working=!0}stop(){this._working=!1}isWorking(){return this._working}seconds(){return Math.floor(this._frames/60)}onExpire(){v.abort()}};o(pa,"Game_Timer");var fa=pa;var _a=class{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._texts=[],this._choices=[],this._faceName="",this._faceIndex=0,this._background=0,this._positionType=2,this._choiceDefaultType=0,this._choiceCancelType=0,this._choiceBackground=0,this._choicePositionType=2,this._numInputVariableId=0,this._numInputMaxDigits=0,this._itemChoiceVariableId=0,this._itemChoiceItypeId=0,this._scrollMode=!1,this._scrollSpeed=2,this._scrollNoFast=!1,this._choiceCallback=null}choices(){return this._choices}faceName(){return this._faceName}faceIndex(){return this._faceIndex}background(){return this._background}positionType(){return this._positionType}choiceDefaultType(){return this._choiceDefaultType}choiceCancelType(){return this._choiceCancelType}choiceBackground(){return this._choiceBackground}choicePositionType(){return this._choicePositionType}numInputVariableId(){return this._numInputVariableId}numInputMaxDigits(){return this._numInputMaxDigits}itemChoiceVariableId(){return this._itemChoiceVariableId}itemChoiceItypeId(){return this._itemChoiceItypeId}scrollMode(){return this._scrollMode}scrollSpeed(){return this._scrollSpeed}scrollNoFast(){return this._scrollNoFast}add(t){this._texts.push(t)}setFaceImage(t,e){this._faceName=t,this._faceIndex=e}setBackground(t){this._background=t}setPositionType(t){this._positionType=t}setChoices(t,e,i){this._choices=t,this._choiceDefaultType=e,this._choiceCancelType=i}setChoiceBackground(t){this._choiceBackground=t}setChoicePositionType(t){this._choicePositionType=t}setNumberInput(t,e){this._numInputVariableId=t,this._numInputMaxDigits=e}setItemChoice(t,e){this._itemChoiceVariableId=t,this._itemChoiceItypeId=e}setScroll(t,e){this._scrollMode=!0,this._scrollSpeed=t,this._scrollNoFast=e}setChoiceCallback(t){this._choiceCallback=t}onChoice(t){this._choiceCallback&&(this._choiceCallback(t),this._choiceCallback=null)}hasText(){return this._texts.length>0}isChoice(){return this._choices.length>0}isNumberInput(){return this._numInputVariableId>0}isItemChoice(){return this._itemChoiceVariableId>0}isBusy(){return this.hasText()||this.isChoice()||this.isNumberInput()||this.isItemChoice()}newPage(){this._texts.length>0&&(this._texts[this._texts.length-1]+="\f")}allText(){return this._texts.join(`
`)}};o(_a,"Game_Message");var ga=_a;var wa=class{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._data=[]}value(t){return!!this._data[t]}setValue(t,e){t>0&&t<self.$dataSystem.switches.length&&(this._data[t]=e,this.onChange())}onChange(){self.$gameMap.requestRefresh()}};o(wa,"Game_Switches");var ya=wa;var ba=class{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._data=[]}value(t){return this._data[t]||0}setValue(t,e){t>0&&t<self.$dataSystem.variables.length&&(typeof e=="number"&&(e=Math.floor(e)),this._data[t]=e,this.onChange())}onChange(){self.$gameMap.requestRefresh()}};o(ba,"Game_Variables");var Sa=ba;var xa=class{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this._data={}}value(t){return!!this._data[t]}setValue(t,e){e?this._data[t]=!0:delete this._data[t],this.onChange()}onChange(){self.$gameMap.requestRefresh()}};o(xa,"Game_SelfSwitches");var Ta=xa;var T=class{constructor(...t){this.initialize(...t)}initialize(){this.initMembers()}initMembers(){this._hp=1,this._mp=0,this._tp=0,this._hidden=!1,this.clearParamPlus(),this.clearStates(),this.clearBuffs()}clearParamPlus(){this._paramPlus=[0,0,0,0,0,0,0,0]}clearStates(){this._states=[],this._stateTurns={}}eraseState(t){let e=this._states.indexOf(t);e>=0&&this._states.splice(e,1),delete this._stateTurns[t]}isStateAffected(t){return this._states.contains(t)}isDeathStateAffected(){return this.isStateAffected(this.deathStateId())}deathStateId(){return 1}resetStateCounts(t){let e=self.$dataStates[t],i=1+Math.max(e.maxTurns-e.minTurns,0);this._stateTurns[t]=e.minTurns+Math.randomInt(i)}isStateExpired(t){return this._stateTurns[t]===0}updateStateTurns(){this._states.forEach(function(t){this._stateTurns[t]>0&&this._stateTurns[t]--},this)}clearBuffs(){this._buffs=[0,0,0,0,0,0,0,0],this._buffTurns=[0,0,0,0,0,0,0,0]}eraseBuff(t){this._buffs[t]=0,this._buffTurns[t]=0}buffLength(){return this._buffs.length}buff(t){return this._buffs[t]}isBuffAffected(t){return this._buffs[t]>0}isDebuffAffected(t){return this._buffs[t]<0}isBuffOrDebuffAffected(t){return this._buffs[t]!==0}isMaxBuffAffected(t){return this._buffs[t]===2}isMaxDebuffAffected(t){return this._buffs[t]===-2}increaseBuff(t){this.isMaxBuffAffected(t)||this._buffs[t]++}decreaseBuff(t){this.isMaxDebuffAffected(t)||this._buffs[t]--}overwriteBuffTurns(t,e){this._buffTurns[t]<e&&(this._buffTurns[t]=e)}isBuffExpired(t){return this._buffTurns[t]===0}updateBuffTurns(){for(let t=0;t<this._buffTurns.length;t++)this._buffTurns[t]>0&&this._buffTurns[t]--}die(){this._hp=0,this.clearStates(),this.clearBuffs()}revive(){this._hp===0&&(this._hp=1)}states(){return this._states.map(t=>self.$dataStates[t])}stateIcons(){return this.states().map(({iconIndex:t})=>t).filter(t=>t>0)}buffIcons(){let t=[];for(let e=0;e<this._buffs.length;e++)this._buffs[e]!==0&&t.push(this.buffIconIndex(this._buffs[e],e));return t}buffIconIndex(t,e){return t>0?T.ICON_BUFF_START+(t-1)*8+e:t<0?T.ICON_DEBUFF_START+(-t-1)*8+e:0}allIcons(){return this.stateIcons().concat(this.buffIcons())}traitObjects(){return this.states()}allTraits(){return this.traitObjects().reduce((t,{traits:e})=>t.concat(e),[])}traits(t){return this.allTraits().filter(e=>e.code===t)}traitsWithId(t,e){return this.allTraits().filter(i=>i.code===t&&i.dataId===e)}traitsPi(t,e){return this.traitsWithId(t,e).reduce((i,{value:s})=>i*s,1)}traitsSum(t,e){return this.traitsWithId(t,e).reduce((i,{value:s})=>i+s,0)}traitsSumAll(t){return this.traits(t).reduce((e,{value:i})=>e+i,0)}traitsSet(t){return this.traits(t).reduce((e,{dataId:i})=>e.concat(i),[])}paramBase(t){return 0}paramPlus(t){return this._paramPlus[t]}paramMin(t){return t===1?0:1}paramMax(t){return t===0?999999:t===1?9999:999}paramRate(t){return this.traitsPi(T.TRAIT_PARAM,t)}paramBuffRate(t){return this._buffs[t]*.25+1}param(t){let e=this.paramBase(t)+this.paramPlus(t);e*=this.paramRate(t)*this.paramBuffRate(t);let i=this.paramMax(t),s=this.paramMin(t);return Math.round(e.clamp(s,i))}xparam(t){return this.traitsSum(T.TRAIT_XPARAM,t)}sparam(t){return this.traitsPi(T.TRAIT_SPARAM,t)}elementRate(t){return this.traitsPi(T.TRAIT_ELEMENT_RATE,t)}debuffRate(t){return this.traitsPi(T.TRAIT_DEBUFF_RATE,t)}stateRate(t){return this.traitsPi(T.TRAIT_STATE_RATE,t)}stateResistSet(){return this.traitsSet(T.TRAIT_STATE_RESIST)}isStateResist(t){return this.stateResistSet().contains(t)}attackElements(){return this.traitsSet(T.TRAIT_ATTACK_ELEMENT)}attackStates(){return this.traitsSet(T.TRAIT_ATTACK_STATE)}attackStatesRate(t){return this.traitsSum(T.TRAIT_ATTACK_STATE,t)}attackSpeed(){return this.traitsSumAll(T.TRAIT_ATTACK_SPEED)}attackTimesAdd(){return Math.max(this.traitsSumAll(T.TRAIT_ATTACK_TIMES),0)}addedSkillTypes(){return this.traitsSet(T.TRAIT_STYPE_ADD)}isSkillTypeSealed(t){return this.traitsSet(T.TRAIT_STYPE_SEAL).contains(t)}addedSkills(){return this.traitsSet(T.TRAIT_SKILL_ADD)}isSkillSealed(t){return this.traitsSet(T.TRAIT_SKILL_SEAL).contains(t)}isEquipWtypeOk(t){return this.traitsSet(T.TRAIT_EQUIP_WTYPE).contains(t)}isEquipAtypeOk(t){return this.traitsSet(T.TRAIT_EQUIP_ATYPE).contains(t)}isEquipTypeLocked(t){return this.traitsSet(T.TRAIT_EQUIP_LOCK).contains(t)}isEquipTypeSealed(t){return this.traitsSet(T.TRAIT_EQUIP_SEAL).contains(t)}slotType(){let t=this.traitsSet(T.TRAIT_SLOT_TYPE);return t.length>0?Math.max.apply(null,t):0}isDualWield(){return this.slotType()===1}actionPlusSet(){return this.traits(T.TRAIT_ACTION_PLUS).map(({value:t})=>t)}specialFlag(t){return this.traits(T.TRAIT_SPECIAL_FLAG).some(({dataId:e})=>e===t)}collapseType(){let t=this.traitsSet(T.TRAIT_COLLAPSE_TYPE);return t.length>0?Math.max.apply(null,t):0}partyAbility(t){return this.traits(T.TRAIT_PARTY_ABILITY).some(({dataId:e})=>e===t)}isAutoBattle(){return this.specialFlag(T.FLAG_ID_AUTO_BATTLE)}isGuard(){return this.specialFlag(T.FLAG_ID_GUARD)&&this.canMove()}isSubstitute(){return this.specialFlag(T.FLAG_ID_SUBSTITUTE)&&this.canMove()}isPreserveTp(){return this.specialFlag(T.FLAG_ID_PRESERVE_TP)}addParam(t,e){this._paramPlus[t]+=e,this.refresh()}setHp(t){this._hp=t,this.refresh()}setMp(t){this._mp=t,this.refresh()}setTp(t){this._tp=t,this.refresh()}maxTp(){return 100}refresh(){this.stateResistSet().forEach(function(t){this.eraseState(t)},this),this._hp=this._hp.clamp(0,this.mhp),this._mp=this._mp.clamp(0,this.mmp),this._tp=this._tp.clamp(0,this.maxTp())}recoverAll(){this.clearStates(),this._hp=this.mhp,this._mp=this.mmp}hpRate(){return this.hp/this.mhp}mpRate(){return this.mmp>0?this.mp/this.mmp:0}tpRate(){return this.tp/this.maxTp()}hide(){this._hidden=!0}appear(){this._hidden=!1}isHidden(){return this._hidden}isAppeared(){return!this.isHidden()}isDead(){return this.isAppeared()&&this.isDeathStateAffected()}isAlive(){return this.isAppeared()&&!this.isDeathStateAffected()}isDying(){return this.isAlive()&&this._hp<this.mhp/4}isRestricted(){return this.isAppeared()&&this.restriction()>0}canInput(){return this.isAppeared()&&!this.isRestricted()&&!this.isAutoBattle()}canMove(){return this.isAppeared()&&this.restriction()<4}isConfused(){return this.isAppeared()&&this.restriction()>=1&&this.restriction()<=3}confusionLevel(){return this.isConfused()?this.restriction():0}isActor(){return!1}isEnemy(){return!1}sortStates(){this._states.sort((t,e)=>{let i=self.$dataStates[t].priority,s=self.$dataStates[e].priority;return i!==s?s-i:t-e})}restriction(){return Math.max.apply(null,this.states().map(({restriction:t})=>t).concat(0))}addNewState(t,e){t===this.deathStateId()&&this.die();let i=this.isRestricted();this._states.push(t),this.sortStates(),!i&&this.isRestricted()&&this.onRestrict()}onRestrict(){}mostImportantStateText(){let t=this.states();for(let e=0;e<t.length;e++)if(t[e].message3)return t[e].message3;return""}stateMotionIndex(){let t=this.states();return t.length>0?t[0].motion:0}stateOverlayIndex(){let t=this.states();return t.length>0?t[0].overlay:0}isSkillWtypeOk(t){return!0}skillMpCost({mpCost:t}){return Math.floor(t*this.mcr)}skillTpCost({tpCost:t}){return t}canPaySkillCost(t){return this._tp>=this.skillTpCost(t)&&this._mp>=this.skillMpCost(t)}paySkillCost(t){this._mp-=this.skillMpCost(t),this._tp-=this.skillTpCost(t)}isOccasionOk({occasion:t}){return self.$gameParty.inBattle()?t===0||t===1:t===0||t===2}meetsUsableItemConditions(t){return this.canMove()&&this.isOccasionOk(t)}meetsSkillConditions(t){return this.meetsUsableItemConditions(t)&&this.isSkillWtypeOk(t)&&this.canPaySkillCost(t)&&!this.isSkillSealed(t.id)&&!this.isSkillTypeSealed(t.stypeId)}meetsItemConditions(t){return this.meetsUsableItemConditions(t)&&self.$gameParty.hasItem(t)}canUse(t){return t?w.isSkill(t)?this.meetsSkillConditions(t):w.isItem(t)?this.meetsItemConditions(t):!1:!1}canEquip(t){return t?w.isWeapon(t)?this.canEquipWeapon(t):w.isArmor(t)?this.canEquipArmor(t):!1:!1}canEquipWeapon({wtypeId:t,etypeId:e}){return this.isEquipWtypeOk(t)&&!this.isEquipTypeSealed(e)}canEquipArmor({atypeId:t,etypeId:e}){return this.isEquipAtypeOk(t)&&!this.isEquipTypeSealed(e)}attackSkillId(){return 1}guardSkillId(){return 2}canAttack(){return this.canUse(self.$dataSkills[this.attackSkillId()])}canGuard(){return this.canUse(self.$dataSkills[this.guardSkillId()])}};o(T,"Game_BattlerBase");T.TRAIT_ELEMENT_RATE=11;T.TRAIT_DEBUFF_RATE=12;T.TRAIT_STATE_RATE=13;T.TRAIT_STATE_RESIST=14;T.TRAIT_PARAM=21;T.TRAIT_XPARAM=22;T.TRAIT_SPARAM=23;T.TRAIT_ATTACK_ELEMENT=31;T.TRAIT_ATTACK_STATE=32;T.TRAIT_ATTACK_SPEED=33;T.TRAIT_ATTACK_TIMES=34;T.TRAIT_STYPE_ADD=41;T.TRAIT_STYPE_SEAL=42;T.TRAIT_SKILL_ADD=43;T.TRAIT_SKILL_SEAL=44;T.TRAIT_EQUIP_WTYPE=51;T.TRAIT_EQUIP_ATYPE=52;T.TRAIT_EQUIP_LOCK=53;T.TRAIT_EQUIP_SEAL=54;T.TRAIT_SLOT_TYPE=55;T.TRAIT_ACTION_PLUS=61;T.TRAIT_SPECIAL_FLAG=62;T.TRAIT_COLLAPSE_TYPE=63;T.TRAIT_PARTY_ABILITY=64;T.FLAG_ID_AUTO_BATTLE=0;T.FLAG_ID_GUARD=1;T.FLAG_ID_SUBSTITUTE=2;T.FLAG_ID_PRESERVE_TP=3;T.ICON_BUFF_START=32;T.ICON_DEBUFF_START=48;Object.defineProperties(T.prototype,{hp:{get(){return this._hp},configurable:!0},mp:{get(){return this._mp},configurable:!0},tp:{get(){return this._tp},configurable:!0},mhp:{get(){return this.param(0)},configurable:!0},mmp:{get(){return this.param(1)},configurable:!0},atk:{get(){return this.param(2)},configurable:!0},def:{get(){return this.param(3)},configurable:!0},mat:{get(){return this.param(4)},configurable:!0},mdf:{get(){return this.param(5)},configurable:!0},agi:{get(){return this.param(6)},configurable:!0},luk:{get(){return this.param(7)},configurable:!0},hit:{get(){return this.xparam(0)},configurable:!0},eva:{get(){return this.xparam(1)},configurable:!0},cri:{get(){return this.xparam(2)},configurable:!0},cev:{get(){return this.xparam(3)},configurable:!0},mev:{get(){return this.xparam(4)},configurable:!0},mrf:{get(){return this.xparam(5)},configurable:!0},cnt:{get(){return this.xparam(6)},configurable:!0},hrg:{get(){return this.xparam(7)},configurable:!0},mrg:{get(){return this.xparam(8)},configurable:!0},trg:{get(){return this.xparam(9)},configurable:!0},tgr:{get(){return this.sparam(0)},configurable:!0},grd:{get(){return this.sparam(1)},configurable:!0},rec:{get(){return this.sparam(2)},configurable:!0},pha:{get(){return this.sparam(3)},configurable:!0},mcr:{get(){return this.sparam(4)},configurable:!0},tcr:{get(){return this.sparam(5)},configurable:!0},pdr:{get(){return this.sparam(6)},configurable:!0},mdr:{get(){return this.sparam(7)},configurable:!0},fdr:{get(){return this.sparam(8)},configurable:!0},exr:{get(){return this.sparam(9)},configurable:!0}});var ve=T;var va=class{constructor(...t){this.initialize(...t)}initialize(){this.clear()}clear(){this.used=!1,this.missed=!1,this.evaded=!1,this.physical=!1,this.drain=!1,this.critical=!1,this.success=!1,this.hpAffected=!1,this.hpDamage=0,this.mpDamage=0,this.tpDamage=0,this.addedStates=[],this.removedStates=[],this.addedBuffs=[],this.addedDebuffs=[],this.removedBuffs=[]}addedStateObjects(){return this.addedStates.map(t=>self.$dataStates[t])}removedStateObjects(){return this.removedStates.map(t=>self.$dataStates[t])}isStatusAffected(){return this.addedStates.length>0||this.removedStates.length>0||this.addedBuffs.length>0||this.addedDebuffs.length>0||this.removedBuffs.length>0}isHit(){return this.used&&!this.missed&&!this.evaded}isStateAdded(t){return this.addedStates.contains(t)}pushAddedState(t){this.isStateAdded(t)||this.addedStates.push(t)}isStateRemoved(t){return this.removedStates.contains(t)}pushRemovedState(t){this.isStateRemoved(t)||this.removedStates.push(t)}isBuffAdded(t){return this.addedBuffs.contains(t)}pushAddedBuff(t){this.isBuffAdded(t)||this.addedBuffs.push(t)}isDebuffAdded(t){return this.addedDebuffs.contains(t)}pushAddedDebuff(t){this.isDebuffAdded(t)||this.addedDebuffs.push(t)}isBuffRemoved(t){return this.removedBuffs.contains(t)}pushRemovedBuff(t){this.isBuffRemoved(t)||this.removedBuffs.push(t)}};o(va,"Game_ActionResult");var Ca=va;var Ia=class extends ve{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}initMembers(){super.initMembers(),this._actions=[],this._speed=0,this._result=new Ca,this._actionState="",this._lastTargetIndex=0,this._animations=[],this._damagePopup=!1,this._effectType=null,this._motionType=null,this._weaponImageId=0,this._motionRefresh=!1,this._selected=!1}clearAnimations(){this._animations=[]}clearDamagePopup(){this._damagePopup=!1}clearWeaponAnimation(){this._weaponImageId=0}clearEffect(){this._effectType=null}clearMotion(){this._motionType=null,this._motionRefresh=!1}requestEffect(t){this._effectType=t}requestMotion(t){this._motionType=t}requestMotionRefresh(){this._motionRefresh=!0}select(){this._selected=!0}deselect(){this._selected=!1}isAnimationRequested(){return this._animations.length>0}isDamagePopupRequested(){return this._damagePopup}isEffectRequested(){return!!this._effectType}isMotionRequested(){return!!this._motionType}isWeaponAnimationRequested(){return this._weaponImageId>0}isMotionRefreshRequested(){return this._motionRefresh}isSelected(){return this._selected}effectType(){return this._effectType}motionType(){return this._motionType}weaponImageId(){return this._weaponImageId}shiftAnimation(){return this._animations.shift()}startAnimation(t,e,i){let s={animationId:t,mirror:e,delay:i};this._animations.push(s)}startDamagePopup(){this._damagePopup=!0}startWeaponAnimation(t){this._weaponImageId=t}action(t){return this._actions[t]}setAction(t,e){this._actions[t]=e}numActions(){return this._actions.length}clearActions(){this._actions=[]}result(){return this._result}clearResult(){this._result.clear()}refresh(){super.refresh(),this.hp===0?this.addState(this.deathStateId()):this.removeState(this.deathStateId())}onApplyDamage(t,e,i){}onReceiveDamage(t,e,i){}onHitAction(t,e){}onEvadeAction(t,e){}onApplyCritical(t,e,i){}onReceiveCritical(t,e,i){}addState(t,e){this.isStateAddable(t)?(this.isStateAffected(t)||(this.addNewState(t,e),this.refresh()),e&&e.onApplyStateSuccess(t,this),this.resetStateCounts(t),this._result.pushAddedState(t)):e&&e.onApplyStateFailure(t,this)}onApplyStateSuccess(t,e){}onApplyStateFailure(t,e){}isStateAddable(t){return this.isAlive()&&self.$dataStates[t]&&!this.isStateResist(t)&&!this._result.isStateRemoved(t)&&!this.isStateRestrict(t)}isStateRestrict(t){return self.$dataStates[t].removeByRestriction&&this.isRestricted()}onRestrict(){super.onRestrict(),this.clearActions(),this.states().forEach(function({removeByRestriction:t,id:e}){t&&this.removeState(e)},this)}removeState(t){this.isStateAffected(t)&&(t===this.deathStateId()&&this.revive(),this.eraseState(t),this.refresh(),this._result.pushRemovedState(t))}escape(){self.$gameParty.inBattle()&&this.hide(),this.clearActions(),this.clearStates(),S.playEscape()}addBuff(t,e){this.isAlive()&&(this.increaseBuff(t),this.isBuffAffected(t)&&this.overwriteBuffTurns(t,e),this._result.pushAddedBuff(t),this.refresh())}addDebuff(t,e){this.isAlive()&&(this.decreaseBuff(t),this.isDebuffAffected(t)&&this.overwriteBuffTurns(t,e),this._result.pushAddedDebuff(t),this.refresh())}removeBuff(t){this.isAlive()&&this.isBuffOrDebuffAffected(t)&&(this.eraseBuff(t),this._result.pushRemovedBuff(t),this.refresh())}removeBattleStates(){this.states().forEach(function({removeAtBattleEnd:t,id:e}){t&&this.removeState(e)},this)}removeAllBuffs(){for(let t=0;t<this.buffLength();t++)this.removeBuff(t)}removeStatesAuto(t){this.states().forEach(function({id:e,autoRemovalTiming:i}){this.isStateExpired(e)&&i===t&&this.removeState(e)},this)}removeBuffsAuto(){for(let t=0;t<this.buffLength();t++)this.isBuffExpired(t)&&this.removeBuff(t)}removeStatesByDamage(){this.states().forEach(function({removeByDamage:t,chanceByDamage:e,id:i}){t&&Math.randomInt(100)<e&&this.removeState(i)},this)}makeActionTimes(){return this.actionPlusSet().reduce((t,e)=>Math.random()<e?t+1:t,1)}makeActions(){if(this.clearActions(),this.canMove()){let t=this.makeActionTimes();this._actions=[];for(let e=0;e<t;e++)this._actions.push(new mt(this))}}speed(){return this._speed}makeSpeed(){this._speed=Math.min.apply(null,this._actions.map(t=>t.speed()))||0}currentAction(){return this._actions[0]}removeCurrentAction(){this._actions.shift()}setLastTarget(t){t?this._lastTargetIndex=t.index():this._lastTargetIndex=0}forceAction(t,e){this.clearActions();let i=new mt(this,!0);i.setSkill(t),e===-2?i.setTarget(this._lastTargetIndex):e===-1?i.decideRandomTarget():i.setTarget(e),this._actions.push(i)}useItem(t){w.isSkill(t)?this.paySkillCost(t):w.isItem(t)&&this.consumeItem(t)}consumeItem(t){self.$gameParty.consumeItem(t)}gainHp(t){this._result.hpDamage=-t,this._result.hpAffected=!0,this.setHp(this.hp+t)}gainMp(t){this._result.mpDamage=-t,this.setMp(this.mp+t)}gainTp(t){this._result.tpDamage=-t,this.setTp(this.tp+t)}gainSilentTp(t){this.setTp(this.tp+t)}initTp(){this.setTp(Math.randomInt(25))}clearTp(){this.setTp(0)}chargeTpByDamage(t){let e=Math.floor(50*t*this.tcr);this.gainSilentTp(e)}regenerateHp(){let t=Math.floor(this.mhp*this.hrg);t=Math.max(t,-this.maxSlipDamage()),t!==0&&this.gainHp(t)}maxSlipDamage(){return self.$dataSystem.optSlipDeath?this.hp:Math.max(this.hp-1,0)}regenerateMp(){let t=Math.floor(this.mmp*this.mrg);t!==0&&this.gainMp(t)}regenerateTp(){let t=Math.floor(100*this.trg);this.gainSilentTp(t)}regenerateAll(){this.isAlive()&&(this.regenerateHp(),this.regenerateMp(),this.regenerateTp())}onBattleStart(){this.setActionState("undecided"),this.clearMotion(),this.isPreserveTp()||this.initTp()}onAllActionsEnd(){this.clearResult(),this.removeStatesAuto(1),this.removeBuffsAuto()}onTurnEnd(){this.clearResult(),this.regenerateAll(),v.isForcedTurn()||(this.updateStateTurns(),this.updateBuffTurns()),this.removeStatesAuto(2)}onBattleEnd(){this.clearResult(),this.removeBattleStates(),this.removeAllBuffs(),this.clearActions(),this.isPreserveTp()||this.clearTp(),this.appear()}onDamage(t){this.removeStatesByDamage(),this.chargeTpByDamage(t/this.mhp)}setActionState(t){this._actionState=t,this.requestMotionRefresh()}isUndecided(){return this._actionState==="undecided"}isInputting(){return this._actionState==="inputting"}isWaiting(){return this._actionState==="waiting"}isActing(){return this._actionState==="acting"}isChanting(){return this.isWaiting()?this._actions.some(t=>t.isMagicSkill()):!1}isGuardWaiting(){return this.isWaiting()?this._actions.some(t=>t.isGuard()):!1}performActionStart(t){t.isGuard()||this.setActionState("acting")}performAction(t){}performActionEnd(){this.setActionState("done")}performDamage(){}performMiss(){S.playMiss()}performRecovery(){S.playRecovery()}performEvasion(){S.playEvasion()}performMagicEvasion(){S.playMagicEvasion()}performCounter(){S.playEvasion()}performReflection(){S.playReflection()}performSubstitute(t){}performCollapse(){}};o(Ia,"Game_Battler");var kt=Ia;var Ma=class extends kt{constructor(...t){super(...t),this.initialize(...t)}get level(){return this._level}initialize(t){super.initialize(),this.setup(t)}initMembers(){super.initMembers(),this._actorId=0,this._name="",this._nickname="",this._classId=0,this._level=0,this._characterName="",this._characterIndex=0,this._faceName="",this._faceIndex=0,this._battlerName="",this._exp={},this._skills=[],this._equips=[],this._actionInputIndex=0,this._lastMenuSkill=new Bt,this._lastBattleSkill=new Bt,this._lastCommandSymbol=""}setup(t){let e=self.$dataActors[t];this._actorId=t,this._name=e.name,this._nickname=e.nickname,this._profile=e.profile,this._classId=e.classId,this._level=e.initialLevel,this.initImages(),this.initExp(),this.initSkills(),this.initEquips(e.equips),this.clearParamPlus(),this.recoverAll()}actorId(){return this._actorId}actor(){return self.$dataActors[this._actorId]}name(){return this._name}setName(t){this._name=t}nickname(){return this._nickname}setNickname(t){this._nickname=t}profile(){return this._profile}setProfile(t){this._profile=t}characterName(){return this._characterName}characterIndex(){return this._characterIndex}faceName(){return this._faceName}faceIndex(){return this._faceIndex}battlerName(){return this._battlerName}clearStates(){super.clearStates(),this._stateSteps={}}eraseState(t){super.eraseState(t),delete this._stateSteps[t]}resetStateCounts(t){super.resetStateCounts(t),this._stateSteps[t]=self.$dataStates[t].stepsToRemove}initImages(){let t=this.actor();this._characterName=t.characterName,this._characterIndex=t.characterIndex,this._faceName=t.faceName,this._faceIndex=t.faceIndex,this._battlerName=t.battlerName}expForLevel(t){let e=this.currentClass(),i=e.expParams[0],s=e.expParams[1],a=e.expParams[2],r=e.expParams[3];return Math.round(i*Math.pow(t-1,.9+a/250)*t*(t+1)/(6+Math.pow(t,2)/50/r)+(t-1)*s)}initExp(){this._exp[this._classId]=this.currentLevelExp()}currentExp(){return this._exp[this._classId]}currentLevelExp(){return this.expForLevel(this._level)}nextLevelExp(){return this.expForLevel(this._level+1)}nextRequiredExp(){return this.nextLevelExp()-this.currentExp()}maxLevel(){return this.actor().maxLevel}isMaxLevel(){return this._level>=this.maxLevel()}initSkills(){this._skills=[],this.currentClass().learnings.forEach(function({level:t,skillId:e}){t<=this._level&&this.learnSkill(e)},this)}initEquips(t){let e=this.equipSlots(),i=e.length;this._equips=[];for(let s=0;s<i;s++)this._equips[s]=new Bt;for(let s=0;s<t.length;s++)s<i&&this._equips[s].setEquip(e[s]===1,t[s]);this.releaseUnequippableItems(!0),this.refresh()}equipSlots(){let t=[];for(let e=1;e<self.$dataSystem.equipTypes.length;e++)t.push(e);return t.length>=2&&this.isDualWield()&&(t[1]=1),t}equips(){return this._equips.map(t=>t.object())}weapons(){return this.equips().filter(t=>t&&w.isWeapon(t))}armors(){return this.equips().filter(t=>t&&w.isArmor(t))}hasWeapon(t){return this.weapons().contains(t)}hasArmor(t){return this.armors().contains(t)}isEquipChangeOk(t){return!this.isEquipTypeLocked(this.equipSlots()[t])&&!this.isEquipTypeSealed(this.equipSlots()[t])}changeEquip(t,e){this.tradeItemWithParty(e,this.equips()[t])&&(!e||this.equipSlots()[t]===e.etypeId)&&(this._equips[t].setObject(e),this.refresh())}forceChangeEquip(t,e){this._equips[t].setObject(e),this.releaseUnequippableItems(!0),this.refresh()}tradeItemWithParty(t,e){return t&&!self.$gameParty.hasItem(t)?!1:(self.$gameParty.gainItem(e,1),self.$gameParty.loseItem(t,1),!0)}changeEquipById(t,e){let i=t-1;this.equipSlots()[i]===1?this.changeEquip(i,self.$dataWeapons[e]):this.changeEquip(i,self.$dataArmors[e])}isEquipped(t){return this.equips().contains(t)}discardEquip(t){let e=this.equips().indexOf(t);e>=0&&this._equips[e].setObject(null)}releaseUnequippableItems(t){for(;;){let e=this.equipSlots(),i=this.equips(),s=!1;if(i.forEach((a,r)=>{a&&(!this.canEquip(a)||a.etypeId!==e[r])&&(t||this.tradeItemWithParty(null,a),this._equips[r].setObject(null),s=!0)}),!s)break}}clearEquipments(){let t=this.equipSlots().length;for(let e=0;e<t;e++)this.isEquipChangeOk(e)&&this.changeEquip(e,null)}optimizeEquipments(){let t=this.equipSlots().length;this.clearEquipments();for(let e=0;e<t;e++)this.isEquipChangeOk(e)&&this.changeEquip(e,this.bestEquipItem(e))}bestEquipItem(t){let e=this.equipSlots()[t],i=self.$gameParty.equipItems().filter(function(r){return r.etypeId===e&&this.canEquip(r)},this),s=null,a=-1e3;for(let r=0;r<i.length;r++){let h=this.calcEquipItemPerformance(i[r]);h>a&&(a=h,s=i[r])}return s}calcEquipItemPerformance({params:t}){return t.reduce((e,i)=>e+i)}isSkillWtypeOk({requiredWtypeId1:t,requiredWtypeId2:e}){let i=t,s=e;return!!(i===0&&s===0||i>0&&this.isWtypeEquipped(i)||s>0&&this.isWtypeEquipped(s))}isWtypeEquipped(t){return this.weapons().some(e=>e.wtypeId===t)}refresh(){this.releaseUnequippableItems(!1),super.refresh()}isActor(){return!0}friendsUnit(){return self.$gameParty}opponentsUnit(){return self.$gameTroop}index(){return self.$gameParty.members().indexOf(this)}isBattleMember(){return self.$gameParty.battleMembers().contains(this)}isFormationChangeOk(){return!0}currentClass(){return self.$dataClasses[this._classId]}isClass(t){return t&&this._classId===t.id}skills(){let t=[];return this._skills.concat(this.addedSkills()).forEach(e=>{t.contains(self.$dataSkills[e])||t.push(self.$dataSkills[e])}),t}usableSkills(){return this.skills().filter(function(t){return this.canUse(t)},this)}traitObjects(){let t=kt.prototype.traitObjects.call(this);t=t.concat([this.actor(),this.currentClass()]);let e=this.equips();for(let i of e)i&&t.push(i);return t}attackElements(){let t=kt.prototype.attackElements.call(this);return this.hasNoWeapons()&&!t.contains(this.bareHandsElementId())&&t.push(this.bareHandsElementId()),t}hasNoWeapons(){return this.weapons().length===0}bareHandsElementId(){return 1}paramMax(t){return t===0?9999:kt.prototype.paramMax.call(this,t)}paramBase(t){return this.currentClass().params[t][this._level]}paramPlus(t){let e=kt.prototype.paramPlus.call(this,t),i=this.equips();for(let s of i)s&&(e+=s.params[t]);return e}attackAnimationId1(){if(this.hasNoWeapons())return this.bareHandsAnimationId();{let t=this.weapons();return t[0]?t[0].animationId:0}}attackAnimationId2(){let t=this.weapons();return t[1]?t[1].animationId:0}bareHandsAnimationId(){return 1}changeExp(t,e){this._exp[this._classId]=Math.max(t,0);let i=this._level,s=this.skills();for(;!this.isMaxLevel()&&this.currentExp()>=this.nextLevelExp();)this.levelUp();for(;this.currentExp()<this.currentLevelExp();)this.levelDown();e&&this._level>i&&this.displayLevelUp(this.findNewSkills(s)),this.refresh()}levelUp(){this._level++,this.currentClass().learnings.forEach(function({level:t,skillId:e}){t===this._level&&this.learnSkill(e)},this)}levelDown(){this._level--}findNewSkills(t){let e=this.skills();for(let i=0;i<t.length;i++){let s=e.indexOf(t[i]);s>=0&&e.splice(s,1)}return e}displayLevelUp(t){let e=m.levelUp.format(this._name,m.level,this._level);self.$gameMessage.newPage(),self.$gameMessage.add(e),t.forEach(({name:i})=>{self.$gameMessage.add(m.obtainSkill.format(i))})}gainExp(t){let e=this.currentExp()+Math.round(t*this.finalExpRate());this.changeExp(e,this.shouldDisplayLevelUp())}finalExpRate(){return this.exr*(this.isBattleMember()?1:this.benchMembersExpRate())}benchMembersExpRate(){return self.$dataSystem.optExtraExp?1:0}shouldDisplayLevelUp(){return!0}changeLevel(t,e){t=t.clamp(1,this.maxLevel()),this.changeExp(this.expForLevel(t),e)}learnSkill(t){this.isLearnedSkill(t)||(this._skills.push(t),this._skills.sort((e,i)=>e-i))}forgetSkill(t){let e=this._skills.indexOf(t);e>=0&&this._skills.splice(e,1)}isLearnedSkill(t){return this._skills.contains(t)}hasSkill(t){return this.skills().contains(self.$dataSkills[t])}changeClass(t,e){e&&(this._exp[t]=this.currentExp()),this._classId=t,this.changeExp(this._exp[this._classId]||0,!1),this.refresh()}setCharacterImage(t,e){this._characterName=t,this._characterIndex=e}setFaceImage(t,e){this._faceName=t,this._faceIndex=e}setBattlerImage(t){this._battlerName=t}isSpriteVisible(){return self.$gameSystem.isSideView()}startAnimation(t,e,i){e=!e,super.startAnimation(t,e,i)}performActionStart(t){super.performActionStart(t)}performAction(t){super.performAction(t),t.isAttack()?this.performAttack():t.isGuard()?this.requestMotion("guard"):t.isMagicSkill()?this.requestMotion("spell"):t.isSkill()?this.requestMotion("skill"):t.isItem()&&this.requestMotion("item")}performActionEnd(){super.performActionEnd()}performAttack(){let t=this.weapons(),e=t[0]?t[0].wtypeId:0,i=self.$dataSystem.attackMotions[e];i&&(i.type===0?this.requestMotion("thrust"):i.type===1?this.requestMotion("swing"):i.type===2&&this.requestMotion("missile"),this.startWeaponAnimation(i.weaponImageId))}performDamage(){super.performDamage(),this.isSpriteVisible()?this.requestMotion("damage"):self.$gameScreen.startShake(5,5,10),S.playActorDamage()}performEvasion(){super.performEvasion(),this.requestMotion("evade")}performMagicEvasion(){super.performMagicEvasion(),this.requestMotion("evade")}performCounter(){super.performCounter(),this.performAttack()}performCollapse(){super.performCollapse(),self.$gameParty.inBattle()&&S.playActorCollapse()}performVictory(){this.canMove()&&this.requestMotion("victory")}performEscape(){this.canMove()&&this.requestMotion("escape")}makeActionList(){let t=[],e=new mt(this);return e.setAttack(),t.push(e),this.usableSkills().forEach(function({id:i}){e=new mt(this),e.setSkill(i),t.push(e)},this),t}makeAutoBattleActions(){for(let t=0;t<this.numActions();t++){let e=this.makeActionList(),i=Number.MIN_VALUE;for(let s=0;s<e.length;s++){let a=e[s].evaluate();a>i&&(i=a,this.setAction(t,e[s]))}}this.setActionState("waiting")}makeConfusionActions(){for(let t=0;t<this.numActions();t++)this.action(t).setConfusion();this.setActionState("waiting")}makeActions(){super.makeActions(),this.numActions()>0?this.setActionState("undecided"):this.setActionState("waiting"),this.isAutoBattle()?this.makeAutoBattleActions():this.isConfused()&&this.makeConfusionActions()}onPlayerWalk(){this.clearResult(),this.checkFloorEffect(),self.$gamePlayer.isNormal()&&(this.turnEndOnMap(),this.states().forEach(function(t){this.updateStateSteps(t)},this),this.showAddedStates(),this.showRemovedStates())}updateStateSteps({removeByWalking:t,id:e}){t&&this._stateSteps[e]>0&&--this._stateSteps[e]===0&&this.removeState(e)}showAddedStates(){this.result().addedStateObjects().forEach(function({message1:t}){t&&self.$gameMessage.add(this._name+t)},this)}showRemovedStates(){this.result().removedStateObjects().forEach(function({message4:t}){t&&self.$gameMessage.add(this._name+t)},this)}stepsForTurn(){return 20}turnEndOnMap(){self.$gameParty.steps()%this.stepsForTurn()===0&&(this.onTurnEnd(),this.result().hpDamage>0&&this.performMapDamage())}checkFloorEffect(){self.$gamePlayer.isOnDamageFloor()&&this.executeFloorDamage()}executeFloorDamage(){let t=Math.floor(this.basicFloorDamage()*this.fdr);t=Math.min(t,this.maxFloorDamage()),this.gainHp(-t),t>0&&this.performMapDamage()}basicFloorDamage(){return 10}maxFloorDamage(){return self.$dataSystem.optFloorDeath?this.hp:Math.max(this.hp-1,0)}performMapDamage(){self.$gameParty.inBattle()||self.$gameScreen.startFlashForDamage()}clearActions(){super.clearActions(),this._actionInputIndex=0}inputtingAction(){return this.action(this._actionInputIndex)}selectNextCommand(){return this._actionInputIndex<this.numActions()-1?(this._actionInputIndex++,!0):!1}selectPreviousCommand(){return this._actionInputIndex>0?(this._actionInputIndex--,!0):!1}lastMenuSkill(){return this._lastMenuSkill.object()}setLastMenuSkill(t){this._lastMenuSkill.setObject(t)}lastBattleSkill(){return this._lastBattleSkill.object()}setLastBattleSkill(t){this._lastBattleSkill.setObject(t)}lastCommandSymbol(){return this._lastCommandSymbol}setLastCommandSymbol(t){this._lastCommandSymbol=t}testEscape({effects:t}){return t.some((e,i,s)=>e&&e.code===mt.EFFECT_SPECIAL)}meetsUsableItemConditions(t){return self.$gameParty.inBattle()&&!v.canEscape()&&this.testEscape(t)?!1:ve.prototype.meetsUsableItemConditions.call(this,t)}};o(Ma,"Game_Actor");var Ea=Ma;var ka=class{constructor(...t){this.initialize(...t)}initialize(){this._data=[]}actor(t){return self.$dataActors[t]?(this._data[t]||(this._data[t]=new Ea(t)),this._data[t]):null}};o(ka,"Game_Actors");var Aa=ka;var Wa=class{constructor(...t){this.initialize(...t)}initialize(){this._inBattle=!1}inBattle(){return this._inBattle}members(){return[]}aliveMembers(){return this.members().filter(t=>t.isAlive())}deadMembers(){return this.members().filter(t=>t.isDead())}movableMembers(){return this.members().filter(t=>t.canMove())}clearActions(){return this.members().forEach(t=>t.clearActions())}agility(){let t=this.members();return t.length===0?1:t.reduce((i,{agi:s})=>i+s,0)/t.length}tgrSum(){return this.aliveMembers().reduce((t,{tgr:e})=>t+e,0)}randomTarget(){let t=Math.random()*this.tgrSum(),e=null;return this.aliveMembers().forEach(i=>{t-=i.tgr,t<=0&&!e&&(e=i)}),e}randomDeadTarget(){let t=this.deadMembers();return t.length===0?null:t[Math.floor(Math.random()*t.length)]}smoothTarget(t){t<0&&(t=0);let e=this.members()[t];return e&&e.isAlive()?e:this.aliveMembers()[0]}smoothDeadTarget(t){t<0&&(t=0);let e=this.members()[t];return e&&e.isDead()?e:this.deadMembers()[0]}clearResults(){this.members().forEach(t=>{t.clearResult()})}onBattleStart(){this.members().forEach(t=>{t.onBattleStart()}),this._inBattle=!0}onBattleEnd(){this._inBattle=!1,this.members().forEach(t=>{t.onBattleEnd()})}makeActions(){this.members().forEach(t=>{t.makeActions()})}select(t){this.members().forEach(e=>{e===t?e.select():e.deselect()})}isAllDead(){return this.aliveMembers().length===0}substituteBattler(){let t=this.members();for(let e=0;e<t.length;e++)if(t[e].isSubstitute())return t[e]}};o(Wa,"Game_Unit");var ae=Wa;var rt=class extends ae{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._gold=0,this._steps=0,this._lastItem=new Bt,this._menuActorId=0,this._targetActorId=0,this._actors=[],this.initAllItems()}initAllItems(){this._items={},this._weapons={},this._armors={}}exists(){return this._actors.length>0}size(){return this.members().length}isEmpty(){return this.size()===0}members(){return this.inBattle()?this.battleMembers():this.allMembers()}allMembers(){return this._actors.map(t=>self.$gameActors.actor(t))}battleMembers(){return this.allMembers().slice(0,this.maxBattleMembers()).filter(t=>t.isAppeared())}maxBattleMembers(){return 4}leader(){return this.battleMembers()[0]}reviveBattleMembers(){this.battleMembers().forEach(t=>{t.isDead()&&t.setHp(1)})}items(){let t=[];for(let e in this._items)t.push(self.$dataItems[e]);return t}weapons(){let t=[];for(let e in this._weapons)t.push(self.$dataWeapons[e]);return t}armors(){let t=[];for(let e in this._armors)t.push(self.$dataArmors[e]);return t}equipItems(){return this.weapons().concat(this.armors())}allItems(){return this.items().concat(this.equipItems())}itemContainer(t){return t?w.isItem(t)?this._items:w.isWeapon(t)?this._weapons:w.isArmor(t)?this._armors:null:null}setupStartingMembers(){this._actors=[],self.$dataSystem.partyMembers.forEach(function(t){self.$gameActors.actor(t)&&this._actors.push(t)},this)}name(){let t=this.battleMembers().length;return t===0?"":t===1?this.leader().name():m.partyName.format(this.leader().name())}setupBattleTest(){this.setupBattleTestMembers(),this.setupBattleTestItems()}setupBattleTestMembers(){self.$dataSystem.testBattlers.forEach(function({actorId:t,level:e,equips:i}){let s=self.$gameActors.actor(t);s&&(s.changeLevel(e,!1),s.initEquips(i),s.recoverAll(),this.addActor(t))},this)}setupBattleTestItems(){self.$dataItems.forEach(function(t){t&&t.name.length>0&&this.gainItem(t,this.maxItems(t))},this)}highestLevel(){return Math.max.apply(null,this.members().map(({level:t})=>t))}addActor(t){this._actors.contains(t)||(this._actors.push(t),self.$gamePlayer.refresh(),self.$gameMap.requestRefresh())}removeActor(t){this._actors.contains(t)&&(this._actors.splice(this._actors.indexOf(t),1),self.$gamePlayer.refresh(),self.$gameMap.requestRefresh())}gold(){return this._gold}gainGold(t){this._gold=(this._gold+t).clamp(0,this.maxGold())}loseGold(t){this.gainGold(-t)}maxGold(){return 99999999}steps(){return this._steps}increaseSteps(){this._steps++}numItems(t){let e=this.itemContainer(t);return e&&e[t.id]||0}maxItems(t){return 99}hasMaxItems(t){return this.numItems(t)>=this.maxItems(t)}hasItem(t,e){return e===void 0&&(e=!1),this.numItems(t)>0?!0:!!(e&&this.isAnyMemberEquipped(t))}isAnyMemberEquipped(t){return this.members().some(e=>e.equips().contains(t))}gainItem(t,e,i){let s=this.itemContainer(t);if(s){let r=this.numItems(t)+e;s[t.id]=r.clamp(0,this.maxItems(t)),s[t.id]===0&&delete s[t.id],i&&r<0&&this.discardMembersEquip(t,-r),self.$gameMap.requestRefresh()}}discardMembersEquip(t,e){let i=e;this.members().forEach(s=>{for(;i>0&&s.isEquipped(t);)s.discardEquip(t),i--})}loseItem(t,e,i){this.gainItem(t,-e,i)}consumeItem(t){w.isItem(t)&&t.consumable&&this.loseItem(t,1)}canUse(t){return this.members().some(e=>e.canUse(t))}canInput(){return this.members().some(t=>t.canInput())}isAllDead(){return ae.prototype.isAllDead.call(this)?this.inBattle()||!this.isEmpty():!1}onPlayerWalk(){this.members().forEach(t=>t.onPlayerWalk())}menuActor(){let t=self.$gameActors.actor(this._menuActorId);return this.members().contains(t)||(t=this.members()[0]),t}setMenuActor(t){this._menuActorId=t.actorId()}makeMenuActorNext(){let t=this.members().indexOf(this.menuActor());t>=0?(t=(t+1)%this.members().length,this.setMenuActor(this.members()[t])):this.setMenuActor(this.members()[0])}makeMenuActorPrevious(){let t=this.members().indexOf(this.menuActor());t>=0?(t=(t+this.members().length-1)%this.members().length,this.setMenuActor(this.members()[t])):this.setMenuActor(this.members()[0])}targetActor(){let t=self.$gameActors.actor(this._targetActorId);return this.members().contains(t)||(t=this.members()[0]),t}setTargetActor(t){this._targetActorId=t.actorId()}lastItem(){return this._lastItem.object()}setLastItem(t){this._lastItem.setObject(t)}swapOrder(t,e){let i=this._actors[t];this._actors[t]=this._actors[e],this._actors[e]=i,self.$gamePlayer.refresh()}charactersForSavefile(){return this.battleMembers().map(t=>[t.characterName(),t.characterIndex()])}facesForSavefile(){return this.battleMembers().map(t=>[t.faceName(),t.faceIndex()])}partyAbility(t){return this.battleMembers().some(e=>e.partyAbility(t))}hasEncounterHalf(){return this.partyAbility(rt.ABILITY_ENCOUNTER_HALF)}hasEncounterNone(){return this.partyAbility(rt.ABILITY_ENCOUNTER_NONE)}hasCancelSurprise(){return this.partyAbility(rt.ABILITY_CANCEL_SURPRISE)}hasRaisePreemptive(){return this.partyAbility(rt.ABILITY_RAISE_PREEMPTIVE)}hasGoldDouble(){return this.partyAbility(rt.ABILITY_GOLD_DOUBLE)}hasDropItemDouble(){return this.partyAbility(rt.ABILITY_DROP_ITEM_DOUBLE)}ratePreemptive(t){let e=this.agility()>=t?.05:.03;return this.hasRaisePreemptive()&&(e*=4),e}rateSurprise(t){let e=this.agility()>=t?.03:.05;return this.hasCancelSurprise()&&(e=0),e}performVictory(){this.members().forEach(t=>{t.performVictory()})}performEscape(){this.members().forEach(t=>{t.performEscape()})}removeBattleStates(){this.members().forEach(t=>{t.removeBattleStates()})}requestMotionRefresh(){this.members().forEach(t=>{t.requestMotionRefresh()})}};o(rt,"Game_Party");rt.ABILITY_ENCOUNTER_HALF=0;rt.ABILITY_ENCOUNTER_NONE=1;rt.ABILITY_CANCEL_SURPRISE=2;rt.ABILITY_RAISE_PREEMPTIVE=3;rt.ABILITY_GOLD_DOUBLE=4;rt.ABILITY_DROP_ITEM_DOUBLE=5;var Pa=rt;var Ba=class extends kt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){super.initialize(),this.setup(t,e,i)}initMembers(){super.initMembers(),this._enemyId=0,this._letter="",this._plural=!1,this._screenX=0,this._screenY=0}setup(t,e,i){this._enemyId=t,this._screenX=e,this._screenY=i,this.recoverAll()}isEnemy(){return!0}friendsUnit(){return self.$gameTroop}opponentsUnit(){return self.$gameParty}index(){return self.$gameTroop.members().indexOf(this)}isBattleMember(){return this.index()>=0}enemyId(){return this._enemyId}enemy(){return self.$dataEnemies[this._enemyId]}traitObjects(){return kt.prototype.traitObjects.call(this).concat(this.enemy())}paramBase(t){return this.enemy().params[t]}exp(){return this.enemy().exp}gold(){return this.enemy().gold}makeDropItems(){return this.enemy().dropItems.reduce((t,{kind:e,denominator:i,dataId:s})=>e>0&&Math.random()*i<this.dropItemRate()?t.concat(this.itemObject(e,s)):t,[])}dropItemRate(){return self.$gameParty.hasDropItemDouble()?2:1}itemObject(t,e){return t===1?self.$dataItems[e]:t===2?self.$dataWeapons[e]:t===3?self.$dataArmors[e]:null}isSpriteVisible(){return!0}screenX(){return this._screenX}screenY(){return this._screenY}battlerName(){return this.enemy().battlerName}battlerHue(){return this.enemy().battlerHue}originalName(){return this.enemy().name}name(){return this.originalName()+(this._plural?this._letter:"")}isLetterEmpty(){return this._letter===""}setLetter(t){this._letter=t}setPlural(t){this._plural=t}performActionStart(t){super.performActionStart(t),this.requestEffect("whiten")}performAction(t){super.performAction(t)}performActionEnd(){super.performActionEnd()}performDamage(){super.performDamage(),S.playEnemyDamage(),this.requestEffect("blink")}performCollapse(){switch(super.performCollapse(),this.collapseType()){case 0:this.requestEffect("collapse"),S.playEnemyCollapse();break;case 1:this.requestEffect("bossCollapse"),S.playBossCollapse1();break;case 2:this.requestEffect("instantCollapse");break}}transform(t){let e=this.originalName();this._enemyId=t,this.originalName()!==e&&(this._letter="",this._plural=!1),this.refresh(),this.numActions()>0&&this.makeActions()}meetsCondition({conditionParam1:t,conditionParam2:e,conditionType:i}){let s=t,a=e;switch(i){case 1:return this.meetsTurnCondition(s,a);case 2:return this.meetsHpCondition(s,a);case 3:return this.meetsMpCondition(s,a);case 4:return this.meetsStateCondition(s);case 5:return this.meetsPartyLevelCondition(s);case 6:return this.meetsSwitchCondition(s);default:return!0}}meetsTurnCondition(t,e){let i=self.$gameTroop.turnCount();return e===0?i===t:i>0&&i>=t&&i%e===t%e}meetsHpCondition(t,e){return this.hpRate()>=t&&this.hpRate()<=e}meetsMpCondition(t,e){return this.mpRate()>=t&&this.mpRate()<=e}meetsStateCondition(t){return this.isStateAffected(t)}meetsPartyLevelCondition(t){return self.$gameParty.highestLevel()>=t}meetsSwitchCondition(t){return self.$gameSwitches.value(t)}isActionValid(t){return this.meetsCondition(t)&&this.canUse(self.$dataSkills[t.skillId])}selectAction(t,e){let i=t.reduce((s,{rating:a})=>s+a-e,0);if(i>0){let s=Math.randomInt(i);for(let a of t)if(s-=a.rating-e,s<0)return a}else return null}selectAllActions(t){let i=Math.max.apply(null,t.map(({rating:s})=>s))-3;t=t.filter(({rating:s})=>s>i);for(let s=0;s<this.numActions();s++)this.action(s).setEnemyAction(this.selectAction(t,i))}makeActions(){if(super.makeActions(),this.numActions()>0){let t=this.enemy().actions.filter(function(e){return this.isActionValid(e)},this);t.length>0&&this.selectAllActions(t)}this.setActionState("waiting")}};o(Ba,"Game_Enemy");var Ra=Ba;var We=class{constructor(...t){this.initialize(...t)}initialize(){this.initMembers()}initMembers(){this._x=0,this._y=0,this._realX=0,this._realY=0,this._moveSpeed=4,this._moveFrequency=6,this._opacity=255,this._blendMode=0,this._direction=2,this._pattern=1,this._priorityType=1,this._tileId=0,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!1,this._walkAnime=!0,this._stepAnime=!1,this._directionFix=!1,this._through=!1,this._transparent=!1,this._bushDepth=0,this._animationId=0,this._balloonId=0,this._animationPlaying=!1,this._balloonPlaying=!1,this._animationCount=0,this._stopCount=0,this._jumpCount=0,this._jumpPeak=0,this._movementSuccess=!0}pos(t,e){return this._x===t&&this._y===e}posNt(t,e){return this.pos(t,e)&&!this.isThrough()}moveSpeed(){return this._moveSpeed}setMoveSpeed(t){this._moveSpeed=t}moveFrequency(){return this._moveFrequency}setMoveFrequency(t){this._moveFrequency=t}opacity(){return this._opacity}setOpacity(t){this._opacity=t}blendMode(){return this._blendMode}setBlendMode(t){this._blendMode=t}isNormalPriority(){return this._priorityType===1}setPriorityType(t){this._priorityType=t}isMoving(){return this._realX!==this._x||this._realY!==this._y}isJumping(){return this._jumpCount>0}jumpHeight(){return(this._jumpPeak*this._jumpPeak-Math.pow(Math.abs(this._jumpCount-this._jumpPeak),2))/2}isStopping(){return!this.isMoving()&&!this.isJumping()}checkStop(t){return this._stopCount>t}resetStopCount(){this._stopCount=0}realMoveSpeed(){return this._moveSpeed+(this.isDashing()?1:0)}distancePerFrame(){return Math.pow(2,this.realMoveSpeed())/256}isDashing(){return!1}isDebugThrough(){return!1}straighten(){(this.hasWalkAnime()||this.hasStepAnime())&&(this._pattern=1),this._animationCount=0}reverseDir(t){return 10-t}canPass(t,e,i){let s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i);return self.$gameMap.isValid(s,a)?this.isThrough()||this.isDebugThrough()?!0:!(!this.isMapPassable(t,e,i)||this.isCollidedWithCharacters(s,a)):!1}canPassDiagonally(t,e,i,s){let a=self.$gameMap.roundXWithDirection(t,i),r=self.$gameMap.roundYWithDirection(e,s);return!!(this.canPass(t,e,s)&&this.canPass(t,r,i)||this.canPass(t,e,i)&&this.canPass(a,e,s))}isMapPassable(t,e,i){let s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i),r=this.reverseDir(i);return self.$gameMap.isPassable(t,e,i)&&self.$gameMap.isPassable(s,a,r)}isCollidedWithCharacters(t,e){return this.isCollidedWithEvents(t,e)||this.isCollidedWithVehicles(t,e)}isCollidedWithEvents(t,e){return self.$gameMap.eventsXyNt(t,e).some(s=>s.isNormalPriority())}isCollidedWithVehicles(t,e){return self.$gameMap.boat().posNt(t,e)||self.$gameMap.ship().posNt(t,e)}setPosition(t,e){this._x=Math.round(t),this._y=Math.round(e),this._realX=t,this._realY=e}copyPosition(t){this._x=t._x,this._y=t._y,this._realX=t._realX,this._realY=t._realY,this._direction=t._direction}locate(t,e){this.setPosition(t,e),this.straighten(),this.refreshBushDepth()}direction(){return this._direction}setDirection(t){!this.isDirectionFixed()&&t&&(this._direction=t),this.resetStopCount()}isTile(){return this._tileId>0&&this._priorityType===0}isObjectCharacter(){return this._isObjectCharacter}shiftY(){return this.isObjectCharacter()?0:6}scrolledX(){return self.$gameMap.adjustX(this._realX)}scrolledY(){return self.$gameMap.adjustY(this._realY)}screenX(){let t=self.$gameMap.tileWidth();return Math.round(this.scrolledX()*t+t/2)}screenY(){let t=self.$gameMap.tileHeight();return Math.round(this.scrolledY()*t+t-this.shiftY()-this.jumpHeight())}screenZ(){return this._priorityType*2+1}isNearTheScreen(){let t=l.width,e=l.height,i=self.$gameMap.tileWidth(),s=self.$gameMap.tileHeight(),a=this.scrolledX()*i+i/2-t/2,r=this.scrolledY()*s+s/2-e/2;return a>=-t&&a<=t&&r>=-e&&r<=e}update(){this.isStopping()&&this.updateStop(),this.isJumping()?this.updateJump():this.isMoving()&&this.updateMove(),this.updateAnimation()}updateStop(){this._stopCount++}updateJump(){this._jumpCount--,this._realX=(this._realX*this._jumpCount+this._x)/(this._jumpCount+1),this._realY=(this._realY*this._jumpCount+this._y)/(this._jumpCount+1),this.refreshBushDepth(),this._jumpCount===0&&(this._realX=this._x=self.$gameMap.roundX(this._x),this._realY=this._y=self.$gameMap.roundY(this._y))}updateMove(){this._x<this._realX&&(this._realX=Math.max(this._realX-this.distancePerFrame(),this._x)),this._x>this._realX&&(this._realX=Math.min(this._realX+this.distancePerFrame(),this._x)),this._y<this._realY&&(this._realY=Math.max(this._realY-this.distancePerFrame(),this._y)),this._y>this._realY&&(this._realY=Math.min(this._realY+this.distancePerFrame(),this._y)),this.isMoving()||this.refreshBushDepth()}updateAnimation(){this.updateAnimationCount(),this._animationCount>=this.animationWait()&&(this.updatePattern(),this._animationCount=0)}animationWait(){return(9-this.realMoveSpeed())*3}updateAnimationCount(){this.isMoving()&&this.hasWalkAnime()?this._animationCount+=1.5:(this.hasStepAnime()||!this.isOriginalPattern())&&this._animationCount++}updatePattern(){!this.hasStepAnime()&&this._stopCount>0?this.resetPattern():this._pattern=(this._pattern+1)%this.maxPattern()}maxPattern(){return 4}pattern(){return this._pattern<3?this._pattern:1}setPattern(t){this._pattern=t}isOriginalPattern(){return this.pattern()===1}resetPattern(){this.setPattern(1)}refreshBushDepth(){this.isNormalPriority()&&!this.isObjectCharacter()&&this.isOnBush()&&!this.isJumping()?this.isMoving()||(this._bushDepth=12):this._bushDepth=0}isOnLadder(){return self.$gameMap.isLadder(this._x,this._y)}isOnBush(){return self.$gameMap.isBush(this._x,this._y)}terrainTag(){return self.$gameMap.terrainTag(this._x,this._y)}regionId(){return self.$gameMap.regionId(this._x,this._y)}increaseSteps(){this.isOnLadder()&&this.setDirection(8),this.resetStopCount(),this.refreshBushDepth()}tileId(){return this._tileId}characterName(){return this._characterName}characterIndex(){return this._characterIndex}setImage(t,e){this._tileId=0,this._characterName=t,this._characterIndex=e,this._isObjectCharacter=p.isObjectCharacter(t)}setTileImage(t){this._tileId=t,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!0}checkEventTriggerTouchFront(t){let e=self.$gameMap.roundXWithDirection(this._x,t),i=self.$gameMap.roundYWithDirection(this._y,t);this.checkEventTriggerTouch(e,i)}checkEventTriggerTouch(t,e){return!1}isMovementSucceeded(t,e){return this._movementSuccess}setMovementSuccess(t){this._movementSuccess=t}moveStraight(t){this.setMovementSuccess(this.canPass(this._x,this._y,t)),this.isMovementSucceeded()?(this.setDirection(t),this._x=self.$gameMap.roundXWithDirection(this._x,t),this._y=self.$gameMap.roundYWithDirection(this._y,t),this._realX=self.$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=self.$gameMap.yWithDirection(this._y,this.reverseDir(t)),this.increaseSteps()):(this.setDirection(t),this.checkEventTriggerTouchFront(t))}moveDiagonally(t,e){this.setMovementSuccess(this.canPassDiagonally(this._x,this._y,t,e)),this.isMovementSucceeded()&&(this._x=self.$gameMap.roundXWithDirection(this._x,t),this._y=self.$gameMap.roundYWithDirection(this._y,e),this._realX=self.$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=self.$gameMap.yWithDirection(this._y,this.reverseDir(e)),this.increaseSteps()),this._direction===this.reverseDir(t)&&this.setDirection(t),this._direction===this.reverseDir(e)&&this.setDirection(e)}jump(t,e){Math.abs(t)>Math.abs(e)?t!==0&&this.setDirection(t<0?4:6):e!==0&&this.setDirection(e<0?8:2),this._x+=t,this._y+=e;let i=Math.round(Math.sqrt(t*t+e*e));this._jumpPeak=10+i-this._moveSpeed,this._jumpCount=this._jumpPeak*2,this.resetStopCount(),this.straighten()}hasWalkAnime(){return this._walkAnime}setWalkAnime(t){this._walkAnime=t}hasStepAnime(){return this._stepAnime}setStepAnime(t){this._stepAnime=t}isDirectionFixed(){return this._directionFix}setDirectionFix(t){this._directionFix=t}isThrough(){return this._through}setThrough(t){this._through=t}isTransparent(){return this._transparent}bushDepth(){return this._bushDepth}setTransparent(t){this._transparent=t}requestAnimation(t){this._animationId=t}requestBalloon(t){this._balloonId=t}animationId(){return this._animationId}balloonId(){return this._balloonId}startAnimation(){this._animationId=0,this._animationPlaying=!0}startBalloon(){this._balloonId=0,this._balloonPlaying=!0}isAnimationPlaying(){return this._animationId>0||this._animationPlaying}isBalloonPlaying(){return this._balloonId>0||this._balloonPlaying}endAnimation(){this._animationPlaying=!1}endBalloon(){this._balloonPlaying=!1}};o(We,"Game_CharacterBase");Object.defineProperties(We.prototype,{x:{get(){return this._x},configurable:!0},y:{get(){return this._y},configurable:!0}});var $a=We;var M=class extends $a{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}initMembers(){super.initMembers(),this._moveRouteForcing=!1,this._moveRoute=null,this._moveRouteIndex=0,this._originalMoveRoute=null,this._originalMoveRouteIndex=0,this._waitCount=0,this._callerEventInfo=null}memorizeMoveRoute(){this._originalMoveRoute=this._moveRoute,this._originalMoveRouteIndex=this._moveRouteIndex}restoreMoveRoute(){this._moveRoute=this._originalMoveRoute,this._moveRouteIndex=this._originalMoveRouteIndex-1,this._originalMoveRoute=null,this._callerEventInfo=null}isMoveRouteForcing(){return this._moveRouteForcing}setMoveRoute(t){this._moveRoute=t,this._moveRouteIndex=0,this._moveRouteForcing=!1}forceMoveRoute(t){this._originalMoveRoute||this.memorizeMoveRoute(),this._moveRoute=t,this._moveRouteIndex=0,this._moveRouteForcing=!0,this._waitCount=0}setCallerEventInfo(t){this._callerEventInfo=t}updateStop(){super.updateStop(),this._moveRouteForcing&&this.updateRoutineMove()}updateRoutineMove(){if(this._waitCount>0)this._waitCount--;else{this.setMovementSuccess(!0);let t=this._moveRoute.list[this._moveRouteIndex];t&&(this.processMoveCommand(t),this.advanceMoveRouteIndex())}}processMoveCommand(t){let e=M,i=t.parameters;switch(t.code){case e.ROUTE_END:this.processRouteEnd();break;case e.ROUTE_MOVE_DOWN:this.moveStraight(2);break;case e.ROUTE_MOVE_LEFT:this.moveStraight(4);break;case e.ROUTE_MOVE_RIGHT:this.moveStraight(6);break;case e.ROUTE_MOVE_UP:this.moveStraight(8);break;case e.ROUTE_MOVE_LOWER_L:this.moveDiagonally(4,2);break;case e.ROUTE_MOVE_LOWER_R:this.moveDiagonally(6,2);break;case e.ROUTE_MOVE_UPPER_L:this.moveDiagonally(4,8);break;case e.ROUTE_MOVE_UPPER_R:this.moveDiagonally(6,8);break;case e.ROUTE_MOVE_RANDOM:this.moveRandom();break;case e.ROUTE_MOVE_TOWARD:this.moveTowardPlayer();break;case e.ROUTE_MOVE_AWAY:this.moveAwayFromPlayer();break;case e.ROUTE_MOVE_FORWARD:this.moveForward();break;case e.ROUTE_MOVE_BACKWARD:this.moveBackward();break;case e.ROUTE_JUMP:this.jump(i[0],i[1]);break;case e.ROUTE_WAIT:this._waitCount=i[0]-1;break;case e.ROUTE_TURN_DOWN:this.setDirection(2);break;case e.ROUTE_TURN_LEFT:this.setDirection(4);break;case e.ROUTE_TURN_RIGHT:this.setDirection(6);break;case e.ROUTE_TURN_UP:this.setDirection(8);break;case e.ROUTE_TURN_90D_R:this.turnRight90();break;case e.ROUTE_TURN_90D_L:this.turnLeft90();break;case e.ROUTE_TURN_180D:this.turn180();break;case e.ROUTE_TURN_90D_R_L:this.turnRightOrLeft90();break;case e.ROUTE_TURN_RANDOM:this.turnRandom();break;case e.ROUTE_TURN_TOWARD:this.turnTowardPlayer();break;case e.ROUTE_TURN_AWAY:this.turnAwayFromPlayer();break;case e.ROUTE_SWITCH_ON:self.$gameSwitches.setValue(i[0],!0);break;case e.ROUTE_SWITCH_OFF:self.$gameSwitches.setValue(i[0],!1);break;case e.ROUTE_CHANGE_SPEED:this.setMoveSpeed(i[0]);break;case e.ROUTE_CHANGE_FREQ:this.setMoveFrequency(i[0]);break;case e.ROUTE_WALK_ANIME_ON:this.setWalkAnime(!0);break;case e.ROUTE_WALK_ANIME_OFF:this.setWalkAnime(!1);break;case e.ROUTE_STEP_ANIME_ON:this.setStepAnime(!0);break;case e.ROUTE_STEP_ANIME_OFF:this.setStepAnime(!1);break;case e.ROUTE_DIR_FIX_ON:this.setDirectionFix(!0);break;case e.ROUTE_DIR_FIX_OFF:this.setDirectionFix(!1);break;case e.ROUTE_THROUGH_ON:this.setThrough(!0);break;case e.ROUTE_THROUGH_OFF:this.setThrough(!1);break;case e.ROUTE_TRANSPARENT_ON:this.setTransparent(!0);break;case e.ROUTE_TRANSPARENT_OFF:this.setTransparent(!1);break;case e.ROUTE_CHANGE_IMAGE:this.setImage(i[0],i[1]);break;case e.ROUTE_CHANGE_OPACITY:this.setOpacity(i[0]);break;case e.ROUTE_CHANGE_BLEND_MODE:this.setBlendMode(i[0]);break;case e.ROUTE_PLAY_SE:b.playSe(i[0]);break;case e.ROUTE_SCRIPT:try{let s=this;new Function("{ context }","return "+i[0])({context:s})}catch(s){if(this._callerEventInfo){for(let a in this._callerEventInfo)s[a]=this._callerEventInfo[a];s.line+=this._moveRouteIndex+1,s.eventCommand="set_route_script",s.content=t.parameters[0]}else s.eventType="map_event",s.mapId=this._mapId,s.mapEventId=this._eventId,s.page=this._pageIndex+1,s.line=this._moveRouteIndex+1,s.eventCommand="auto_route_script",s.content=t.parameters[0];throw s}break}}deltaXFrom(t){return self.$gameMap.deltaX(this.x,t)}deltaYFrom(t){return self.$gameMap.deltaY(this.y,t)}moveRandom(){let t=2+Math.randomInt(4)*2;this.canPass(this.x,this.y,t)&&this.moveStraight(t)}moveTowardCharacter({x:t,y:e}){let i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?(this.moveStraight(i>0?4:6),!this.isMovementSucceeded()&&s!==0&&this.moveStraight(s>0?8:2)):s!==0&&(this.moveStraight(s>0?8:2),!this.isMovementSucceeded()&&i!==0&&this.moveStraight(i>0?4:6))}moveAwayFromCharacter({x:t,y:e}){let i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?(this.moveStraight(i>0?6:4),!this.isMovementSucceeded()&&s!==0&&this.moveStraight(s>0?2:8)):s!==0&&(this.moveStraight(s>0?2:8),!this.isMovementSucceeded()&&i!==0&&this.moveStraight(i>0?6:4))}turnTowardCharacter({x:t,y:e}){let i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?this.setDirection(i>0?4:6):s!==0&&this.setDirection(s>0?8:2)}turnAwayFromCharacter({x:t,y:e}){let i=this.deltaXFrom(t),s=this.deltaYFrom(e);Math.abs(i)>Math.abs(s)?this.setDirection(i>0?6:4):s!==0&&this.setDirection(s>0?2:8)}turnTowardPlayer(){this.turnTowardCharacter(self.$gamePlayer)}turnAwayFromPlayer(){this.turnAwayFromCharacter(self.$gamePlayer)}moveTowardPlayer(){this.moveTowardCharacter(self.$gamePlayer)}moveAwayFromPlayer(){this.moveAwayFromCharacter(self.$gamePlayer)}moveForward(){this.moveStraight(this.direction())}moveBackward(){let t=this.isDirectionFixed();this.setDirectionFix(!0),this.moveStraight(this.reverseDir(this.direction())),this.setDirectionFix(t)}processRouteEnd(){this._moveRoute.repeat?this._moveRouteIndex=-1:this._moveRouteForcing&&(this._moveRouteForcing=!1,this.restoreMoveRoute())}advanceMoveRouteIndex(){let t=this._moveRoute;if(t&&(this.isMovementSucceeded()||t.skippable)){let e=t.list.length-1;this._moveRouteIndex++,t.repeat&&this._moveRouteIndex>=e&&(this._moveRouteIndex=0)}}turnRight90(){switch(this.direction()){case 2:this.setDirection(4);break;case 4:this.setDirection(8);break;case 6:this.setDirection(2);break;case 8:this.setDirection(6);break}}turnLeft90(){switch(this.direction()){case 2:this.setDirection(6);break;case 4:this.setDirection(2);break;case 6:this.setDirection(8);break;case 8:this.setDirection(4);break}}turn180(){this.setDirection(this.reverseDir(this.direction()))}turnRightOrLeft90(){switch(Math.randomInt(2)){case 0:this.turnRight90();break;case 1:this.turnLeft90();break}}turnRandom(){this.setDirection(2+Math.randomInt(4)*2)}swap(t){let e=t.x,i=t.y;t.locate(this.x,this.y),this.locate(e,i)}findDirectionTo(t,e){let i=this.searchLimit(),s=self.$gameMap.width(),a=[],r=[],h=[],c={},d=c;if(this.x===t&&this.y===e)return 0;for(c.parent=null,c.x=this.x,c.y=this.y,c.g=0,c.f=self.$gameMap.distance(c.x,c.y,t,e),a.push(c),r.push(c.y*s+c.x);a.length>0;){let B=0;for(let X=0;X<a.length;X++)a[X].f<a[B].f&&(B=X);let E=a[B],F=E.x,N=E.y,z=N*s+F,st=E.g;if(a.splice(B,1),r.splice(r.indexOf(z),1),h.push(z),E.x===t&&E.y===e){d=E;break}if(!(st>=i))for(let X=0;X<4;X++){let j=2+X*2,wt=self.$gameMap.roundXWithDirection(F,j),yt=self.$gameMap.roundYWithDirection(N,j),At=yt*s+wt;if(h.contains(At)||!this.canPass(F,N,j))continue;let Nt=st+1,Ht=r.indexOf(At);if(Ht<0||Nt<a[Ht].g){let lt;Ht>=0?lt=a[Ht]:(lt={},a.push(lt),r.push(At)),lt.parent=E,lt.x=wt,lt.y=yt,lt.g=Nt,lt.f=Nt+self.$gameMap.distance(wt,yt,t,e),(!d||lt.f-lt.g<d.f-d.g)&&(d=lt)}}}let u=d;for(;u.parent&&u.parent!==c;)u=u.parent;let f=self.$gameMap.deltaX(u.x,c.x),y=self.$gameMap.deltaY(u.y,c.y);if(y>0)return 2;if(f<0)return 4;if(f>0)return 6;if(y<0)return 8;let P=this.deltaXFrom(t),$=this.deltaYFrom(e);return Math.abs(P)>Math.abs($)?P>0?4:6:$!==0?$>0?8:2:0}searchLimit(){return 12}};o(M,"Game_Character");M.ROUTE_END=0;M.ROUTE_MOVE_DOWN=1;M.ROUTE_MOVE_LEFT=2;M.ROUTE_MOVE_RIGHT=3;M.ROUTE_MOVE_UP=4;M.ROUTE_MOVE_LOWER_L=5;M.ROUTE_MOVE_LOWER_R=6;M.ROUTE_MOVE_UPPER_L=7;M.ROUTE_MOVE_UPPER_R=8;M.ROUTE_MOVE_RANDOM=9;M.ROUTE_MOVE_TOWARD=10;M.ROUTE_MOVE_AWAY=11;M.ROUTE_MOVE_FORWARD=12;M.ROUTE_MOVE_BACKWARD=13;M.ROUTE_JUMP=14;M.ROUTE_WAIT=15;M.ROUTE_TURN_DOWN=16;M.ROUTE_TURN_LEFT=17;M.ROUTE_TURN_RIGHT=18;M.ROUTE_TURN_UP=19;M.ROUTE_TURN_90D_R=20;M.ROUTE_TURN_90D_L=21;M.ROUTE_TURN_180D=22;M.ROUTE_TURN_90D_R_L=23;M.ROUTE_TURN_RANDOM=24;M.ROUTE_TURN_TOWARD=25;M.ROUTE_TURN_AWAY=26;M.ROUTE_SWITCH_ON=27;M.ROUTE_SWITCH_OFF=28;M.ROUTE_CHANGE_SPEED=29;M.ROUTE_CHANGE_FREQ=30;M.ROUTE_WALK_ANIME_ON=31;M.ROUTE_WALK_ANIME_OFF=32;M.ROUTE_STEP_ANIME_ON=33;M.ROUTE_STEP_ANIME_OFF=34;M.ROUTE_DIR_FIX_ON=35;M.ROUTE_DIR_FIX_OFF=36;M.ROUTE_THROUGH_ON=37;M.ROUTE_THROUGH_OFF=38;M.ROUTE_TRANSPARENT_ON=39;M.ROUTE_TRANSPARENT_OFF=40;M.ROUTE_CHANGE_IMAGE=41;M.ROUTE_CHANGE_OPACITY=42;M.ROUTE_CHANGE_BLEND_MODE=43;M.ROUTE_PLAY_SE=44;M.ROUTE_SCRIPT=45;var nt=M;var Fa=class extends Zt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){this._windowWidth=t,this._purchaseOnly=e,super.initialize(0,0)}windowWidth(){return this._windowWidth}maxCols(){return 3}makeCommandList(){this.addCommand(m.buy,"buy"),this.addCommand(m.sell,"sell",!this._purchaseOnly),this.addCommand(m.cancel,"cancel")}};o(Fa,"Window_ShopCommand");var Da=Fa;var La=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){let a=this.windowWidth();super.initialize(t,e,a,i),this._shopGoods=s,this._money=0,this.refresh(),this.select(0)}windowWidth(){return 456}maxItems(){return this._data?this._data.length:1}item(){return this._data[this.index()]}setMoney(t){this._money=t,this.refresh()}isCurrentItemEnabled(){return this.isEnabled(this._data[this.index()])}price(t){return this._price[this._data.indexOf(t)]||0}isEnabled(t){return t&&this.price(t)<=this._money&&!self.$gameParty.hasMaxItems(t)}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}makeItemList(){this._data=[],this._price=[],this._shopGoods.forEach(function(t){let e=null;switch(t[0]){case 0:e=self.$dataItems[t[1]];break;case 1:e=self.$dataWeapons[t[1]];break;case 2:e=self.$dataArmors[t[1]];break}e&&(this._data.push(e),this._price.push(t[2]===0?e.price:t[3]))},this)}drawItem(t){let e=this._data[t],i=this.itemRect(t),s=96;i.width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,i.x,i.y,i.width-s),this.drawText(this.price(e),i.x+i.width-s,i.y,s,"right"),this.changePaintOpacity(!0)}setStatusWindow(t){this._statusWindow=t,this.callUpdateHelp()}updateHelp(){this.setHelpWindowItem(this.item()),this._statusWindow&&this._statusWindow.setItem(this.item())}};o(La,"Window_ShopBuy");var Oa=La;var Na=class extends vt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s)}isEnabled(t){return t&&t.price>0}};o(Na,"Window_ShopSell");var Ha=Na;var za=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i){let s=this.windowWidth();super.initialize(t,e,s,i),this._item=null,this._max=1,this._price=0,this._number=1,this._currencyUnit=m.currencyUnit,this.createButtons()}windowWidth(){return 456}number(){return this._number}setup(t,e,i){this._item=t,this._max=Math.floor(e),this._price=i,this._number=1,this.placeButtons(),this.updateButtonsVisiblity(),this.refresh()}setCurrencyUnit(t){this._currencyUnit=t,this.refresh()}createButtons(){let t=p.loadSystem("ButtonSet"),e=48,i=48;this._buttons=[];for(let s=0;s<5;s++){let a=new ce,r=e*s,h=e*(s===4?2:1);a.bitmap=t,a.setColdFrame(r,0,h,i),a.setHotFrame(r,i,h,i),a.visible=!1,this._buttons.push(a),this.addChild(a)}this._buttons[0].setClickHandler(this.onButtonDown2.bind(this)),this._buttons[1].setClickHandler(this.onButtonDown.bind(this)),this._buttons[2].setClickHandler(this.onButtonUp.bind(this)),this._buttons[3].setClickHandler(this.onButtonUp2.bind(this)),this._buttons[4].setClickHandler(this.onButtonOk.bind(this))}placeButtons(){let t=this._buttons.length,e=16,i=-e;for(let a=0;a<t;a++)i+=this._buttons[a].width+e;let s=(this.width-i)/2;for(let a=0;a<t;a++){let r=this._buttons[a];r.x=s,r.y=this.buttonY(),s+=r.width+e}}updateButtonsVisiblity(){k.date>x.date?this.showButtons():this.hideButtons()}showButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!0}hideButtons(){for(let t=0;t<this._buttons.length;t++)this._buttons[t].visible=!1}refresh(){this.contents.clear(),this.drawItemName(this._item,0,this.itemY()),this.drawMultiplicationSign(),this.drawNumber(),this.drawTotalPrice()}drawMultiplicationSign(){let t="\xD7",e=this.textWidth(t),i=this.cursorX()-e*2,s=this.itemY();this.resetTextColor(),this.drawText(t,i,s,e)}drawNumber(){let t=this.cursorX(),e=this.itemY(),i=this.cursorWidth()-this.textPadding();this.resetTextColor(),this.drawText(this._number,t,e,i,"right")}drawTotalPrice(){let t=this._price*this._number,e=this.contentsWidth()-this.textPadding();this.drawCurrencyValue(t,this._currencyUnit,0,this.priceY(),e)}itemY(){return Math.round(this.contentsHeight()/2-this.lineHeight()*1.5)}priceY(){return Math.round(this.contentsHeight()/2+this.lineHeight()/2)}buttonY(){return Math.round(this.priceY()+this.lineHeight()*2.5)}cursorWidth(){let t=this.textWidth("0");return this.maxDigits()*t+this.textPadding()*2}cursorX(){return this.contentsWidth()-this.cursorWidth()-this.textPadding()}maxDigits(){return 2}update(){super.update(),this.processNumberChange()}isOkTriggered(){return x.isTriggered("ok")}playOkSound(){}processNumberChange(){this.isOpenAndActive()&&(x.isRepeated("right")&&this.changeNumber(1),x.isRepeated("left")&&this.changeNumber(-1),x.isRepeated("up")&&this.changeNumber(10),x.isRepeated("down")&&this.changeNumber(-10))}changeNumber(t){let e=this._number;this._number=(this._number+t).clamp(1,this._max),this._number!==e&&(S.playCursor(),this.refresh())}updateCursor(){this.setCursorRect(this.cursorX(),this.itemY(),this.cursorWidth(),this.lineHeight())}onButtonUp(){this.changeNumber(1)}onButtonUp2(){this.changeNumber(10)}onButtonDown(){this.changeNumber(-1)}onButtonDown2(){this.changeNumber(-10)}onButtonOk(){this.processOk()}};o(za,"Window_ShopNumber");var Va=za;var qa=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e,i,s){super.initialize(t,e,i,s),this._item=null,this._pageIndex=0,this.refresh()}refresh(){if(this.contents.clear(),this._item){let t=this.textPadding();this.drawPossession(t,0),this.isEquipItem()&&this.drawEquipInfo(t,this.lineHeight()*2)}}setItem(t){this._item=t,this.refresh()}isEquipItem(){return w.isWeapon(this._item)||w.isArmor(this._item)}drawPossession(t,e){let i=this.contents.width-this.textPadding()-t,s=this.textWidth("0000");this.changeTextColor(this.systemColor()),this.drawText(m.possession,t,e,i-s),this.resetTextColor(),this.drawText(self.$gameParty.numItems(this._item),t,e,i,"right")}drawEquipInfo(t,e){let i=this.statusMembers();for(let s=0;s<i.length;s++)this.drawActorEquipInfo(t,e+this.lineHeight()*(s*2.4),i[s])}statusMembers(){let t=this._pageIndex*this.pageSize(),e=t+this.pageSize();return self.$gameParty.members().slice(t,e)}pageSize(){return 4}maxPages(){return Math.floor((self.$gameParty.size()+this.pageSize()-1)/this.pageSize())}drawActorEquipInfo(t,e,i){let s=i.canEquip(this._item);this.changePaintOpacity(s),this.resetTextColor(),this.drawText(i.name(),t,e,168);let a=this.currentEquippedItem(i,this._item.etypeId);s&&this.drawActorParamChange(t,e,i,a),this.drawItemName(a,t,e+this.lineHeight()),this.changePaintOpacity(!0)}drawActorParamChange(t,e,i,s){let a=this.contents.width-this.textPadding()-t,r=this.paramId(),h=this._item.params[r]-(s?s.params[r]:0);this.changeTextColor(this.paramchangeTextColor(h)),this.drawText((h>0?"+":"")+h,t,e,a,"right")}paramId(){return w.isWeapon(this._item)?2:3}currentEquippedItem(t,e){let i=[],s=t.equips(),a=t.equipSlots();for(let d=0;d<a.length;d++)a[d]===e&&i.push(s[d]);let r=this.paramId(),h=Number.MAX_VALUE,c=null;for(let d=0;d<i.length;d++)i[d]&&i[d].params[r]<h&&(h=i[d].params[r],c=i[d]);return c}update(){super.update(),this.updatePage()}updatePage(){this.isPageChangeEnabled()&&this.isPageChangeRequested()&&this.changePage()}isPageChangeEnabled(){return this.visible&&this.maxPages()>=2}isPageChangeRequested(){return!!(x.isTriggered("shift")||k.isTriggered()&&this.isTouchedInsideFrame())}isTouchedInsideFrame(){let t=this.canvasToLocalX(k.x),e=this.canvasToLocalY(k.y);return t>=0&&e>=0&&t<this.width&&e<this.height}changePage(){this._pageIndex=(this._pageIndex+1)%this.maxPages(),this.refresh(),S.playCursor()}};o(qa,"Window_ShopStatus");var Ua=qa;var Xa=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}prepare(t,e){this._goods=t,this._purchaseOnly=e,this._item=null}create(){super.create(),this.createHelpWindow(),this.createGoldWindow(),this.createCommandWindow(),this.createDummyWindow(),this.createNumberWindow(),this.createStatusWindow(),this.createBuyWindow(),this.createCategoryWindow(),this.createSellWindow()}createGoldWindow(){this._goldWindow=new Yt(0,this._helpWindow.height),this._goldWindow.x=l.boxWidth-this._goldWindow.width,this.addWindow(this._goldWindow)}createCommandWindow(){this._commandWindow=new Da(this._goldWindow.x,this._purchaseOnly),this._commandWindow.y=this._helpWindow.height,this._commandWindow.setHandler("buy",this.commandBuy.bind(this)),this._commandWindow.setHandler("sell",this.commandSell.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)}createDummyWindow(){let t=this._commandWindow.y+this._commandWindow.height,e=l.boxHeight-t;this._dummyWindow=new H(0,t,l.boxWidth,e),this.addWindow(this._dummyWindow)}createNumberWindow(){let t=this._dummyWindow.y,e=this._dummyWindow.height;this._numberWindow=new Va(0,t,e),this._numberWindow.hide(),this._numberWindow.setHandler("ok",this.onNumberOk.bind(this)),this._numberWindow.setHandler("cancel",this.onNumberCancel.bind(this)),this.addWindow(this._numberWindow)}createStatusWindow(){let t=this._numberWindow.width,e=this._dummyWindow.y,i=l.boxWidth-t,s=this._dummyWindow.height;this._statusWindow=new Ua(t,e,i,s),this._statusWindow.hide(),this.addWindow(this._statusWindow)}createBuyWindow(){let t=this._dummyWindow.y,e=this._dummyWindow.height;this._buyWindow=new Oa(0,t,e,this._goods),this._buyWindow.setHelpWindow(this._helpWindow),this._buyWindow.setStatusWindow(this._statusWindow),this._buyWindow.hide(),this._buyWindow.setHandler("ok",this.onBuyOk.bind(this)),this._buyWindow.setHandler("cancel",this.onBuyCancel.bind(this)),this.addWindow(this._buyWindow)}createCategoryWindow(){this._categoryWindow=new ge,this._categoryWindow.setHelpWindow(this._helpWindow),this._categoryWindow.y=this._dummyWindow.y,this._categoryWindow.hide(),this._categoryWindow.deactivate(),this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this)),this._categoryWindow.setHandler("cancel",this.onCategoryCancel.bind(this)),this.addWindow(this._categoryWindow)}createSellWindow(){let t=this._categoryWindow.y+this._categoryWindow.height,e=l.boxHeight-t;this._sellWindow=new Ha(0,t,l.boxWidth,e),this._sellWindow.setHelpWindow(this._helpWindow),this._sellWindow.hide(),this._sellWindow.setHandler("ok",this.onSellOk.bind(this)),this._sellWindow.setHandler("cancel",this.onSellCancel.bind(this)),this._categoryWindow.setItemWindow(this._sellWindow),this.addWindow(this._sellWindow)}activateBuyWindow(){this._buyWindow.setMoney(this.money()),this._buyWindow.show(),this._buyWindow.activate(),this._statusWindow.show()}activateSellWindow(){this._categoryWindow.show(),this._sellWindow.refresh(),this._sellWindow.show(),this._sellWindow.activate(),this._statusWindow.hide()}commandBuy(){this._dummyWindow.hide(),this.activateBuyWindow()}commandSell(){this._dummyWindow.hide(),this._categoryWindow.show(),this._categoryWindow.activate(),this._sellWindow.show(),this._sellWindow.deselect(),this._sellWindow.refresh()}onBuyOk(){this._item=this._buyWindow.item(),this._buyWindow.hide(),this._numberWindow.setup(this._item,this.maxBuy(),this.buyingPrice()),this._numberWindow.setCurrencyUnit(this.currencyUnit()),this._numberWindow.show(),this._numberWindow.activate()}onBuyCancel(){this._commandWindow.activate(),this._dummyWindow.show(),this._buyWindow.hide(),this._statusWindow.hide(),this._statusWindow.setItem(null),this._helpWindow.clear()}onCategoryOk(){this.activateSellWindow(),this._sellWindow.select(0)}onCategoryCancel(){this._commandWindow.activate(),this._dummyWindow.show(),this._categoryWindow.hide(),this._sellWindow.hide()}onSellOk(){this._item=this._sellWindow.item(),this._categoryWindow.hide(),this._sellWindow.hide(),this._numberWindow.setup(this._item,this.maxSell(),this.sellingPrice()),this._numberWindow.setCurrencyUnit(this.currencyUnit()),this._numberWindow.show(),this._numberWindow.activate(),this._statusWindow.setItem(this._item),this._statusWindow.show()}onSellCancel(){this._sellWindow.deselect(),this._categoryWindow.activate(),this._statusWindow.setItem(null),this._helpWindow.clear()}onNumberOk(){switch(S.playShop(),this._commandWindow.currentSymbol()){case"buy":this.doBuy(this._numberWindow.number());break;case"sell":this.doSell(this._numberWindow.number());break}this.endNumberInput(),this._goldWindow.refresh(),this._statusWindow.refresh()}onNumberCancel(){S.playCancel(),this.endNumberInput()}doBuy(t){self.$gameParty.loseGold(t*this.buyingPrice()),self.$gameParty.gainItem(this._item,t)}doSell(t){self.$gameParty.gainGold(t*this.sellingPrice()),self.$gameParty.loseItem(this._item,t)}endNumberInput(){switch(this._numberWindow.hide(),this._commandWindow.currentSymbol()){case"buy":this.activateBuyWindow();break;case"sell":this.activateSellWindow();break}}maxBuy(){let t=self.$gameParty.maxItems(this._item)-self.$gameParty.numItems(this._item),e=this.buyingPrice();return e>0?Math.min(t,Math.floor(this.money()/e)):t}maxSell(){return self.$gameParty.numItems(this._item)}money(){return this._goldWindow.value()}currencyUnit(){return this._goldWindow.currencyUnit()}buyingPrice(){return this._buyWindow.price(this._item)}sellingPrice(){return Math.floor(this._item.price/2)}};o(Xa,"Scene_Shop");var Ga=Xa;var Ya=class extends H{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){let i=this.windowWidth(),s=this.windowHeight(),a=(l.boxWidth-i)/2,r=(l.boxHeight-(s+this.fittingHeight(9)+8))/2;super.initialize(a,r,i,s),this._actor=t,this._name=t.name().slice(0,this._maxLength),this._index=this._name.length,this._maxLength=e,this._defaultName=this._name,this.deactivate(),this.refresh(),p.reserveFace(t.faceName())}windowWidth(){return 480}windowHeight(){return this.fittingHeight(4)}name(){return this._name}restoreDefault(){return this._name=this._defaultName,this._index=this._name.length,this.refresh(),this._name.length>0}add(t){return this._index<this._maxLength?(this._name+=t,this._index++,this.refresh(),!0):!1}back(){return this._index>0?(this._index--,this._name=this._name.slice(0,this._index),this.refresh(),!0):!1}faceWidth(){return 144}charWidth(){let t=self.$gameSystem.isJapanese()?"\uFF21":"A";return this.textWidth(t)}left(){let t=(this.contentsWidth()+this.faceWidth())/2,e=(this._maxLength+1)*this.charWidth();return Math.min(t-e/2,this.contentsWidth()-e)}itemRect(t){return{x:this.left()+t*this.charWidth(),y:54,width:this.charWidth(),height:this.lineHeight()}}underlineRect(t){let e=this.itemRect(t);return e.x++,e.y+=e.height-4,e.width-=2,e.height=2,e}underlineColor(){return this.normalColor()}drawUnderline(t){let e=this.underlineRect(t),i=this.underlineColor();this.contents.paintOpacity=48,this.contents.fillRect(e.x,e.y,e.width,e.height,i),this.contents.paintOpacity=255}drawChar(t){let e=this.itemRect(t);this.resetTextColor(),this.drawText(this._name[t]||"",e.x,e.y)}refresh(){this.contents.clear(),this.drawActorFace(this._actor,0,0);for(let e=0;e<this._maxLength;e++)this.drawUnderline(e);for(let e=0;e<this._name.length;e++)this.drawChar(e);let t=this.itemRect(this._index);this.setCursorRect(t.x,t.y,t.width,t.height)}};o(Ya,"Window_NameEdit");var ja=Ya;var ot=class extends D{constructor(...t){super(...t),this.initialize(...t)}initialize(t){let e=t.x,i=t.y+t.height+8,s=t.width,a=this.windowHeight();super.initialize(e,i,s,a),this._editWindow=t,this._page=0,this._index=0,this.refresh(),this.updateCursor(),this.activate()}windowHeight(){return this.fittingHeight(9)}table(){return self.$gameSystem.isJapanese()?[ot.JAPAN1,ot.JAPAN2,ot.JAPAN3]:self.$gameSystem.isRussian()?[ot.RUSSIA]:[ot.LATIN1,ot.LATIN2]}maxCols(){return 10}maxItems(){return 90}character(){return this._index<88?this.table()[this._page][this._index]:""}isPageChange(){return this._index===88}isOk(){return this._index===89}itemRect(t){return{x:t%10*42+Math.floor(t%10/5)*24,y:Math.floor(t/10)*this.lineHeight(),width:42,height:this.lineHeight()}}refresh(){let t=this.table();this.contents.clear(),this.resetTextColor();for(let e=0;e<90;e++){let i=this.itemRect(e);i.x+=3,i.width-=6,this.drawText(t[this._page][e],i.x,i.y,i.width,"center")}}updateCursor(){let t=this.itemRect(this._index);this.setCursorRect(t.x,t.y,t.width,t.height)}isCursorMovable(){return this.active}cursorDown(t){(this._index<80||t)&&(this._index=(this._index+10)%90)}cursorUp(t){(this._index>=10||t)&&(this._index=(this._index+80)%90)}cursorRight(t){this._index%10<9?this._index++:t&&(this._index-=9)}cursorLeft(t){this._index%10>0?this._index--:t&&(this._index+=9)}cursorPagedown(){this._page=(this._page+1)%this.table().length,this.refresh()}cursorPageup(){this._page=(this._page+this.table().length-1)%this.table().length,this.refresh()}processCursorMove(){let t=this._page;super.processCursorMove(),this.updateCursor(),this._page!==t&&S.playCursor()}processHandling(){this.isOpen()&&this.active&&(x.isTriggered("shift")&&this.processJump(),x.isRepeated("cancel")&&this.processBack(),x.isRepeated("ok")&&this.processOk())}isCancelEnabled(){return!0}processCancel(){this.processBack()}processJump(){this._index!==89&&(this._index=89,S.playCursor())}processBack(){this._editWindow.back()&&S.playCancel()}processOk(){this.character()?this.onNameAdd():this.isPageChange()?(S.playOk(),this.cursorPagedown()):this.isOk()&&this.onNameOk()}onNameAdd(){this._editWindow.add(this.character())?S.playOk():S.playBuzzer()}onNameOk(){this._editWindow.name()===""?this._editWindow.restoreDefault()?S.playOk():S.playBuzzer():(S.playOk(),this.callOkHandler())}};o(ot,"Window_NameInput");ot.LATIN1=["A","B","C","D","E","a","b","c","d","e","F","G","H","I","J","f","g","h","i","j","K","L","M","N","O","k","l","m","n","o","P","Q","R","S","T","p","q","r","s","t","U","V","W","X","Y","u","v","w","x","y","Z","[","]","^","_","z","{","}","|","~","0","1","2","3","4","!","#","$","%","&","5","6","7","8","9","(",")","*","+","-","/","=","@","<",">",":",";"," ","Page","OK"];ot.LATIN2=["\xC1","\xC9","\xCD","\xD3","\xDA","\xE1","\xE9","\xED","\xF3","\xFA","\xC0","\xC8","\xCC","\xD2","\xD9","\xE0","\xE8","\xEC","\xF2","\xF9","\xC2","\xCA","\xCE","\xD4","\xDB","\xE2","\xEA","\xEE","\xF4","\xFB","\xC4","\xCB","\xCF","\xD6","\xDC","\xE4","\xEB","\xEF","\xF6","\xFC","\u0100","\u0112","\u012A","\u014C","\u016A","\u0101","\u0113","\u012B","\u014D","\u016B","\xC3","\xC5","\xC6","\xC7","\xD0","\xE3","\xE5","\xE6","\xE7","\xF0","\xD1","\xD5","\xD8","\u0160","\u0174","\xF1","\xF5","\xF8","\u0161","\u0175","\xDD","\u0176","\u0178","\u017D","\xDE","\xFD","\xFF","\u0177","\u017E","\xFE","\u0132","\u0152","\u0133","\u0153","\xDF","\xAB","\xBB"," ","Page","OK"];ot.RUSSIA=["\u0410","\u0411","\u0412","\u0413","\u0414","\u0430","\u0431","\u0432","\u0433","\u0434","\u0415","\u0401","\u0416","\u0417","\u0418","\u0435","\u0451","\u0436","\u0437","\u0438","\u0419","\u041A","\u041B","\u041C","\u041D","\u0439","\u043A","\u043B","\u043C","\u043D","\u041E","\u041F","\u0420","\u0421","\u0422","\u043E","\u043F","\u0440","\u0441","\u0442","\u0423","\u0424","\u0425","\u0426","\u0427","\u0443","\u0444","\u0445","\u0446","\u0447","\u0428","\u0429","\u042A","\u042B","\u042C","\u0448","\u0449","\u044A","\u044B","\u044C","\u042D","\u042E","\u042F","^","_","\u044D","\u044E","\u044F","%","&","0","1","2","3","4","(",")","*","+","-","5","6","7","8","9",":",";"," ","","OK"];ot.JAPAN1=["\u3042","\u3044","\u3046","\u3048","\u304A","\u304C","\u304E","\u3050","\u3052","\u3054","\u304B","\u304D","\u304F","\u3051","\u3053","\u3056","\u3058","\u305A","\u305C","\u305E","\u3055","\u3057","\u3059","\u305B","\u305D","\u3060","\u3062","\u3065","\u3067","\u3069","\u305F","\u3061","\u3064","\u3066","\u3068","\u3070","\u3073","\u3076","\u3079","\u307C","\u306A","\u306B","\u306C","\u306D","\u306E","\u3071","\u3074","\u3077","\u307A","\u307D","\u306F","\u3072","\u3075","\u3078","\u307B","\u3041","\u3043","\u3045","\u3047","\u3049","\u307E","\u307F","\u3080","\u3081","\u3082","\u3063","\u3083","\u3085","\u3087","\u308E","\u3084","\u3086","\u3088","\u308F","\u3093","\u30FC","\uFF5E","\u30FB","\uFF1D","\u2606","\u3089","\u308A","\u308B","\u308C","\u308D","\u3094","\u3092","\u3000","\u30AB\u30CA","\u6C7A\u5B9A"];ot.JAPAN2=["\u30A2","\u30A4","\u30A6","\u30A8","\u30AA","\u30AC","\u30AE","\u30B0","\u30B2","\u30B4","\u30AB","\u30AD","\u30AF","\u30B1","\u30B3","\u30B6","\u30B8","\u30BA","\u30BC","\u30BE","\u30B5","\u30B7","\u30B9","\u30BB","\u30BD","\u30C0","\u30C2","\u30C5","\u30C7","\u30C9","\u30BF","\u30C1","\u30C4","\u30C6","\u30C8","\u30D0","\u30D3","\u30D6","\u30D9","\u30DC","\u30CA","\u30CB","\u30CC","\u30CD","\u30CE","\u30D1","\u30D4","\u30D7","\u30DA","\u30DD","\u30CF","\u30D2","\u30D5","\u30D8","\u30DB","\u30A1","\u30A3","\u30A5","\u30A7","\u30A9","\u30DE","\u30DF","\u30E0","\u30E1","\u30E2","\u30C3","\u30E3","\u30E5","\u30E7","\u30EE","\u30E4","\u30E6","\u30E8","\u30EF","\u30F3","\u30FC","\uFF5E","\u30FB","\uFF1D","\u2606","\u30E9","\u30EA","\u30EB","\u30EC","\u30ED","\u30F4","\u30F2","\u3000","\u82F1\u6570","\u6C7A\u5B9A"];ot.JAPAN3=["\uFF21","\uFF22","\uFF23","\uFF24","\uFF25","\uFF41","\uFF42","\uFF43","\uFF44","\uFF45","\uFF26","\uFF27","\uFF28","\uFF29","\uFF2A","\uFF46","\uFF47","\uFF48","\uFF49","\uFF4A","\uFF2B","\uFF2C","\uFF2D","\uFF2E","\uFF2F","\uFF4B","\uFF4C","\uFF4D","\uFF4E","\uFF4F","\uFF30","\uFF31","\uFF32","\uFF33","\uFF34","\uFF50","\uFF51","\uFF52","\uFF53","\uFF54","\uFF35","\uFF36","\uFF37","\uFF38","\uFF39","\uFF55","\uFF56","\uFF57","\uFF58","\uFF59","\uFF3A","\uFF3B","\uFF3D","\uFF3E","\uFF3F","\uFF5A","\uFF5B","\uFF5D","\uFF5C","\uFF5E","\uFF10","\uFF11","\uFF12","\uFF13","\uFF14","\uFF01","\uFF03","\uFF04","\uFF05","\uFF06","\uFF15","\uFF16","\uFF17","\uFF18","\uFF19","\uFF08","\uFF09","\uFF0A","\uFF0B","\uFF0D","\uFF0F","\uFF1D","\uFF20","\uFF1C","\uFF1E","\uFF1A","\uFF1B","\u3000","\u304B\u306A","\u6C7A\u5B9A"];var Ka=ot;var Za=class extends Y{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize()}prepare(t,e){this._actorId=t,this._maxLength=e}create(){super.create(),this._actor=self.$gameActors.actor(this._actorId),this.createEditWindow(),this.createInputWindow()}start(){super.start(),this._editWindow.refresh()}createEditWindow(){this._editWindow=new ja(this._actor,this._maxLength),this.addWindow(this._editWindow)}createInputWindow(){this._inputWindow=new Ka(this._editWindow),this._inputWindow.setHandler("ok",this.onInputOk.bind(this)),this.addWindow(this._inputWindow)}onInputOk(){this._actor.setName(this._editWindow.name()),this.popScene()}};o(Za,"Scene_Name");var Ja=Za;var Q=class{constructor(...t){this.initialize(...t)}initialize(t){this._depth=t||0,this.checkOverflow(),this.clear(),this._branch={},this._params=[],this._indent=0,this._frameCount=0,this._freezeChecker=0}checkOverflow(){if(this._depth>=100)throw new Error("Common event calls exceeded the limit")}clear(){this._mapId=0,this._eventId=0,this._list=null,this._index=0,this._waitCount=0,this._waitMode="",this._comments="",this._eventInfo=null,this._character=null,this._childInterpreter=null}setup(t,e){this.clear(),this._mapId=self.$gameMap.mapId(),this._eventId=e||0,this._list=t,Q.requestImages(t)}eventId(){return this._eventId}isOnCurrentMap(){return this._mapId===self.$gameMap.mapId()}setEventInfo(t){this._eventInfo=t}setupReservedCommonEvent(){return self.$gameTemp.isCommonEventReserved()?(this.setup(self.$gameTemp.reservedCommonEvent().list),this.setEventInfo({eventType:"common_event",commonEventId:self.$gameTemp.reservedCommonEventId()}),self.$gameTemp.clearCommonEvent(),!0):!1}isRunning(){return!!this._list}update(){for(;this.isRunning()&&!(this.updateChild()||this.updateWait()||g.isSceneChanging()||!this.executeCommand()||this.checkFreeze()););}updateChild(){if(this._childInterpreter){if(this._childInterpreter.update(),this._childInterpreter.isRunning())return!0;this._childInterpreter=null}return!1}updateWait(){return this.updateWaitCount()||this.updateWaitMode()}updateWaitCount(){return this._waitCount>0?(this._waitCount--,!0):!1}updateWaitMode(){let t=!1;switch(this._waitMode){case"message":t=self.$gameMessage.isBusy();break;case"transfer":t=self.$gamePlayer.isTransferring();break;case"scroll":t=self.$gameMap.isScrolling();break;case"route":t=this._character.isMoveRouteForcing();break;case"animation":t=this._character.isAnimationPlaying();break;case"balloon":t=this._character.isBalloonPlaying();break;case"gather":t=self.$gamePlayer.areFollowersGathering();break;case"action":t=v.isActionForced();break;case"video":t=l.isVideoPlaying();break;case"image":t=!p.isReady();break}return t||(this._waitMode=""),t}setWaitMode(t){this._waitMode=t}wait(t){this._waitCount=t}fadeSpeed(){return 24}executeCommand(){let t=this.currentCommand();if(t){this._params=t.parameters,this._indent=t.indent;let e=`command${t.code}`;if(typeof this[e]=="function")try{if(!this[e]())return!1}catch(i){for(let s in this._eventInfo)i[s]=this._eventInfo[s];throw i.eventCommand=i.eventCommand||"other",i.line=i.line||this._index+1,i}this._index++}else this.terminate();return!0}checkFreeze(){return this._frameCount!==l.frameCount&&(this._frameCount=l.frameCount,this._freezeChecker=0),this._freezeChecker++>=1e5}terminate(){this._list=null,this._comments=""}skipBranch(){for(;this._list[this._index+1].indent>this._indent;)this._index++}currentCommand(){return this._list[this._index]}nextEventCode(){let t=this._list[this._index+1];return t?t.code:0}iterateActorId(t,e){if(t===0)self.$gameParty.members().forEach(e);else{let i=self.$gameActors.actor(t);i&&e(i)}}iterateActorEx(t,e,i){t===0?this.iterateActorId(e,i):this.iterateActorId(self.$gameVariables.value(e),i)}iterateActorIndex(t,e){if(t<0)self.$gameParty.members().forEach(e);else{let i=self.$gameParty.members()[t];i&&e(i)}}iterateEnemyIndex(t,e){if(t<0)self.$gameTroop.members().forEach(e);else{let i=self.$gameTroop.members()[t];i&&e(i)}}iterateBattler(t,e,i){self.$gameParty.inBattle()&&(t===0?this.iterateEnemyIndex(e,i):this.iterateActorId(e,i))}character(t){return self.$gameParty.inBattle()?null:t<0?self.$gamePlayer:this.isOnCurrentMap()?self.$gameMap.event(t>0?t:this._eventId):null}operateValue(t,e,i){let s=e===0?i:self.$gameVariables.value(i);return t===0?s:-s}changeHp(t,e,i){t.isAlive()&&(!i&&t.hp<=-e&&(e=1-t.hp),t.gainHp(e),t.isDead()&&t.performCollapse())}command101(){if(!self.$gameMessage.isBusy()){for(self.$gameMessage.setFaceImage(this._params[0],this._params[1]),self.$gameMessage.setBackground(this._params[2]),self.$gameMessage.setPositionType(this._params[3]);this.nextEventCode()===401;)this._index++,self.$gameMessage.add(this.currentCommand().parameters[0]);switch(this.nextEventCode()){case 102:this._index++,this.setupChoices(this.currentCommand().parameters);break;case 103:this._index++,this.setupNumInput(this.currentCommand().parameters);break;case 104:this._index++,this.setupItemChoice(this.currentCommand().parameters);break}this._index++,this.setWaitMode("message")}return!1}command102(){return self.$gameMessage.isBusy()||(this.setupChoices(this._params),this._index++,this.setWaitMode("message")),!1}setupChoices(t){let e=t[0].clone(),i=t[1],s=t.length>2?t[2]:0,a=t.length>3?t[3]:2,r=t.length>4?t[4]:0;i>=e.length&&(i=-2),self.$gameMessage.setChoices(e,s,i),self.$gameMessage.setChoiceBackground(r),self.$gameMessage.setChoicePositionType(a),self.$gameMessage.setChoiceCallback(h=>{this._branch[this._indent]=h})}command402(){return this._branch[this._indent]!==this._params[0]&&this.skipBranch(),!0}command403(){return this._branch[this._indent]>=0&&this.skipBranch(),!0}command103(){return self.$gameMessage.isBusy()||(this.setupNumInput(this._params),this._index++,this.setWaitMode("message")),!1}setupNumInput(t){self.$gameMessage.setNumberInput(t[0],t[1])}command104(){return self.$gameMessage.isBusy()||(this.setupItemChoice(this._params),this._index++,this.setWaitMode("message")),!1}setupItemChoice(t){self.$gameMessage.setItemChoice(t[0],t[1]||2)}command105(){if(!self.$gameMessage.isBusy()){for(self.$gameMessage.setScroll(this._params[0],this._params[1]);this.nextEventCode()===405;)this._index++,self.$gameMessage.add(this.currentCommand().parameters[0]);this._index++,this.setWaitMode("message")}return!1}command108(){for(this._comments=[this._params[0]];this.nextEventCode()===408;)this._index++,this._comments.push(this.currentCommand().parameters[0]);return!0}command111(){let t=!1;switch(this._params[0]){case 0:t=self.$gameSwitches.value(this._params[1])===(this._params[2]===0);break;case 1:let e=self.$gameVariables.value(this._params[1]),i;switch(this._params[2]===0?i=this._params[3]:i=self.$gameVariables.value(this._params[3]),this._params[4]){case 0:t=e===i;break;case 1:t=e>=i;break;case 2:t=e<=i;break;case 3:t=e>i;break;case 4:t=e<i;break;case 5:t=e!==i;break}break;case 2:if(this._eventId>0){let h=[this._mapId,this._eventId,this._params[1]];t=self.$gameSelfSwitches.value(h)===(this._params[2]===0)}break;case 3:self.$gameTimer.isWorking()&&(this._params[2]===0?t=self.$gameTimer.seconds()>=this._params[1]:t=self.$gameTimer.seconds()<=this._params[1]);break;case 4:let s=self.$gameActors.actor(this._params[1]);if(s){let h=this._params[3];switch(this._params[2]){case 0:t=self.$gameParty.members().contains(s);break;case 1:t=s.name()===h;break;case 2:t=s.isClass(self.$dataClasses[h]);break;case 3:t=s.hasSkill(h);break;case 4:t=s.hasWeapon(self.$dataWeapons[h]);break;case 5:t=s.hasArmor(self.$dataArmors[h]);break;case 6:t=s.isStateAffected(h);break}}break;case 5:let a=self.$gameTroop.members()[this._params[1]];if(a)switch(this._params[2]){case 0:t=a.isAlive();break;case 1:t=a.isStateAffected(this._params[3]);break}break;case 6:let r=this.character(this._params[1]);r&&(t=r.direction()===this._params[2]);break;case 7:switch(this._params[2]){case 0:t=self.$gameParty.gold()>=this._params[1];break;case 1:t=self.$gameParty.gold()<=this._params[1];break;case 2:t=self.$gameParty.gold()<this._params[1];break}break;case 8:t=self.$gameParty.hasItem(self.$dataItems[this._params[1]]);break;case 9:t=self.$gameParty.hasItem(self.$dataWeapons[this._params[1]],this._params[2]);break;case 10:t=self.$gameParty.hasItem(self.$dataArmors[this._params[1]],this._params[2]);break;case 11:t=x.isPressed(this._params[1]);break;case 12:try{let h=this;t=new Function("{ context }","return !!"+this._params[1])({context:h})}catch(h){throw h.eventCommand="conditional_branch_script",h.content=this._params[1],h}break;case 13:t=self.$gamePlayer.vehicle()===self.$gameMap.vehicle(this._params[1]);break}return this._branch[this._indent]=t,this._branch[this._indent]===!1&&this.skipBranch(),!0}command411(){return this._branch[this._indent]!==!1&&this.skipBranch(),!0}command112(){return!0}command413(){do this._index--;while(this.currentCommand().indent!==this._indent);return!0}command113(){let t=0;for(;this._index<this._list.length-1;){this._index++;let e=this.currentCommand();if(e.code===112&&t++,e.code===413)if(t>0)t--;else break}return!0}command115(){return this._index=this._list.length,!0}command117(){let t=self.$dataCommonEvents[this._params[0]];if(t){let e=this.isOnCurrentMap()?this._eventId:0;this.setupChild(t.list,e)}return!0}setupChild(t,e){this._childInterpreter=new Q(this._depth+1),this._childInterpreter.setup(t,e),this._childInterpreter.setEventInfo({eventType:"common_event",commonEventId:this._params[0]})}command118(){return!0}command119(){let t=this._params[0];for(let e=0;e<this._list.length;e++){let i=this._list[e];if(i.code===118&&i.parameters[0]===t){this.jumpTo(e);return}}return!0}jumpTo(t){let e=this._index,i=Math.min(t,e),s=Math.max(t,e),a=this._indent;for(let r=i;r<=s;r++){let h=this._list[r].indent;h!==a&&(this._branch[a]=null,a=h)}this._index=t}command121(){for(let t=this._params[0];t<=this._params[1];t++)self.$gameSwitches.setValue(t,this._params[2]===0);return!0}command122(){let t=0;switch(this._params[3]){case 0:t=this._params[4];break;case 1:t=self.$gameVariables.value(this._params[4]);break;case 2:t=this._params[5]-this._params[4]+1;for(let e=this._params[0];e<=this._params[1];e++)this.operateVariable(e,this._params[2],this._params[4]+Math.randomInt(t));return!0;case 3:t=this.gameDataOperand(this._params[4],this._params[5],this._params[6]);break;case 4:try{let e=this;t=new Function("{ context }","return "+this._params[4])({context:e})}catch(e){throw e.eventCommand="control_variables",e.content=this._params[4],e}break}for(let e=this._params[0];e<=this._params[1];e++)this.operateVariable(e,this._params[2],t);return!0}gameDataOperand(t,e,i){switch(t){case 0:return self.$gameParty.numItems(self.$dataItems[e]);case 1:return self.$gameParty.numItems(self.$dataWeapons[e]);case 2:return self.$gameParty.numItems(self.$dataArmors[e]);case 3:let s=self.$gameActors.actor(e);if(s)switch(i){case 0:return s.level;case 1:return s.currentExp();case 2:return s.hp;case 3:return s.mp;default:if(i>=4&&i<=11)return s.param(i-4)}break;case 4:let a=self.$gameTroop.members()[e];if(a)switch(i){case 0:return a.hp;case 1:return a.mp;default:if(i>=2&&i<=9)return a.param(i-2)}break;case 5:let r=this.character(e);if(r)switch(i){case 0:return r.x;case 1:return r.y;case 2:return r.direction();case 3:return r.screenX();case 4:return r.screenY()}break;case 6:let h=self.$gameParty.members()[e];return h?h.actorId():0;case 7:switch(e){case 0:return self.$gameMap.mapId();case 1:return self.$gameParty.size();case 2:return self.$gameParty.gold();case 3:return self.$gameParty.steps();case 4:return self.$gameSystem.playtime();case 5:return self.$gameTimer.seconds();case 6:return self.$gameSystem.saveCount();case 7:return self.$gameSystem.battleCount();case 8:return self.$gameSystem.winCount();case 9:return self.$gameSystem.escapeCount()}break}return 0}operateVariable(t,e,i){try{let s=self.$gameVariables.value(t);switch(e){case 0:self.$gameVariables.setValue(t,s=i);break;case 1:self.$gameVariables.setValue(t,s+i);break;case 2:self.$gameVariables.setValue(t,s-i);break;case 3:self.$gameVariables.setValue(t,s*i);break;case 4:self.$gameVariables.setValue(t,s/i);break;case 5:self.$gameVariables.setValue(t,s%i);break}}catch{self.$gameVariables.setValue(t,0)}}command123(){if(this._eventId>0){let t=[this._mapId,this._eventId,this._params[0]];self.$gameSelfSwitches.setValue(t,this._params[1]===0)}return!0}command124(){return this._params[0]===0?self.$gameTimer.start(this._params[1]*60):self.$gameTimer.stop(),!0}command125(){let t=this.operateValue(this._params[0],this._params[1],this._params[2]);return self.$gameParty.gainGold(t),!0}command126(){let t=this.operateValue(this._params[1],this._params[2],this._params[3]);return self.$gameParty.gainItem(self.$dataItems[this._params[0]],t),!0}command127(){let t=this.operateValue(this._params[1],this._params[2],this._params[3]);return self.$gameParty.gainItem(self.$dataWeapons[this._params[0]],t,this._params[4]),!0}command128(){let t=this.operateValue(this._params[1],this._params[2],this._params[3]);return self.$gameParty.gainItem(self.$dataArmors[this._params[0]],t,this._params[4]),!0}command129(){return self.$gameActors.actor(this._params[0])&&(this._params[1]===0?(this._params[2]&&self.$gameActors.actor(this._params[0]).setup(this._params[0]),self.$gameParty.addActor(this._params[0])):self.$gameParty.removeActor(this._params[0])),!0}command132(){return self.$gameSystem.setBattleBgm(this._params[0]),!0}command133(){return self.$gameSystem.setVictoryMe(this._params[0]),!0}command134(){return this._params[0]===0?self.$gameSystem.disableSave():self.$gameSystem.enableSave(),!0}command135(){return this._params[0]===0?self.$gameSystem.disableMenu():self.$gameSystem.enableMenu(),!0}command136(){return this._params[0]===0?self.$gameSystem.disableEncounter():self.$gameSystem.enableEncounter(),self.$gamePlayer.makeEncounterCount(),!0}command137(){return this._params[0]===0?self.$gameSystem.disableFormation():self.$gameSystem.enableFormation(),!0}command138(){return self.$gameSystem.setWindowTone(this._params[0]),!0}command139(){return self.$gameSystem.setDefeatMe(this._params[0]),!0}command140(){let t=self.$gameMap.vehicle(this._params[0]);return t&&t.setBgm(this._params[1]),!0}command201(){if(!self.$gameParty.inBattle()&&!self.$gameMessage.isBusy()){let t,e,i;this._params[0]===0?(t=this._params[1],e=this._params[2],i=this._params[3]):(t=self.$gameVariables.value(this._params[1]),e=self.$gameVariables.value(this._params[2]),i=self.$gameVariables.value(this._params[3])),self.$gamePlayer.reserveTransfer(t,e,i,this._params[4],this._params[5]),this.setWaitMode("transfer"),this._index++}return!1}command202(){let t,e,i;this._params[1]===0?(t=this._params[2],e=this._params[3],i=this._params[4]):(t=self.$gameVariables.value(this._params[2]),e=self.$gameVariables.value(this._params[3]),i=self.$gameVariables.value(this._params[4]));let s=self.$gameMap.vehicle(this._params[0]);return s&&s.setLocation(t,e,i),!0}command203(){let t=this.character(this._params[0]);if(t){if(this._params[1]===0)t.locate(this._params[2],this._params[3]);else if(this._params[1]===1){let e=self.$gameVariables.value(this._params[2]),i=self.$gameVariables.value(this._params[3]);t.locate(e,i)}else{let e=this.character(this._params[2]);e&&t.swap(e)}this._params[4]>0&&t.setDirection(this._params[4])}return!0}command204(){if(!self.$gameParty.inBattle()){if(self.$gameMap.isScrolling())return this.setWaitMode("scroll"),!1;self.$gameMap.startScroll(this._params[0],this._params[1],this._params[2])}return!0}command205(){if(self.$gameMap.refreshIfNeeded(),this._character=this.character(this._params[0]),this._character){this._character.forceMoveRoute(this._params[1]);let t=Ft.makeDeepCopy(this._eventInfo);t.line=this._index+1,this._character.setCallerEventInfo(t),this._params[1].wait&&this.setWaitMode("route")}return!0}command206(){return self.$gamePlayer.getOnOffVehicle(),!0}command211(){return self.$gamePlayer.setTransparent(this._params[0]===0),!0}command212(){return this._character=this.character(this._params[0]),this._character&&(this._character.requestAnimation(this._params[1]),this._params[2]&&this.setWaitMode("animation")),!0}command213(){return this._character=this.character(this._params[0]),this._character&&(this._character.requestBalloon(this._params[1]),this._params[2]&&this.setWaitMode("balloon")),!0}command214(){return this.isOnCurrentMap()&&this._eventId>0&&self.$gameMap.eraseEvent(this._eventId),!0}command216(){return this._params[0]===0?self.$gamePlayer.showFollowers():self.$gamePlayer.hideFollowers(),self.$gamePlayer.refresh(),!0}command217(){return self.$gameParty.inBattle()||(self.$gamePlayer.gatherFollowers(),this.setWaitMode("gather")),!0}command221(){return self.$gameMessage.isBusy()||(self.$gameScreen.startFadeOut(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1}command222(){return self.$gameMessage.isBusy()||(self.$gameScreen.startFadeIn(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1}command223(){return self.$gameScreen.startTint(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0}command224(){return self.$gameScreen.startFlash(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0}command225(){return self.$gameScreen.startShake(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0}command230(){return this.wait(this._params[0]),!0}command231(){let t,e;return this._params[3]===0?(t=this._params[4],e=this._params[5]):(t=self.$gameVariables.value(this._params[4]),e=self.$gameVariables.value(this._params[5])),self.$gameScreen.showPicture(this._params[0],this._params[1],this._params[2],t,e,this._params[6],this._params[7],this._params[8],this._params[9]),!0}command232(){let t,e;return this._params[3]===0?(t=this._params[4],e=this._params[5]):(t=self.$gameVariables.value(this._params[4]),e=self.$gameVariables.value(this._params[5])),self.$gameScreen.movePicture(this._params[0],this._params[2],t,e,this._params[6],this._params[7],this._params[8],this._params[9],this._params[10]),this._params[11]&&this.wait(this._params[10]),!0}command233(){return self.$gameScreen.rotatePicture(this._params[0],this._params[1]),!0}command234(){return self.$gameScreen.tintPicture(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0}command235(){return self.$gameScreen.erasePicture(this._params[0]),!0}command236(){return self.$gameParty.inBattle()||(self.$gameScreen.changeWeather(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2])),!0}command241(){return b.playBgm(this._params[0]),!0}command242(){return b.fadeOutBgm(this._params[0]),!0}command243(){return self.$gameSystem.saveBgm(),!0}command244(){return self.$gameSystem.replayBgm(),!0}command245(){return b.playBgs(this._params[0]),!0}command246(){return b.fadeOutBgs(this._params[0]),!0}command249(){return b.playMe(this._params[0]),!0}command250(){return b.playSe(this._params[0]),!0}command251(){return b.stopSe(),!0}command261(){if(!self.$gameMessage.isBusy()){let t=this._params[0];if(t.length>0){let e=this.videoFileExt();l.playVideo(`movies/${t}${e}`),this.setWaitMode("video")}this._index++}return!1}videoFileExt(){return l.canPlayVideoType("video/webm")&&!I.isMobileDevice()?".webm":".mp4"}command281(){return this._params[0]===0?self.$gameMap.enableNameDisplay():self.$gameMap.disableNameDisplay(),!0}command282(){let t=self.$dataTilesets[this._params[0]];return this._imageReservationId||(this._imageReservationId=I.generateRuntimeId()),t.tilesetNames.map(function(i){return p.reserveTileset(i,0,this._imageReservationId)},this).every(i=>i.isReady())?(self.$gameMap.changeTileset(this._params[0]),p.releaseReservation(this._imageReservationId),this._imageReservationId=null,!0):!1}command283(){return self.$gameMap.changeBattleback(this._params[0],this._params[1]),!0}command284(){return self.$gameMap.changeParallax(this._params[0],this._params[1],this._params[2],this._params[3],this._params[4]),!0}command285(){let t,e,i;switch(this._params[2]===0?(t=this._params[3],e=this._params[4]):(t=self.$gameVariables.value(this._params[3]),e=self.$gameVariables.value(this._params[4])),this._params[1]){case 0:i=self.$gameMap.terrainTag(t,e);break;case 1:i=self.$gameMap.eventIdXy(t,e);break;case 2:case 3:case 4:case 5:i=self.$gameMap.tileId(t,e,this._params[1]-2);break;default:i=self.$gameMap.regionId(t,e);break}return self.$gameVariables.setValue(this._params[0],i),!0}command301(){if(!self.$gameParty.inBattle()){let t;this._params[0]===0?t=this._params[1]:this._params[0]===1?t=self.$gameVariables.value(this._params[1]):t=self.$gamePlayer.makeEncounterTroopId(),self.$dataTroops[t]&&(v.setup(t,this._params[2],this._params[3]),v.setEventCallback(e=>{this._branch[this._indent]=e}),self.$gamePlayer.makeEncounterCount(),g.push(Ct))}return!0}command601(){return this._branch[this._indent]!==0&&this.skipBranch(),!0}command602(){return this._branch[this._indent]!==1&&this.skipBranch(),!0}command603(){return this._branch[this._indent]!==2&&this.skipBranch(),!0}command302(){if(!self.$gameParty.inBattle()){let t=[this._params];for(;this.nextEventCode()===605;)this._index++,t.push(this.currentCommand().parameters);g.push(Ga),g.prepareNextScene(t,this._params[4])}return!0}command303(){return self.$gameParty.inBattle()||self.$dataActors[this._params[0]]&&(g.push(Ja),g.prepareNextScene(this._params[0],this._params[1])),!0}command311(){let t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],e=>{this.changeHp(e,t,this._params[5])}),!0}command312(){let t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],e=>{e.gainMp(t)}),!0}command326(){let t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],e=>{e.gainTp(t)}),!0}command313(){return this.iterateActorEx(this._params[0],this._params[1],t=>{let e=t.isDead();this._params[2]===0?t.addState(this._params[3]):t.removeState(this._params[3]),t.isDead()&&!e&&t.performCollapse(),t.clearResult()}),!0}command314(){return this.iterateActorEx(this._params[0],this._params[1],t=>{t.recoverAll()}),!0}command315(){let t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],e=>{e.changeExp(e.currentExp()+t,this._params[5])}),!0}command316(){let t=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],e=>{e.changeLevel(e.level+t,this._params[5])}),!0}command317(){let t=this.operateValue(this._params[3],this._params[4],this._params[5]);return this.iterateActorEx(this._params[0],this._params[1],e=>{e.addParam(this._params[2],t)}),!0}command318(){return this.iterateActorEx(this._params[0],this._params[1],t=>{this._params[2]===0?t.learnSkill(this._params[3]):t.forgetSkill(this._params[3])}),!0}command319(){let t=self.$gameActors.actor(this._params[0]);return t&&t.changeEquipById(this._params[1],this._params[2]),!0}command320(){let t=self.$gameActors.actor(this._params[0]);return t&&t.setName(this._params[1]),!0}command321(){let t=self.$gameActors.actor(this._params[0]);return t&&self.$dataClasses[this._params[1]]&&t.changeClass(this._params[1],this._params[2]),!0}command322(){let t=self.$gameActors.actor(this._params[0]);return t&&(t.setCharacterImage(this._params[1],this._params[2]),t.setFaceImage(this._params[3],this._params[4]),t.setBattlerImage(this._params[5])),self.$gamePlayer.refresh(),!0}command323(){let t=self.$gameMap.vehicle(this._params[0]);return t&&t.setImage(this._params[1],this._params[2]),!0}command324(){let t=self.$gameActors.actor(this._params[0]);return t&&t.setNickname(this._params[1]),!0}command325(){let t=self.$gameActors.actor(this._params[0]);return t&&t.setProfile(this._params[1]),!0}command331(){let t=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],e=>{this.changeHp(e,t,this._params[4])}),!0}command332(){let t=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],e=>{e.gainMp(t)}),!0}command342(){let t=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],e=>{e.gainTp(t)}),!0}command333(){return this.iterateEnemyIndex(this._params[0],t=>{let e=t.isDead();this._params[1]===0?t.addState(this._params[2]):t.removeState(this._params[2]),t.isDead()&&!e&&t.performCollapse(),t.clearResult()}),!0}command334(){return this.iterateEnemyIndex(this._params[0],t=>{t.recoverAll()}),!0}command335(){return this.iterateEnemyIndex(this._params[0],t=>{t.appear(),self.$gameTroop.makeUniqueNames()}),!0}command336(){return this.iterateEnemyIndex(this._params[0],t=>{t.transform(this._params[1]),self.$gameTroop.makeUniqueNames()}),!0}command337(){return this._params[2]==!0?this.iterateEnemyIndex(-1,t=>{t.isAlive()&&t.startAnimation(this._params[1],!1,0)}):this.iterateEnemyIndex(this._params[0],t=>{t.isAlive()&&t.startAnimation(this._params[1],!1,0)}),!0}command339(){return this.iterateBattler(this._params[0],this._params[1],t=>{t.isDeathStateAffected()||(t.forceAction(this._params[2],this._params[3]),v.forceAction(t),this.setWaitMode("action"))}),!0}command340(){return v.abort(),!0}command351(){return self.$gameParty.inBattle()||(g.push(Se),Kt.initCommandPosition()),!0}command352(){return self.$gameParty.inBattle()||g.push(be),!0}command353(){return g.goto(Tt),!0}command354(){return g.goto(ft),!0}command355(){let t=this._index+1,e=`${this.currentCommand().parameters[0]}
`;for(;this.nextEventCode()===655;)this._index++,e+=`${this.currentCommand().parameters[0]}
`;let i=this._index+1;try{let s=this;new Function("{ context }","return "+e)({context:s})}catch(s){throw s.line=`${t}-${i}`,s.eventCommand="script",s.content=e,s}return!0}command356(){let t=this._params[0].split(" "),e=t.shift();try{this.pluginCommand(e,t)}catch(i){throw i.eventCommand="plugin_command",i.content=this._params[0],i}return!0}pluginCommand(t,e){}static requestImagesByPluginCommand(t,e){}static requestImagesForCommand({parameters:t,code:e}){let i=t;switch(e){case 101:p.requestFace(i[0]);break;case 129:let s=self.$gameActors.actor(i[0]);if(s&&i[1]===0){let y=s.characterName();p.requestCharacter(y)}break;case 205:i[1]&&i[1].list.forEach(({parameters:y,code:P})=>{let $=y;P===nt.ROUTE_CHANGE_IMAGE&&p.requestCharacter($[0])});break;case 212:case 337:if(i[1]){let y=self.$dataAnimations[i[1]],P=y.animation1Name,$=y.animation2Name,B=y.animation1Hue,E=y.animation2Hue;p.requestAnimation(P,B),p.requestAnimation($,E)}break;case 216:i[0]===0&&self.$gamePlayer.followers().forEach(y=>{let P=y.characterName();p.requestCharacter(P)});break;case 231:p.requestPicture(i[1]);break;case 282:self.$dataTilesets[i[0]].tilesetNames.forEach(y=>{p.requestTileset(y)});break;case 283:self.$gameParty.inBattle()&&(p.requestBattleback1(i[0]),p.requestBattleback2(i[1]));break;case 284:self.$gameParty.inBattle()||p.requestParallax(i[0]);break;case 322:p.requestCharacter(i[1]),p.requestFace(i[3]),p.requestSvActor(i[5]);break;case 323:self.$gameMap.vehicle(i[0])&&p.requestCharacter(i[1]);break;case 336:let h=self.$dataEnemies[i[1]],c=h.battlerName,d=h.battlerHue;self.$gameSystem.isSideView()?p.requestSvEnemy(c,d):p.requestEnemy(c,d);break;case 356:let u=i[0].split(" "),f=u.shift();Q.requestImagesByPluginCommand(f,u);break}}static requestImagesByChildEvent({parameters:t},e){let i=t,s=self.$dataCommonEvents[i[0]];s&&(e||(e=[]),e.contains(i[0])||(e.push(i[0]),Q.requestImages(s.list,e)))}static requestImages(t,e){if(!t)return;let i=t.length;for(let s=0;s<i;s+=1){let a=t[s];a.code===117?Q.requestImagesByChildEvent(a,e):Q.requestImagesForCommand(a)}}};o(Q,"Game_Interpreter");var Ot=class extends ae{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this._interpreter=new Q,this.clear()}isEventRunning(){return this._interpreter.isRunning()}updateInterpreter(){this._interpreter.update()}turnCount(){return this._turnCount}members(){return this._enemies}clear(){this._interpreter.clear(),this._troopId=0,this._eventFlags={},this._enemies=[],this._turnCount=0,this._namesCount={}}troop(){return self.$dataTroops[this._troopId]}setup(t){this.clear(),this._troopId=t,this._enemies=[],this.troop().members.forEach(function(e){if(self.$dataEnemies[e.enemyId]){let i=e.enemyId,s=e.x,a=e.y,r=new Ra(i,s,a);e.hidden&&r.hide(),this._enemies.push(r)}},this),this.makeUniqueNames()}makeUniqueNames(){let t=this.letterTable();this.members().forEach(function(e){if(e.isAlive()&&e.isLetterEmpty()){let i=e.originalName(),s=this._namesCount[i]||0;e.setLetter(t[s%t.length]),this._namesCount[i]=s+1}},this),this.members().forEach(function(e){let i=e.originalName();this._namesCount[i]>=2&&e.setPlural(!0)},this)}letterTable(){return self.$gameSystem.isCJK()?Ot.LETTER_TABLE_FULL:Ot.LETTER_TABLE_HALF}enemyNames(){let t=[];return this.members().forEach(e=>{let i=e.originalName();e.isAlive()&&!t.contains(i)&&t.push(i)}),t}meetsConditions({conditions:t}){let e=t;if(!e.turnEnding&&!e.turnValid&&!e.enemyValid&&!e.actorValid&&!e.switchValid||e.turnEnding&&!v.isTurnEnd())return!1;if(e.turnValid){let i=this._turnCount,s=e.turnA,a=e.turnB;if(a===0&&i!==s||a>0&&(i<1||i<s||i%a!==s%a))return!1}if(e.enemyValid){let i=self.$gameTroop.members()[e.enemyIndex];if(!i||i.hpRate()*100>e.enemyHp)return!1}if(e.actorValid){let i=self.$gameActors.actor(e.actorId);if(!i||i.hpRate()*100>e.actorHp)return!1}return!(e.switchValid&&!self.$gameSwitches.value(e.switchId))}setupBattleEvent(){if(!this._interpreter.isRunning()){if(this._interpreter.setupReservedCommonEvent())return;let t=this.troop().pages;for(let e=0;e<t.length;e++){let i=t[e];if(this.meetsConditions(i)&&!this._eventFlags[e]){this._interpreter.setup(i.list),this._interpreter.setEventInfo({eventType:"battle_event",troopId:this._troopId,page:e+1}),i.span<=1&&(this._eventFlags[e]=!0);break}}}}increaseTurn(){this.troop().pages.forEach(({span:e},i)=>{e===1&&(this._eventFlags[i]=!1)}),this._turnCount++}expTotal(){return this.deadMembers().reduce((t,e)=>t+e.exp(),0)}goldTotal(){return this.deadMembers().reduce((t,e)=>t+e.gold(),0)*this.goldRate()}goldRate(){return self.$gameParty.hasGoldDouble()?2:1}makeDropItems(){return this.deadMembers().reduce((t,e)=>t.concat(e.makeDropItems()),[])}};o(Ot,"Game_Troop");Ot.LETTER_TABLE_HALF=[" A"," B"," C"," D"," E"," F"," G"," H"," I"," J"," K"," L"," M"," N"," O"," P"," Q"," R"," S"," T"," U"," V"," W"," X"," Y"," Z"];Ot.LETTER_TABLE_FULL=["\uFF21","\uFF22","\uFF23","\uFF24","\uFF25","\uFF26","\uFF27","\uFF28","\uFF29","\uFF2A","\uFF2B","\uFF2C","\uFF2D","\uFF2E","\uFF2F","\uFF30","\uFF31","\uFF32","\uFF33","\uFF34","\uFF35","\uFF36","\uFF37","\uFF38","\uFF39","\uFF3A"];var Qa=Ot;var tr=class{constructor(...t){this.initialize(...t)}initialize(t){this._commonEventId=t,this.refresh()}event(){return self.$dataCommonEvents[this._commonEventId]}list(){return this.event().list}refresh(){this.isActive()?this._interpreter||(this._interpreter=new Q):this._interpreter=null}isActive(){let t=this.event();return t.trigger===2&&self.$gameSwitches.value(t.switchId)}update(){this._interpreter&&(this._interpreter.isRunning()||(this._interpreter.setup(this.list()),this._interpreter.setEventInfo({eventType:"common_event",commonEventId:this._commonEventId})),this._interpreter.update())}};o(tr,"Game_CommonEvent");var er=tr;var ir=class extends nt{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this._type=t,this.resetDirection(),this.initMoveSpeed(),this.loadSystemSettings()}initMembers(){super.initMembers(),this._type="",this._mapId=0,this._altitude=0,this._driving=!1,this._bgm=null}isBoat(){return this._type==="boat"}isShip(){return this._type==="ship"}isAirship(){return this._type==="airship"}resetDirection(){this.setDirection(4)}initMoveSpeed(){this.isBoat()?this.setMoveSpeed(4):this.isShip()?this.setMoveSpeed(5):this.isAirship()&&this.setMoveSpeed(6)}vehicle(){return this.isBoat()?self.$dataSystem.boat:this.isShip()?self.$dataSystem.ship:this.isAirship()?self.$dataSystem.airship:null}loadSystemSettings(){let t=this.vehicle();this._mapId=t.startMapId,this.setPosition(t.startX,t.startY),this.setImage(t.characterName,t.characterIndex)}refresh(){this._driving?(this._mapId=self.$gameMap.mapId(),this.syncWithPlayer()):this._mapId===self.$gameMap.mapId()&&this.locate(this.x,this.y),this.isAirship()?this.setPriorityType(this._driving?2:0):this.setPriorityType(1),this.setWalkAnime(this._driving),this.setStepAnime(this._driving),this.setTransparent(this._mapId!==self.$gameMap.mapId())}setLocation(t,e,i){this._mapId=t,this.setPosition(e,i),this.refresh()}pos(t,e){return this._mapId===self.$gameMap.mapId()?nt.prototype.pos.call(this,t,e):!1}isMapPassable(t,e,i){let s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i);return this.isBoat()?self.$gameMap.isBoatPassable(s,a):this.isShip()?self.$gameMap.isShipPassable(s,a):!!this.isAirship()}getOn(){this._driving=!0,this.setWalkAnime(!0),this.setStepAnime(!0),self.$gameSystem.saveWalkingBgm(),this.playBgm()}getOff(){this._driving=!1,this.setWalkAnime(!1),this.setStepAnime(!1),this.resetDirection(),self.$gameSystem.replayWalkingBgm()}setBgm(t){this._bgm=t}playBgm(){b.playBgm(this._bgm||this.vehicle().bgm)}syncWithPlayer(){this.copyPosition(self.$gamePlayer),this.refreshBushDepth()}screenY(){return nt.prototype.screenY.call(this)-this._altitude}shadowX(){return this.screenX()}shadowY(){return this.screenY()+this._altitude}shadowOpacity(){return 255*this._altitude/this.maxAltitude()}canMove(){return this.isAirship()?this.isHighest():!0}update(){super.update(),this.isAirship()&&this.updateAirship()}updateAirship(){this.updateAirshipAltitude(),this.setStepAnime(this.isHighest()),this.setPriorityType(this.isLowest()?0:2)}updateAirshipAltitude(){this._driving&&!this.isHighest()&&this._altitude++,!this._driving&&!this.isLowest()&&this._altitude--}maxAltitude(){return 48}isLowest(){return this._altitude<=0}isHighest(){return this._altitude>=this.maxAltitude()}isTakeoffOk(){return self.$gamePlayer.areFollowersGathered()}isLandOk(t,e,i){if(this.isAirship()){if(!self.$gameMap.isAirshipLandOk(t,e)||self.$gameMap.eventsXy(t,e).length>0)return!1}else{let s=self.$gameMap.roundXWithDirection(t,i),a=self.$gameMap.roundYWithDirection(e,i);if(!self.$gameMap.isValid(s,a)||!self.$gameMap.isPassable(s,a,this.reverseDir(i))||this.isCollidedWithCharacters(s,a))return!1}return!0}};o(ir,"Game_Vehicle");var Ce=ir;var sr=class extends nt{constructor(...t){super(...t),this.initialize(...t)}initialize(t,e){super.initialize(),this._mapId=t,this._eventId=e,this.locate(this.event().x,this.event().y),this.refresh()}initMembers(){super.initMembers(),this._moveType=0,this._trigger=0,this._starting=!1,this._erased=!1,this._pageIndex=-2,this._originalPattern=1,this._originalDirection=2,this._prelockDirection=0,this._locked=!1}eventId(){return this._eventId}event(){return self.$dataMap.events[this._eventId]}page(){return this.event().pages[this._pageIndex]}list(){return this.page().list}isCollidedWithCharacters(t,e){return nt.prototype.isCollidedWithCharacters.call(this,t,e)||this.isCollidedWithPlayerCharacters(t,e)}isCollidedWithEvents(t,e){return self.$gameMap.eventsXyNt(t,e).length>0}isCollidedWithPlayerCharacters(t,e){return this.isNormalPriority()&&self.$gamePlayer.isCollided(t,e)}lock(){this._locked||(this._prelockDirection=this.direction(),this.turnTowardPlayer(),this._locked=!0)}unlock(){this._locked&&(this._locked=!1,this.setDirection(this._prelockDirection))}updateStop(){this._locked&&this.resetStopCount(),super.updateStop(),this.isMoveRouteForcing()||this.updateSelfMovement()}updateSelfMovement(){if(!this._locked&&this.isNearTheScreen()&&this.checkStop(this.stopCountThreshold()))switch(this._moveType){case 1:this.moveTypeRandom();break;case 2:this.moveTypeTowardPlayer();break;case 3:this.moveTypeCustom();break}}stopCountThreshold(){return 30*(5-this.moveFrequency())}moveTypeRandom(){switch(Math.randomInt(6)){case 0:case 1:this.moveRandom();break;case 2:case 3:case 4:this.moveForward();break;case 5:this.resetStopCount();break}}moveTypeTowardPlayer(){if(this.isNearThePlayer())switch(Math.randomInt(6)){case 0:case 1:case 2:case 3:this.moveTowardPlayer();break;case 4:this.moveRandom();break;case 5:this.moveForward();break}else this.moveRandom()}isNearThePlayer(){let t=Math.abs(this.deltaXFrom(self.$gamePlayer.x)),e=Math.abs(this.deltaYFrom(self.$gamePlayer.y));return t+e<20}moveTypeCustom(){this.updateRoutineMove()}isStarting(){return this._starting}clearStartingFlag(){this._starting=!1}isTriggerIn(t){return t.contains(this._trigger)}start(){let t=this.list();t&&t.length>1&&(this._starting=!0,this.isTriggerIn([0,1,2])&&this.lock())}erase(){this._erased=!0,this.refresh()}refresh(){let t=this._erased?-1:this.findProperPageIndex();this._pageIndex!==t&&(this._pageIndex=t,this.setupPage())}findProperPageIndex(){let t=this.event().pages;for(let e=t.length-1;e>=0;e--){let i=t[e];if(this.meetsConditions(i))return e}return-1}meetsConditions({conditions:t}){let e=t;if(e.switch1Valid&&!self.$gameSwitches.value(e.switch1Id)||e.switch2Valid&&!self.$gameSwitches.value(e.switch2Id)||e.variableValid&&self.$gameVariables.value(e.variableId)<e.variableValue)return!1;if(e.selfSwitchValid){let i=[this._mapId,this._eventId,e.selfSwitchCh];if(self.$gameSelfSwitches.value(i)!==!0)return!1}if(e.itemValid){let i=self.$dataItems[e.itemId];if(!self.$gameParty.hasItem(i))return!1}if(e.actorValid){let i=self.$gameActors.actor(e.actorId);if(!self.$gameParty.members().contains(i))return!1}return!0}setupPage(){this._pageIndex>=0?this.setupPageSettings():this.clearPageSettings(),this.refreshBushDepth(),this.clearStartingFlag(),this.checkEventTriggerAuto()}clearPageSettings(){this.setImage("",0),this._moveType=0,this._trigger=null,this._interpreter=null,this.setThrough(!0)}setupPageSettings(){let t=this.page(),e=t.image;e.tileId>0?this.setTileImage(e.tileId):this.setImage(e.characterName,e.characterIndex),this._originalDirection!==e.direction&&(this._originalDirection=e.direction,this._prelockDirection=0,this.setDirectionFix(!1),this.setDirection(e.direction)),this._originalPattern!==e.pattern&&(this._originalPattern=e.pattern,this.setPattern(e.pattern)),this.setMoveSpeed(t.moveSpeed),this.setMoveFrequency(t.moveFrequency),this.setPriorityType(t.priorityType),this.setWalkAnime(t.walkAnime),this.setStepAnime(t.stepAnime),this.setDirectionFix(t.directionFix),this.setThrough(t.through),this.setMoveRoute(t.moveRoute),this._moveType=t.moveType,this._trigger=t.trigger,this._trigger===4?this._interpreter=new Q:this._interpreter=null}isOriginalPattern(){return this.pattern()===this._originalPattern}resetPattern(){this.setPattern(this._originalPattern)}checkEventTriggerTouch(t,e){self.$gameMap.isEventRunning()||this._trigger===2&&self.$gamePlayer.pos(t,e)&&!this.isJumping()&&this.isNormalPriority()&&this.start()}checkEventTriggerAuto(){this._trigger===3&&this.start()}update(){super.update(),this.checkEventTriggerAuto(),this.updateParallel()}updateParallel(){this._interpreter&&(this._interpreter.isRunning()||(this._interpreter.setup(this.list(),this._eventId),this._interpreter.setEventInfo(this.getEventInfo())),this._interpreter.update())}locate(t,e){super.locate(t,e),this._prelockDirection=0}forceMoveRoute(t){super.forceMoveRoute(t),this._prelockDirection=0}getEventInfo(){return{eventType:"map_event",mapId:this._mapId,mapEventId:this._eventId,page:this._pageIndex+1}}};o(sr,"Game_Event");var ar=sr;var rr=class{constructor(...t){this.initialize(...t)}initialize(){this._interpreter=new Q,this._mapId=0,this._tilesetId=0,this._events=[],this._commonEvents=[],this._vehicles=[],this._displayX=0,this._displayY=0,this._nameDisplay=!0,this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4,this._parallaxName="",this._parallaxZero=!1,this._parallaxLoopX=!1,this._parallaxLoopY=!1,this._parallaxSx=0,this._parallaxSy=0,this._parallaxX=0,this._parallaxY=0,this._battleback1Name=null,this._battleback2Name=null,this.createVehicles()}setup(t){if(!self.$dataMap)throw new Error("The map data is not available");this._mapId=t,this._tilesetId=self.$dataMap.tilesetId,this._displayX=0,this._displayY=0,this.refereshVehicles(),this.setupEvents(),this.setupScroll(),this.setupParallax(),this.setupBattleback(),this._needsRefresh=!1}isEventRunning(){return this._interpreter.isRunning()||this.isAnyEventStarting()}tileWidth(){return 48}tileHeight(){return 48}mapId(){return this._mapId}tilesetId(){return this._tilesetId}displayX(){return this._displayX}displayY(){return this._displayY}parallaxName(){return this._parallaxName}battleback1Name(){return this._battleback1Name}battleback2Name(){return this._battleback2Name}requestRefresh(t){this._needsRefresh=!0}isNameDisplayEnabled(){return this._nameDisplay}disableNameDisplay(){this._nameDisplay=!1}enableNameDisplay(){this._nameDisplay=!0}createVehicles(){this._vehicles=[],this._vehicles[0]=new Ce("boat"),this._vehicles[1]=new Ce("ship"),this._vehicles[2]=new Ce("airship")}refereshVehicles(){this._vehicles.forEach(t=>{t.refresh()})}vehicles(){return this._vehicles}vehicle(t){return t===0||t==="boat"?this.boat():t===1||t==="ship"?this.ship():t===2||t==="airship"?this.airship():null}boat(){return this._vehicles[0]}ship(){return this._vehicles[1]}airship(){return this._vehicles[2]}setupEvents(){this._events=[];for(let t=0;t<self.$dataMap.events.length;t++)self.$dataMap.events[t]&&(this._events[t]=new ar(this._mapId,t));this._commonEvents=this.parallelCommonEvents().map(({id:t})=>new er(t)),this.refreshTileEvents()}events(){return this._events.filter(t=>!!t)}event(t){return this._events[t]}eraseEvent(t){this._events[t].erase()}parallelCommonEvents(){return self.$dataCommonEvents.filter(t=>t&&t.trigger===2)}setupScroll(){this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4}setupParallax(){this._parallaxName=self.$dataMap.parallaxName||"",this._parallaxZero=p.isZeroParallax(this._parallaxName),this._parallaxLoopX=self.$dataMap.parallaxLoopX,this._parallaxLoopY=self.$dataMap.parallaxLoopY,this._parallaxSx=self.$dataMap.parallaxSx,this._parallaxSy=self.$dataMap.parallaxSy,this._parallaxX=0,this._parallaxY=0}setupBattleback(){self.$dataMap.specifyBattleback?(this._battleback1Name=self.$dataMap.battleback1Name,this._battleback2Name=self.$dataMap.battleback2Name):(this._battleback1Name=null,this._battleback2Name=null)}setDisplayPos(t,e){if(this.isLoopHorizontal())this._displayX=t.mod(this.width()),this._parallaxX=t;else{let i=this.width()-this.screenTileX();this._displayX=i<0?i/2:t.clamp(0,i),this._parallaxX=this._displayX}if(this.isLoopVertical())this._displayY=e.mod(this.height()),this._parallaxY=e;else{let i=this.height()-this.screenTileY();this._displayY=i<0?i/2:e.clamp(0,i),this._parallaxY=this._displayY}}parallaxOx(){return this._parallaxZero?this._parallaxX*this.tileWidth():this._parallaxLoopX?this._parallaxX*this.tileWidth()/2:0}parallaxOy(){return this._parallaxZero?this._parallaxY*this.tileHeight():this._parallaxLoopY?this._parallaxY*this.tileHeight()/2:0}tileset(){return self.$dataTilesets[this._tilesetId]}tilesetFlags(){let t=this.tileset();return t?t.flags:[]}displayName(){return self.$dataMap.displayName}width(){return self.$dataMap.width}height(){return self.$dataMap.height}data(){return self.$dataMap.data}isLoopHorizontal(){return self.$dataMap.scrollType===2||self.$dataMap.scrollType===3}isLoopVertical(){return self.$dataMap.scrollType===1||self.$dataMap.scrollType===3}isDashDisabled(){return self.$dataMap.disableDashing}encounterList(){return self.$dataMap.encounterList}encounterStep(){return self.$dataMap.encounterStep}isOverworld(){return this.tileset()&&this.tileset().mode===0}screenTileX(){return l.width/this.tileWidth()}screenTileY(){return l.height/this.tileHeight()}adjustX(t){return this.isLoopHorizontal()&&t<this._displayX-(this.width()-this.screenTileX())/2?t-this._displayX+self.$dataMap.width:t-this._displayX}adjustY(t){return this.isLoopVertical()&&t<this._displayY-(this.height()-this.screenTileY())/2?t-this._displayY+self.$dataMap.height:t-this._displayY}roundX(t){return this.isLoopHorizontal()?t.mod(this.width()):t}roundY(t){return this.isLoopVertical()?t.mod(this.height()):t}xWithDirection(t,e){return t+(e===6?1:e===4?-1:0)}yWithDirection(t,e){return t+(e===2?1:e===8?-1:0)}roundXWithDirection(t,e){return this.roundX(t+(e===6?1:e===4?-1:0))}roundYWithDirection(t,e){return this.roundY(t+(e===2?1:e===8?-1:0))}deltaX(t,e){let i=t-e;return this.isLoopHorizontal()&&Math.abs(i)>this.width()/2&&(i<0?i+=this.width():i-=this.width()),i}deltaY(t,e){let i=t-e;return this.isLoopVertical()&&Math.abs(i)>this.height()/2&&(i<0?i+=this.height():i-=this.height()),i}distance(t,e,i,s){return Math.abs(this.deltaX(t,i))+Math.abs(this.deltaY(e,s))}canvasToMapX(t){let e=this.tileWidth(),i=this._displayX*e,s=Math.floor((i+t)/e);return this.roundX(s)}canvasToMapY(t){let e=this.tileHeight(),i=this._displayY*e,s=Math.floor((i+t)/e);return this.roundY(s)}autoplay(){self.$dataMap.autoplayBgm&&(self.$gamePlayer.isInVehicle()?self.$gameSystem.saveWalkingBgm2():b.playBgm(self.$dataMap.bgm)),self.$dataMap.autoplayBgs&&b.playBgs(self.$dataMap.bgs)}refreshIfNeeded(){this._needsRefresh&&this.refresh()}refresh(){this.events().forEach(t=>{t.refresh()}),this._commonEvents.forEach(t=>{t.refresh()}),this.refreshTileEvents(),this._needsRefresh=!1}refreshTileEvents(){this.tileEvents=this.events().filter(t=>t.isTile())}eventsXy(t,e){return this.events().filter(i=>i.pos(t,e))}eventsXyNt(t,e){return this.events().filter(i=>i.posNt(t,e))}tileEventsXy(t,e){return this.tileEvents.filter(i=>i.posNt(t,e))}eventIdXy(t,e){let i=this.eventsXy(t,e);return i.length===0?0:i[0].eventId()}scrollDown(t){if(this.isLoopVertical())this._displayY+=t,this._displayY%=self.$dataMap.height,this._parallaxLoopY&&(this._parallaxY+=t);else if(this.height()>=this.screenTileY()){let e=this._displayY;this._displayY=Math.min(this._displayY+t,this.height()-this.screenTileY()),this._parallaxY+=this._displayY-e}}scrollLeft(t){if(this.isLoopHorizontal())this._displayX+=self.$dataMap.width-t,this._displayX%=self.$dataMap.width,this._parallaxLoopX&&(this._parallaxX-=t);else if(this.width()>=this.screenTileX()){let e=this._displayX;this._displayX=Math.max(this._displayX-t,0),this._parallaxX+=this._displayX-e}}scrollRight(t){if(this.isLoopHorizontal())this._displayX+=t,this._displayX%=self.$dataMap.width,this._parallaxLoopX&&(this._parallaxX+=t);else if(this.width()>=this.screenTileX()){let e=this._displayX;this._displayX=Math.min(this._displayX+t,this.width()-this.screenTileX()),this._parallaxX+=this._displayX-e}}scrollUp(t){if(this.isLoopVertical())this._displayY+=self.$dataMap.height-t,this._displayY%=self.$dataMap.height,this._parallaxLoopY&&(this._parallaxY-=t);else if(this.height()>=this.screenTileY()){let e=this._displayY;this._displayY=Math.max(this._displayY-t,0),this._parallaxY+=this._displayY-e}}isValid(t,e){return t>=0&&t<this.width()&&e>=0&&e<this.height()}checkPassage(t,e,i){let s=this.tilesetFlags(),a=this.allTiles(t,e);for(let r=0;r<a.length;r++){let h=s[a[r]];if(!(h&16)){if(!(h&i))return!0;if((h&i)===i)return!1}}return!1}tileId(t,e,i){let s=self.$dataMap.width,a=self.$dataMap.height;return self.$dataMap.data[(i*a+e)*s+t]||0}layeredTiles(t,e){let i=[];for(let s=0;s<4;s++)i.push(this.tileId(t,e,3-s));return i}allTiles(t,e){return this.tileEventsXy(t,e).map(s=>s.tileId()).concat(this.layeredTiles(t,e))}autotileType(t,e,i){let s=this.tileId(t,e,i);return s>=2048?Math.floor((s-2048)/48):-1}isPassable(t,e,i){return this.checkPassage(t,e,1<<i/2-1&15)}isBoatPassable(t,e){return this.checkPassage(t,e,512)}isShipPassable(t,e){return this.checkPassage(t,e,1024)}isAirshipLandOk(t,e){return this.checkPassage(t,e,2048)&&this.checkPassage(t,e,15)}checkLayeredTilesFlags(t,e,i){let s=this.tilesetFlags();return this.layeredTiles(t,e).some(a=>(s[a]&i)!==0)}isLadder(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,32)}isBush(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,64)}isCounter(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,128)}isDamageFloor(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,256)}terrainTag(t,e){if(this.isValid(t,e)){let i=this.tilesetFlags(),s=this.layeredTiles(t,e);for(let a=0;a<s.length;a++){let r=i[s[a]]>>12;if(r>0)return r}}return 0}regionId(t,e){return this.isValid(t,e)?this.tileId(t,e,5):0}startScroll(t,e,i){this._scrollDirection=t,this._scrollRest=e,this._scrollSpeed=i}isScrolling(){return this._scrollRest>0}update(t){this.refreshIfNeeded(),t&&this.updateInterpreter(),this.updateScroll(),this.updateEvents(),this.updateVehicles(),this.updateParallax()}updateScroll(){if(this.isScrolling()){let t=this._displayX,e=this._displayY;this.doScroll(this._scrollDirection,this.scrollDistance()),this._displayX===t&&this._displayY===e?this._scrollRest=0:this._scrollRest-=this.scrollDistance()}}scrollDistance(){return Math.pow(2,this._scrollSpeed)/256}doScroll(t,e){switch(t){case 2:this.scrollDown(e);break;case 4:this.scrollLeft(e);break;case 6:this.scrollRight(e);break;case 8:this.scrollUp(e);break}}updateEvents(){this.events().forEach(t=>{t.update()}),this._commonEvents.forEach(t=>{t.update()})}updateVehicles(){this._vehicles.forEach(t=>{t.update()})}updateParallax(){this._parallaxLoopX&&(this._parallaxX+=this._parallaxSx/this.tileWidth()/2),this._parallaxLoopY&&(this._parallaxY+=this._parallaxSy/this.tileHeight()/2)}changeTileset(t){this._tilesetId=t,this.refresh()}changeBattleback(t,e){this._battleback1Name=t,this._battleback2Name=e}changeParallax(t,e,i,s,a){this._parallaxName=t,this._parallaxZero=p.isZeroParallax(this._parallaxName),this._parallaxLoopX&&!e&&(this._parallaxX=0),this._parallaxLoopY&&!i&&(this._parallaxY=0),this._parallaxLoopX=e,this._parallaxLoopY=i,this._parallaxSx=s,this._parallaxSy=a}updateInterpreter(){for(;;)if(this._interpreter.update(),this._interpreter.isRunning()||(this._interpreter.eventId()>0&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear()),!this.setupStartingEvent()))return}unlockEvent(t){this._events[t]&&this._events[t].unlock()}setupStartingEvent(){return this.refreshIfNeeded(),!!(this._interpreter.setupReservedCommonEvent()||this.setupTestEvent()||this.setupStartingMapEvent()||this.setupAutorunCommonEvent())}setupTestEvent(){return self.$testEvent?(this._interpreter.setup(self.$testEvent,0),this._interpreter.setEventInfo({eventType:"test_event"}),self.$testEvent=null,!0):!1}setupStartingMapEvent(){let t=this.events();for(let e of t)if(e.isStarting())return e.clearStartingFlag(),this._interpreter.setup(e.list(),e.eventId()),this._interpreter.setEventInfo(e.getEventInfo()),!0;return!1}setupAutorunCommonEvent(){for(let t=0;t<self.$dataCommonEvents.length;t++){let e=self.$dataCommonEvents[t];if(e&&e.trigger===1&&self.$gameSwitches.value(e.switchId))return this._interpreter.setup(e.list),this._interpreter.setEventInfo({eventType:"common_event",commonEventId:t}),!0}return!1}isAnyEventStarting(){return this.events().some(t=>t.isStarting())}};o(rr,"Game_Map");var nr=rr;var or=class extends nt{constructor(...t){super(...t),this.initialize(...t)}initialize(t){super.initialize(),this._memberIndex=t,this.setTransparent(self.$dataSystem.optTransparent),this.setThrough(!0)}refresh(){let t=this.isVisible()?this.actor().characterName():"",e=this.isVisible()?this.actor().characterIndex():0;this.setImage(t,e)}actor(){return self.$gameParty.battleMembers()[this._memberIndex]}isVisible(){return this.actor()&&self.$gamePlayer.followers().isVisible()}update(){super.update(),this.setMoveSpeed(self.$gamePlayer.realMoveSpeed()),this.setOpacity(self.$gamePlayer.opacity()),this.setBlendMode(self.$gamePlayer.blendMode()),this.setWalkAnime(self.$gamePlayer.hasWalkAnime()),this.setStepAnime(self.$gamePlayer.hasStepAnime()),this.setDirectionFix(self.$gamePlayer.isDirectionFixed()),this.setTransparent(self.$gamePlayer.isTransparent())}chaseCharacter({x:t,y:e}){let i=this.deltaXFrom(t),s=this.deltaYFrom(e);i!==0&&s!==0?this.moveDiagonally(i>0?4:6,s>0?8:2):i!==0?this.moveStraight(i>0?4:6):s!==0&&this.moveStraight(s>0?8:2),this.setMoveSpeed(self.$gamePlayer.realMoveSpeed())}};o(or,"Game_Follower");var hr=or;var lr=class{constructor(...t){this.initialize(...t)}initialize(){this._visible=self.$dataSystem.optFollowers,this._gathering=!1,this._data=[];for(let t=1;t<self.$gameParty.maxBattleMembers();t++)this._data.push(new hr(t))}isVisible(){return this._visible}show(){this._visible=!0}hide(){this._visible=!1}follower(t){return this._data[t]}forEach(t,e){this._data.forEach(t,e)}reverseEach(t,e){this._data.reverse(),this._data.forEach(t,e),this._data.reverse()}refresh(){this.forEach(t=>t.refresh(),this)}update(){this.areGathering()&&(this.areMoving()||this.updateMove(),this.areGathered()&&(this._gathering=!1)),this.forEach(t=>{t.update()},this)}updateMove(){for(let t=this._data.length-1;t>=0;t--){let e=t>0?this._data[t-1]:self.$gamePlayer;this._data[t].chaseCharacter(e)}}jumpAll(){if(self.$gamePlayer.isJumping())for(let t of this._data){let e=self.$gamePlayer.deltaXFrom(t.x),i=self.$gamePlayer.deltaYFrom(t.y);t.jump(e,i)}}synchronize(t,e,i){this.forEach(s=>{s.locate(t,e),s.setDirection(i)},this)}gather(){this._gathering=!0}areGathering(){return this._gathering}visibleFollowers(){return this._data.filter(t=>t.isVisible(),this)}areMoving(){return this.visibleFollowers().some(t=>t.isMoving(),this)}areGathered(){return this.visibleFollowers().every(t=>!t.isMoving()&&t.pos(self.$gamePlayer.x,self.$gamePlayer.y),this)}isSomeoneCollided(t,e){return this.visibleFollowers().some(i=>i.pos(t,e),this)}};o(lr,"Game_Followers");var cr=lr;var dr=class extends nt{constructor(...t){super(...t),this.initialize(...t)}initialize(){super.initialize(),this.setTransparent(self.$dataSystem.optTransparent)}initMembers(){super.initMembers(),this._vehicleType="walk",this._vehicleGettingOn=!1,this._vehicleGettingOff=!1,this._dashing=!1,this._needsMapReload=!1,this._transferring=!1,this._newMapId=0,this._newX=0,this._newY=0,this._newDirection=0,this._fadeType=0,this._followers=new cr,this._encounterCount=0}clearTransferInfo(){this._transferring=!1,this._newMapId=0,this._newX=0,this._newY=0,this._newDirection=0}followers(){return this._followers}refresh(){let t=self.$gameParty.leader(),e=t?t.characterName():"",i=t?t.characterIndex():0;this.setImage(e,i),this._followers.refresh()}isStopping(){return this._vehicleGettingOn||this._vehicleGettingOff?!1:nt.prototype.isStopping.call(this)}reserveTransfer(t,e,i,s,a){this._transferring=!0,this._newMapId=t,this._newX=e,this._newY=i,this._newDirection=s,this._fadeType=a}requestMapReload(){this._needsMapReload=!0}isTransferring(){return this._transferring}newMapId(){return this._newMapId}fadeType(){return this._fadeType}performTransfer(){this.isTransferring()&&(this.setDirection(this._newDirection),(this._newMapId!==self.$gameMap.mapId()||this._needsMapReload)&&(self.$gameMap.setup(this._newMapId),this._needsMapReload=!1),this.locate(this._newX,this._newY),this.refresh(),w.autoSaveGame(),this.clearTransferInfo())}isMapPassable(t,e,i){let s=this.vehicle();return s?s.isMapPassable(t,e,i):nt.prototype.isMapPassable.call(this,t,e,i)}vehicle(){return self.$gameMap.vehicle(this._vehicleType)}isInBoat(){return this._vehicleType==="boat"}isInShip(){return this._vehicleType==="ship"}isInAirship(){return this._vehicleType==="airship"}isInVehicle(){return this.isInBoat()||this.isInShip()||this.isInAirship()}isNormal(){return this._vehicleType==="walk"&&!this.isMoveRouteForcing()}isDashing(){return this._dashing}isDebugThrough(){return x.isPressed("control")&&self.$gameTemp.isPlaytest()}isCollided(t,e){return this.isThrough()?!1:this.pos(t,e)||this._followers.isSomeoneCollided(t,e)}centerX(){return(l.width/self.$gameMap.tileWidth()-1)/2}centerY(){return(l.height/self.$gameMap.tileHeight()-1)/2}center(t,e){return self.$gameMap.setDisplayPos(t-this.centerX(),e-this.centerY())}locate(t,e){super.locate(t,e),this.center(t,e),this.makeEncounterCount(),this.isInVehicle()&&this.vehicle().refresh(),this._followers.synchronize(t,e,this.direction())}increaseSteps(){super.increaseSteps(),this.isNormal()&&self.$gameParty.increaseSteps()}makeEncounterCount(){let t=self.$gameMap.encounterStep();this._encounterCount=Math.randomInt(t)+Math.randomInt(t)+1}makeEncounterTroopId(){let t=[],e=0;if(self.$gameMap.encounterList().forEach(function(i){this.meetsEncounterConditions(i)&&(t.push(i),e+=i.weight)},this),e>0){let i=Math.randomInt(e);for(let s=0;s<t.length;s++)if(i-=t[s].weight,i<0)return t[s].troopId}return 0}meetsEncounterConditions({regionSet:t}){return t.length===0||t.contains(this.regionId())}executeEncounter(){if(!self.$gameMap.isEventRunning()&&this._encounterCount<=0){this.makeEncounterCount();let t=this.makeEncounterTroopId();return self.$dataTroops[t]?(v.setup(t,!0,!1),v.onEncounter(),!0):!1}else return!1}startMapEvent(t,e,i,s){self.$gameMap.isEventRunning()||self.$gameMap.eventsXy(t,e).forEach(a=>{a.isTriggerIn(i)&&a.isNormalPriority()===s&&a.start()})}moveByInput(){if(!this.isMoving()&&this.canMove()){let t=this.getInputDirection();if(t>0)self.$gameTemp.clearDestination();else if(self.$gameTemp.isDestinationValid()){let e=self.$gameTemp.destinationX(),i=self.$gameTemp.destinationY();t=this.findDirectionTo(e,i)}t>0&&this.executeMove(t)}}canMove(){return!(self.$gameMap.isEventRunning()||self.$gameMessage.isBusy()||this.isMoveRouteForcing()||this.areFollowersGathering()||this._vehicleGettingOn||this._vehicleGettingOff||this.isInVehicle()&&!this.vehicle().canMove())}getInputDirection(){return x.dir4}executeMove(t){this.moveStraight(t)}update(t){let e=this.scrolledX(),i=this.scrolledY(),s=this.isMoving();this.updateDashing(),t&&this.moveByInput(),super.update(),this.updateScroll(e,i),this.updateVehicle(),this.isMoving()||this.updateNonmoving(s),this._followers.update()}updateDashing(){this.isMoving()||(this.canMove()&&!this.isInVehicle()&&!self.$gameMap.isDashDisabled()?this._dashing=this.isDashButtonPressed()||self.$gameTemp.isDestinationValid():this._dashing=!1)}isDashButtonPressed(){let t=x.isPressed("shift");return ut.alwaysDash?!t:t}updateScroll(t,e){let i=t,s=e,a=this.scrolledX(),r=this.scrolledY();r>s&&r>this.centerY()&&self.$gameMap.scrollDown(r-s),a<i&&a<this.centerX()&&self.$gameMap.scrollLeft(i-a),a>i&&a>this.centerX()&&self.$gameMap.scrollRight(a-i),r<s&&r<this.centerY()&&self.$gameMap.scrollUp(s-r)}updateVehicle(){this.isInVehicle()&&!this.areFollowersGathering()&&(this._vehicleGettingOn?this.updateVehicleGetOn():this._vehicleGettingOff?this.updateVehicleGetOff():this.vehicle().syncWithPlayer())}updateVehicleGetOn(){!this.areFollowersGathering()&&!this.isMoving()&&(this.setDirection(this.vehicle().direction()),this.setMoveSpeed(this.vehicle().moveSpeed()),this._vehicleGettingOn=!1,this.setTransparent(!0),this.isInAirship()&&this.setThrough(!0),this.vehicle().getOn())}updateVehicleGetOff(){!this.areFollowersGathering()&&this.vehicle().isLowest()&&(this._vehicleGettingOff=!1,this._vehicleType="walk",this.setTransparent(!1))}updateNonmoving(t){if(!self.$gameMap.isEventRunning()){if(t&&(self.$gameParty.onPlayerWalk(),this.checkEventTriggerHere([1,2]),self.$gameMap.setupStartingEvent())||this.triggerAction())return;t?this.updateEncounterCount():self.$gameTemp.clearDestination()}}triggerAction(){return!!(this.canMove()&&(this.triggerButtonAction()||this.triggerTouchAction()))}triggerButtonAction(){return!!(x.isTriggered("ok")&&(this.getOnOffVehicle()||(this.checkEventTriggerHere([0]),self.$gameMap.setupStartingEvent())||(this.checkEventTriggerThere([0,1,2]),self.$gameMap.setupStartingEvent())))}triggerTouchAction(){if(self.$gameTemp.isDestinationValid()){let t=this.direction(),e=this.x,i=this.y,s=self.$gameMap.roundXWithDirection(e,t),a=self.$gameMap.roundYWithDirection(i,t),r=self.$gameMap.roundXWithDirection(s,t),h=self.$gameMap.roundYWithDirection(a,t),c=self.$gameTemp.destinationX(),d=self.$gameTemp.destinationY();if(c===e&&d===i)return this.triggerTouchActionD1(e,i);if(c===s&&d===a)return this.triggerTouchActionD2(s,a);if(c===r&&d===h)return this.triggerTouchActionD3(s,a)}return!1}triggerTouchActionD1(t,e){return self.$gameMap.airship().pos(t,e)&&k.isTriggered()&&this.getOnOffVehicle()?!0:(this.checkEventTriggerHere([0]),self.$gameMap.setupStartingEvent())}triggerTouchActionD2(t,e){return(self.$gameMap.boat().pos(t,e)||self.$gameMap.ship().pos(t,e))&&k.isTriggered()&&this.getOnVehicle()||(this.isInBoat()||this.isInShip())&&k.isTriggered()&&this.getOffVehicle()?!0:(this.checkEventTriggerThere([0,1,2]),self.$gameMap.setupStartingEvent())}triggerTouchActionD3(t,e){return self.$gameMap.isCounter(t,e)&&this.checkEventTriggerThere([0,1,2]),self.$gameMap.setupStartingEvent()}updateEncounterCount(){this.canEncounter()&&(this._encounterCount-=this.encounterProgressValue())}canEncounter(){return!self.$gameParty.hasEncounterNone()&&self.$gameSystem.isEncounterEnabled()&&!this.isInAirship()&&!this.isMoveRouteForcing()&&!this.isDebugThrough()}encounterProgressValue(){let t=self.$gameMap.isBush(this.x,this.y)?2:1;return self.$gameParty.hasEncounterHalf()&&(t*=.5),this.isInShip()&&(t*=.5),t}checkEventTriggerHere(t){this.canStartLocalEvents()&&this.startMapEvent(this.x,this.y,t,!1)}checkEventTriggerThere(t){if(this.canStartLocalEvents()){let e=this.direction(),i=this.x,s=this.y,a=self.$gameMap.roundXWithDirection(i,e),r=self.$gameMap.roundYWithDirection(s,e);if(this.startMapEvent(a,r,t,!0),!self.$gameMap.isAnyEventStarting()&&self.$gameMap.isCounter(a,r)){let h=self.$gameMap.roundXWithDirection(a,e),c=self.$gameMap.roundYWithDirection(r,e);this.startMapEvent(h,c,t,!0)}}}checkEventTriggerTouch(t,e){this.canStartLocalEvents()&&this.startMapEvent(t,e,[1,2],!0)}canStartLocalEvents(){return!this.isInAirship()}getOnOffVehicle(){return this.isInVehicle()?this.getOffVehicle():this.getOnVehicle()}getOnVehicle(){let t=this.direction(),e=this.x,i=this.y,s=self.$gameMap.roundXWithDirection(e,t),a=self.$gameMap.roundYWithDirection(i,t);return self.$gameMap.airship().pos(e,i)?this._vehicleType="airship":self.$gameMap.ship().pos(s,a)?this._vehicleType="ship":self.$gameMap.boat().pos(s,a)&&(this._vehicleType="boat"),this.isInVehicle()&&(this._vehicleGettingOn=!0,this.isInAirship()||this.forceMoveForward(),this.gatherFollowers()),this._vehicleGettingOn}getOffVehicle(){return this.vehicle().isLandOk(this.x,this.y,this.direction())&&(this.isInAirship()&&this.setDirection(2),this._followers.synchronize(this.x,this.y,this.direction()),this.vehicle().getOff(),this.isInAirship()||(this.forceMoveForward(),this.setTransparent(!1)),this._vehicleGettingOff=!0,this.setMoveSpeed(4),this.setThrough(!1),this.makeEncounterCount(),this.gatherFollowers()),this._vehicleGettingOff}forceMoveForward(){this.setThrough(!0),this.moveForward(),this.setThrough(!1)}isOnDamageFloor(){return self.$gameMap.isDamageFloor(this.x,this.y)&&!this.isInAirship()}moveStraight(t){this.canPass(this.x,this.y,t)&&this._followers.updateMove(),super.moveStraight(t)}moveDiagonally(t,e){this.canPassDiagonally(this.x,this.y,t,e)&&this._followers.updateMove(),super.moveDiagonally(t,e)}jump(t,e){super.jump(t,e),this._followers.jumpAll()}showFollowers(){this._followers.show()}hideFollowers(){this._followers.hide()}gatherFollowers(){this._followers.gather()}areFollowersGathering(){return this._followers.areGathering()}areFollowersGathered(){return this._followers.areGathered()}};o(dr,"Game_Player");var mr=dr;var w=class{constructor(){throw new Error("This is a static class")}static loadDatabase(){let e=this.isBattleTest()||this.isEventTest()?"Test_":"";for(let i=0;i<this._databaseFiles.length;i++){let s=this._databaseFiles[i].name,a=this._databaseFiles[i].src;this.loadDataFile(s,e+a)}this.isEventTest()&&this.loadDataFile("$testEvent",`${e}Event.json`)}static loadDataFile(t,e){let i=new XMLHttpRequest,s=`data/${e}`;i.open("GET",s),i.overrideMimeType("application/json"),i.onload=()=>{i.status<400&&(window[t]=JSON.parse(i.responseText),w.onLoad(window[t]))},i.onerror=this._mapLoader||(()=>{w._errorUrl=w._errorUrl||s}),window[t]=null,i.send()}static isDatabaseLoaded(){this.checkError();for(let t=0;t<this._databaseFiles.length;t++)if(!window[this._databaseFiles[t].name])return!1;return!0}static isGlobalInfoLoaded(){return this._isGlobalInfoLoaded}static loadMapData(t){if(t>0){let e="Map%1.json".format(t.padZero(3));this._mapLoader=ct.createLoader(`data/${e}`,this.loadDataFile.bind(this,"$dataMap",e)),this.loadDataFile("$dataMap",e)}else this.makeEmptyMap()}static isMapLoaded(){return this.checkError(),!!self.$dataMap}static onLoad(t){let e;if(t===self.$dataMap?(this.extractMetadata(t),e=t.events):e=t,Array.isArray(e))for(let i of e)i&&i.note!==void 0&&this.extractMetadata(i);t===self.$dataSystem&&(ht.hasEncryptedImages=!!t.hasEncryptedImages,ht.hasEncryptedAudio=!!t.hasEncryptedAudio,Ae.loadSystemImages())}static setupNewGame(){this.createGameObjects(),this.selectSavefileForNewGame().then(()=>{self.$gameParty.setupStartingMembers(),self.$gamePlayer.reserveTransfer(self.$dataSystem.startMapId,self.$dataSystem.startX,self.$dataSystem.startY),l.frameCount=0,g.resetFrameCount()})}static setupBattleTest(){this.createGameObjects(),self.$gameParty.setupBattleTest(),v.setup(self.$dataSystem.testTroopId,!0,!1),v.setBattleTest(!0),v.playBattleBgm()}static setupEventTest(){this.createGameObjects(),this.selectSavefileForNewGame().then(()=>{self.$gameParty.setupStartingMembers(),self.$gamePlayer.reserveTransfer(-1,8,6),self.$gamePlayer.setTransparent(!1)})}static async loadGlobalInfo(){if(this._globalInfo)return this._globalInfo;let t;try{t=await et.load(0)}catch{return this._isGlobalInfoLoaded=!0,[]}if(t){this._globalInfo=JSON.parse(t);for(let e=1;e<=this.maxSavefiles();e++)await et.exists(e)?this._saveFileExists=!0:delete this._globalInfo[e];return this._isGlobalInfoLoaded=!0,this._globalInfo}else return this._globalInfo=[],this._isGlobalInfoLoaded=!0,this._globalInfo}static saveGlobalInfo(t){this._globalInfo=null,et.save(0,JSON.stringify(t))}static async isThisGameFile(t){let e=await this.loadGlobalInfo();if(e&&e[t]){if(et.isLocalMode())return!0;{let i=e[t];return i.globalId===this._globalId&&i.title===self.$dataSystem.gameTitle}}else return!1}static isAnySavefileExists(){return this._saveFileExists}static async latestSavefileId(){let t=await this.loadGlobalInfo(),e=1,i=0;if(t)for(let s=1;s<t.length;s++)await this.isThisGameFile(s)&&t[s].timestamp>i&&(i=t[s].timestamp,e=s);return e}static async loadAllSavefileImages(){let t=await this.loadGlobalInfo();if(t){for(let e=1;e<t.length;e++)if(await this.isThisGameFile(e)){let i=t[e];this.loadSavefileImages(i)}}}static onBeforeSave(){}static onAfterSave(){}static async saveGame(t){try{this.onBeforeSave(),await et.backup(t);let e=await this.saveGameWithoutRescue(t);return this.onAfterSave(),e}catch{try{await et.remove(t),await et.restoreBackup(t)}catch{}return!1}}static onBeforeLoad(){}static onAfterLoad(){}static async loadGame(t){try{this.onBeforeLoad();let e=await this.loadGameWithoutRescue(t);return this.onAfterLoad(),e}catch{return!1}}static async loadSavefileInfo(t){let e=await this.loadGlobalInfo();return e&&e[t]?e[t]:null}static lastAccessedSavefileId(){return this._lastAccessedId}static async saveGameWithoutRescue(t){let e=Ft.stringify(this.makeSaveContents());e.length>=2e5,await et.save(t,e),this._lastAccessedId=t;let i=await this.loadGlobalInfo()||[];return i[t]=this.makeSavefileInfo(),await this.saveGlobalInfo(i),!0}static async loadGameWithoutRescue(t){if(await this.isThisGameFile(t)){let e=await et.load(t);return this.createGameObjects(),this.extractSaveContents(Ft.parse(e)),this._lastAccessedId=t,!0}else return!1}static async selectSavefileForNewGame(){let t=await this.loadGlobalInfo();if(this._lastAccessedId=1,t){let e=Math.max(0,t.length-1);if(e<this.maxSavefiles())this._lastAccessedId=e+1;else{let i=Number.MAX_VALUE;for(let s=1;s<t.length;s++){if(!t[s]){this._lastAccessedId=s;break}t[s].timestamp<i&&(i=t[s].timestamp,this._lastAccessedId=s)}}}}static makeSavefileInfo(){let t={};return t.globalId=this._globalId,t.title=self.$dataSystem.gameTitle,t.characters=self.$gameParty.charactersForSavefile(),t.faces=self.$gameParty.facesForSavefile(),t.playtime=self.$gameSystem.playtimeText(),t.timestamp=Date.now(),t}static setAutoSaveFileId(t){this._autoSaveFileId=t}static isAutoSaveFileId(t){return this._autoSaveFileId!==0&&this._autoSaveFileId===t}static autoSaveGame(){this._autoSaveFileId!==0&&!this.isEventTest()&&self.$gameSystem.isSaveEnabled()&&(self.$gameSystem.onBeforeSave(),this.saveGame(this._autoSaveFileId).then(t=>{t&&et.cleanBackup(this._autoSaveFileId)}))}static makeEmptyMap(){self.$dataMap={},self.$dataMap.data=[],self.$dataMap.events=[],self.$dataMap.width=100,self.$dataMap.height=100,self.$dataMap.scrollType=3}static extractMetadata(t){let e=/<([^<>:]+)(:?)([^>]*)>/g;for(t.meta={};;){let i=e.exec(t.note);if(i)i[2]===":"?t.meta[i[1]]=i[3]:t.meta[i[1]]=!0;else break}}static checkError(){if(w._errorUrl)throw new Error(`Failed to load: ${w._errorUrl}`)}static isBattleTest(){return I.isOptionValid("btest")}static isEventTest(){return I.isOptionValid("etest")}static isSkill(t){return t&&self.$dataSkills.contains(t)}static isItem(t){return t&&self.$dataItems.contains(t)}static isWeapon(t){return t&&self.$dataWeapons.contains(t)}static isArmor(t){return t&&self.$dataArmors.contains(t)}static createGameObjects(){self.$gameTemp=new oa,self.$gameSystem=new la,self.$gameScreen=new ua,self.$gameTimer=new fa,self.$gameMessage=new ga,self.$gameSwitches=new ya,self.$gameVariables=new Sa,self.$gameSelfSwitches=new Ta,self.$gameActors=new Aa,self.$gameParty=new Pa,self.$gameTroop=new Qa,self.$gameMap=new nr,self.$gamePlayer=new mr}static loadSavefileImages({characters:t,faces:e}){if(t)for(let i=0;i<t.length;i++)p.reserveCharacter(t[i][0]);if(e)for(let i=0;i<e.length;i++)p.reserveFace(e[i][0])}static maxSavefiles(){return 20}static makeSaveContents(){let t={};return t.system=self.$gameSystem,t.screen=self.$gameScreen,t.timer=self.$gameTimer,t.switches=self.$gameSwitches,t.variables=self.$gameVariables,t.selfSwitches=self.$gameSelfSwitches,t.actors=self.$gameActors,t.party=self.$gameParty,t.map=self.$gameMap,t.player=self.$gamePlayer,t}static extractSaveContents(t){self.$gameSystem=t.system,self.$gameScreen=t.screen,self.$gameTimer=t.timer,self.$gameSwitches=t.switches,self.$gameVariables=t.variables,self.$gameSelfSwitches=t.selfSwitches,self.$gameActors=t.actors,self.$gameParty=t.party,self.$gameMap=t.map,self.$gamePlayer=t.player}};o(w,"DataManager");w._globalId="RPGMV";w._lastAccessedId=1;w._errorUrl=null;w._autoSaveFileId=0;w._isGlobalInfoLoaded=!1;w._saveFileExists=!1;w._databaseFiles=[{name:"$dataActors",src:"Actors.json"},{name:"$dataClasses",src:"Classes.json"},{name:"$dataSkills",src:"Skills.json"},{name:"$dataItems",src:"Items.json"},{name:"$dataWeapons",src:"Weapons.json"},{name:"$dataArmors",src:"Armors.json"},{name:"$dataEnemies",src:"Enemies.json"},{name:"$dataTroops",src:"Troops.json"},{name:"$dataStates",src:"States.json"},{name:"$dataAnimations",src:"Animations.json"},{name:"$dataTilesets",src:"Tilesets.json"},{name:"$dataCommonEvents",src:"CommonEvents.json"},{name:"$dataSystem",src:"System.json"},{name:"$dataMapInfos",src:"MapInfos.json"}];var pr=null,fr=null,_r=null,gr=null,wr=null,yr=null,br=null,Sr=null,xr=null,Tr=null,vr=null,Cr=null,Ir=null,Mr=null,Er=null,kr=null,Ar=null,Wr=null,Pr=null,Br=null,Rr=null,$r=null,Fr=null,Dr=null,Lr=null,Or=null,Nr=null,Hr=null,zr=null;((n,t,e)=>{n.$dataActors=pr,n.$dataClasses=fr,n.$dataSkills=_r,n.$dataItems=gr,n.$dataWeapons=wr,n.$dataArmors=yr,n.$dataEnemies=br,n.$dataTroops=Sr,n.$dataStates=xr,n.$dataAnimations=Tr,n.$dataTilesets=vr,n.$dataCommonEvents=Cr,n.$dataSystem=Ir,n.$dataMapInfos=Mr,n.$dataMap=Er,n.$gameTemp=kr,n.$gameSystem=Ar,n.$gameScreen=Wr,n.$gameTimer=Pr,n.$gameMessage=Br,n.$gameSwitches=Rr,n.$gameVariables=$r,n.$gameSelfSwitches=Fr,n.$gameActors=Dr,n.$gameParty=Lr,n.$gameTroop=Or,n.$gameMap=Nr,n.$gamePlayer=Hr,n.$testEvent=zr,n.Game_Temp=oa,n.Game_System=la,n.Game_Timer=fa,n.Game_Message=ga,n.Game_Switches=ya,n.Game_Variables=Sa,n.Game_SelfSwitches=Ta,n.Game_Screen=ua,n.Game_Picture=da,n.Game_Item=Bt,n.Game_Action=mt,n.Game_ActionResult=Ca,n.Game_BattlerBase=ve,n.Game_Battler=kt,n.Game_Actor=Ea,n.Game_Enemy=Ra,n.Game_Actors=Aa,n.Game_Unit=ae,n.Game_Party=Pa,n.Game_Troop=Qa,n.Game_Map=nr,n.Game_CommonEvent=er,n.Game_CharacterBase=$a,n.Game_Character=nt,n.Game_Player=mr,n.Game_Follower=hr,n.Game_Followers=cr,n.Game_Vehicle=Ce,n.Game_Event=ar,n.Game_Interpreter=Q,n.Scene_Base=it,n.Scene_Boot=Ae,n.Scene_Title=ft,n.Scene_Map=Rt,n.Scene_MenuBase=Y,n.Scene_Menu=Se,n.Scene_ItemBase=_e,n.Scene_Item=hs,n.Scene_Skill=ps,n.Scene_Equip=vs,n.Scene_Status=Es,n.Scene_Options=we,n.Scene_File=ye,n.Scene_Save=be,n.Scene_Load=xe,n.Scene_GameEnd=Os,n.Scene_Shop=Ga,n.Scene_Name=Ja,n.Scene_Debug=Xs,n.Scene_Battle=Ct,n.Scene_Gameover=Tt,n.Sprite_Base=pt,n.Sprite_Button=ce,n.Sprite_Character=se,n.Sprite_Battler=le,n.Sprite_Actor=bi,n.Sprite_Enemy=fi,n.Sprite_Animation=hi,n.Sprite_Damage=di,n.Sprite_StateIcon=ui,n.Sprite_StateOverlay=yi,n.Sprite_Weapon=gi,n.Sprite_Balloon=Ks,n.Sprite_Picture=ai,n.Sprite_Timer=ni,n.Sprite_Destination=Qs,n.Spriteset_Base=he,n.Spriteset_Map=ea,n.Spriteset_Battle=xi,n.Window_Base=H,n.Window_Selectable=D,n.Window_Command=J,n.Window_HorzCommand=Zt,n.Window_Help=Gt,n.Window_Gold=Yt,n.Window_MenuCommand=Kt,n.Window_MenuStatus=fe,n.Window_MenuActor=ss,n.Window_ItemCategory=ge,n.Window_ItemList=vt,n.Window_SkillType=cs,n.Window_SkillStatus=ms,n.Window_SkillList=pe,n.Window_EquipStatus=_s,n.Window_EquipCommand=ws,n.Window_EquipSlot=bs,n.Window_EquipItem=xs,n.Window_Status=Is,n.Window_Options=As,n.Window_SavefileList=Bs,n.Window_ShopCommand=Da,n.Window_ShopBuy=Oa,n.Window_ShopSell=Ha,n.Window_ShopNumber=Va,n.Window_ShopStatus=Ua,n.Window_NameEdit=ja,n.Window_NameInput=Ka,n.Window_ChoiceList=Ei,n.Window_NumberInput=Wi,n.Window_EventItem=Ri,n.Window_Message=de,n.Window_ScrollText=me,n.Window_MapName=Ys,n.Window_BattleLog=Li,n.Window_PartyCommand=Ni,n.Window_ActorCommand=zi,n.Window_BattleStatus=ue,n.Window_BattleActor=Ui,n.Window_BattleEnemy=Gi,n.Window_BattleSkill=Ki,n.Window_BattleItem=Ji,n.Window_TitleCommand=Te,n.Window_GameEnd=Ds,n.Window_DebugRange=zs,n.Window_DebugEdit=qs,n.ProgressWatcher=te,n.Utils=I,n.CacheEntry=Be,n.CacheMap=$e,n.ImageCache=Ie,n.RequestQueue=De,n.Point=Wt,n.Rectangle=G,n.Bitmap=V,n.BitmapPIXI=qt,n.Graphics=l,n.Input=x,n.TouchInput=k,n.Sprite=C,n.Tilemap=U,n.ShaderTilemap=ze,n.TilingSprite=Ut,n.ScreenSprite=St,n.WindowSkinCache=Ee,n.Window=qe,n.WindowLayer=Ue,n.Weather=Ge,n.ToneFilter=je,n.ToneSprite=Ze,n.Stage=Qe,n.WebAudio=zt,n.JsonEx=Ft,n.Decrypter=ht,n.ResourceHandler=ct,n.DataManager=w,n.ConfigManager=ut,n.GameStorageManager=et,n.ImageManager=p,n.AudioManager=b,n.SoundManager=S,n.TextManager=m,n.SceneManager=g,n.BattleManager=v,n.PluginManager=Me,Me.setup($plugins);let i=o(()=>{t.body.classList.remove("is-loading"),e.settings.SCALE_MODE=e.SCALE_MODES.NEAREST,e.settings.ROUND_PIXELS=!0,e.settings.GC_MAX_IDLE=600,e.settings.MIPMAP_TEXTURES=e.MIPMAP_MODES.OFF,e.settings.RESOLUTION=1,I.isMobileSafari()&&(e.settings.PRECISION_FRAGMENT=e.PRECISION.HIGH),g.run(Ae)},"init");t.readyState==="complete"?i():window.addEventListener("load",i)})(self,document,PIXI);})();
/**
 * Re-add ZLayer functionality to @pixi/tilemap.
 *
 * @link https://github.com/pixijs/tilemap/blob/master/demo/rpgmaker.js
 * @credit https://github.com/pixijs/tilemap/graphs/contributors
 * @license https://github.com/pixijs/tilemap/blob/master/LICENSE
 */
