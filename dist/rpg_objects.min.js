// @license https://github.com/thinknathan/corescript/blob/master/LICENSE
"use strict"
function Game_Temp(){this.initialize.apply(this,arguments)}function Game_System(){this.initialize.apply(this,arguments)}function Game_Timer(){this.initialize.apply(this,arguments)}function Game_Message(){this.initialize.apply(this,arguments)}function Game_Switches(){this.initialize.apply(this,arguments)}function Game_Variables(){this.initialize.apply(this,arguments)}function Game_SelfSwitches(){this.initialize.apply(this,arguments)}function Game_Screen(){this.initialize.apply(this,arguments)}function Game_Picture(){this.initialize.apply(this,arguments)}function Game_Item(){this.initialize.apply(this,arguments)}function Game_Action(){this.initialize.apply(this,arguments)}function Game_ActionResult(){this.initialize.apply(this,arguments)}function Game_BattlerBase(){this.initialize.apply(this,arguments)}function Game_Battler(){this.initialize.apply(this,arguments)}function Game_Actor(){this.initialize.apply(this,arguments)}function Game_Enemy(){this.initialize.apply(this,arguments)}function Game_Actors(){this.initialize.apply(this,arguments)}function Game_Unit(){this.initialize.apply(this,arguments)}function Game_Party(){this.initialize.apply(this,arguments)}function Game_Troop(){this.initialize.apply(this,arguments)}function Game_Map(){this.initialize.apply(this,arguments)}function Game_CommonEvent(){this.initialize.apply(this,arguments)}function Game_CharacterBase(){this.initialize.apply(this,arguments)}function Game_Character(){this.initialize.apply(this,arguments)}function Game_Player(){this.initialize.apply(this,arguments)}function Game_Follower(){this.initialize.apply(this,arguments)}function Game_Followers(){this.initialize.apply(this,arguments)}function Game_Vehicle(){this.initialize.apply(this,arguments)}function Game_Event(){this.initialize.apply(this,arguments)}function Game_Interpreter(){this.initialize.apply(this,arguments)}Game_Temp.prototype.initialize=function(){this._isPlaytest=Utils.isOptionValid("test"),this._commonEventId=0,this._destinationX=null,this._destinationY=null},Game_Temp.prototype.isPlaytest=function(){return this._isPlaytest},Game_Temp.prototype.reserveCommonEvent=function(commonEventId){this._commonEventId=commonEventId},Game_Temp.prototype.clearCommonEvent=function(){this._commonEventId=0},Game_Temp.prototype.isCommonEventReserved=function(){return this._commonEventId>0},Game_Temp.prototype.reservedCommonEvent=function(){return $dataCommonEvents[this._commonEventId]},Game_Temp.prototype.reservedCommonEventId=function(){return this._commonEventId},Game_Temp.prototype.setDestination=function(x,y){this._destinationX=x,this._destinationY=y},Game_Temp.prototype.clearDestination=function(){this._destinationX=null,this._destinationY=null},Game_Temp.prototype.isDestinationValid=function(){return null!==this._destinationX},Game_Temp.prototype.destinationX=function(){return this._destinationX},Game_Temp.prototype.destinationY=function(){return this._destinationY},Game_System.prototype.initialize=function(){this._saveEnabled=!0,this._menuEnabled=!0,this._encounterEnabled=!0,this._formationEnabled=!0,this._battleCount=0,this._winCount=0,this._escapeCount=0,this._saveCount=0,this._versionId=0,this._framesOnSave=0,this._sceneFramesOnSave=0,this._bgmOnSave=null,this._bgsOnSave=null,this._windowTone=null,this._battleBgm=null,this._victoryMe=null,this._defeatMe=null,this._savedBgm=null,this._walkingBgm=null},Game_System.prototype.isJapanese=function(){return $dataSystem.locale.match(/^ja/)},Game_System.prototype.isChinese=function(){return $dataSystem.locale.match(/^zh/)},Game_System.prototype.isKorean=function(){return $dataSystem.locale.match(/^ko/)},Game_System.prototype.isCJK=function(){return $dataSystem.locale.match(/^(ja|zh|ko)/)},Game_System.prototype.isRussian=function(){return $dataSystem.locale.match(/^ru/)},Game_System.prototype.isSideView=function(){return $dataSystem.optSideView},Game_System.prototype.isSaveEnabled=function(){return this._saveEnabled},Game_System.prototype.disableSave=function(){this._saveEnabled=!1},Game_System.prototype.enableSave=function(){this._saveEnabled=!0},Game_System.prototype.isMenuEnabled=function(){return this._menuEnabled},Game_System.prototype.disableMenu=function(){this._menuEnabled=!1},Game_System.prototype.enableMenu=function(){this._menuEnabled=!0},Game_System.prototype.isEncounterEnabled=function(){return this._encounterEnabled},Game_System.prototype.disableEncounter=function(){this._encounterEnabled=!1},Game_System.prototype.enableEncounter=function(){this._encounterEnabled=!0},Game_System.prototype.isFormationEnabled=function(){return this._formationEnabled},Game_System.prototype.disableFormation=function(){this._formationEnabled=!1},Game_System.prototype.enableFormation=function(){this._formationEnabled=!0},Game_System.prototype.battleCount=function(){return this._battleCount},Game_System.prototype.winCount=function(){return this._winCount},Game_System.prototype.escapeCount=function(){return this._escapeCount},Game_System.prototype.saveCount=function(){return this._saveCount},Game_System.prototype.versionId=function(){return this._versionId},Game_System.prototype.windowTone=function(){return this._windowTone||$dataSystem.windowTone},Game_System.prototype.setWindowTone=function(value){this._windowTone=value},Game_System.prototype.battleBgm=function(){return this._battleBgm||$dataSystem.battleBgm},Game_System.prototype.setBattleBgm=function(value){this._battleBgm=value},Game_System.prototype.victoryMe=function(){return this._victoryMe||$dataSystem.victoryMe},Game_System.prototype.setVictoryMe=function(value){this._victoryMe=value},Game_System.prototype.defeatMe=function(){return this._defeatMe||$dataSystem.defeatMe},Game_System.prototype.setDefeatMe=function(value){this._defeatMe=value},Game_System.prototype.onBattleStart=function(){this._battleCount++},Game_System.prototype.onBattleWin=function(){this._winCount++},Game_System.prototype.onBattleEscape=function(){this._escapeCount++},Game_System.prototype.onBeforeSave=function(){this._saveCount++,this._versionId=$dataSystem.versionId,this._framesOnSave=Graphics.frameCount,this._sceneFramesOnSave=SceneManager.frameCount(),this._bgmOnSave=AudioManager.saveBgm(),this._bgsOnSave=AudioManager.saveBgs()},Game_System.prototype.onAfterLoad=function(){Graphics.frameCount=this._framesOnSave,SceneManager.setFrameCount(this._sceneFramesOnSave||this._framesOnSave),AudioManager.playBgm(this._bgmOnSave),AudioManager.playBgs(this._bgsOnSave)},Game_System.prototype.playtime=function(){return Math.floor(SceneManager.frameCount()/60)},Game_System.prototype.playtimeText=function(){const hour=Math.floor(this.playtime()/60/60),min=Math.floor(this.playtime()/60)%60,sec=this.playtime()%60
return hour.padZero(2)+":"+min.padZero(2)+":"+sec.padZero(2)},Game_System.prototype.saveBgm=function(){this._savedBgm=AudioManager.saveBgm()},Game_System.prototype.replayBgm=function(){this._savedBgm&&AudioManager.replayBgm(this._savedBgm)},Game_System.prototype.saveWalkingBgm=function(){this._walkingBgm=AudioManager.saveBgm()},Game_System.prototype.replayWalkingBgm=function(){this._walkingBgm&&AudioManager.playBgm(this._walkingBgm)},Game_System.prototype.saveWalkingBgm2=function(){this._walkingBgm=$dataMap.bgm},Game_Timer.prototype.initialize=function(){this._frames=0,this._working=!1},Game_Timer.prototype.update=function(sceneActive){sceneActive&&this._working&&this._frames>0&&(this._frames--,0===this._frames&&this.onExpire())},Game_Timer.prototype.start=function(count){this._frames=count,this._working=!0},Game_Timer.prototype.stop=function(){this._working=!1},Game_Timer.prototype.isWorking=function(){return this._working},Game_Timer.prototype.seconds=function(){return Math.floor(this._frames/60)},Game_Timer.prototype.onExpire=function(){BattleManager.abort()},Game_Message.prototype.initialize=function(){this.clear()},Game_Message.prototype.clear=function(){this._texts=[],this._choices=[],this._faceName="",this._faceIndex=0,this._background=0,this._positionType=2,this._choiceDefaultType=0,this._choiceCancelType=0,this._choiceBackground=0,this._choicePositionType=2,this._numInputVariableId=0,this._numInputMaxDigits=0,this._itemChoiceVariableId=0,this._itemChoiceItypeId=0,this._scrollMode=!1,this._scrollSpeed=2,this._scrollNoFast=!1,this._choiceCallback=null},Game_Message.prototype.choices=function(){return this._choices},Game_Message.prototype.faceName=function(){return this._faceName},Game_Message.prototype.faceIndex=function(){return this._faceIndex},Game_Message.prototype.background=function(){return this._background},Game_Message.prototype.positionType=function(){return this._positionType},Game_Message.prototype.choiceDefaultType=function(){return this._choiceDefaultType},Game_Message.prototype.choiceCancelType=function(){return this._choiceCancelType},Game_Message.prototype.choiceBackground=function(){return this._choiceBackground},Game_Message.prototype.choicePositionType=function(){return this._choicePositionType},Game_Message.prototype.numInputVariableId=function(){return this._numInputVariableId},Game_Message.prototype.numInputMaxDigits=function(){return this._numInputMaxDigits},Game_Message.prototype.itemChoiceVariableId=function(){return this._itemChoiceVariableId},Game_Message.prototype.itemChoiceItypeId=function(){return this._itemChoiceItypeId},Game_Message.prototype.scrollMode=function(){return this._scrollMode},Game_Message.prototype.scrollSpeed=function(){return this._scrollSpeed},Game_Message.prototype.scrollNoFast=function(){return this._scrollNoFast},Game_Message.prototype.add=function(text){this._texts.push(text)},Game_Message.prototype.setFaceImage=function(faceName,faceIndex){this._faceName=faceName,this._faceIndex=faceIndex},Game_Message.prototype.setBackground=function(background){this._background=background},Game_Message.prototype.setPositionType=function(positionType){this._positionType=positionType},Game_Message.prototype.setChoices=function(choices,defaultType,cancelType){this._choices=choices,this._choiceDefaultType=defaultType,this._choiceCancelType=cancelType},Game_Message.prototype.setChoiceBackground=function(background){this._choiceBackground=background},Game_Message.prototype.setChoicePositionType=function(positionType){this._choicePositionType=positionType},Game_Message.prototype.setNumberInput=function(variableId,maxDigits){this._numInputVariableId=variableId,this._numInputMaxDigits=maxDigits},Game_Message.prototype.setItemChoice=function(variableId,itemType){this._itemChoiceVariableId=variableId,this._itemChoiceItypeId=itemType},Game_Message.prototype.setScroll=function(speed,noFast){this._scrollMode=!0,this._scrollSpeed=speed,this._scrollNoFast=noFast},Game_Message.prototype.setChoiceCallback=function(callback){this._choiceCallback=callback},Game_Message.prototype.onChoice=function(n){this._choiceCallback&&(this._choiceCallback(n),this._choiceCallback=null)},Game_Message.prototype.hasText=function(){return this._texts.length>0},Game_Message.prototype.isChoice=function(){return this._choices.length>0},Game_Message.prototype.isNumberInput=function(){return this._numInputVariableId>0},Game_Message.prototype.isItemChoice=function(){return this._itemChoiceVariableId>0},Game_Message.prototype.isBusy=function(){return this.hasText()||this.isChoice()||this.isNumberInput()||this.isItemChoice()},Game_Message.prototype.newPage=function(){this._texts.length>0&&(this._texts[this._texts.length-1]+="\f")},Game_Message.prototype.allText=function(){return this._texts.join("\n")},Game_Switches.prototype.initialize=function(){this.clear()},Game_Switches.prototype.clear=function(){this._data=[]},Game_Switches.prototype.value=function(switchId){return!!this._data[switchId]},Game_Switches.prototype.setValue=function(switchId,value){switchId>0&&switchId<$dataSystem.switches.length&&(this._data[switchId]=value,this.onChange())},Game_Switches.prototype.onChange=function(){$gameMap.requestRefresh()},Game_Variables.prototype.initialize=function(){this.clear()},Game_Variables.prototype.clear=function(){this._data=[]},Game_Variables.prototype.value=function(variableId){return this._data[variableId]||0},Game_Variables.prototype.setValue=function(variableId,value){variableId>0&&variableId<$dataSystem.variables.length&&("number"==typeof value&&(value=Math.floor(value)),this._data[variableId]=value,this.onChange())},Game_Variables.prototype.onChange=function(){$gameMap.requestRefresh()},Game_SelfSwitches.prototype.initialize=function(){this.clear()},Game_SelfSwitches.prototype.clear=function(){this._data={}},Game_SelfSwitches.prototype.value=function(key){return!!this._data[key]},Game_SelfSwitches.prototype.setValue=function(key,value){value?this._data[key]=!0:delete this._data[key],this.onChange()},Game_SelfSwitches.prototype.onChange=function(){$gameMap.requestRefresh()},Game_Screen.prototype.initialize=function(){this.clear()},Game_Screen.prototype.clear=function(){this.clearFade(),this.clearTone(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.clearWeather(),this.clearPictures()},Game_Screen.prototype.onBattleStart=function(){this.clearFade(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.eraseBattlePictures()},Game_Screen.prototype.brightness=function(){return this._brightness},Game_Screen.prototype.tone=function(){return this._tone},Game_Screen.prototype.flashColor=function(){return this._flashColor},Game_Screen.prototype.shake=function(){return this._shake},Game_Screen.prototype.zoomX=function(){return this._zoomX},Game_Screen.prototype.zoomY=function(){return this._zoomY},Game_Screen.prototype.zoomScale=function(){return this._zoomScale},Game_Screen.prototype.weatherType=function(){return this._weatherType},Game_Screen.prototype.weatherPower=function(){return this._weatherPower},Game_Screen.prototype.picture=function(pictureId){const realPictureId=this.realPictureId(pictureId)
return this._pictures[realPictureId]},Game_Screen.prototype.realPictureId=function(pictureId){return $gameParty.inBattle()?pictureId+this.maxPictures():pictureId},Game_Screen.prototype.clearFade=function(){this._brightness=255,this._fadeOutDuration=0,this._fadeInDuration=0},Game_Screen.prototype.clearTone=function(){this._tone=[0,0,0,0],this._toneTarget=[0,0,0,0],this._toneDuration=0},Game_Screen.prototype.clearFlash=function(){this._flashColor=[0,0,0,0],this._flashDuration=0},Game_Screen.prototype.clearShake=function(){this._shakePower=0,this._shakeSpeed=0,this._shakeDuration=0,this._shakeDirection=1,this._shake=0},Game_Screen.prototype.clearZoom=function(){this._zoomX=0,this._zoomY=0,this._zoomScale=1,this._zoomScaleTarget=1,this._zoomDuration=0},Game_Screen.prototype.clearWeather=function(){this._weatherType="none",this._weatherPower=0,this._weatherPowerTarget=0,this._weatherDuration=0},Game_Screen.prototype.clearPictures=function(){this._pictures=[]},Game_Screen.prototype.eraseBattlePictures=function(){this._pictures=this._pictures.slice(0,this.maxPictures()+1)},Game_Screen.prototype.maxPictures=function(){return 100},Game_Screen.prototype.startFadeOut=function(duration){this._fadeOutDuration=duration,this._fadeInDuration=0},Game_Screen.prototype.startFadeIn=function(duration){this._fadeInDuration=duration,this._fadeOutDuration=0},Game_Screen.prototype.startTint=function(tone,duration){this._toneTarget=tone.clone(),this._toneDuration=duration,0===this._toneDuration&&(this._tone=this._toneTarget.clone())},Game_Screen.prototype.startFlash=function(color,duration){this._flashColor=color.clone(),this._flashDuration=duration},Game_Screen.prototype.startShake=function(power,speed,duration){this._shakePower=power,this._shakeSpeed=speed,this._shakeDuration=duration},Game_Screen.prototype.startZoom=function(x,y,scale,duration){this._zoomX=x,this._zoomY=y,this._zoomScaleTarget=scale,this._zoomDuration=duration},Game_Screen.prototype.setZoom=function(x,y,scale){this._zoomX=x,this._zoomY=y,this._zoomScale=scale},Game_Screen.prototype.changeWeather=function(type,power,duration){"none"===type&&0!==duration||(this._weatherType=type),this._weatherPowerTarget="none"===type?0:power,this._weatherDuration=duration,0===duration&&(this._weatherPower=this._weatherPowerTarget)},Game_Screen.prototype.update=function(){this.updateFadeOut(),this.updateFadeIn(),this.updateTone(),this.updateFlash(),this.updateShake(),this.updateZoom(),this.updateWeather(),this.updatePictures()},Game_Screen.prototype.updateFadeOut=function(){if(this._fadeOutDuration>0){const d=this._fadeOutDuration
this._brightness=this._brightness*(d-1)/d,this._fadeOutDuration--}},Game_Screen.prototype.updateFadeIn=function(){if(this._fadeInDuration>0){const d=this._fadeInDuration
this._brightness=(this._brightness*(d-1)+255)/d,this._fadeInDuration--}},Game_Screen.prototype.updateTone=function(){if(this._toneDuration>0){const d=this._toneDuration
for(let i=0;i<4;i++)this._tone[i]=(this._tone[i]*(d-1)+this._toneTarget[i])/d
this._toneDuration--}},Game_Screen.prototype.updateFlash=function(){if(this._flashDuration>0){const d=this._flashDuration
this._flashColor[3]*=(d-1)/d,this._flashDuration--}},Game_Screen.prototype.updateShake=function(){if(this._shakeDuration>0||0!==this._shake){const delta=this._shakePower*this._shakeSpeed*this._shakeDirection/10
this._shakeDuration<=1&&this._shake*(this._shake+delta)<0?this._shake=0:this._shake+=delta,this._shake>2*this._shakePower&&(this._shakeDirection=-1),this._shake<2*-this._shakePower&&(this._shakeDirection=1),this._shakeDuration--}},Game_Screen.prototype.updateZoom=function(){if(this._zoomDuration>0){const d=this._zoomDuration,t=this._zoomScaleTarget
this._zoomScale=(this._zoomScale*(d-1)+t)/d,this._zoomDuration--}},Game_Screen.prototype.updateWeather=function(){if(this._weatherDuration>0){const d=this._weatherDuration,t=this._weatherPowerTarget
this._weatherPower=(this._weatherPower*(d-1)+t)/d,this._weatherDuration--,0===this._weatherDuration&&0===this._weatherPowerTarget&&(this._weatherType="none")}},Game_Screen.prototype.updatePictures=function(){this._pictures.forEach((function(picture){picture&&picture.update()}))},Game_Screen.prototype.startFlashForDamage=function(){this.startFlash([255,0,0,128],8)},Game_Screen.prototype.showPicture=function(pictureId,name,origin,x,y,scaleX,scaleY,opacity,blendMode){const realPictureId=this.realPictureId(pictureId),picture=new Game_Picture
picture.show(name,origin,x,y,scaleX,scaleY,opacity,blendMode),this._pictures[realPictureId]=picture},Game_Screen.prototype.movePicture=function(pictureId,origin,x,y,scaleX,scaleY,opacity,blendMode,duration){const picture=this.picture(pictureId)
picture&&picture.move(origin,x,y,scaleX,scaleY,opacity,blendMode,duration)},Game_Screen.prototype.rotatePicture=function(pictureId,speed){const picture=this.picture(pictureId)
picture&&picture.rotate(speed)},Game_Screen.prototype.tintPicture=function(pictureId,tone,duration){const picture=this.picture(pictureId)
picture&&picture.tint(tone,duration)},Game_Screen.prototype.erasePicture=function(pictureId){const realPictureId=this.realPictureId(pictureId)
this._pictures[realPictureId]=null},Game_Picture.prototype.initialize=function(){this.initBasic(),this.initTarget(),this.initTone(),this.initRotation()},Game_Picture.prototype.name=function(){return this._name},Game_Picture.prototype.origin=function(){return this._origin},Game_Picture.prototype.x=function(){return this._x},Game_Picture.prototype.y=function(){return this._y},Game_Picture.prototype.scaleX=function(){return this._scaleX},Game_Picture.prototype.scaleY=function(){return this._scaleY},Game_Picture.prototype.opacity=function(){return this._opacity},Game_Picture.prototype.blendMode=function(){return this._blendMode},Game_Picture.prototype.tone=function(){return this._tone},Game_Picture.prototype.angle=function(){return this._angle},Game_Picture.prototype.initBasic=function(){this._name="",this._origin=0,this._x=0,this._y=0,this._scaleX=100,this._scaleY=100,this._opacity=255,this._blendMode=0},Game_Picture.prototype.initTarget=function(){this._targetX=this._x,this._targetY=this._y,this._targetScaleX=this._scaleX,this._targetScaleY=this._scaleY,this._targetOpacity=this._opacity,this._duration=0},Game_Picture.prototype.initTone=function(){this._tone=null,this._toneTarget=null,this._toneDuration=0},Game_Picture.prototype.initRotation=function(){this._angle=0,this._rotationSpeed=0},Game_Picture.prototype.show=function(name,origin,x,y,scaleX,scaleY,opacity,blendMode){this._name=name,this._origin=origin,this._x=x,this._y=y,this._scaleX=scaleX,this._scaleY=scaleY,this._opacity=opacity,this._blendMode=blendMode,this.initTarget(),this.initTone(),this.initRotation()},Game_Picture.prototype.move=function(origin,x,y,scaleX,scaleY,opacity,blendMode,duration){this._origin=origin,this._targetX=x,this._targetY=y,this._targetScaleX=scaleX,this._targetScaleY=scaleY,this._targetOpacity=opacity,this._blendMode=blendMode,this._duration=duration},Game_Picture.prototype.rotate=function(speed){this._rotationSpeed=speed},Game_Picture.prototype.tint=function(tone,duration){this._tone||(this._tone=[0,0,0,0]),this._toneTarget=tone.clone(),this._toneDuration=duration,0===this._toneDuration&&(this._tone=this._toneTarget.clone())},Game_Picture.prototype.erase=function(){this._name="",this._origin=0,this.initTarget(),this.initTone(),this.initRotation()},Game_Picture.prototype.update=function(){this.updateMove(),this.updateTone(),this.updateRotation()},Game_Picture.prototype.updateMove=function(){if(this._duration>0){const d=this._duration
this._x=(this._x*(d-1)+this._targetX)/d,this._y=(this._y*(d-1)+this._targetY)/d,this._scaleX=(this._scaleX*(d-1)+this._targetScaleX)/d,this._scaleY=(this._scaleY*(d-1)+this._targetScaleY)/d,this._opacity=(this._opacity*(d-1)+this._targetOpacity)/d,this._duration--}},Game_Picture.prototype.updateTone=function(){if(this._toneDuration>0){const d=this._toneDuration
for(let i=0;i<4;i++)this._tone[i]=(this._tone[i]*(d-1)+this._toneTarget[i])/d
this._toneDuration--}},Game_Picture.prototype.updateRotation=function(){0!==this._rotationSpeed&&(this._angle+=this._rotationSpeed/2)},Game_Item.prototype.initialize=function(item){this._dataClass="",this._itemId=0,item&&this.setObject(item)},Game_Item.prototype.isSkill=function(){return"skill"===this._dataClass},Game_Item.prototype.isItem=function(){return"item"===this._dataClass},Game_Item.prototype.isUsableItem=function(){return this.isSkill()||this.isItem()},Game_Item.prototype.isWeapon=function(){return"weapon"===this._dataClass},Game_Item.prototype.isArmor=function(){return"armor"===this._dataClass},Game_Item.prototype.isEquipItem=function(){return this.isWeapon()||this.isArmor()},Game_Item.prototype.isNull=function(){return""===this._dataClass},Game_Item.prototype.itemId=function(){return this._itemId},Game_Item.prototype.object=function(){return this.isSkill()?$dataSkills[this._itemId]:this.isItem()?$dataItems[this._itemId]:this.isWeapon()?$dataWeapons[this._itemId]:this.isArmor()?$dataArmors[this._itemId]:null},Game_Item.prototype.setObject=function(item){DataManager.isSkill(item)?this._dataClass="skill":DataManager.isItem(item)?this._dataClass="item":DataManager.isWeapon(item)?this._dataClass="weapon":DataManager.isArmor(item)?this._dataClass="armor":this._dataClass="",this._itemId=item?item.id:0},Game_Item.prototype.setEquip=function(isWeapon,itemId){this._dataClass=isWeapon?"weapon":"armor",this._itemId=itemId},Game_Action.EFFECT_RECOVER_HP=11,Game_Action.EFFECT_RECOVER_MP=12,Game_Action.EFFECT_GAIN_TP=13,Game_Action.EFFECT_ADD_STATE=21,Game_Action.EFFECT_REMOVE_STATE=22,Game_Action.EFFECT_ADD_BUFF=31,Game_Action.EFFECT_ADD_DEBUFF=32,Game_Action.EFFECT_REMOVE_BUFF=33,Game_Action.EFFECT_REMOVE_DEBUFF=34,Game_Action.EFFECT_SPECIAL=41,Game_Action.EFFECT_GROW=42,Game_Action.EFFECT_LEARN_SKILL=43,Game_Action.EFFECT_COMMON_EVENT=44,Game_Action.SPECIAL_EFFECT_ESCAPE=0,Game_Action.HITTYPE_CERTAIN=0,Game_Action.HITTYPE_PHYSICAL=1,Game_Action.HITTYPE_MAGICAL=2,Game_Action.prototype.initialize=function(subject,forcing){this._subjectActorId=0,this._subjectEnemyIndex=-1,this._forcing=forcing||!1,this.setSubject(subject),this.clear()},Game_Action.prototype.clear=function(){this._item=new Game_Item,this._targetIndex=-1},Game_Action.prototype.setSubject=function(subject){subject.isActor()?(this._subjectActorId=subject.actorId(),this._subjectEnemyIndex=-1):(this._subjectEnemyIndex=subject.index(),this._subjectActorId=0)},Game_Action.prototype.subject=function(){return this._subjectActorId>0?$gameActors.actor(this._subjectActorId):$gameTroop.members()[this._subjectEnemyIndex]},Game_Action.prototype.friendsUnit=function(){return this.subject().friendsUnit()},Game_Action.prototype.opponentsUnit=function(){return this.subject().opponentsUnit()},Game_Action.prototype.setEnemyAction=function(action){action?this.setSkill(action.skillId):this.clear()},Game_Action.prototype.setAttack=function(){this.setSkill(this.subject().attackSkillId())},Game_Action.prototype.setGuard=function(){this.setSkill(this.subject().guardSkillId())},Game_Action.prototype.setSkill=function(skillId){this._item.setObject($dataSkills[skillId])},Game_Action.prototype.setItem=function(itemId){this._item.setObject($dataItems[itemId])},Game_Action.prototype.setItemObject=function(object){this._item.setObject(object)},Game_Action.prototype.setTarget=function(targetIndex){this._targetIndex=targetIndex},Game_Action.prototype.item=function(){return this._item.object()},Game_Action.prototype.isSkill=function(){return this._item.isSkill()},Game_Action.prototype.isItem=function(){return this._item.isItem()},Game_Action.prototype.numRepeats=function(){let repeats=this.item().repeats
return this.isAttack()&&(repeats+=this.subject().attackTimesAdd()),Math.floor(repeats)},Game_Action.prototype.checkItemScope=function(list){return list.contains(this.item().scope)},Game_Action.prototype.isForOpponent=function(){return this.checkItemScope([1,2,3,4,5,6])},Game_Action.prototype.isForFriend=function(){return this.checkItemScope([7,8,9,10,11])},Game_Action.prototype.isForDeadFriend=function(){return this.checkItemScope([9,10])},Game_Action.prototype.isForUser=function(){return this.checkItemScope([11])},Game_Action.prototype.isForOne=function(){return this.checkItemScope([1,3,7,9,11])},Game_Action.prototype.isForRandom=function(){return this.checkItemScope([3,4,5,6])},Game_Action.prototype.isForAll=function(){return this.checkItemScope([2,8,10])},Game_Action.prototype.needsSelection=function(){return this.checkItemScope([1,7,9])},Game_Action.prototype.numTargets=function(){return this.isForRandom()?this.item().scope-2:0},Game_Action.prototype.checkDamageType=function(list){return list.contains(this.item().damage.type)},Game_Action.prototype.isHpEffect=function(){return this.checkDamageType([1,3,5])},Game_Action.prototype.isMpEffect=function(){return this.checkDamageType([2,4,6])},Game_Action.prototype.isDamage=function(){return this.checkDamageType([1,2])},Game_Action.prototype.isRecover=function(){return this.checkDamageType([3,4])},Game_Action.prototype.isDrain=function(){return this.checkDamageType([5,6])},Game_Action.prototype.isHpRecover=function(){return this.checkDamageType([3])},Game_Action.prototype.isMpRecover=function(){return this.checkDamageType([4])},Game_Action.prototype.isCertainHit=function(){return this.item().hitType===Game_Action.HITTYPE_CERTAIN},Game_Action.prototype.isPhysical=function(){return this.item().hitType===Game_Action.HITTYPE_PHYSICAL},Game_Action.prototype.isMagical=function(){return this.item().hitType===Game_Action.HITTYPE_MAGICAL},Game_Action.prototype.isAttack=function(){return this.item()===$dataSkills[this.subject().attackSkillId()]},Game_Action.prototype.isGuard=function(){return this.item()===$dataSkills[this.subject().guardSkillId()]},Game_Action.prototype.isMagicSkill=function(){return!!this.isSkill()&&$dataSystem.magicSkills.contains(this.item().stypeId)},Game_Action.prototype.decideRandomTarget=function(){let target
target=this.isForDeadFriend()?this.friendsUnit().randomDeadTarget():this.isForFriend()?this.friendsUnit().randomTarget():this.opponentsUnit().randomTarget(),target?this._targetIndex=target.index():this.clear()},Game_Action.prototype.setConfusion=function(){this.setAttack()},Game_Action.prototype.prepare=function(){this.subject().isConfused()&&!this._forcing&&this.setConfusion()},Game_Action.prototype.isValid=function(){return this._forcing&&this.item()||this.subject().canUse(this.item())},Game_Action.prototype.speed=function(){const agi=this.subject().agi
let speed=agi+Math.randomInt(Math.floor(5+agi/4))
return this.item()&&(speed+=this.item().speed),this.isAttack()&&(speed+=this.subject().attackSpeed()),speed},Game_Action.prototype.makeTargets=function(){let targets=[]
return!this._forcing&&this.subject().isConfused()?targets=[this.confusionTarget()]:this.isForOpponent()?targets=this.targetsForOpponents():this.isForFriend()&&(targets=this.targetsForFriends()),this.repeatTargets(targets)},Game_Action.prototype.repeatTargets=function(targets){const repeatedTargets=[],repeats=this.numRepeats()
for(let i=0;i<targets.length;i++){const target=targets[i]
if(target)for(let j=0;j<repeats;j++)repeatedTargets.push(target)}return repeatedTargets},Game_Action.prototype.confusionTarget=function(){switch(this.subject().confusionLevel()){case 1:return this.opponentsUnit().randomTarget()
case 2:return 0===Math.randomInt(2)?this.opponentsUnit().randomTarget():this.friendsUnit().randomTarget()
default:return this.friendsUnit().randomTarget()}},Game_Action.prototype.targetsForOpponents=function(){let targets=[]
const unit=this.opponentsUnit()
if(this.isForRandom())for(let i=0;i<this.numTargets();i++)targets.push(unit.randomTarget())
else this.isForOne()?this._targetIndex<0?targets.push(unit.randomTarget()):targets.push(unit.smoothTarget(this._targetIndex)):targets=unit.aliveMembers()
return targets},Game_Action.prototype.targetsForFriends=function(){let targets=[]
const unit=this.friendsUnit()
return this.isForUser()?[this.subject()]:(this.isForDeadFriend()?this.isForOne()?targets.push(unit.smoothDeadTarget(this._targetIndex)):targets=unit.deadMembers():this.isForOne()?this._targetIndex<0?targets.push(unit.randomTarget()):targets.push(unit.smoothTarget(this._targetIndex)):targets=unit.aliveMembers(),targets)},Game_Action.prototype.evaluate=function(){let value=0
return this.itemTargetCandidates().forEach((function(target){const targetValue=this.evaluateWithTarget(target)
this.isForAll()?value+=targetValue:targetValue>value&&(value=targetValue,this._targetIndex=target.index())}),this),value*=this.numRepeats(),value>0&&(value+=Math.random()),value},Game_Action.prototype.itemTargetCandidates=function(){return this.isValid()?this.isForOpponent()?this.opponentsUnit().aliveMembers():this.isForUser()?[this.subject()]:this.isForDeadFriend()?this.friendsUnit().deadMembers():this.friendsUnit().aliveMembers():[]},Game_Action.prototype.evaluateWithTarget=function(target){if(this.isHpEffect()){const value=this.makeDamageValue(target,!1)
if(this.isForOpponent())return value/Math.max(target.hp,1)
{const recovery=void 0
return Math.min(-value,target.mhp-target.hp)/target.mhp}}},Game_Action.prototype.testApply=function(target){return this.isForDeadFriend()===target.isDead()&&($gameParty.inBattle()||this.isForOpponent()||this.isHpRecover()&&target.hp<target.mhp||this.isMpRecover()&&target.mp<target.mmp||this.hasItemAnyValidEffects(target))},Game_Action.prototype.hasItemAnyValidEffects=function(target){return this.item().effects.some((function(effect){return this.testItemEffect(target,effect)}),this)},Game_Action.prototype.testItemEffect=function(target,effect){switch(effect.code){case Game_Action.EFFECT_RECOVER_HP:return target.hp<target.mhp||effect.value1<0||effect.value2<0
case Game_Action.EFFECT_RECOVER_MP:return target.mp<target.mmp||effect.value1<0||effect.value2<0
case Game_Action.EFFECT_ADD_STATE:return!target.isStateAffected(effect.dataId)
case Game_Action.EFFECT_REMOVE_STATE:return target.isStateAffected(effect.dataId)
case Game_Action.EFFECT_ADD_BUFF:return!target.isMaxBuffAffected(effect.dataId)
case Game_Action.EFFECT_ADD_DEBUFF:return!target.isMaxDebuffAffected(effect.dataId)
case Game_Action.EFFECT_REMOVE_BUFF:return target.isBuffAffected(effect.dataId)
case Game_Action.EFFECT_REMOVE_DEBUFF:return target.isDebuffAffected(effect.dataId)
case Game_Action.EFFECT_LEARN_SKILL:return target.isActor()&&!target.isLearnedSkill(effect.dataId)
default:return!0}},Game_Action.prototype.itemCnt=function(target){return this.isPhysical()&&target.canMove()?target.cnt:0},Game_Action.prototype.itemMrf=function(target){return this.isMagical()?target.mrf:0},Game_Action.prototype.itemHit=function(target){return this.isPhysical()?.01*this.item().successRate*this.subject().hit:.01*this.item().successRate},Game_Action.prototype.itemEva=function(target){return this.isPhysical()?target.eva:this.isMagical()?target.mev:0},Game_Action.prototype.itemCri=function(target){return this.item().damage.critical?this.subject().cri*(1-target.cev):0},Game_Action.prototype.apply=function(target){const result=target.result()
if(this.subject().clearResult(),result.clear(),result.used=this.testApply(target),result.missed=result.used&&Math.random()>=this.itemHit(target),result.evaded=!result.missed&&Math.random()<this.itemEva(target),result.physical=this.isPhysical(),result.drain=this.isDrain(),result.isHit()){if(this.item().damage.type>0){result.critical=Math.random()<this.itemCri(target)
const value=this.makeDamageValue(target,result.critical)
this.executeDamage(target,value)}this.item().effects.forEach((function(effect){this.applyItemEffect(target,effect)}),this),this.applyItemUserEffect(target)}},Game_Action.prototype.makeDamageValue=function(target,critical){const item=this.item(),baseValue=this.evalDamageFormula(target)
let value=baseValue*this.calcElementRate(target)
return this.isPhysical()&&(value*=target.pdr),this.isMagical()&&(value*=target.mdr),baseValue<0&&(value*=target.rec),critical&&(value=this.applyCritical(value)),value=this.applyVariance(value,item.damage.variance),value=this.applyGuard(value,target),value=Math.round(value),value},Game_Action.prototype.evalDamageFormula=function(target){try{const item=this.item(),a=this.subject(),b=target,v=$gameVariables._data,sign=[3,4].contains(item.damage.type)?-1:1,value=Math.max(eval(item.damage.formula),0)*sign
return isNaN(value)&&(value=0),value}catch(e){return 0}},Game_Action.prototype.calcElementRate=function(target){return this.item().damage.elementId<0?this.elementsMaxRate(target,this.subject().attackElements()):target.elementRate(this.item().damage.elementId)},Game_Action.prototype.elementsMaxRate=function(target,elements){return elements.length>0?Math.max.apply(null,elements.map((function(elementId){return target.elementRate(elementId)}),this)):1},Game_Action.prototype.applyCritical=function(damage){return 3*damage},Game_Action.prototype.applyVariance=function(damage,variance){const amp=Math.floor(Math.max(Math.abs(damage)*variance/100,0)),v=Math.randomInt(amp+1)+Math.randomInt(amp+1)-amp
return damage>=0?damage+v:damage-v},Game_Action.prototype.applyGuard=function(damage,target){return damage/(damage>0&&target.isGuard()?2*target.grd:1)},Game_Action.prototype.executeDamage=function(target,value){const result=target.result()
0===value&&(result.critical=!1),this.isHpEffect()&&this.executeHpDamage(target,value),this.isMpEffect()&&this.executeMpDamage(target,value)},Game_Action.prototype.executeHpDamage=function(target,value){this.isDrain()&&(value=Math.min(target.hp,value)),this.makeSuccess(target),target.gainHp(-value),value>0&&target.onDamage(value),this.gainDrainedHp(value)},Game_Action.prototype.executeMpDamage=function(target,value){this.isMpRecover()||(value=Math.min(target.mp,value)),0!==value&&this.makeSuccess(target),target.gainMp(-value),this.gainDrainedMp(value)},Game_Action.prototype.gainDrainedHp=function(value){if(this.isDrain()){let gainTarget=this.subject()
void 0!==this._reflectionTarget&&(gainTarget=this._reflectionTarget),gainTarget.gainHp(value)}},Game_Action.prototype.gainDrainedMp=function(value){if(this.isDrain()){let gainTarget=this.subject()
void 0!==this._reflectionTarget&&(gainTarget=this._reflectionTarget),gainTarget.gainMp(value)}},Game_Action.prototype.applyItemEffect=function(target,effect){switch(effect.code){case Game_Action.EFFECT_RECOVER_HP:this.itemEffectRecoverHp(target,effect)
break
case Game_Action.EFFECT_RECOVER_MP:this.itemEffectRecoverMp(target,effect)
break
case Game_Action.EFFECT_GAIN_TP:this.itemEffectGainTp(target,effect)
break
case Game_Action.EFFECT_ADD_STATE:this.itemEffectAddState(target,effect)
break
case Game_Action.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(target,effect)
break
case Game_Action.EFFECT_ADD_BUFF:this.itemEffectAddBuff(target,effect)
break
case Game_Action.EFFECT_ADD_DEBUFF:this.itemEffectAddDebuff(target,effect)
break
case Game_Action.EFFECT_REMOVE_BUFF:this.itemEffectRemoveBuff(target,effect)
break
case Game_Action.EFFECT_REMOVE_DEBUFF:this.itemEffectRemoveDebuff(target,effect)
break
case Game_Action.EFFECT_SPECIAL:this.itemEffectSpecial(target,effect)
break
case Game_Action.EFFECT_GROW:this.itemEffectGrow(target,effect)
break
case Game_Action.EFFECT_LEARN_SKILL:this.itemEffectLearnSkill(target,effect)
break
case Game_Action.EFFECT_COMMON_EVENT:this.itemEffectCommonEvent(target,effect)}},Game_Action.prototype.itemEffectRecoverHp=function(target,effect){let value=(target.mhp*effect.value1+effect.value2)*target.rec
this.isItem()&&(value*=this.subject().pha),value=Math.floor(value),0!==value&&(target.gainHp(value),this.makeSuccess(target))},Game_Action.prototype.itemEffectRecoverMp=function(target,effect){let value=(target.mmp*effect.value1+effect.value2)*target.rec
this.isItem()&&(value*=this.subject().pha),value=Math.floor(value),0!==value&&(target.gainMp(value),this.makeSuccess(target))},Game_Action.prototype.itemEffectGainTp=function(target,effect){const value=Math.floor(effect.value1)
0!==value&&(target.gainTp(value),this.makeSuccess(target))},Game_Action.prototype.itemEffectAddState=function(target,effect){0===effect.dataId?this.itemEffectAddAttackState(target,effect):this.itemEffectAddNormalState(target,effect)},Game_Action.prototype.itemEffectAddAttackState=function(target,effect){this.subject().attackStates().forEach(function(stateId){let chance=effect.value1
chance*=target.stateRate(stateId),chance*=this.subject().attackStatesRate(stateId),chance*=this.lukEffectRate(target),Math.random()<chance&&(target.addState(stateId),this.makeSuccess(target))}.bind(this),target)},Game_Action.prototype.itemEffectAddNormalState=function(target,effect){let chance=effect.value1
this.isCertainHit()||(chance*=target.stateRate(effect.dataId),chance*=this.lukEffectRate(target)),Math.random()<chance&&(target.addState(effect.dataId),this.makeSuccess(target))},Game_Action.prototype.itemEffectRemoveState=function(target,effect){const chance=effect.value1
Math.random()<chance&&(target.removeState(effect.dataId),this.makeSuccess(target))},Game_Action.prototype.itemEffectAddBuff=function(target,effect){target.addBuff(effect.dataId,effect.value1),this.makeSuccess(target)},Game_Action.prototype.itemEffectAddDebuff=function(target,effect){const chance=target.debuffRate(effect.dataId)*this.lukEffectRate(target)
Math.random()<chance&&(target.addDebuff(effect.dataId,effect.value1),this.makeSuccess(target))},Game_Action.prototype.itemEffectRemoveBuff=function(target,effect){target.isBuffAffected(effect.dataId)&&(target.removeBuff(effect.dataId),this.makeSuccess(target))},Game_Action.prototype.itemEffectRemoveDebuff=function(target,effect){target.isDebuffAffected(effect.dataId)&&(target.removeBuff(effect.dataId),this.makeSuccess(target))},Game_Action.prototype.itemEffectSpecial=function(target,effect){effect.dataId===Game_Action.SPECIAL_EFFECT_ESCAPE&&(target.escape(),this.makeSuccess(target))},Game_Action.prototype.itemEffectGrow=function(target,effect){target.addParam(effect.dataId,Math.floor(effect.value1)),this.makeSuccess(target)},Game_Action.prototype.itemEffectLearnSkill=function(target,effect){target.isActor()&&(target.learnSkill(effect.dataId),this.makeSuccess(target))},Game_Action.prototype.itemEffectCommonEvent=function(target,effect){},Game_Action.prototype.makeSuccess=function(target){target.result().success=!0},Game_Action.prototype.applyItemUserEffect=function(target){const value=Math.floor(this.item().tpGain*this.subject().tcr)
this.subject().gainSilentTp(value)},Game_Action.prototype.lukEffectRate=function(target){return Math.max(1+.001*(this.subject().luk-target.luk),0)},Game_Action.prototype.applyGlobal=function(){this.item().effects.forEach((function(effect){effect.code===Game_Action.EFFECT_COMMON_EVENT&&$gameTemp.reserveCommonEvent(effect.dataId)}),this)},Game_ActionResult.prototype.initialize=function(){this.clear()},Game_ActionResult.prototype.clear=function(){this.used=!1,this.missed=!1,this.evaded=!1,this.physical=!1,this.drain=!1,this.critical=!1,this.success=!1,this.hpAffected=!1,this.hpDamage=0,this.mpDamage=0,this.tpDamage=0,this.addedStates=[],this.removedStates=[],this.addedBuffs=[],this.addedDebuffs=[],this.removedBuffs=[]},Game_ActionResult.prototype.addedStateObjects=function(){return this.addedStates.map((function(id){return $dataStates[id]}))},Game_ActionResult.prototype.removedStateObjects=function(){return this.removedStates.map((function(id){return $dataStates[id]}))},Game_ActionResult.prototype.isStatusAffected=function(){return this.addedStates.length>0||this.removedStates.length>0||this.addedBuffs.length>0||this.addedDebuffs.length>0||this.removedBuffs.length>0},Game_ActionResult.prototype.isHit=function(){return this.used&&!this.missed&&!this.evaded},Game_ActionResult.prototype.isStateAdded=function(stateId){return this.addedStates.contains(stateId)},Game_ActionResult.prototype.pushAddedState=function(stateId){this.isStateAdded(stateId)||this.addedStates.push(stateId)},Game_ActionResult.prototype.isStateRemoved=function(stateId){return this.removedStates.contains(stateId)},Game_ActionResult.prototype.pushRemovedState=function(stateId){this.isStateRemoved(stateId)||this.removedStates.push(stateId)},Game_ActionResult.prototype.isBuffAdded=function(paramId){return this.addedBuffs.contains(paramId)},Game_ActionResult.prototype.pushAddedBuff=function(paramId){this.isBuffAdded(paramId)||this.addedBuffs.push(paramId)},Game_ActionResult.prototype.isDebuffAdded=function(paramId){return this.addedDebuffs.contains(paramId)},Game_ActionResult.prototype.pushAddedDebuff=function(paramId){this.isDebuffAdded(paramId)||this.addedDebuffs.push(paramId)},Game_ActionResult.prototype.isBuffRemoved=function(paramId){return this.removedBuffs.contains(paramId)},Game_ActionResult.prototype.pushRemovedBuff=function(paramId){this.isBuffRemoved(paramId)||this.removedBuffs.push(paramId)},Game_BattlerBase.TRAIT_ELEMENT_RATE=11,Game_BattlerBase.TRAIT_DEBUFF_RATE=12,Game_BattlerBase.TRAIT_STATE_RATE=13,Game_BattlerBase.TRAIT_STATE_RESIST=14,Game_BattlerBase.TRAIT_PARAM=21,Game_BattlerBase.TRAIT_XPARAM=22,Game_BattlerBase.TRAIT_SPARAM=23,Game_BattlerBase.TRAIT_ATTACK_ELEMENT=31,Game_BattlerBase.TRAIT_ATTACK_STATE=32,Game_BattlerBase.TRAIT_ATTACK_SPEED=33,Game_BattlerBase.TRAIT_ATTACK_TIMES=34,Game_BattlerBase.TRAIT_STYPE_ADD=41,Game_BattlerBase.TRAIT_STYPE_SEAL=42,Game_BattlerBase.TRAIT_SKILL_ADD=43,Game_BattlerBase.TRAIT_SKILL_SEAL=44,Game_BattlerBase.TRAIT_EQUIP_WTYPE=51,Game_BattlerBase.TRAIT_EQUIP_ATYPE=52,Game_BattlerBase.TRAIT_EQUIP_LOCK=53,Game_BattlerBase.TRAIT_EQUIP_SEAL=54,Game_BattlerBase.TRAIT_SLOT_TYPE=55,Game_BattlerBase.TRAIT_ACTION_PLUS=61,Game_BattlerBase.TRAIT_SPECIAL_FLAG=62,Game_BattlerBase.TRAIT_COLLAPSE_TYPE=63,Game_BattlerBase.TRAIT_PARTY_ABILITY=64,Game_BattlerBase.FLAG_ID_AUTO_BATTLE=0,Game_BattlerBase.FLAG_ID_GUARD=1,Game_BattlerBase.FLAG_ID_SUBSTITUTE=2,Game_BattlerBase.FLAG_ID_PRESERVE_TP=3,Game_BattlerBase.ICON_BUFF_START=32,Game_BattlerBase.ICON_DEBUFF_START=48,Object.defineProperties(Game_BattlerBase.prototype,{hp:{get(){return this._hp},configurable:!0},mp:{get(){return this._mp},configurable:!0},tp:{get(){return this._tp},configurable:!0},mhp:{get(){return this.param(0)},configurable:!0},mmp:{get(){return this.param(1)},configurable:!0},atk:{get(){return this.param(2)},configurable:!0},def:{get(){return this.param(3)},configurable:!0},mat:{get(){return this.param(4)},configurable:!0},mdf:{get(){return this.param(5)},configurable:!0},agi:{get(){return this.param(6)},configurable:!0},luk:{get(){return this.param(7)},configurable:!0},hit:{get(){return this.xparam(0)},configurable:!0},eva:{get(){return this.xparam(1)},configurable:!0},cri:{get(){return this.xparam(2)},configurable:!0},cev:{get(){return this.xparam(3)},configurable:!0},mev:{get(){return this.xparam(4)},configurable:!0},mrf:{get(){return this.xparam(5)},configurable:!0},cnt:{get(){return this.xparam(6)},configurable:!0},hrg:{get(){return this.xparam(7)},configurable:!0},mrg:{get(){return this.xparam(8)},configurable:!0},trg:{get(){return this.xparam(9)},configurable:!0},tgr:{get(){return this.sparam(0)},configurable:!0},grd:{get(){return this.sparam(1)},configurable:!0},rec:{get(){return this.sparam(2)},configurable:!0},pha:{get(){return this.sparam(3)},configurable:!0},mcr:{get(){return this.sparam(4)},configurable:!0},tcr:{get(){return this.sparam(5)},configurable:!0},pdr:{get(){return this.sparam(6)},configurable:!0},mdr:{get(){return this.sparam(7)},configurable:!0},fdr:{get(){return this.sparam(8)},configurable:!0},exr:{get(){return this.sparam(9)},configurable:!0}}),Game_BattlerBase.prototype.initialize=function(){this.initMembers()},Game_BattlerBase.prototype.initMembers=function(){this._hp=1,this._mp=0,this._tp=0,this._hidden=!1,this.clearParamPlus(),this.clearStates(),this.clearBuffs()},Game_BattlerBase.prototype.clearParamPlus=function(){this._paramPlus=[0,0,0,0,0,0,0,0]},Game_BattlerBase.prototype.clearStates=function(){this._states=[],this._stateTurns={}},Game_BattlerBase.prototype.eraseState=function(stateId){const index=this._states.indexOf(stateId)
index>=0&&this._states.splice(index,1),delete this._stateTurns[stateId]},Game_BattlerBase.prototype.isStateAffected=function(stateId){return this._states.contains(stateId)},Game_BattlerBase.prototype.isDeathStateAffected=function(){return this.isStateAffected(this.deathStateId())},Game_BattlerBase.prototype.deathStateId=function(){return 1},Game_BattlerBase.prototype.resetStateCounts=function(stateId){const state=$dataStates[stateId],variance=1+Math.max(state.maxTurns-state.minTurns,0)
this._stateTurns[stateId]=state.minTurns+Math.randomInt(variance)},Game_BattlerBase.prototype.isStateExpired=function(stateId){return 0===this._stateTurns[stateId]},Game_BattlerBase.prototype.updateStateTurns=function(){this._states.forEach((function(stateId){this._stateTurns[stateId]>0&&this._stateTurns[stateId]--}),this)},Game_BattlerBase.prototype.clearBuffs=function(){this._buffs=[0,0,0,0,0,0,0,0],this._buffTurns=[0,0,0,0,0,0,0,0]},Game_BattlerBase.prototype.eraseBuff=function(paramId){this._buffs[paramId]=0,this._buffTurns[paramId]=0},Game_BattlerBase.prototype.buffLength=function(){return this._buffs.length},Game_BattlerBase.prototype.buff=function(paramId){return this._buffs[paramId]},Game_BattlerBase.prototype.isBuffAffected=function(paramId){return this._buffs[paramId]>0},Game_BattlerBase.prototype.isDebuffAffected=function(paramId){return this._buffs[paramId]<0},Game_BattlerBase.prototype.isBuffOrDebuffAffected=function(paramId){return 0!==this._buffs[paramId]},Game_BattlerBase.prototype.isMaxBuffAffected=function(paramId){return 2===this._buffs[paramId]},Game_BattlerBase.prototype.isMaxDebuffAffected=function(paramId){return-2===this._buffs[paramId]},Game_BattlerBase.prototype.increaseBuff=function(paramId){this.isMaxBuffAffected(paramId)||this._buffs[paramId]++},Game_BattlerBase.prototype.decreaseBuff=function(paramId){this.isMaxDebuffAffected(paramId)||this._buffs[paramId]--},Game_BattlerBase.prototype.overwriteBuffTurns=function(paramId,turns){this._buffTurns[paramId]<turns&&(this._buffTurns[paramId]=turns)},Game_BattlerBase.prototype.isBuffExpired=function(paramId){return 0===this._buffTurns[paramId]},Game_BattlerBase.prototype.updateBuffTurns=function(){for(let i=0;i<this._buffTurns.length;i++)this._buffTurns[i]>0&&this._buffTurns[i]--},Game_BattlerBase.prototype.die=function(){this._hp=0,this.clearStates(),this.clearBuffs()},Game_BattlerBase.prototype.revive=function(){0===this._hp&&(this._hp=1)},Game_BattlerBase.prototype.states=function(){return this._states.map((function(id){return $dataStates[id]}))},Game_BattlerBase.prototype.stateIcons=function(){return this.states().map((function(state){return state.iconIndex})).filter((function(iconIndex){return iconIndex>0}))},Game_BattlerBase.prototype.buffIcons=function(){const icons=[]
for(let i=0;i<this._buffs.length;i++)0!==this._buffs[i]&&icons.push(this.buffIconIndex(this._buffs[i],i))
return icons},Game_BattlerBase.prototype.buffIconIndex=function(buffLevel,paramId){return buffLevel>0?Game_BattlerBase.ICON_BUFF_START+8*(buffLevel-1)+paramId:buffLevel<0?Game_BattlerBase.ICON_DEBUFF_START+8*(-buffLevel-1)+paramId:0},Game_BattlerBase.prototype.allIcons=function(){return this.stateIcons().concat(this.buffIcons())},Game_BattlerBase.prototype.traitObjects=function(){return this.states()},Game_BattlerBase.prototype.allTraits=function(){return this.traitObjects().reduce((function(r,obj){return r.concat(obj.traits)}),[])},Game_BattlerBase.prototype.traits=function(code){return this.allTraits().filter((function(trait){return trait.code===code}))},Game_BattlerBase.prototype.traitsWithId=function(code,id){return this.allTraits().filter((function(trait){return trait.code===code&&trait.dataId===id}))},Game_BattlerBase.prototype.traitsPi=function(code,id){return this.traitsWithId(code,id).reduce((function(r,trait){return r*trait.value}),1)},Game_BattlerBase.prototype.traitsSum=function(code,id){return this.traitsWithId(code,id).reduce((function(r,trait){return r+trait.value}),0)},Game_BattlerBase.prototype.traitsSumAll=function(code){return this.traits(code).reduce((function(r,trait){return r+trait.value}),0)},Game_BattlerBase.prototype.traitsSet=function(code){return this.traits(code).reduce((function(r,trait){return r.concat(trait.dataId)}),[])},Game_BattlerBase.prototype.paramBase=function(paramId){return 0},Game_BattlerBase.prototype.paramPlus=function(paramId){return this._paramPlus[paramId]},Game_BattlerBase.prototype.paramMin=function(paramId){return 1===paramId?0:1},Game_BattlerBase.prototype.paramMax=function(paramId){return 0===paramId?999999:1===paramId?9999:999},Game_BattlerBase.prototype.paramRate=function(paramId){return this.traitsPi(Game_BattlerBase.TRAIT_PARAM,paramId)},Game_BattlerBase.prototype.paramBuffRate=function(paramId){return.25*this._buffs[paramId]+1},Game_BattlerBase.prototype.param=function(paramId){let value=this.paramBase(paramId)+this.paramPlus(paramId)
value*=this.paramRate(paramId)*this.paramBuffRate(paramId)
const maxValue=this.paramMax(paramId),minValue=this.paramMin(paramId)
return Math.round(value.clamp(minValue,maxValue))},Game_BattlerBase.prototype.xparam=function(xparamId){return this.traitsSum(Game_BattlerBase.TRAIT_XPARAM,xparamId)},Game_BattlerBase.prototype.sparam=function(sparamId){return this.traitsPi(Game_BattlerBase.TRAIT_SPARAM,sparamId)},Game_BattlerBase.prototype.elementRate=function(elementId){return this.traitsPi(Game_BattlerBase.TRAIT_ELEMENT_RATE,elementId)},Game_BattlerBase.prototype.debuffRate=function(paramId){return this.traitsPi(Game_BattlerBase.TRAIT_DEBUFF_RATE,paramId)},Game_BattlerBase.prototype.stateRate=function(stateId){return this.traitsPi(Game_BattlerBase.TRAIT_STATE_RATE,stateId)},Game_BattlerBase.prototype.stateResistSet=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STATE_RESIST)},Game_BattlerBase.prototype.isStateResist=function(stateId){return this.stateResistSet().contains(stateId)},Game_BattlerBase.prototype.attackElements=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_ELEMENT)},Game_BattlerBase.prototype.attackStates=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_STATE)},Game_BattlerBase.prototype.attackStatesRate=function(stateId){return this.traitsSum(Game_BattlerBase.TRAIT_ATTACK_STATE,stateId)},Game_BattlerBase.prototype.attackSpeed=function(){return this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_SPEED)},Game_BattlerBase.prototype.attackTimesAdd=function(){return Math.max(this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_TIMES),0)},Game_BattlerBase.prototype.addedSkillTypes=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_ADD)},Game_BattlerBase.prototype.isSkillTypeSealed=function(stypeId){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_SEAL).contains(stypeId)},Game_BattlerBase.prototype.addedSkills=function(){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_ADD)},Game_BattlerBase.prototype.isSkillSealed=function(skillId){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_SEAL).contains(skillId)},Game_BattlerBase.prototype.isEquipWtypeOk=function(wtypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_WTYPE).contains(wtypeId)},Game_BattlerBase.prototype.isEquipAtypeOk=function(atypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_ATYPE).contains(atypeId)},Game_BattlerBase.prototype.isEquipTypeLocked=function(etypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_LOCK).contains(etypeId)},Game_BattlerBase.prototype.isEquipTypeSealed=function(etypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_SEAL).contains(etypeId)},Game_BattlerBase.prototype.slotType=function(){const set=this.traitsSet(Game_BattlerBase.TRAIT_SLOT_TYPE)
return set.length>0?Math.max.apply(null,set):0},Game_BattlerBase.prototype.isDualWield=function(){return 1===this.slotType()},Game_BattlerBase.prototype.actionPlusSet=function(){return this.traits(Game_BattlerBase.TRAIT_ACTION_PLUS).map((function(trait){return trait.value}))},Game_BattlerBase.prototype.specialFlag=function(flagId){return this.traits(Game_BattlerBase.TRAIT_SPECIAL_FLAG).some((function(trait){return trait.dataId===flagId}))},Game_BattlerBase.prototype.collapseType=function(){const set=this.traitsSet(Game_BattlerBase.TRAIT_COLLAPSE_TYPE)
return set.length>0?Math.max.apply(null,set):0},Game_BattlerBase.prototype.partyAbility=function(abilityId){return this.traits(Game_BattlerBase.TRAIT_PARTY_ABILITY).some((function(trait){return trait.dataId===abilityId}))},Game_BattlerBase.prototype.isAutoBattle=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_AUTO_BATTLE)},Game_BattlerBase.prototype.isGuard=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_GUARD)&&this.canMove()},Game_BattlerBase.prototype.isSubstitute=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_SUBSTITUTE)&&this.canMove()},Game_BattlerBase.prototype.isPreserveTp=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_PRESERVE_TP)},Game_BattlerBase.prototype.addParam=function(paramId,value){this._paramPlus[paramId]+=value,this.refresh()},Game_BattlerBase.prototype.setHp=function(hp){this._hp=hp,this.refresh()},Game_BattlerBase.prototype.setMp=function(mp){this._mp=mp,this.refresh()},Game_BattlerBase.prototype.setTp=function(tp){this._tp=tp,this.refresh()},Game_BattlerBase.prototype.maxTp=function(){return 100},Game_BattlerBase.prototype.refresh=function(){this.stateResistSet().forEach((function(stateId){this.eraseState(stateId)}),this),this._hp=this._hp.clamp(0,this.mhp),this._mp=this._mp.clamp(0,this.mmp),this._tp=this._tp.clamp(0,this.maxTp())},Game_BattlerBase.prototype.recoverAll=function(){this.clearStates(),this._hp=this.mhp,this._mp=this.mmp},Game_BattlerBase.prototype.hpRate=function(){return this.hp/this.mhp},Game_BattlerBase.prototype.mpRate=function(){return this.mmp>0?this.mp/this.mmp:0},Game_BattlerBase.prototype.tpRate=function(){return this.tp/this.maxTp()},Game_BattlerBase.prototype.hide=function(){this._hidden=!0},Game_BattlerBase.prototype.appear=function(){this._hidden=!1},Game_BattlerBase.prototype.isHidden=function(){return this._hidden},Game_BattlerBase.prototype.isAppeared=function(){return!this.isHidden()},Game_BattlerBase.prototype.isDead=function(){return this.isAppeared()&&this.isDeathStateAffected()},Game_BattlerBase.prototype.isAlive=function(){return this.isAppeared()&&!this.isDeathStateAffected()},Game_BattlerBase.prototype.isDying=function(){return this.isAlive()&&this._hp<this.mhp/4},Game_BattlerBase.prototype.isRestricted=function(){return this.isAppeared()&&this.restriction()>0},Game_BattlerBase.prototype.canInput=function(){return this.isAppeared()&&!this.isRestricted()&&!this.isAutoBattle()},Game_BattlerBase.prototype.canMove=function(){return this.isAppeared()&&this.restriction()<4},Game_BattlerBase.prototype.isConfused=function(){return this.isAppeared()&&this.restriction()>=1&&this.restriction()<=3},Game_BattlerBase.prototype.confusionLevel=function(){return this.isConfused()?this.restriction():0},Game_BattlerBase.prototype.isActor=function(){return!1},Game_BattlerBase.prototype.isEnemy=function(){return!1},Game_BattlerBase.prototype.sortStates=function(){this._states.sort((function(a,b){const p1=$dataStates[a].priority,p2=$dataStates[b].priority
return p1!==p2?p2-p1:a-b}))},Game_BattlerBase.prototype.restriction=function(){return Math.max.apply(null,this.states().map((function(state){return state.restriction})).concat(0))},Game_BattlerBase.prototype.addNewState=function(stateId){stateId===this.deathStateId()&&this.die()
const restricted=this.isRestricted()
this._states.push(stateId),this.sortStates(),!restricted&&this.isRestricted()&&this.onRestrict()},Game_BattlerBase.prototype.onRestrict=function(){},Game_BattlerBase.prototype.mostImportantStateText=function(){const states=this.states()
for(let i=0;i<states.length;i++)if(states[i].message3)return states[i].message3
return""},Game_BattlerBase.prototype.stateMotionIndex=function(){const states=this.states()
return states.length>0?states[0].motion:0},Game_BattlerBase.prototype.stateOverlayIndex=function(){const states=this.states()
return states.length>0?states[0].overlay:0},Game_BattlerBase.prototype.isSkillWtypeOk=function(skill){return!0},Game_BattlerBase.prototype.skillMpCost=function(skill){return Math.floor(skill.mpCost*this.mcr)},Game_BattlerBase.prototype.skillTpCost=function(skill){return skill.tpCost},Game_BattlerBase.prototype.canPaySkillCost=function(skill){return this._tp>=this.skillTpCost(skill)&&this._mp>=this.skillMpCost(skill)},Game_BattlerBase.prototype.paySkillCost=function(skill){this._mp-=this.skillMpCost(skill),this._tp-=this.skillTpCost(skill)},Game_BattlerBase.prototype.isOccasionOk=function(item){return $gameParty.inBattle()?0===item.occasion||1===item.occasion:0===item.occasion||2===item.occasion},Game_BattlerBase.prototype.meetsUsableItemConditions=function(item){return this.canMove()&&this.isOccasionOk(item)},Game_BattlerBase.prototype.meetsSkillConditions=function(skill){return this.meetsUsableItemConditions(skill)&&this.isSkillWtypeOk(skill)&&this.canPaySkillCost(skill)&&!this.isSkillSealed(skill.id)&&!this.isSkillTypeSealed(skill.stypeId)},Game_BattlerBase.prototype.meetsItemConditions=function(item){return this.meetsUsableItemConditions(item)&&$gameParty.hasItem(item)},Game_BattlerBase.prototype.canUse=function(item){return!!item&&(DataManager.isSkill(item)?this.meetsSkillConditions(item):!!DataManager.isItem(item)&&this.meetsItemConditions(item))},Game_BattlerBase.prototype.canEquip=function(item){return!!item&&(DataManager.isWeapon(item)?this.canEquipWeapon(item):!!DataManager.isArmor(item)&&this.canEquipArmor(item))},Game_BattlerBase.prototype.canEquipWeapon=function(item){return this.isEquipWtypeOk(item.wtypeId)&&!this.isEquipTypeSealed(item.etypeId)},Game_BattlerBase.prototype.canEquipArmor=function(item){return this.isEquipAtypeOk(item.atypeId)&&!this.isEquipTypeSealed(item.etypeId)},Game_BattlerBase.prototype.attackSkillId=function(){return 1},Game_BattlerBase.prototype.guardSkillId=function(){return 2},Game_BattlerBase.prototype.canAttack=function(){return this.canUse($dataSkills[this.attackSkillId()])},Game_BattlerBase.prototype.canGuard=function(){return this.canUse($dataSkills[this.guardSkillId()])},Game_Battler.prototype=Object.create(Game_BattlerBase.prototype),Game_Battler.prototype.constructor=Game_Battler,Game_Battler.prototype.initialize=function(){Game_BattlerBase.prototype.initialize.call(this)},Game_Battler.prototype.initMembers=function(){Game_BattlerBase.prototype.initMembers.call(this),this._actions=[],this._speed=0,this._result=new Game_ActionResult,this._actionState="",this._lastTargetIndex=0,this._animations=[],this._damagePopup=!1,this._effectType=null,this._motionType=null,this._weaponImageId=0,this._motionRefresh=!1,this._selected=!1},Game_Battler.prototype.clearAnimations=function(){this._animations=[]},Game_Battler.prototype.clearDamagePopup=function(){this._damagePopup=!1},Game_Battler.prototype.clearWeaponAnimation=function(){this._weaponImageId=0},Game_Battler.prototype.clearEffect=function(){this._effectType=null},Game_Battler.prototype.clearMotion=function(){this._motionType=null,this._motionRefresh=!1},Game_Battler.prototype.requestEffect=function(effectType){this._effectType=effectType},Game_Battler.prototype.requestMotion=function(motionType){this._motionType=motionType},Game_Battler.prototype.requestMotionRefresh=function(){this._motionRefresh=!0},Game_Battler.prototype.select=function(){this._selected=!0},Game_Battler.prototype.deselect=function(){this._selected=!1},Game_Battler.prototype.isAnimationRequested=function(){return this._animations.length>0},Game_Battler.prototype.isDamagePopupRequested=function(){return this._damagePopup},Game_Battler.prototype.isEffectRequested=function(){return!!this._effectType},Game_Battler.prototype.isMotionRequested=function(){return!!this._motionType},Game_Battler.prototype.isWeaponAnimationRequested=function(){return this._weaponImageId>0},Game_Battler.prototype.isMotionRefreshRequested=function(){return this._motionRefresh},Game_Battler.prototype.isSelected=function(){return this._selected},Game_Battler.prototype.effectType=function(){return this._effectType},Game_Battler.prototype.motionType=function(){return this._motionType},Game_Battler.prototype.weaponImageId=function(){return this._weaponImageId},Game_Battler.prototype.shiftAnimation=function(){return this._animations.shift()},Game_Battler.prototype.startAnimation=function(animationId,mirror,delay){const data={animationId,mirror,delay}
this._animations.push(data)},Game_Battler.prototype.startDamagePopup=function(){this._damagePopup=!0},Game_Battler.prototype.startWeaponAnimation=function(weaponImageId){this._weaponImageId=weaponImageId},Game_Battler.prototype.action=function(index){return this._actions[index]},Game_Battler.prototype.setAction=function(index,action){this._actions[index]=action},Game_Battler.prototype.numActions=function(){return this._actions.length},Game_Battler.prototype.clearActions=function(){this._actions=[]},Game_Battler.prototype.result=function(){return this._result},Game_Battler.prototype.clearResult=function(){this._result.clear()},Game_Battler.prototype.refresh=function(){Game_BattlerBase.prototype.refresh.call(this),0===this.hp?this.addState(this.deathStateId()):this.removeState(this.deathStateId())},Game_Battler.prototype.addState=function(stateId){this.isStateAddable(stateId)&&(this.isStateAffected(stateId)||(this.addNewState(stateId),this.refresh()),this.resetStateCounts(stateId),this._result.pushAddedState(stateId))},Game_Battler.prototype.isStateAddable=function(stateId){return this.isAlive()&&$dataStates[stateId]&&!this.isStateResist(stateId)&&!this._result.isStateRemoved(stateId)&&!this.isStateRestrict(stateId)},Game_Battler.prototype.isStateRestrict=function(stateId){return $dataStates[stateId].removeByRestriction&&this.isRestricted()},Game_Battler.prototype.onRestrict=function(){Game_BattlerBase.prototype.onRestrict.call(this),this.clearActions(),this.states().forEach((function(state){state.removeByRestriction&&this.removeState(state.id)}),this)},Game_Battler.prototype.removeState=function(stateId){this.isStateAffected(stateId)&&(stateId===this.deathStateId()&&this.revive(),this.eraseState(stateId),this.refresh(),this._result.pushRemovedState(stateId))},Game_Battler.prototype.escape=function(){$gameParty.inBattle()&&this.hide(),this.clearActions(),this.clearStates(),SoundManager.playEscape()},Game_Battler.prototype.addBuff=function(paramId,turns){this.isAlive()&&(this.increaseBuff(paramId),this.isBuffAffected(paramId)&&this.overwriteBuffTurns(paramId,turns),this._result.pushAddedBuff(paramId),this.refresh())},Game_Battler.prototype.addDebuff=function(paramId,turns){this.isAlive()&&(this.decreaseBuff(paramId),this.isDebuffAffected(paramId)&&this.overwriteBuffTurns(paramId,turns),this._result.pushAddedDebuff(paramId),this.refresh())},Game_Battler.prototype.removeBuff=function(paramId){this.isAlive()&&this.isBuffOrDebuffAffected(paramId)&&(this.eraseBuff(paramId),this._result.pushRemovedBuff(paramId),this.refresh())},Game_Battler.prototype.removeBattleStates=function(){this.states().forEach((function(state){state.removeAtBattleEnd&&this.removeState(state.id)}),this)},Game_Battler.prototype.removeAllBuffs=function(){for(let i=0;i<this.buffLength();i++)this.removeBuff(i)},Game_Battler.prototype.removeStatesAuto=function(timing){this.states().forEach((function(state){this.isStateExpired(state.id)&&state.autoRemovalTiming===timing&&this.removeState(state.id)}),this)},Game_Battler.prototype.removeBuffsAuto=function(){for(let i=0;i<this.buffLength();i++)this.isBuffExpired(i)&&this.removeBuff(i)},Game_Battler.prototype.removeStatesByDamage=function(){this.states().forEach((function(state){state.removeByDamage&&Math.randomInt(100)<state.chanceByDamage&&this.removeState(state.id)}),this)},Game_Battler.prototype.makeActionTimes=function(){return this.actionPlusSet().reduce((function(r,p){return Math.random()<p?r+1:r}),1)},Game_Battler.prototype.makeActions=function(){if(this.clearActions(),this.canMove()){const actionTimes=this.makeActionTimes()
this._actions=[]
for(let i=0;i<actionTimes;i++)this._actions.push(new Game_Action(this))}},Game_Battler.prototype.speed=function(){return this._speed},Game_Battler.prototype.makeSpeed=function(){this._speed=Math.min.apply(null,this._actions.map((function(action){return action.speed()})))||0},Game_Battler.prototype.currentAction=function(){return this._actions[0]},Game_Battler.prototype.removeCurrentAction=function(){this._actions.shift()},Game_Battler.prototype.setLastTarget=function(target){this._lastTargetIndex=target?target.index():0},Game_Battler.prototype.forceAction=function(skillId,targetIndex){this.clearActions()
const action=new Game_Action(this,!0)
action.setSkill(skillId),-2===targetIndex?action.setTarget(this._lastTargetIndex):-1===targetIndex?action.decideRandomTarget():action.setTarget(targetIndex),this._actions.push(action)},Game_Battler.prototype.useItem=function(item){DataManager.isSkill(item)?this.paySkillCost(item):DataManager.isItem(item)&&this.consumeItem(item)},Game_Battler.prototype.consumeItem=function(item){$gameParty.consumeItem(item)},Game_Battler.prototype.gainHp=function(value){this._result.hpDamage=-value,this._result.hpAffected=!0,this.setHp(this.hp+value)},Game_Battler.prototype.gainMp=function(value){this._result.mpDamage=-value,this.setMp(this.mp+value)},Game_Battler.prototype.gainTp=function(value){this._result.tpDamage=-value,this.setTp(this.tp+value)},Game_Battler.prototype.gainSilentTp=function(value){this.setTp(this.tp+value)},Game_Battler.prototype.initTp=function(){this.setTp(Math.randomInt(25))},Game_Battler.prototype.clearTp=function(){this.setTp(0)},Game_Battler.prototype.chargeTpByDamage=function(damageRate){const value=Math.floor(50*damageRate*this.tcr)
this.gainSilentTp(value)},Game_Battler.prototype.regenerateHp=function(){let value=Math.floor(this.mhp*this.hrg)
value=Math.max(value,-this.maxSlipDamage()),0!==value&&this.gainHp(value)},Game_Battler.prototype.maxSlipDamage=function(){return $dataSystem.optSlipDeath?this.hp:Math.max(this.hp-1,0)},Game_Battler.prototype.regenerateMp=function(){const value=Math.floor(this.mmp*this.mrg)
0!==value&&this.gainMp(value)},Game_Battler.prototype.regenerateTp=function(){const value=Math.floor(100*this.trg)
this.gainSilentTp(value)},Game_Battler.prototype.regenerateAll=function(){this.isAlive()&&(this.regenerateHp(),this.regenerateMp(),this.regenerateTp())},Game_Battler.prototype.onBattleStart=function(){this.setActionState("undecided"),this.clearMotion(),this.isPreserveTp()||this.initTp()},Game_Battler.prototype.onAllActionsEnd=function(){this.clearResult(),this.removeStatesAuto(1),this.removeBuffsAuto()},Game_Battler.prototype.onTurnEnd=function(){this.clearResult(),this.regenerateAll(),BattleManager.isForcedTurn()||(this.updateStateTurns(),this.updateBuffTurns()),this.removeStatesAuto(2)},Game_Battler.prototype.onBattleEnd=function(){this.clearResult(),this.removeBattleStates(),this.removeAllBuffs(),this.clearActions(),this.isPreserveTp()||this.clearTp(),this.appear()},Game_Battler.prototype.onDamage=function(value){this.removeStatesByDamage(),this.chargeTpByDamage(value/this.mhp)},Game_Battler.prototype.setActionState=function(actionState){this._actionState=actionState,this.requestMotionRefresh()},Game_Battler.prototype.isUndecided=function(){return"undecided"===this._actionState},Game_Battler.prototype.isInputting=function(){return"inputting"===this._actionState},Game_Battler.prototype.isWaiting=function(){return"waiting"===this._actionState},Game_Battler.prototype.isActing=function(){return"acting"===this._actionState},Game_Battler.prototype.isChanting=function(){return!!this.isWaiting()&&this._actions.some((function(action){return action.isMagicSkill()}))},Game_Battler.prototype.isGuardWaiting=function(){return!!this.isWaiting()&&this._actions.some((function(action){return action.isGuard()}))},Game_Battler.prototype.performActionStart=function(action){action.isGuard()||this.setActionState("acting")},Game_Battler.prototype.performAction=function(action){},Game_Battler.prototype.performActionEnd=function(){this.setActionState("done")},Game_Battler.prototype.performDamage=function(){},Game_Battler.prototype.performMiss=function(){SoundManager.playMiss()},Game_Battler.prototype.performRecovery=function(){SoundManager.playRecovery()},Game_Battler.prototype.performEvasion=function(){SoundManager.playEvasion()},Game_Battler.prototype.performMagicEvasion=function(){SoundManager.playMagicEvasion()},Game_Battler.prototype.performCounter=function(){SoundManager.playEvasion()},Game_Battler.prototype.performReflection=function(){SoundManager.playReflection()},Game_Battler.prototype.performSubstitute=function(target){},Game_Battler.prototype.performCollapse=function(){},Game_Actor.prototype=Object.create(Game_Battler.prototype),Game_Actor.prototype.constructor=Game_Actor,Object.defineProperty(Game_Actor.prototype,"level",{get(){return this._level},configurable:!0}),Game_Actor.prototype.initialize=function(actorId){Game_Battler.prototype.initialize.call(this),this.setup(actorId)},Game_Actor.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this),this._actorId=0,this._name="",this._nickname="",this._classId=0,this._level=0,this._characterName="",this._characterIndex=0,this._faceName="",this._faceIndex=0,this._battlerName="",this._exp={},this._skills=[],this._equips=[],this._actionInputIndex=0,this._lastMenuSkill=new Game_Item,this._lastBattleSkill=new Game_Item,this._lastCommandSymbol=""},Game_Actor.prototype.setup=function(actorId){const actor=$dataActors[actorId]
this._actorId=actorId,this._name=actor.name,this._nickname=actor.nickname,this._profile=actor.profile,this._classId=actor.classId,this._level=actor.initialLevel,this.initImages(),this.initExp(),this.initSkills(),this.initEquips(actor.equips),this.clearParamPlus(),this.recoverAll()},Game_Actor.prototype.actorId=function(){return this._actorId},Game_Actor.prototype.actor=function(){return $dataActors[this._actorId]},Game_Actor.prototype.name=function(){return this._name},Game_Actor.prototype.setName=function(name){this._name=name},Game_Actor.prototype.nickname=function(){return this._nickname},Game_Actor.prototype.setNickname=function(nickname){this._nickname=nickname},Game_Actor.prototype.profile=function(){return this._profile},Game_Actor.prototype.setProfile=function(profile){this._profile=profile},Game_Actor.prototype.characterName=function(){return this._characterName},Game_Actor.prototype.characterIndex=function(){return this._characterIndex},Game_Actor.prototype.faceName=function(){return this._faceName},Game_Actor.prototype.faceIndex=function(){return this._faceIndex},Game_Actor.prototype.battlerName=function(){return this._battlerName},Game_Actor.prototype.clearStates=function(){Game_Battler.prototype.clearStates.call(this),this._stateSteps={}},Game_Actor.prototype.eraseState=function(stateId){Game_Battler.prototype.eraseState.call(this,stateId),delete this._stateSteps[stateId]},Game_Actor.prototype.resetStateCounts=function(stateId){Game_Battler.prototype.resetStateCounts.call(this,stateId),this._stateSteps[stateId]=$dataStates[stateId].stepsToRemove},Game_Actor.prototype.initImages=function(){const actor=this.actor()
this._characterName=actor.characterName,this._characterIndex=actor.characterIndex,this._faceName=actor.faceName,this._faceIndex=actor.faceIndex,this._battlerName=actor.battlerName},Game_Actor.prototype.expForLevel=function(level){const c=this.currentClass(),basis=c.expParams[0],extra=c.expParams[1],acc_a=c.expParams[2],acc_b=c.expParams[3]
return Math.round(basis*Math.pow(level-1,.9+acc_a/250)*level*(level+1)/(6+Math.pow(level,2)/50/acc_b)+(level-1)*extra)},Game_Actor.prototype.initExp=function(){this._exp[this._classId]=this.currentLevelExp()},Game_Actor.prototype.currentExp=function(){return this._exp[this._classId]},Game_Actor.prototype.currentLevelExp=function(){return this.expForLevel(this._level)},Game_Actor.prototype.nextLevelExp=function(){return this.expForLevel(this._level+1)},Game_Actor.prototype.nextRequiredExp=function(){return this.nextLevelExp()-this.currentExp()},Game_Actor.prototype.maxLevel=function(){return this.actor().maxLevel},Game_Actor.prototype.isMaxLevel=function(){return this._level>=this.maxLevel()},Game_Actor.prototype.initSkills=function(){this._skills=[],this.currentClass().learnings.forEach((function(learning){learning.level<=this._level&&this.learnSkill(learning.skillId)}),this)},Game_Actor.prototype.initEquips=function(equips){const slots=this.equipSlots(),maxSlots=slots.length
this._equips=[]
for(let i=0;i<maxSlots;i++)this._equips[i]=new Game_Item
for(let j=0;j<equips.length;j++)j<maxSlots&&this._equips[j].setEquip(1===slots[j],equips[j])
this.releaseUnequippableItems(!0),this.refresh()},Game_Actor.prototype.equipSlots=function(){const slots=[]
for(let i=1;i<$dataSystem.equipTypes.length;i++)slots.push(i)
return slots.length>=2&&this.isDualWield()&&(slots[1]=1),slots},Game_Actor.prototype.equips=function(){return this._equips.map((function(item){return item.object()}))},Game_Actor.prototype.weapons=function(){return this.equips().filter((function(item){return item&&DataManager.isWeapon(item)}))},Game_Actor.prototype.armors=function(){return this.equips().filter((function(item){return item&&DataManager.isArmor(item)}))},Game_Actor.prototype.hasWeapon=function(weapon){return this.weapons().contains(weapon)},Game_Actor.prototype.hasArmor=function(armor){return this.armors().contains(armor)},Game_Actor.prototype.isEquipChangeOk=function(slotId){return!this.isEquipTypeLocked(this.equipSlots()[slotId])&&!this.isEquipTypeSealed(this.equipSlots()[slotId])},Game_Actor.prototype.changeEquip=function(slotId,item){!this.tradeItemWithParty(item,this.equips()[slotId])||item&&this.equipSlots()[slotId]!==item.etypeId||(this._equips[slotId].setObject(item),this.refresh())},Game_Actor.prototype.forceChangeEquip=function(slotId,item){this._equips[slotId].setObject(item),this.releaseUnequippableItems(!0),this.refresh()},Game_Actor.prototype.tradeItemWithParty=function(newItem,oldItem){return!(newItem&&!$gameParty.hasItem(newItem)||($gameParty.gainItem(oldItem,1),$gameParty.loseItem(newItem,1),0))},Game_Actor.prototype.changeEquipById=function(etypeId,itemId){const slotId=etypeId-1
1===this.equipSlots()[slotId]?this.changeEquip(slotId,$dataWeapons[itemId]):this.changeEquip(slotId,$dataArmors[itemId])},Game_Actor.prototype.isEquipped=function(item){return this.equips().contains(item)},Game_Actor.prototype.discardEquip=function(item){const slotId=this.equips().indexOf(item)
slotId>=0&&this._equips[slotId].setObject(null)},Game_Actor.prototype.releaseUnequippableItems=function(forcing){for(;;){const slots=this.equipSlots(),equips=this.equips()
let changed=!1
for(let i=0;i<equips.length;i++){const item=equips[i]
!item||this.canEquip(item)&&item.etypeId===slots[i]||(forcing||this.tradeItemWithParty(null,item),this._equips[i].setObject(null),changed=!0)}if(!changed)break}},Game_Actor.prototype.clearEquipments=function(){const maxSlots=this.equipSlots().length
for(let i=0;i<maxSlots;i++)this.isEquipChangeOk(i)&&this.changeEquip(i,null)},Game_Actor.prototype.optimizeEquipments=function(){const maxSlots=this.equipSlots().length
this.clearEquipments()
for(let i=0;i<maxSlots;i++)this.isEquipChangeOk(i)&&this.changeEquip(i,this.bestEquipItem(i))},Game_Actor.prototype.bestEquipItem=function(slotId){const etypeId=this.equipSlots()[slotId],items=$gameParty.equipItems().filter((function(item){return item.etypeId===etypeId&&this.canEquip(item)}),this)
let bestItem=null,bestPerformance=-1e3
for(let i=0;i<items.length;i++){const performance=this.calcEquipItemPerformance(items[i])
performance>bestPerformance&&(bestPerformance=performance,bestItem=items[i])}return bestItem},Game_Actor.prototype.calcEquipItemPerformance=function(item){return item.params.reduce((function(a,b){return a+b}))},Game_Actor.prototype.isSkillWtypeOk=function(skill){const wtypeId1=skill.requiredWtypeId1,wtypeId2=skill.requiredWtypeId2
return!!(0===wtypeId1&&0===wtypeId2||wtypeId1>0&&this.isWtypeEquipped(wtypeId1)||wtypeId2>0&&this.isWtypeEquipped(wtypeId2))},Game_Actor.prototype.isWtypeEquipped=function(wtypeId){return this.weapons().some((function(weapon){return weapon.wtypeId===wtypeId}))},Game_Actor.prototype.refresh=function(){this.releaseUnequippableItems(!1),Game_Battler.prototype.refresh.call(this)},Game_Actor.prototype.isActor=function(){return!0},Game_Actor.prototype.friendsUnit=function(){return $gameParty},Game_Actor.prototype.opponentsUnit=function(){return $gameTroop},Game_Actor.prototype.index=function(){return $gameParty.members().indexOf(this)},Game_Actor.prototype.isBattleMember=function(){return $gameParty.battleMembers().contains(this)},Game_Actor.prototype.isFormationChangeOk=function(){return!0},Game_Actor.prototype.currentClass=function(){return $dataClasses[this._classId]},Game_Actor.prototype.isClass=function(gameClass){return gameClass&&this._classId===gameClass.id},Game_Actor.prototype.skills=function(){const list=[]
return this._skills.concat(this.addedSkills()).forEach((function(id){list.contains($dataSkills[id])||list.push($dataSkills[id])})),list},Game_Actor.prototype.usableSkills=function(){return this.skills().filter((function(skill){return this.canUse(skill)}),this)},Game_Actor.prototype.traitObjects=function(){let objects=Game_Battler.prototype.traitObjects.call(this)
objects=objects.concat([this.actor(),this.currentClass()])
const equips=this.equips()
for(let i=0;i<equips.length;i++){const item=equips[i]
item&&objects.push(item)}return objects},Game_Actor.prototype.attackElements=function(){const set=Game_Battler.prototype.attackElements.call(this)
return this.hasNoWeapons()&&!set.contains(this.bareHandsElementId())&&set.push(this.bareHandsElementId()),set},Game_Actor.prototype.hasNoWeapons=function(){return 0===this.weapons().length},Game_Actor.prototype.bareHandsElementId=function(){return 1},Game_Actor.prototype.paramMax=function(paramId){return 0===paramId?9999:Game_Battler.prototype.paramMax.call(this,paramId)},Game_Actor.prototype.paramBase=function(paramId){return this.currentClass().params[paramId][this._level]},Game_Actor.prototype.paramPlus=function(paramId){let value=Game_Battler.prototype.paramPlus.call(this,paramId)
const equips=this.equips()
for(let i=0;i<equips.length;i++){const item=equips[i]
item&&(value+=item.params[paramId])}return value},Game_Actor.prototype.attackAnimationId1=function(){if(this.hasNoWeapons())return this.bareHandsAnimationId()
{const weapons=this.weapons()
return weapons[0]?weapons[0].animationId:0}},Game_Actor.prototype.attackAnimationId2=function(){const weapons=this.weapons()
return weapons[1]?weapons[1].animationId:0},Game_Actor.prototype.bareHandsAnimationId=function(){return 1},Game_Actor.prototype.changeExp=function(exp,show){this._exp[this._classId]=Math.max(exp,0)
const lastLevel=this._level,lastSkills=this.skills()
for(;!this.isMaxLevel()&&this.currentExp()>=this.nextLevelExp();)this.levelUp()
for(;this.currentExp()<this.currentLevelExp();)this.levelDown()
show&&this._level>lastLevel&&this.displayLevelUp(this.findNewSkills(lastSkills)),this.refresh()},Game_Actor.prototype.levelUp=function(){this._level++,this.currentClass().learnings.forEach((function(learning){learning.level===this._level&&this.learnSkill(learning.skillId)}),this)},Game_Actor.prototype.levelDown=function(){this._level--},Game_Actor.prototype.findNewSkills=function(lastSkills){const newSkills=this.skills()
for(let i=0;i<lastSkills.length;i++){const index=newSkills.indexOf(lastSkills[i])
index>=0&&newSkills.splice(index,1)}return newSkills},Game_Actor.prototype.displayLevelUp=function(newSkills){const text=TextManager.levelUp.format(this._name,TextManager.level,this._level)
$gameMessage.newPage(),$gameMessage.add(text),newSkills.forEach((function(skill){$gameMessage.add(TextManager.obtainSkill.format(skill.name))}))},Game_Actor.prototype.gainExp=function(exp){const newExp=this.currentExp()+Math.round(exp*this.finalExpRate())
this.changeExp(newExp,this.shouldDisplayLevelUp())},Game_Actor.prototype.finalExpRate=function(){return this.exr*(this.isBattleMember()?1:this.benchMembersExpRate())},Game_Actor.prototype.benchMembersExpRate=function(){return $dataSystem.optExtraExp?1:0},Game_Actor.prototype.shouldDisplayLevelUp=function(){return!0},Game_Actor.prototype.changeLevel=function(level,show){level=level.clamp(1,this.maxLevel()),this.changeExp(this.expForLevel(level),show)},Game_Actor.prototype.learnSkill=function(skillId){this.isLearnedSkill(skillId)||(this._skills.push(skillId),this._skills.sort((function(a,b){return a-b})))},Game_Actor.prototype.forgetSkill=function(skillId){const index=this._skills.indexOf(skillId)
index>=0&&this._skills.splice(index,1)},Game_Actor.prototype.isLearnedSkill=function(skillId){return this._skills.contains(skillId)},Game_Actor.prototype.hasSkill=function(skillId){return this.skills().contains($dataSkills[skillId])},Game_Actor.prototype.changeClass=function(classId,keepExp){keepExp&&(this._exp[classId]=this.currentExp()),this._classId=classId,this.changeExp(this._exp[this._classId]||0,!1),this.refresh()},Game_Actor.prototype.setCharacterImage=function(characterName,characterIndex){this._characterName=characterName,this._characterIndex=characterIndex},Game_Actor.prototype.setFaceImage=function(faceName,faceIndex){this._faceName=faceName,this._faceIndex=faceIndex},Game_Actor.prototype.setBattlerImage=function(battlerName){this._battlerName=battlerName},Game_Actor.prototype.isSpriteVisible=function(){return $gameSystem.isSideView()},Game_Actor.prototype.startAnimation=function(animationId,mirror,delay){mirror=!mirror,Game_Battler.prototype.startAnimation.call(this,animationId,mirror,delay)},Game_Actor.prototype.performActionStart=function(action){Game_Battler.prototype.performActionStart.call(this,action)},Game_Actor.prototype.performAction=function(action){Game_Battler.prototype.performAction.call(this,action),action.isAttack()?this.performAttack():action.isGuard()?this.requestMotion("guard"):action.isMagicSkill()?this.requestMotion("spell"):action.isSkill()?this.requestMotion("skill"):action.isItem()&&this.requestMotion("item")},Game_Actor.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)},Game_Actor.prototype.performAttack=function(){const weapons=this.weapons(),wtypeId=weapons[0]?weapons[0].wtypeId:0,attackMotion=$dataSystem.attackMotions[wtypeId]
attackMotion&&(0===attackMotion.type?this.requestMotion("thrust"):1===attackMotion.type?this.requestMotion("swing"):2===attackMotion.type&&this.requestMotion("missile"),this.startWeaponAnimation(attackMotion.weaponImageId))},Game_Actor.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this),this.isSpriteVisible()?this.requestMotion("damage"):$gameScreen.startShake(5,5,10),SoundManager.playActorDamage()},Game_Actor.prototype.performEvasion=function(){Game_Battler.prototype.performEvasion.call(this),this.requestMotion("evade")},Game_Actor.prototype.performMagicEvasion=function(){Game_Battler.prototype.performMagicEvasion.call(this),this.requestMotion("evade")},Game_Actor.prototype.performCounter=function(){Game_Battler.prototype.performCounter.call(this),this.performAttack()},Game_Actor.prototype.performCollapse=function(){Game_Battler.prototype.performCollapse.call(this),$gameParty.inBattle()&&SoundManager.playActorCollapse()},Game_Actor.prototype.performVictory=function(){this.canMove()&&this.requestMotion("victory")},Game_Actor.prototype.performEscape=function(){this.canMove()&&this.requestMotion("escape")},Game_Actor.prototype.makeActionList=function(){const list=[]
let action=new Game_Action(this)
return action.setAttack(),list.push(action),this.usableSkills().forEach((function(skill){action=new Game_Action(this),action.setSkill(skill.id),list.push(action)}),this),list},Game_Actor.prototype.makeAutoBattleActions=function(){for(let i=0;i<this.numActions();i++){const list=this.makeActionList()
let maxValue=Number.MIN_VALUE
for(let j=0;j<list.length;j++){const value=list[j].evaluate()
value>maxValue&&(maxValue=value,this.setAction(i,list[j]))}}this.setActionState("waiting")},Game_Actor.prototype.makeConfusionActions=function(){for(let i=0;i<this.numActions();i++)this.action(i).setConfusion()
this.setActionState("waiting")},Game_Actor.prototype.makeActions=function(){Game_Battler.prototype.makeActions.call(this),this.numActions()>0?this.setActionState("undecided"):this.setActionState("waiting"),this.isAutoBattle()?this.makeAutoBattleActions():this.isConfused()&&this.makeConfusionActions()},Game_Actor.prototype.onPlayerWalk=function(){this.clearResult(),this.checkFloorEffect(),$gamePlayer.isNormal()&&(this.turnEndOnMap(),this.states().forEach((function(state){this.updateStateSteps(state)}),this),this.showAddedStates(),this.showRemovedStates())},Game_Actor.prototype.updateStateSteps=function(state){state.removeByWalking&&this._stateSteps[state.id]>0&&0==--this._stateSteps[state.id]&&this.removeState(state.id)},Game_Actor.prototype.showAddedStates=function(){this.result().addedStateObjects().forEach((function(state){state.message1&&$gameMessage.add(this._name+state.message1)}),this)},Game_Actor.prototype.showRemovedStates=function(){this.result().removedStateObjects().forEach((function(state){state.message4&&$gameMessage.add(this._name+state.message4)}),this)},Game_Actor.prototype.stepsForTurn=function(){return 20},Game_Actor.prototype.turnEndOnMap=function(){$gameParty.steps()%this.stepsForTurn()==0&&(this.onTurnEnd(),this.result().hpDamage>0&&this.performMapDamage())},Game_Actor.prototype.checkFloorEffect=function(){$gamePlayer.isOnDamageFloor()&&this.executeFloorDamage()},Game_Actor.prototype.executeFloorDamage=function(){let damage=Math.floor(this.basicFloorDamage()*this.fdr)
damage=Math.min(damage,this.maxFloorDamage()),this.gainHp(-damage),damage>0&&this.performMapDamage()},Game_Actor.prototype.basicFloorDamage=function(){return 10},Game_Actor.prototype.maxFloorDamage=function(){return $dataSystem.optFloorDeath?this.hp:Math.max(this.hp-1,0)},Game_Actor.prototype.performMapDamage=function(){$gameParty.inBattle()||$gameScreen.startFlashForDamage()},Game_Actor.prototype.clearActions=function(){Game_Battler.prototype.clearActions.call(this),this._actionInputIndex=0},Game_Actor.prototype.inputtingAction=function(){return this.action(this._actionInputIndex)},Game_Actor.prototype.selectNextCommand=function(){return this._actionInputIndex<this.numActions()-1&&(this._actionInputIndex++,!0)},Game_Actor.prototype.selectPreviousCommand=function(){return this._actionInputIndex>0&&(this._actionInputIndex--,!0)},Game_Actor.prototype.lastMenuSkill=function(){return this._lastMenuSkill.object()},Game_Actor.prototype.setLastMenuSkill=function(skill){this._lastMenuSkill.setObject(skill)},Game_Actor.prototype.lastBattleSkill=function(){return this._lastBattleSkill.object()},Game_Actor.prototype.setLastBattleSkill=function(skill){this._lastBattleSkill.setObject(skill)},Game_Actor.prototype.lastCommandSymbol=function(){return this._lastCommandSymbol},Game_Actor.prototype.setLastCommandSymbol=function(symbol){this._lastCommandSymbol=symbol},Game_Actor.prototype.testEscape=function(item){return item.effects.some((function(effect,index,ar){return effect&&effect.code===Game_Action.EFFECT_SPECIAL}))},Game_Actor.prototype.meetsUsableItemConditions=function(item){return!($gameParty.inBattle()&&!BattleManager.canEscape()&&this.testEscape(item))&&Game_BattlerBase.prototype.meetsUsableItemConditions.call(this,item)},Game_Enemy.prototype=Object.create(Game_Battler.prototype),Game_Enemy.prototype.constructor=Game_Enemy,Game_Enemy.prototype.initialize=function(enemyId,x,y){Game_Battler.prototype.initialize.call(this),this.setup(enemyId,x,y)},Game_Enemy.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this),this._enemyId=0,this._letter="",this._plural=!1,this._screenX=0,this._screenY=0},Game_Enemy.prototype.setup=function(enemyId,x,y){this._enemyId=enemyId,this._screenX=x,this._screenY=y,this.recoverAll()},Game_Enemy.prototype.isEnemy=function(){return!0},Game_Enemy.prototype.friendsUnit=function(){return $gameTroop},Game_Enemy.prototype.opponentsUnit=function(){return $gameParty},Game_Enemy.prototype.index=function(){return $gameTroop.members().indexOf(this)},Game_Enemy.prototype.isBattleMember=function(){return this.index()>=0},Game_Enemy.prototype.enemyId=function(){return this._enemyId},Game_Enemy.prototype.enemy=function(){return $dataEnemies[this._enemyId]},Game_Enemy.prototype.traitObjects=function(){return Game_Battler.prototype.traitObjects.call(this).concat(this.enemy())},Game_Enemy.prototype.paramBase=function(paramId){return this.enemy().params[paramId]},Game_Enemy.prototype.exp=function(){return this.enemy().exp},Game_Enemy.prototype.gold=function(){return this.enemy().gold},Game_Enemy.prototype.makeDropItems=function(){return this.enemy().dropItems.reduce(function(r,di){return di.kind>0&&Math.random()*di.denominator<this.dropItemRate()?r.concat(this.itemObject(di.kind,di.dataId)):r}.bind(this),[])},Game_Enemy.prototype.dropItemRate=function(){return $gameParty.hasDropItemDouble()?2:1},Game_Enemy.prototype.itemObject=function(kind,dataId){return 1===kind?$dataItems[dataId]:2===kind?$dataWeapons[dataId]:3===kind?$dataArmors[dataId]:null},Game_Enemy.prototype.isSpriteVisible=function(){return!0},Game_Enemy.prototype.screenX=function(){return this._screenX},Game_Enemy.prototype.screenY=function(){return this._screenY},Game_Enemy.prototype.battlerName=function(){return this.enemy().battlerName},Game_Enemy.prototype.battlerHue=function(){return this.enemy().battlerHue},Game_Enemy.prototype.originalName=function(){return this.enemy().name},Game_Enemy.prototype.name=function(){return this.originalName()+(this._plural?this._letter:"")},Game_Enemy.prototype.isLetterEmpty=function(){return""===this._letter},Game_Enemy.prototype.setLetter=function(letter){this._letter=letter},Game_Enemy.prototype.setPlural=function(plural){this._plural=plural},Game_Enemy.prototype.performActionStart=function(action){Game_Battler.prototype.performActionStart.call(this,action),this.requestEffect("whiten")},Game_Enemy.prototype.performAction=function(action){Game_Battler.prototype.performAction.call(this,action)},Game_Enemy.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)},Game_Enemy.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this),SoundManager.playEnemyDamage(),this.requestEffect("blink")},Game_Enemy.prototype.performCollapse=function(){switch(Game_Battler.prototype.performCollapse.call(this),this.collapseType()){case 0:this.requestEffect("collapse"),SoundManager.playEnemyCollapse()
break
case 1:this.requestEffect("bossCollapse"),SoundManager.playBossCollapse1()
break
case 2:this.requestEffect("instantCollapse")}},Game_Enemy.prototype.transform=function(enemyId){const name=this.originalName()
this._enemyId=enemyId,this.originalName()!==name&&(this._letter="",this._plural=!1),this.refresh(),this.numActions()>0&&this.makeActions()},Game_Enemy.prototype.meetsCondition=function(action){const param1=action.conditionParam1,param2=action.conditionParam2
switch(action.conditionType){case 1:return this.meetsTurnCondition(param1,param2)
case 2:return this.meetsHpCondition(param1,param2)
case 3:return this.meetsMpCondition(param1,param2)
case 4:return this.meetsStateCondition(param1)
case 5:return this.meetsPartyLevelCondition(param1)
case 6:return this.meetsSwitchCondition(param1)
default:return!0}},Game_Enemy.prototype.meetsTurnCondition=function(param1,param2){const n=$gameTroop.turnCount()
return 0===param2?n===param1:n>0&&n>=param1&&n%param2==param1%param2},Game_Enemy.prototype.meetsHpCondition=function(param1,param2){return this.hpRate()>=param1&&this.hpRate()<=param2},Game_Enemy.prototype.meetsMpCondition=function(param1,param2){return this.mpRate()>=param1&&this.mpRate()<=param2},Game_Enemy.prototype.meetsStateCondition=function(param){return this.isStateAffected(param)},Game_Enemy.prototype.meetsPartyLevelCondition=function(param){return $gameParty.highestLevel()>=param},Game_Enemy.prototype.meetsSwitchCondition=function(param){return $gameSwitches.value(param)},Game_Enemy.prototype.isActionValid=function(action){return this.meetsCondition(action)&&this.canUse($dataSkills[action.skillId])},Game_Enemy.prototype.selectAction=function(actionList,ratingZero){const sum=actionList.reduce((function(r,a){return r+a.rating-ratingZero}),0)
if(!(sum>0))return null
{let value=Math.randomInt(sum)
for(let i=0;i<actionList.length;i++){const action=actionList[i]
if(value-=action.rating-ratingZero,value<0)return action}}},Game_Enemy.prototype.selectAllActions=function(actionList){const ratingMax=void 0,ratingZero=Math.max.apply(null,actionList.map((function(a){return a.rating})))-3
actionList=actionList.filter((function(a){return a.rating>ratingZero}))
for(let i=0;i<this.numActions();i++)this.action(i).setEnemyAction(this.selectAction(actionList,ratingZero))},Game_Enemy.prototype.makeActions=function(){if(Game_Battler.prototype.makeActions.call(this),this.numActions()>0){const actionList=this.enemy().actions.filter((function(a){return this.isActionValid(a)}),this)
actionList.length>0&&this.selectAllActions(actionList)}this.setActionState("waiting")},Game_Actors.prototype.initialize=function(){this._data=[]},Game_Actors.prototype.actor=function(actorId){return $dataActors[actorId]?(this._data[actorId]||(this._data[actorId]=new Game_Actor(actorId)),this._data[actorId]):null},Game_Unit.prototype.initialize=function(){this._inBattle=!1},Game_Unit.prototype.inBattle=function(){return this._inBattle},Game_Unit.prototype.members=function(){return[]},Game_Unit.prototype.aliveMembers=function(){return this.members().filter((function(member){return member.isAlive()}))},Game_Unit.prototype.deadMembers=function(){return this.members().filter((function(member){return member.isDead()}))},Game_Unit.prototype.movableMembers=function(){return this.members().filter((function(member){return member.canMove()}))},Game_Unit.prototype.clearActions=function(){return this.members().forEach((function(member){return member.clearActions()}))},Game_Unit.prototype.agility=function(){const members=this.members()
if(0===members.length)return 1
const sum=void 0
return members.reduce((function(r,member){return r+member.agi}),0)/members.length},Game_Unit.prototype.tgrSum=function(){return this.aliveMembers().reduce((function(r,member){return r+member.tgr}),0)},Game_Unit.prototype.randomTarget=function(){let tgrRand=Math.random()*this.tgrSum(),target=null
return this.aliveMembers().forEach((function(member){tgrRand-=member.tgr,tgrRand<=0&&!target&&(target=member)})),target},Game_Unit.prototype.randomDeadTarget=function(){const members=this.deadMembers()
return 0===members.length?null:members[Math.floor(Math.random()*members.length)]},Game_Unit.prototype.smoothTarget=function(index){index<0&&(index=0)
const member=this.members()[index]
return member&&member.isAlive()?member:this.aliveMembers()[0]},Game_Unit.prototype.smoothDeadTarget=function(index){index<0&&(index=0)
const member=this.members()[index]
return member&&member.isDead()?member:this.deadMembers()[0]},Game_Unit.prototype.clearResults=function(){this.members().forEach((function(member){member.clearResult()}))},Game_Unit.prototype.onBattleStart=function(){this.members().forEach((function(member){member.onBattleStart()})),this._inBattle=!0},Game_Unit.prototype.onBattleEnd=function(){this._inBattle=!1,this.members().forEach((function(member){member.onBattleEnd()}))},Game_Unit.prototype.makeActions=function(){this.members().forEach((function(member){member.makeActions()}))},Game_Unit.prototype.select=function(activeMember){this.members().forEach((function(member){member===activeMember?member.select():member.deselect()}))},Game_Unit.prototype.isAllDead=function(){return 0===this.aliveMembers().length},Game_Unit.prototype.substituteBattler=function(){const members=this.members()
for(let i=0;i<members.length;i++)if(members[i].isSubstitute())return members[i]},Game_Party.prototype=Object.create(Game_Unit.prototype),Game_Party.prototype.constructor=Game_Party,Game_Party.ABILITY_ENCOUNTER_HALF=0,Game_Party.ABILITY_ENCOUNTER_NONE=1,Game_Party.ABILITY_CANCEL_SURPRISE=2,Game_Party.ABILITY_RAISE_PREEMPTIVE=3,Game_Party.ABILITY_GOLD_DOUBLE=4,Game_Party.ABILITY_DROP_ITEM_DOUBLE=5,Game_Party.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this),this._gold=0,this._steps=0,this._lastItem=new Game_Item,this._menuActorId=0,this._targetActorId=0,this._actors=[],this.initAllItems()},Game_Party.prototype.initAllItems=function(){this._items={},this._weapons={},this._armors={}},Game_Party.prototype.exists=function(){return this._actors.length>0},Game_Party.prototype.size=function(){return this.members().length},Game_Party.prototype.isEmpty=function(){return 0===this.size()},Game_Party.prototype.members=function(){return this.inBattle()?this.battleMembers():this.allMembers()},Game_Party.prototype.allMembers=function(){return this._actors.map((function(id){return $gameActors.actor(id)}))},Game_Party.prototype.battleMembers=function(){return this.allMembers().slice(0,this.maxBattleMembers()).filter((function(actor){return actor.isAppeared()}))},Game_Party.prototype.maxBattleMembers=function(){return 4},Game_Party.prototype.leader=function(){return this.battleMembers()[0]},Game_Party.prototype.reviveBattleMembers=function(){this.battleMembers().forEach((function(actor){actor.isDead()&&actor.setHp(1)}))},Game_Party.prototype.items=function(){const list=[]
for(let id in this._items)list.push($dataItems[id])
return list},Game_Party.prototype.weapons=function(){const list=[]
for(let id in this._weapons)list.push($dataWeapons[id])
return list},Game_Party.prototype.armors=function(){const list=[]
for(let id in this._armors)list.push($dataArmors[id])
return list},Game_Party.prototype.equipItems=function(){return this.weapons().concat(this.armors())},Game_Party.prototype.allItems=function(){return this.items().concat(this.equipItems())}
Game_Party.prototype.itemContainer=function(item){return item?DataManager.isItem(item)?this._items:DataManager.isWeapon(item)?this._weapons:DataManager.isArmor(item)?this._armors:null:null},Game_Party.prototype.setupStartingMembers=function(){this._actors=[],$dataSystem.partyMembers.forEach((function(actorId){$gameActors.actor(actorId)&&this._actors.push(actorId)}),this)},Game_Party.prototype.name=function(){const numBattleMembers=this.battleMembers().length
return 0===numBattleMembers?"":1===numBattleMembers?this.leader().name():TextManager.partyName.format(this.leader().name())},Game_Party.prototype.setupBattleTest=function(){this.setupBattleTestMembers(),this.setupBattleTestItems()},Game_Party.prototype.setupBattleTestMembers=function(){$dataSystem.testBattlers.forEach((function(battler){const actor=$gameActors.actor(battler.actorId)
actor&&(actor.changeLevel(battler.level,!1),actor.initEquips(battler.equips),actor.recoverAll(),this.addActor(battler.actorId))}),this)},Game_Party.prototype.setupBattleTestItems=function(){$dataItems.forEach((function(item){item&&item.name.length>0&&this.gainItem(item,this.maxItems(item))}),this)},Game_Party.prototype.highestLevel=function(){return Math.max.apply(null,this.members().map((function(actor){return actor.level})))},Game_Party.prototype.addActor=function(actorId){this._actors.contains(actorId)||(this._actors.push(actorId),$gamePlayer.refresh(),$gameMap.requestRefresh())},Game_Party.prototype.removeActor=function(actorId){this._actors.contains(actorId)&&(this._actors.splice(this._actors.indexOf(actorId),1),$gamePlayer.refresh(),$gameMap.requestRefresh())},Game_Party.prototype.gold=function(){return this._gold},Game_Party.prototype.gainGold=function(amount){this._gold=(this._gold+amount).clamp(0,this.maxGold())},Game_Party.prototype.loseGold=function(amount){this.gainGold(-amount)},Game_Party.prototype.maxGold=function(){return 99999999},Game_Party.prototype.steps=function(){return this._steps},Game_Party.prototype.increaseSteps=function(){this._steps++},Game_Party.prototype.numItems=function(item){const container=this.itemContainer(item)
return container&&container[item.id]||0},Game_Party.prototype.maxItems=function(item){return 99},Game_Party.prototype.hasMaxItems=function(item){return this.numItems(item)>=this.maxItems(item)},Game_Party.prototype.hasItem=function(item,includeEquip){return void 0===includeEquip&&(includeEquip=!1),this.numItems(item)>0||!(!includeEquip||!this.isAnyMemberEquipped(item))},Game_Party.prototype.isAnyMemberEquipped=function(item){return this.members().some((function(actor){return actor.equips().contains(item)}))},Game_Party.prototype.gainItem=function(item,amount,includeEquip){const container=this.itemContainer(item)
if(container){const lastNumber=void 0,newNumber=this.numItems(item)+amount
container[item.id]=newNumber.clamp(0,this.maxItems(item)),0===container[item.id]&&delete container[item.id],includeEquip&&newNumber<0&&this.discardMembersEquip(item,-newNumber),$gameMap.requestRefresh()}},Game_Party.prototype.discardMembersEquip=function(item,amount){let n=amount
this.members().forEach((function(actor){for(;n>0&&actor.isEquipped(item);)actor.discardEquip(item),n--}))},Game_Party.prototype.loseItem=function(item,amount,includeEquip){this.gainItem(item,-amount,includeEquip)},Game_Party.prototype.consumeItem=function(item){DataManager.isItem(item)&&item.consumable&&this.loseItem(item,1)},Game_Party.prototype.canUse=function(item){return this.members().some((function(actor){return actor.canUse(item)}))},Game_Party.prototype.canInput=function(){return this.members().some((function(actor){return actor.canInput()}))},Game_Party.prototype.isAllDead=function(){return!!Game_Unit.prototype.isAllDead.call(this)&&(this.inBattle()||!this.isEmpty())},Game_Party.prototype.onPlayerWalk=function(){this.members().forEach((function(actor){return actor.onPlayerWalk()}))},Game_Party.prototype.menuActor=function(){let actor=$gameActors.actor(this._menuActorId)
return this.members().contains(actor)||(actor=this.members()[0]),actor},Game_Party.prototype.setMenuActor=function(actor){this._menuActorId=actor.actorId()},Game_Party.prototype.makeMenuActorNext=function(){let index=this.members().indexOf(this.menuActor())
index>=0?(index=(index+1)%this.members().length,this.setMenuActor(this.members()[index])):this.setMenuActor(this.members()[0])},Game_Party.prototype.makeMenuActorPrevious=function(){let index=this.members().indexOf(this.menuActor())
index>=0?(index=(index+this.members().length-1)%this.members().length,this.setMenuActor(this.members()[index])):this.setMenuActor(this.members()[0])},Game_Party.prototype.targetActor=function(){let actor=$gameActors.actor(this._targetActorId)
return this.members().contains(actor)||(actor=this.members()[0]),actor},Game_Party.prototype.setTargetActor=function(actor){this._targetActorId=actor.actorId()},Game_Party.prototype.lastItem=function(){return this._lastItem.object()},Game_Party.prototype.setLastItem=function(item){this._lastItem.setObject(item)},Game_Party.prototype.swapOrder=function(index1,index2){const temp=this._actors[index1]
this._actors[index1]=this._actors[index2],this._actors[index2]=temp,$gamePlayer.refresh()},Game_Party.prototype.charactersForSavefile=function(){return this.battleMembers().map((function(actor){return[actor.characterName(),actor.characterIndex()]}))},Game_Party.prototype.facesForSavefile=function(){return this.battleMembers().map((function(actor){return[actor.faceName(),actor.faceIndex()]}))},Game_Party.prototype.partyAbility=function(abilityId){return this.battleMembers().some((function(actor){return actor.partyAbility(abilityId)}))},Game_Party.prototype.hasEncounterHalf=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_HALF)},Game_Party.prototype.hasEncounterNone=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_NONE)},Game_Party.prototype.hasCancelSurprise=function(){return this.partyAbility(Game_Party.ABILITY_CANCEL_SURPRISE)},Game_Party.prototype.hasRaisePreemptive=function(){return this.partyAbility(Game_Party.ABILITY_RAISE_PREEMPTIVE)},Game_Party.prototype.hasGoldDouble=function(){return this.partyAbility(Game_Party.ABILITY_GOLD_DOUBLE)},Game_Party.prototype.hasDropItemDouble=function(){return this.partyAbility(Game_Party.ABILITY_DROP_ITEM_DOUBLE)},Game_Party.prototype.ratePreemptive=function(troopAgi){let rate=this.agility()>=troopAgi?.05:.03
return this.hasRaisePreemptive()&&(rate*=4),rate},Game_Party.prototype.rateSurprise=function(troopAgi){let rate=this.agility()>=troopAgi?.03:.05
return this.hasCancelSurprise()&&(rate=0),rate},Game_Party.prototype.performVictory=function(){this.members().forEach((function(actor){actor.performVictory()}))},Game_Party.prototype.performEscape=function(){this.members().forEach((function(actor){actor.performEscape()}))},Game_Party.prototype.removeBattleStates=function(){this.members().forEach((function(actor){actor.removeBattleStates()}))},Game_Party.prototype.requestMotionRefresh=function(){this.members().forEach((function(actor){actor.requestMotionRefresh()}))},Game_Troop.prototype=Object.create(Game_Unit.prototype),Game_Troop.prototype.constructor=Game_Troop,Game_Troop.LETTER_TABLE_HALF=[" A"," B"," C"," D"," E"," F"," G"," H"," I"," J"," K"," L"," M"," N"," O"," P"," Q"," R"," S"," T"," U"," V"," W"," X"," Y"," Z"],Game_Troop.LETTER_TABLE_FULL=["Ａ","Ｂ","Ｃ","Ｄ","Ｅ","Ｆ","Ｇ","Ｈ","Ｉ","Ｊ","Ｋ","Ｌ","Ｍ","Ｎ","Ｏ","Ｐ","Ｑ","Ｒ","Ｓ","Ｔ","Ｕ","Ｖ","Ｗ","Ｘ","Ｙ","Ｚ"],Game_Troop.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this),this._interpreter=new Game_Interpreter,this.clear()},Game_Troop.prototype.isEventRunning=function(){return this._interpreter.isRunning()},Game_Troop.prototype.updateInterpreter=function(){this._interpreter.update()},Game_Troop.prototype.turnCount=function(){return this._turnCount},Game_Troop.prototype.members=function(){return this._enemies},Game_Troop.prototype.clear=function(){this._interpreter.clear(),this._troopId=0,this._eventFlags={},this._enemies=[],this._turnCount=0,this._namesCount={}},Game_Troop.prototype.troop=function(){return $dataTroops[this._troopId]},Game_Troop.prototype.setup=function(troopId){this.clear(),this._troopId=troopId,this._enemies=[],this.troop().members.forEach((function(member){if($dataEnemies[member.enemyId]){const enemyId=void 0,x=void 0,y=void 0,enemy=new Game_Enemy(member.enemyId,member.x,member.y)
member.hidden&&enemy.hide(),this._enemies.push(enemy)}}),this),this.makeUniqueNames()},Game_Troop.prototype.makeUniqueNames=function(){const table=this.letterTable()
this.members().forEach((function(enemy){if(enemy.isAlive()&&enemy.isLetterEmpty()){const name=enemy.originalName(),n=this._namesCount[name]||0
enemy.setLetter(table[n%table.length]),this._namesCount[name]=n+1}}),this),this.members().forEach((function(enemy){const name=enemy.originalName()
this._namesCount[name]>=2&&enemy.setPlural(!0)}),this)},Game_Troop.prototype.letterTable=function(){return $gameSystem.isCJK()?Game_Troop.LETTER_TABLE_FULL:Game_Troop.LETTER_TABLE_HALF},Game_Troop.prototype.enemyNames=function(){const names=[]
return this.members().forEach((function(enemy){const name=enemy.originalName()
enemy.isAlive()&&!names.contains(name)&&names.push(name)})),names},Game_Troop.prototype.meetsConditions=function(page){const c=page.conditions
if(!(c.turnEnding||c.turnValid||c.enemyValid||c.actorValid||c.switchValid))return!1
if(c.turnEnding&&!BattleManager.isTurnEnd())return!1
if(c.turnValid){const n=this._turnCount,a=c.turnA,b=c.turnB
if(0===b&&n!==a)return!1
if(b>0&&(n<1||n<a||n%b!=a%b))return!1}if(c.enemyValid){const enemy=$gameTroop.members()[c.enemyIndex]
if(!enemy||100*enemy.hpRate()>c.enemyHp)return!1}if(c.actorValid){const actor=$gameActors.actor(c.actorId)
if(!actor||100*actor.hpRate()>c.actorHp)return!1}return!(c.switchValid&&!$gameSwitches.value(c.switchId))},Game_Troop.prototype.setupBattleEvent=function(){if(!this._interpreter.isRunning()){if(this._interpreter.setupReservedCommonEvent())return
const pages=this.troop().pages
for(let i=0;i<pages.length;i++){const page=pages[i]
if(this.meetsConditions(page)&&!this._eventFlags[i]){this._interpreter.setup(page.list),this._interpreter.setEventInfo({eventType:"battle_event",troopId:this._troopId,page:i+1}),page.span<=1&&(this._eventFlags[i]=!0)
break}}}},Game_Troop.prototype.increaseTurn=function(){const pages=this.troop().pages
for(let i=0;i<pages.length;i++){const page=void 0
1===pages[i].span&&(this._eventFlags[i]=!1)}this._turnCount++},Game_Troop.prototype.expTotal=function(){return this.deadMembers().reduce((function(r,enemy){return r+enemy.exp()}),0)},Game_Troop.prototype.goldTotal=function(){return this.deadMembers().reduce((function(r,enemy){return r+enemy.gold()}),0)*this.goldRate()},Game_Troop.prototype.goldRate=function(){return $gameParty.hasGoldDouble()?2:1},Game_Troop.prototype.makeDropItems=function(){return this.deadMembers().reduce((function(r,enemy){return r.concat(enemy.makeDropItems())}),[])},Game_Map.prototype.initialize=function(){this._interpreter=new Game_Interpreter,this._mapId=0,this._tilesetId=0,this._events=[],this._commonEvents=[],this._vehicles=[],this._displayX=0,this._displayY=0,this._nameDisplay=!0,this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4,this._parallaxName="",this._parallaxZero=!1,this._parallaxLoopX=!1,this._parallaxLoopY=!1,this._parallaxSx=0,this._parallaxSy=0,this._parallaxX=0,this._parallaxY=0,this._battleback1Name=null,this._battleback2Name=null,this.createVehicles()},Game_Map.prototype.setup=function(mapId){if(!$dataMap)throw new Error("The map data is not available")
this._mapId=mapId,this._tilesetId=$dataMap.tilesetId,this._displayX=0,this._displayY=0,this.refereshVehicles(),this.setupEvents(),this.setupScroll(),this.setupParallax(),this.setupBattleback(),this._needsRefresh=!1},Game_Map.prototype.isEventRunning=function(){return this._interpreter.isRunning()||this.isAnyEventStarting()},Game_Map.prototype.tileWidth=function(){return 48},Game_Map.prototype.tileHeight=function(){return 48},Game_Map.prototype.mapId=function(){return this._mapId},Game_Map.prototype.tilesetId=function(){return this._tilesetId},Game_Map.prototype.displayX=function(){return this._displayX},Game_Map.prototype.displayY=function(){return this._displayY},Game_Map.prototype.parallaxName=function(){return this._parallaxName},Game_Map.prototype.battleback1Name=function(){return this._battleback1Name},Game_Map.prototype.battleback2Name=function(){return this._battleback2Name},Game_Map.prototype.requestRefresh=function(mapId){this._needsRefresh=!0},Game_Map.prototype.isNameDisplayEnabled=function(){return this._nameDisplay},Game_Map.prototype.disableNameDisplay=function(){this._nameDisplay=!1},Game_Map.prototype.enableNameDisplay=function(){this._nameDisplay=!0},Game_Map.prototype.createVehicles=function(){this._vehicles=[],this._vehicles[0]=new Game_Vehicle("boat"),this._vehicles[1]=new Game_Vehicle("ship"),this._vehicles[2]=new Game_Vehicle("airship")},Game_Map.prototype.refereshVehicles=function(){this._vehicles.forEach((function(vehicle){vehicle.refresh()}))},Game_Map.prototype.vehicles=function(){return this._vehicles},Game_Map.prototype.vehicle=function(type){return 0===type||"boat"===type?this.boat():1===type||"ship"===type?this.ship():2===type||"airship"===type?this.airship():null},Game_Map.prototype.boat=function(){return this._vehicles[0]},Game_Map.prototype.ship=function(){return this._vehicles[1]},Game_Map.prototype.airship=function(){return this._vehicles[2]},Game_Map.prototype.setupEvents=function(){this._events=[]
for(let i=0;i<$dataMap.events.length;i++)$dataMap.events[i]&&(this._events[i]=new Game_Event(this._mapId,i))
this._commonEvents=this.parallelCommonEvents().map((function(commonEvent){return new Game_CommonEvent(commonEvent.id)})),this.refreshTileEvents()},Game_Map.prototype.events=function(){return this._events.filter((function(event){return!!event}))},Game_Map.prototype.event=function(eventId){return this._events[eventId]},Game_Map.prototype.eraseEvent=function(eventId){this._events[eventId].erase()},Game_Map.prototype.parallelCommonEvents=function(){return $dataCommonEvents.filter((function(commonEvent){return commonEvent&&2===commonEvent.trigger}))},Game_Map.prototype.setupScroll=function(){this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4},Game_Map.prototype.setupParallax=function(){this._parallaxName=$dataMap.parallaxName||"",this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName),this._parallaxLoopX=$dataMap.parallaxLoopX,this._parallaxLoopY=$dataMap.parallaxLoopY,this._parallaxSx=$dataMap.parallaxSx,this._parallaxSy=$dataMap.parallaxSy,this._parallaxX=0,this._parallaxY=0},Game_Map.prototype.setupBattleback=function(){$dataMap.specifyBattleback?(this._battleback1Name=$dataMap.battleback1Name,this._battleback2Name=$dataMap.battleback2Name):(this._battleback1Name=null,this._battleback2Name=null)},Game_Map.prototype.setDisplayPos=function(x,y){if(this.isLoopHorizontal())this._displayX=x.mod(this.width()),this._parallaxX=x
else{const endX=this.width()-this.screenTileX()
this._displayX=endX<0?endX/2:x.clamp(0,endX),this._parallaxX=this._displayX}if(this.isLoopVertical())this._displayY=y.mod(this.height()),this._parallaxY=y
else{const endY=this.height()-this.screenTileY()
this._displayY=endY<0?endY/2:y.clamp(0,endY),this._parallaxY=this._displayY}},Game_Map.prototype.parallaxOx=function(){return this._parallaxZero?this._parallaxX*this.tileWidth():this._parallaxLoopX?this._parallaxX*this.tileWidth()/2:0},Game_Map.prototype.parallaxOy=function(){return this._parallaxZero?this._parallaxY*this.tileHeight():this._parallaxLoopY?this._parallaxY*this.tileHeight()/2:0},Game_Map.prototype.tileset=function(){return $dataTilesets[this._tilesetId]},Game_Map.prototype.tilesetFlags=function(){const tileset=this.tileset()
return tileset?tileset.flags:[]},Game_Map.prototype.displayName=function(){return $dataMap.displayName},Game_Map.prototype.width=function(){return $dataMap.width},Game_Map.prototype.height=function(){return $dataMap.height},Game_Map.prototype.data=function(){return $dataMap.data},Game_Map.prototype.isLoopHorizontal=function(){return 2===$dataMap.scrollType||3===$dataMap.scrollType},Game_Map.prototype.isLoopVertical=function(){return 1===$dataMap.scrollType||3===$dataMap.scrollType},Game_Map.prototype.isDashDisabled=function(){return $dataMap.disableDashing},Game_Map.prototype.encounterList=function(){return $dataMap.encounterList},Game_Map.prototype.encounterStep=function(){return $dataMap.encounterStep},Game_Map.prototype.isOverworld=function(){return this.tileset()&&0===this.tileset().mode},Game_Map.prototype.screenTileX=function(){return Graphics.width/this.tileWidth()},Game_Map.prototype.screenTileY=function(){return Graphics.height/this.tileHeight()},Game_Map.prototype.adjustX=function(x){return this.isLoopHorizontal()&&x<this._displayX-(this.width()-this.screenTileX())/2?x-this._displayX+$dataMap.width:x-this._displayX},Game_Map.prototype.adjustY=function(y){return this.isLoopVertical()&&y<this._displayY-(this.height()-this.screenTileY())/2?y-this._displayY+$dataMap.height:y-this._displayY},Game_Map.prototype.roundX=function(x){return this.isLoopHorizontal()?x.mod(this.width()):x},Game_Map.prototype.roundY=function(y){return this.isLoopVertical()?y.mod(this.height()):y},Game_Map.prototype.xWithDirection=function(x,d){return x+(6===d?1:4===d?-1:0)},Game_Map.prototype.yWithDirection=function(y,d){return y+(2===d?1:8===d?-1:0)},Game_Map.prototype.roundXWithDirection=function(x,d){return this.roundX(x+(6===d?1:4===d?-1:0))},Game_Map.prototype.roundYWithDirection=function(y,d){return this.roundY(y+(2===d?1:8===d?-1:0))},Game_Map.prototype.deltaX=function(x1,x2){let result=x1-x2
return this.isLoopHorizontal()&&Math.abs(result)>this.width()/2&&(result<0?result+=this.width():result-=this.width()),result},Game_Map.prototype.deltaY=function(y1,y2){let result=y1-y2
return this.isLoopVertical()&&Math.abs(result)>this.height()/2&&(result<0?result+=this.height():result-=this.height()),result},Game_Map.prototype.distance=function(x1,y1,x2,y2){return Math.abs(this.deltaX(x1,x2))+Math.abs(this.deltaY(y1,y2))},Game_Map.prototype.canvasToMapX=function(x){const tileWidth=this.tileWidth(),originX=this._displayX*tileWidth,mapX=Math.floor((originX+x)/tileWidth)
return this.roundX(mapX)},Game_Map.prototype.canvasToMapY=function(y){const tileHeight=this.tileHeight(),originY=this._displayY*tileHeight,mapY=Math.floor((originY+y)/tileHeight)
return this.roundY(mapY)},Game_Map.prototype.autoplay=function(){$dataMap.autoplayBgm&&($gamePlayer.isInVehicle()?$gameSystem.saveWalkingBgm2():AudioManager.playBgm($dataMap.bgm)),$dataMap.autoplayBgs&&AudioManager.playBgs($dataMap.bgs)},Game_Map.prototype.refreshIfNeeded=function(){this._needsRefresh&&this.refresh()},Game_Map.prototype.refresh=function(){this.events().forEach((function(event){event.refresh()})),this._commonEvents.forEach((function(event){event.refresh()})),this.refreshTileEvents(),this._needsRefresh=!1},Game_Map.prototype.refreshTileEvents=function(){this.tileEvents=this.events().filter((function(event){return event.isTile()}))},Game_Map.prototype.eventsXy=function(x,y){return this.events().filter((function(event){return event.pos(x,y)}))},Game_Map.prototype.eventsXyNt=function(x,y){return this.events().filter((function(event){return event.posNt(x,y)}))},Game_Map.prototype.tileEventsXy=function(x,y){return this.tileEvents.filter((function(event){return event.posNt(x,y)}))},Game_Map.prototype.eventIdXy=function(x,y){const list=this.eventsXy(x,y)
return 0===list.length?0:list[0].eventId()},Game_Map.prototype.scrollDown=function(distance){if(this.isLoopVertical())this._displayY+=distance,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY+=distance)
else if(this.height()>=this.screenTileY()){const lastY=this._displayY
this._displayY=Math.min(this._displayY+distance,this.height()-this.screenTileY()),this._parallaxY+=this._displayY-lastY}},Game_Map.prototype.scrollLeft=function(distance){if(this.isLoopHorizontal())this._displayX+=$dataMap.width-distance,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX-=distance)
else if(this.width()>=this.screenTileX()){const lastX=this._displayX
this._displayX=Math.max(this._displayX-distance,0),this._parallaxX+=this._displayX-lastX}},Game_Map.prototype.scrollRight=function(distance){if(this.isLoopHorizontal())this._displayX+=distance,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX+=distance)
else if(this.width()>=this.screenTileX()){const lastX=this._displayX
this._displayX=Math.min(this._displayX+distance,this.width()-this.screenTileX()),this._parallaxX+=this._displayX-lastX}},Game_Map.prototype.scrollUp=function(distance){if(this.isLoopVertical())this._displayY+=$dataMap.height-distance,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY-=distance)
else if(this.height()>=this.screenTileY()){const lastY=this._displayY
this._displayY=Math.max(this._displayY-distance,0),this._parallaxY+=this._displayY-lastY}},Game_Map.prototype.isValid=function(x,y){return x>=0&&x<this.width()&&y>=0&&y<this.height()},Game_Map.prototype.checkPassage=function(x,y,bit){const flags=this.tilesetFlags(),tiles=this.allTiles(x,y)
for(let i=0;i<tiles.length;i++){const flag=flags[tiles[i]]
if(0==(16&flag)){if(0==(flag&bit))return!0
if((flag&bit)===bit)return!1}}return!1},Game_Map.prototype.tileId=function(x,y,z){const width=$dataMap.width,height=$dataMap.height
return $dataMap.data[(z*height+y)*width+x]||0},Game_Map.prototype.layeredTiles=function(x,y){const tiles=[]
for(let i=0;i<4;i++)tiles.push(this.tileId(x,y,3-i))
return tiles},Game_Map.prototype.allTiles=function(x,y){const tiles=void 0
return this.tileEventsXy(x,y).map((function(event){return event.tileId()})).concat(this.layeredTiles(x,y))},Game_Map.prototype.autotileType=function(x,y,z){const tileId=this.tileId(x,y,z)
return tileId>=2048?Math.floor((tileId-2048)/48):-1},Game_Map.prototype.isPassable=function(x,y,d){return this.checkPassage(x,y,1<<d/2-1&15)},Game_Map.prototype.isBoatPassable=function(x,y){return this.checkPassage(x,y,512)},Game_Map.prototype.isShipPassable=function(x,y){return this.checkPassage(x,y,1024)},Game_Map.prototype.isAirshipLandOk=function(x,y){return this.checkPassage(x,y,2048)&&this.checkPassage(x,y,15)},Game_Map.prototype.checkLayeredTilesFlags=function(x,y,bit){const flags=this.tilesetFlags()
return this.layeredTiles(x,y).some((function(tileId){return 0!=(flags[tileId]&bit)}))},Game_Map.prototype.isLadder=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,32)},Game_Map.prototype.isBush=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,64)},Game_Map.prototype.isCounter=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,128)},Game_Map.prototype.isDamageFloor=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,256)},Game_Map.prototype.terrainTag=function(x,y){if(this.isValid(x,y)){const flags=this.tilesetFlags(),tiles=this.layeredTiles(x,y)
for(let i=0;i<tiles.length;i++){const tag=flags[tiles[i]]>>12
if(tag>0)return tag}}return 0},Game_Map.prototype.regionId=function(x,y){return this.isValid(x,y)?this.tileId(x,y,5):0},Game_Map.prototype.startScroll=function(direction,distance,speed){this._scrollDirection=direction,this._scrollRest=distance,this._scrollSpeed=speed},Game_Map.prototype.isScrolling=function(){return this._scrollRest>0},Game_Map.prototype.update=function(sceneActive){this.refreshIfNeeded(),sceneActive&&this.updateInterpreter(),this.updateScroll(),this.updateEvents(),this.updateVehicles(),this.updateParallax()},Game_Map.prototype.updateScroll=function(){if(this.isScrolling()){const lastX=this._displayX,lastY=this._displayY
this.doScroll(this._scrollDirection,this.scrollDistance()),this._displayX===lastX&&this._displayY===lastY?this._scrollRest=0:this._scrollRest-=this.scrollDistance()}},Game_Map.prototype.scrollDistance=function(){return Math.pow(2,this._scrollSpeed)/256},Game_Map.prototype.doScroll=function(direction,distance){switch(direction){case 2:this.scrollDown(distance)
break
case 4:this.scrollLeft(distance)
break
case 6:this.scrollRight(distance)
break
case 8:this.scrollUp(distance)}},Game_Map.prototype.updateEvents=function(){this.events().forEach((function(event){event.update()})),this._commonEvents.forEach((function(event){event.update()}))},Game_Map.prototype.updateVehicles=function(){this._vehicles.forEach((function(vehicle){vehicle.update()}))},Game_Map.prototype.updateParallax=function(){this._parallaxLoopX&&(this._parallaxX+=this._parallaxSx/this.tileWidth()/2),this._parallaxLoopY&&(this._parallaxY+=this._parallaxSy/this.tileHeight()/2)},Game_Map.prototype.changeTileset=function(tilesetId){this._tilesetId=tilesetId,this.refresh()},Game_Map.prototype.changeBattleback=function(battleback1Name,battleback2Name){this._battleback1Name=battleback1Name,this._battleback2Name=battleback2Name},Game_Map.prototype.changeParallax=function(name,loopX,loopY,sx,sy){this._parallaxName=name,this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName),this._parallaxLoopX&&!loopX&&(this._parallaxX=0),this._parallaxLoopY&&!loopY&&(this._parallaxY=0),this._parallaxLoopX=loopX,this._parallaxLoopY=loopY,this._parallaxSx=sx,this._parallaxSy=sy},Game_Map.prototype.updateInterpreter=function(){for(;;){if(this._interpreter.update(),this._interpreter.isRunning())return
if(this._interpreter.eventId()>0&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear()),!this.setupStartingEvent())return}},Game_Map.prototype.unlockEvent=function(eventId){this._events[eventId]&&this._events[eventId].unlock()},Game_Map.prototype.setupStartingEvent=function(){return this.refreshIfNeeded(),!!(this._interpreter.setupReservedCommonEvent()||this.setupTestEvent()||this.setupStartingMapEvent()||this.setupAutorunCommonEvent())},Game_Map.prototype.setupTestEvent=function(){return!!$testEvent&&(this._interpreter.setup($testEvent,0),this._interpreter.setEventInfo({eventType:"test_event"}),$testEvent=null,!0)},Game_Map.prototype.setupStartingMapEvent=function(){const events=this.events()
for(let i=0;i<events.length;i++){const event=events[i]
if(event.isStarting())return event.clearStartingFlag(),this._interpreter.setup(event.list(),event.eventId()),this._interpreter.setEventInfo(event.getEventInfo()),!0}return!1},Game_Map.prototype.setupAutorunCommonEvent=function(){for(let i=0;i<$dataCommonEvents.length;i++){const event=$dataCommonEvents[i]
if(event&&1===event.trigger&&$gameSwitches.value(event.switchId))return this._interpreter.setup(event.list),this._interpreter.setEventInfo({eventType:"common_event",commonEventId:i}),!0}return!1},Game_Map.prototype.isAnyEventStarting=function(){return this.events().some((function(event){return event.isStarting()}))},Game_CommonEvent.prototype.initialize=function(commonEventId){this._commonEventId=commonEventId,this.refresh()},Game_CommonEvent.prototype.event=function(){return $dataCommonEvents[this._commonEventId]},Game_CommonEvent.prototype.list=function(){return this.event().list},Game_CommonEvent.prototype.refresh=function(){this.isActive()?this._interpreter||(this._interpreter=new Game_Interpreter):this._interpreter=null},Game_CommonEvent.prototype.isActive=function(){const event=this.event()
return 2===event.trigger&&$gameSwitches.value(event.switchId)},Game_CommonEvent.prototype.update=function(){this._interpreter&&(this._interpreter.isRunning()||(this._interpreter.setup(this.list()),this._interpreter.setEventInfo({eventType:"common_event",commonEventId:this._commonEventId})),this._interpreter.update())},Object.defineProperties(Game_CharacterBase.prototype,{x:{get(){return this._x},configurable:!0},y:{get(){return this._y},configurable:!0}}),Game_CharacterBase.prototype.initialize=function(){this.initMembers()},Game_CharacterBase.prototype.initMembers=function(){this._x=0,this._y=0,this._realX=0,this._realY=0,this._moveSpeed=4,this._moveFrequency=6,this._opacity=255,this._blendMode=0,this._direction=2,this._pattern=1,this._priorityType=1,this._tileId=0,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!1,this._walkAnime=!0,this._stepAnime=!1,this._directionFix=!1,this._through=!1,this._transparent=!1,this._bushDepth=0,this._animationId=0,this._balloonId=0,this._animationPlaying=!1,this._balloonPlaying=!1,this._animationCount=0,this._stopCount=0,this._jumpCount=0,this._jumpPeak=0,this._movementSuccess=!0},Game_CharacterBase.prototype.pos=function(x,y){return this._x===x&&this._y===y},Game_CharacterBase.prototype.posNt=function(x,y){return this.pos(x,y)&&!this.isThrough()},Game_CharacterBase.prototype.moveSpeed=function(){return this._moveSpeed},Game_CharacterBase.prototype.setMoveSpeed=function(moveSpeed){this._moveSpeed=moveSpeed},Game_CharacterBase.prototype.moveFrequency=function(){return this._moveFrequency},Game_CharacterBase.prototype.setMoveFrequency=function(moveFrequency){this._moveFrequency=moveFrequency},Game_CharacterBase.prototype.opacity=function(){return this._opacity},Game_CharacterBase.prototype.setOpacity=function(opacity){this._opacity=opacity},Game_CharacterBase.prototype.blendMode=function(){return this._blendMode},Game_CharacterBase.prototype.setBlendMode=function(blendMode){this._blendMode=blendMode},Game_CharacterBase.prototype.isNormalPriority=function(){return 1===this._priorityType},Game_CharacterBase.prototype.setPriorityType=function(priorityType){this._priorityType=priorityType},Game_CharacterBase.prototype.isMoving=function(){return this._realX!==this._x||this._realY!==this._y},Game_CharacterBase.prototype.isJumping=function(){return this._jumpCount>0},Game_CharacterBase.prototype.jumpHeight=function(){return(this._jumpPeak*this._jumpPeak-Math.pow(Math.abs(this._jumpCount-this._jumpPeak),2))/2},Game_CharacterBase.prototype.isStopping=function(){return!this.isMoving()&&!this.isJumping()},Game_CharacterBase.prototype.checkStop=function(threshold){return this._stopCount>threshold},Game_CharacterBase.prototype.resetStopCount=function(){this._stopCount=0},Game_CharacterBase.prototype.realMoveSpeed=function(){return this._moveSpeed+(this.isDashing()?1:0)},Game_CharacterBase.prototype.distancePerFrame=function(){return Math.pow(2,this.realMoveSpeed())/256},Game_CharacterBase.prototype.isDashing=function(){return!1},Game_CharacterBase.prototype.isDebugThrough=function(){return!1},Game_CharacterBase.prototype.straighten=function(){(this.hasWalkAnime()||this.hasStepAnime())&&(this._pattern=1),this._animationCount=0},Game_CharacterBase.prototype.reverseDir=function(d){return 10-d},Game_CharacterBase.prototype.canPass=function(x,y,d){const x2=$gameMap.roundXWithDirection(x,d),y2=$gameMap.roundYWithDirection(y,d)
return!(!$gameMap.isValid(x2,y2)||!this.isThrough()&&!this.isDebugThrough()&&(!this.isMapPassable(x,y,d)||this.isCollidedWithCharacters(x2,y2)))},Game_CharacterBase.prototype.canPassDiagonally=function(x,y,horz,vert){const x2=$gameMap.roundXWithDirection(x,horz),y2=$gameMap.roundYWithDirection(y,vert)
return!(!this.canPass(x,y,vert)||!this.canPass(x,y2,horz))||!(!this.canPass(x,y,horz)||!this.canPass(x2,y,vert))},Game_CharacterBase.prototype.isMapPassable=function(x,y,d){const x2=$gameMap.roundXWithDirection(x,d),y2=$gameMap.roundYWithDirection(y,d),d2=this.reverseDir(d)
return $gameMap.isPassable(x,y,d)&&$gameMap.isPassable(x2,y2,d2)},Game_CharacterBase.prototype.isCollidedWithCharacters=function(x,y){return this.isCollidedWithEvents(x,y)||this.isCollidedWithVehicles(x,y)},Game_CharacterBase.prototype.isCollidedWithEvents=function(x,y){const events=void 0
return $gameMap.eventsXyNt(x,y).some((function(event){return event.isNormalPriority()}))},Game_CharacterBase.prototype.isCollidedWithVehicles=function(x,y){return $gameMap.boat().posNt(x,y)||$gameMap.ship().posNt(x,y)},Game_CharacterBase.prototype.setPosition=function(x,y){this._x=Math.round(x),this._y=Math.round(y),this._realX=x,this._realY=y},Game_CharacterBase.prototype.copyPosition=function(character){this._x=character._x,this._y=character._y,this._realX=character._realX,this._realY=character._realY,this._direction=character._direction},Game_CharacterBase.prototype.locate=function(x,y){this.setPosition(x,y),this.straighten(),this.refreshBushDepth()},Game_CharacterBase.prototype.direction=function(){return this._direction},Game_CharacterBase.prototype.setDirection=function(d){!this.isDirectionFixed()&&d&&(this._direction=d),this.resetStopCount()},Game_CharacterBase.prototype.isTile=function(){return this._tileId>0&&0===this._priorityType},Game_CharacterBase.prototype.isObjectCharacter=function(){return this._isObjectCharacter},Game_CharacterBase.prototype.shiftY=function(){return this.isObjectCharacter()?0:6},Game_CharacterBase.prototype.scrolledX=function(){return $gameMap.adjustX(this._realX)},Game_CharacterBase.prototype.scrolledY=function(){return $gameMap.adjustY(this._realY)},Game_CharacterBase.prototype.screenX=function(){const tw=$gameMap.tileWidth()
return Math.round(this.scrolledX()*tw+tw/2)},Game_CharacterBase.prototype.screenY=function(){const th=$gameMap.tileHeight()
return Math.round(this.scrolledY()*th+th-this.shiftY()-this.jumpHeight())},Game_CharacterBase.prototype.screenZ=function(){return 2*this._priorityType+1},Game_CharacterBase.prototype.isNearTheScreen=function(){const gw=Graphics.width,gh=Graphics.height,tw=$gameMap.tileWidth(),th=$gameMap.tileHeight(),px=this.scrolledX()*tw+tw/2-gw/2,py=this.scrolledY()*th+th/2-gh/2
return px>=-gw&&px<=gw&&py>=-gh&&py<=gh},Game_CharacterBase.prototype.update=function(){this.isStopping()&&this.updateStop(),this.isJumping()?this.updateJump():this.isMoving()&&this.updateMove(),this.updateAnimation()},Game_CharacterBase.prototype.updateStop=function(){this._stopCount++},Game_CharacterBase.prototype.updateJump=function(){this._jumpCount--,this._realX=(this._realX*this._jumpCount+this._x)/(this._jumpCount+1),this._realY=(this._realY*this._jumpCount+this._y)/(this._jumpCount+1),this.refreshBushDepth(),0===this._jumpCount&&(this._realX=this._x=$gameMap.roundX(this._x),this._realY=this._y=$gameMap.roundY(this._y))},Game_CharacterBase.prototype.updateMove=function(){this._x<this._realX&&(this._realX=Math.max(this._realX-this.distancePerFrame(),this._x)),this._x>this._realX&&(this._realX=Math.min(this._realX+this.distancePerFrame(),this._x)),this._y<this._realY&&(this._realY=Math.max(this._realY-this.distancePerFrame(),this._y)),this._y>this._realY&&(this._realY=Math.min(this._realY+this.distancePerFrame(),this._y)),this.isMoving()||this.refreshBushDepth()},Game_CharacterBase.prototype.updateAnimation=function(){this.updateAnimationCount(),this._animationCount>=this.animationWait()&&(this.updatePattern(),this._animationCount=0)},Game_CharacterBase.prototype.animationWait=function(){return 3*(9-this.realMoveSpeed())},Game_CharacterBase.prototype.updateAnimationCount=function(){this.isMoving()&&this.hasWalkAnime()?this._animationCount+=1.5:!this.hasStepAnime()&&this.isOriginalPattern()||this._animationCount++},Game_CharacterBase.prototype.updatePattern=function(){!this.hasStepAnime()&&this._stopCount>0?this.resetPattern():this._pattern=(this._pattern+1)%this.maxPattern()},Game_CharacterBase.prototype.maxPattern=function(){return 4},Game_CharacterBase.prototype.pattern=function(){return this._pattern<3?this._pattern:1},Game_CharacterBase.prototype.setPattern=function(pattern){this._pattern=pattern},Game_CharacterBase.prototype.isOriginalPattern=function(){return 1===this.pattern()},Game_CharacterBase.prototype.resetPattern=function(){this.setPattern(1)},Game_CharacterBase.prototype.refreshBushDepth=function(){this.isNormalPriority()&&!this.isObjectCharacter()&&this.isOnBush()&&!this.isJumping()?this.isMoving()||(this._bushDepth=12):this._bushDepth=0},Game_CharacterBase.prototype.isOnLadder=function(){return $gameMap.isLadder(this._x,this._y)},Game_CharacterBase.prototype.isOnBush=function(){return $gameMap.isBush(this._x,this._y)},Game_CharacterBase.prototype.terrainTag=function(){return $gameMap.terrainTag(this._x,this._y)},Game_CharacterBase.prototype.regionId=function(){return $gameMap.regionId(this._x,this._y)},Game_CharacterBase.prototype.increaseSteps=function(){this.isOnLadder()&&this.setDirection(8),this.resetStopCount(),this.refreshBushDepth()},Game_CharacterBase.prototype.tileId=function(){return this._tileId},Game_CharacterBase.prototype.characterName=function(){return this._characterName},Game_CharacterBase.prototype.characterIndex=function(){return this._characterIndex},Game_CharacterBase.prototype.setImage=function(characterName,characterIndex){this._tileId=0,this._characterName=characterName,this._characterIndex=characterIndex,this._isObjectCharacter=ImageManager.isObjectCharacter(characterName)},Game_CharacterBase.prototype.setTileImage=function(tileId){this._tileId=tileId,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!0},Game_CharacterBase.prototype.checkEventTriggerTouchFront=function(d){const x2=$gameMap.roundXWithDirection(this._x,d),y2=$gameMap.roundYWithDirection(this._y,d)
this.checkEventTriggerTouch(x2,y2)},Game_CharacterBase.prototype.checkEventTriggerTouch=function(x,y){return!1},Game_CharacterBase.prototype.isMovementSucceeded=function(x,y){return this._movementSuccess},Game_CharacterBase.prototype.setMovementSuccess=function(success){this._movementSuccess=success},Game_CharacterBase.prototype.moveStraight=function(d){this.setMovementSuccess(this.canPass(this._x,this._y,d)),this.isMovementSucceeded()?(this.setDirection(d),this._x=$gameMap.roundXWithDirection(this._x,d),this._y=$gameMap.roundYWithDirection(this._y,d),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(d)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(d)),this.increaseSteps()):(this.setDirection(d),this.checkEventTriggerTouchFront(d))},Game_CharacterBase.prototype.moveDiagonally=function(horz,vert){this.setMovementSuccess(this.canPassDiagonally(this._x,this._y,horz,vert)),this.isMovementSucceeded()&&(this._x=$gameMap.roundXWithDirection(this._x,horz),this._y=$gameMap.roundYWithDirection(this._y,vert),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(horz)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(vert)),this.increaseSteps()),this._direction===this.reverseDir(horz)&&this.setDirection(horz),this._direction===this.reverseDir(vert)&&this.setDirection(vert)},Game_CharacterBase.prototype.jump=function(xPlus,yPlus){Math.abs(xPlus)>Math.abs(yPlus)?0!==xPlus&&this.setDirection(xPlus<0?4:6):0!==yPlus&&this.setDirection(yPlus<0?8:2),this._x+=xPlus,this._y+=yPlus
const distance=Math.round(Math.sqrt(xPlus*xPlus+yPlus*yPlus))
this._jumpPeak=10+distance-this._moveSpeed,this._jumpCount=2*this._jumpPeak,this.resetStopCount(),this.straighten()},Game_CharacterBase.prototype.hasWalkAnime=function(){return this._walkAnime},Game_CharacterBase.prototype.setWalkAnime=function(walkAnime){this._walkAnime=walkAnime},Game_CharacterBase.prototype.hasStepAnime=function(){return this._stepAnime},Game_CharacterBase.prototype.setStepAnime=function(stepAnime){this._stepAnime=stepAnime},Game_CharacterBase.prototype.isDirectionFixed=function(){return this._directionFix},Game_CharacterBase.prototype.setDirectionFix=function(directionFix){this._directionFix=directionFix},Game_CharacterBase.prototype.isThrough=function(){return this._through},Game_CharacterBase.prototype.setThrough=function(through){this._through=through},Game_CharacterBase.prototype.isTransparent=function(){return this._transparent},Game_CharacterBase.prototype.bushDepth=function(){return this._bushDepth},Game_CharacterBase.prototype.setTransparent=function(transparent){this._transparent=transparent},Game_CharacterBase.prototype.requestAnimation=function(animationId){this._animationId=animationId},Game_CharacterBase.prototype.requestBalloon=function(balloonId){this._balloonId=balloonId},Game_CharacterBase.prototype.animationId=function(){return this._animationId},Game_CharacterBase.prototype.balloonId=function(){return this._balloonId},Game_CharacterBase.prototype.startAnimation=function(){this._animationId=0,this._animationPlaying=!0},Game_CharacterBase.prototype.startBalloon=function(){this._balloonId=0,this._balloonPlaying=!0},Game_CharacterBase.prototype.isAnimationPlaying=function(){return this._animationId>0||this._animationPlaying},Game_CharacterBase.prototype.isBalloonPlaying=function(){return this._balloonId>0||this._balloonPlaying},Game_CharacterBase.prototype.endAnimation=function(){this._animationPlaying=!1},Game_CharacterBase.prototype.endBalloon=function(){this._balloonPlaying=!1},Game_Character.prototype=Object.create(Game_CharacterBase.prototype),Game_Character.prototype.constructor=Game_Character,Game_Character.ROUTE_END=0,Game_Character.ROUTE_MOVE_DOWN=1,Game_Character.ROUTE_MOVE_LEFT=2,Game_Character.ROUTE_MOVE_RIGHT=3,Game_Character.ROUTE_MOVE_UP=4,Game_Character.ROUTE_MOVE_LOWER_L=5,Game_Character.ROUTE_MOVE_LOWER_R=6,Game_Character.ROUTE_MOVE_UPPER_L=7,Game_Character.ROUTE_MOVE_UPPER_R=8,Game_Character.ROUTE_MOVE_RANDOM=9,Game_Character.ROUTE_MOVE_TOWARD=10,Game_Character.ROUTE_MOVE_AWAY=11,Game_Character.ROUTE_MOVE_FORWARD=12,Game_Character.ROUTE_MOVE_BACKWARD=13,Game_Character.ROUTE_JUMP=14,Game_Character.ROUTE_WAIT=15,Game_Character.ROUTE_TURN_DOWN=16,Game_Character.ROUTE_TURN_LEFT=17,Game_Character.ROUTE_TURN_RIGHT=18,Game_Character.ROUTE_TURN_UP=19,Game_Character.ROUTE_TURN_90D_R=20,Game_Character.ROUTE_TURN_90D_L=21,Game_Character.ROUTE_TURN_180D=22,Game_Character.ROUTE_TURN_90D_R_L=23,Game_Character.ROUTE_TURN_RANDOM=24,Game_Character.ROUTE_TURN_TOWARD=25,Game_Character.ROUTE_TURN_AWAY=26,Game_Character.ROUTE_SWITCH_ON=27,Game_Character.ROUTE_SWITCH_OFF=28,Game_Character.ROUTE_CHANGE_SPEED=29,Game_Character.ROUTE_CHANGE_FREQ=30,Game_Character.ROUTE_WALK_ANIME_ON=31,Game_Character.ROUTE_WALK_ANIME_OFF=32,Game_Character.ROUTE_STEP_ANIME_ON=33,Game_Character.ROUTE_STEP_ANIME_OFF=34,Game_Character.ROUTE_DIR_FIX_ON=35,Game_Character.ROUTE_DIR_FIX_OFF=36,Game_Character.ROUTE_THROUGH_ON=37,Game_Character.ROUTE_THROUGH_OFF=38,Game_Character.ROUTE_TRANSPARENT_ON=39,Game_Character.ROUTE_TRANSPARENT_OFF=40,Game_Character.ROUTE_CHANGE_IMAGE=41,Game_Character.ROUTE_CHANGE_OPACITY=42,Game_Character.ROUTE_CHANGE_BLEND_MODE=43,Game_Character.ROUTE_PLAY_SE=44,Game_Character.ROUTE_SCRIPT=45,Game_Character.prototype.initialize=function(){Game_CharacterBase.prototype.initialize.call(this)},Game_Character.prototype.initMembers=function(){Game_CharacterBase.prototype.initMembers.call(this),this._moveRouteForcing=!1,this._moveRoute=null,this._moveRouteIndex=0,this._originalMoveRoute=null,this._originalMoveRouteIndex=0,this._waitCount=0,this._callerEventInfo=null},Game_Character.prototype.memorizeMoveRoute=function(){this._originalMoveRoute=this._moveRoute,this._originalMoveRouteIndex=this._moveRouteIndex},Game_Character.prototype.restoreMoveRoute=function(){this._moveRoute=this._originalMoveRoute,this._moveRouteIndex=this._originalMoveRouteIndex-1,this._originalMoveRoute=null,this._callerEventInfo=null},Game_Character.prototype.isMoveRouteForcing=function(){return this._moveRouteForcing},Game_Character.prototype.setMoveRoute=function(moveRoute){this._moveRoute=moveRoute,this._moveRouteIndex=0,this._moveRouteForcing=!1},Game_Character.prototype.forceMoveRoute=function(moveRoute){this._originalMoveRoute||this.memorizeMoveRoute(),this._moveRoute=moveRoute,this._moveRouteIndex=0,this._moveRouteForcing=!0,this._waitCount=0},Game_Character.prototype.setCallerEventInfo=function(callerEventInfo){this._callerEventInfo=callerEventInfo},Game_Character.prototype.updateStop=function(){Game_CharacterBase.prototype.updateStop.call(this),this._moveRouteForcing&&this.updateRoutineMove()},Game_Character.prototype.updateRoutineMove=function(){if(this._waitCount>0)this._waitCount--
else{this.setMovementSuccess(!0)
const command=this._moveRoute.list[this._moveRouteIndex]
command&&(this.processMoveCommand(command),this.advanceMoveRouteIndex())}},Game_Character.prototype.processMoveCommand=function(command){const gc=Game_Character,params=command.parameters
switch(command.code){case gc.ROUTE_END:this.processRouteEnd()
break
case gc.ROUTE_MOVE_DOWN:this.moveStraight(2)
break
case gc.ROUTE_MOVE_LEFT:this.moveStraight(4)
break
case gc.ROUTE_MOVE_RIGHT:this.moveStraight(6)
break
case gc.ROUTE_MOVE_UP:this.moveStraight(8)
break
case gc.ROUTE_MOVE_LOWER_L:this.moveDiagonally(4,2)
break
case gc.ROUTE_MOVE_LOWER_R:this.moveDiagonally(6,2)
break
case gc.ROUTE_MOVE_UPPER_L:this.moveDiagonally(4,8)
break
case gc.ROUTE_MOVE_UPPER_R:this.moveDiagonally(6,8)
break
case gc.ROUTE_MOVE_RANDOM:this.moveRandom()
break
case gc.ROUTE_MOVE_TOWARD:this.moveTowardPlayer()
break
case gc.ROUTE_MOVE_AWAY:this.moveAwayFromPlayer()
break
case gc.ROUTE_MOVE_FORWARD:this.moveForward()
break
case gc.ROUTE_MOVE_BACKWARD:this.moveBackward()
break
case gc.ROUTE_JUMP:this.jump(params[0],params[1])
break
case gc.ROUTE_WAIT:this._waitCount=params[0]-1
break
case gc.ROUTE_TURN_DOWN:this.setDirection(2)
break
case gc.ROUTE_TURN_LEFT:this.setDirection(4)
break
case gc.ROUTE_TURN_RIGHT:this.setDirection(6)
break
case gc.ROUTE_TURN_UP:this.setDirection(8)
break
case gc.ROUTE_TURN_90D_R:this.turnRight90()
break
case gc.ROUTE_TURN_90D_L:this.turnLeft90()
break
case gc.ROUTE_TURN_180D:this.turn180()
break
case gc.ROUTE_TURN_90D_R_L:this.turnRightOrLeft90()
break
case gc.ROUTE_TURN_RANDOM:this.turnRandom()
break
case gc.ROUTE_TURN_TOWARD:this.turnTowardPlayer()
break
case gc.ROUTE_TURN_AWAY:this.turnAwayFromPlayer()
break
case gc.ROUTE_SWITCH_ON:$gameSwitches.setValue(params[0],!0)
break
case gc.ROUTE_SWITCH_OFF:$gameSwitches.setValue(params[0],!1)
break
case gc.ROUTE_CHANGE_SPEED:this.setMoveSpeed(params[0])
break
case gc.ROUTE_CHANGE_FREQ:this.setMoveFrequency(params[0])
break
case gc.ROUTE_WALK_ANIME_ON:this.setWalkAnime(!0)
break
case gc.ROUTE_WALK_ANIME_OFF:this.setWalkAnime(!1)
break
case gc.ROUTE_STEP_ANIME_ON:this.setStepAnime(!0)
break
case gc.ROUTE_STEP_ANIME_OFF:this.setStepAnime(!1)
break
case gc.ROUTE_DIR_FIX_ON:this.setDirectionFix(!0)
break
case gc.ROUTE_DIR_FIX_OFF:this.setDirectionFix(!1)
break
case gc.ROUTE_THROUGH_ON:this.setThrough(!0)
break
case gc.ROUTE_THROUGH_OFF:this.setThrough(!1)
break
case gc.ROUTE_TRANSPARENT_ON:this.setTransparent(!0)
break
case gc.ROUTE_TRANSPARENT_OFF:this.setTransparent(!1)
break
case gc.ROUTE_CHANGE_IMAGE:this.setImage(params[0],params[1])
break
case gc.ROUTE_CHANGE_OPACITY:this.setOpacity(params[0])
break
case gc.ROUTE_CHANGE_BLEND_MODE:this.setBlendMode(params[0])
break
case gc.ROUTE_PLAY_SE:AudioManager.playSe(params[0])
break
case gc.ROUTE_SCRIPT:try{eval(params[0])}catch(error){if(this._callerEventInfo){for(let key in this._callerEventInfo)error[key]=this._callerEventInfo[key]
error.line+=this._moveRouteIndex+1,error.eventCommand="set_route_script",error.content=command.parameters[0]}else error.eventType="map_event",error.mapId=this._mapId,error.mapEventId=this._eventId,error.page=this._pageIndex+1,error.line=this._moveRouteIndex+1,error.eventCommand="auto_route_script",error.content=command.parameters[0]
throw error}}},Game_Character.prototype.deltaXFrom=function(x){return $gameMap.deltaX(this.x,x)},Game_Character.prototype.deltaYFrom=function(y){return $gameMap.deltaY(this.y,y)},Game_Character.prototype.moveRandom=function(){const d=2+2*Math.randomInt(4)
this.canPass(this.x,this.y,d)&&this.moveStraight(d)},Game_Character.prototype.moveTowardCharacter=function(character){const sx=this.deltaXFrom(character.x),sy=this.deltaYFrom(character.y)
Math.abs(sx)>Math.abs(sy)?(this.moveStraight(sx>0?4:6),this.isMovementSucceeded()||0===sy||this.moveStraight(sy>0?8:2)):0!==sy&&(this.moveStraight(sy>0?8:2),this.isMovementSucceeded()||0===sx||this.moveStraight(sx>0?4:6))},Game_Character.prototype.moveAwayFromCharacter=function(character){const sx=this.deltaXFrom(character.x),sy=this.deltaYFrom(character.y)
Math.abs(sx)>Math.abs(sy)?(this.moveStraight(sx>0?6:4),this.isMovementSucceeded()||0===sy||this.moveStraight(sy>0?2:8)):0!==sy&&(this.moveStraight(sy>0?2:8),this.isMovementSucceeded()||0===sx||this.moveStraight(sx>0?6:4))},Game_Character.prototype.turnTowardCharacter=function(character){const sx=this.deltaXFrom(character.x),sy=this.deltaYFrom(character.y)
Math.abs(sx)>Math.abs(sy)?this.setDirection(sx>0?4:6):0!==sy&&this.setDirection(sy>0?8:2)},Game_Character.prototype.turnAwayFromCharacter=function(character){const sx=this.deltaXFrom(character.x),sy=this.deltaYFrom(character.y)
Math.abs(sx)>Math.abs(sy)?this.setDirection(sx>0?6:4):0!==sy&&this.setDirection(sy>0?2:8)},Game_Character.prototype.turnTowardPlayer=function(){this.turnTowardCharacter($gamePlayer)},Game_Character.prototype.turnAwayFromPlayer=function(){this.turnAwayFromCharacter($gamePlayer)},Game_Character.prototype.moveTowardPlayer=function(){this.moveTowardCharacter($gamePlayer)},Game_Character.prototype.moveAwayFromPlayer=function(){this.moveAwayFromCharacter($gamePlayer)},Game_Character.prototype.moveForward=function(){this.moveStraight(this.direction())},Game_Character.prototype.moveBackward=function(){const lastDirectionFix=this.isDirectionFixed()
this.setDirectionFix(!0),this.moveStraight(this.reverseDir(this.direction())),this.setDirectionFix(lastDirectionFix)},Game_Character.prototype.processRouteEnd=function(){this._moveRoute.repeat?this._moveRouteIndex=-1:this._moveRouteForcing&&(this._moveRouteForcing=!1,this.restoreMoveRoute())},Game_Character.prototype.advanceMoveRouteIndex=function(){const moveRoute=this._moveRoute
if(moveRoute&&(this.isMovementSucceeded()||moveRoute.skippable)){const numCommands=moveRoute.list.length-1
this._moveRouteIndex++,moveRoute.repeat&&this._moveRouteIndex>=numCommands&&(this._moveRouteIndex=0)}},Game_Character.prototype.turnRight90=function(){switch(this.direction()){case 2:this.setDirection(4)
break
case 4:this.setDirection(8)
break
case 6:this.setDirection(2)
break
case 8:this.setDirection(6)}},Game_Character.prototype.turnLeft90=function(){switch(this.direction()){case 2:this.setDirection(6)
break
case 4:this.setDirection(2)
break
case 6:this.setDirection(8)
break
case 8:this.setDirection(4)}},Game_Character.prototype.turn180=function(){this.setDirection(this.reverseDir(this.direction()))},Game_Character.prototype.turnRightOrLeft90=function(){switch(Math.randomInt(2)){case 0:this.turnRight90()
break
case 1:this.turnLeft90()}},Game_Character.prototype.turnRandom=function(){this.setDirection(2+2*Math.randomInt(4))},Game_Character.prototype.swap=function(character){const newX=character.x,newY=character.y
character.locate(this.x,this.y),this.locate(newX,newY)},Game_Character.prototype.findDirectionTo=function(goalX,goalY){const searchLimit=this.searchLimit(),mapWidth=$gameMap.width(),nodeList=[],openList=[],closedList=[],start={}
let best=start
if(this.x===goalX&&this.y===goalY)return 0
for(start.parent=null,start.x=this.x,start.y=this.y,start.g=0,start.f=$gameMap.distance(start.x,start.y,goalX,goalY),nodeList.push(start),openList.push(start.y*mapWidth+start.x);nodeList.length>0;){let bestIndex=0
for(let i=0;i<nodeList.length;i++)nodeList[i].f<nodeList[bestIndex].f&&(bestIndex=i)
const current=nodeList[bestIndex],x1=current.x,y1=current.y,pos1=y1*mapWidth+x1,g1=current.g
if(nodeList.splice(bestIndex,1),openList.splice(openList.indexOf(pos1),1),closedList.push(pos1),current.x===goalX&&current.y===goalY){best=current
break}if(!(g1>=searchLimit))for(let j=0;j<4;j++){const direction=2+2*j,x2=$gameMap.roundXWithDirection(x1,direction),y2=$gameMap.roundYWithDirection(y1,direction),pos2=y2*mapWidth+x2
if(closedList.contains(pos2))continue
if(!this.canPass(x1,y1,direction))continue
const g2=g1+1,index2=openList.indexOf(pos2)
if(index2<0||g2<nodeList[index2].g){let neighbor
index2>=0?neighbor=nodeList[index2]:(neighbor={},nodeList.push(neighbor),openList.push(pos2)),neighbor.parent=current,neighbor.x=x2,neighbor.y=y2,neighbor.g=g2,neighbor.f=g2+$gameMap.distance(x2,y2,goalX,goalY),(!best||neighbor.f-neighbor.g<best.f-best.g)&&(best=neighbor)}}}let node=best
for(;node.parent&&node.parent!==start;)node=node.parent
const deltaX1=$gameMap.deltaX(node.x,start.x),deltaY1=$gameMap.deltaY(node.y,start.y)
if(deltaY1>0)return 2
if(deltaX1<0)return 4
if(deltaX1>0)return 6
if(deltaY1<0)return 8
const deltaX2=this.deltaXFrom(goalX),deltaY2=this.deltaYFrom(goalY)
return Math.abs(deltaX2)>Math.abs(deltaY2)?deltaX2>0?4:6:0!==deltaY2?deltaY2>0?8:2:0},Game_Character.prototype.searchLimit=function(){return 12},Game_Player.prototype=Object.create(Game_Character.prototype),Game_Player.prototype.constructor=Game_Player,Game_Player.prototype.initialize=function(){Game_Character.prototype.initialize.call(this),this.setTransparent($dataSystem.optTransparent)},Game_Player.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this),this._vehicleType="walk",this._vehicleGettingOn=!1,this._vehicleGettingOff=!1,this._dashing=!1,this._needsMapReload=!1,this._transferring=!1,this._newMapId=0,this._newX=0,this._newY=0,this._newDirection=0,this._fadeType=0,this._followers=new Game_Followers,this._encounterCount=0},Game_Player.prototype.clearTransferInfo=function(){this._transferring=!1,this._newMapId=0,this._newX=0,this._newY=0,this._newDirection=0},Game_Player.prototype.followers=function(){return this._followers},Game_Player.prototype.refresh=function(){const actor=$gameParty.leader(),characterName=actor?actor.characterName():"",characterIndex=actor?actor.characterIndex():0
this.setImage(characterName,characterIndex),this._followers.refresh()},Game_Player.prototype.isStopping=function(){return!this._vehicleGettingOn&&!this._vehicleGettingOff&&Game_Character.prototype.isStopping.call(this)},Game_Player.prototype.reserveTransfer=function(mapId,x,y,d,fadeType){this._transferring=!0,this._newMapId=mapId,this._newX=x,this._newY=y,this._newDirection=d,this._fadeType=fadeType},Game_Player.prototype.requestMapReload=function(){this._needsMapReload=!0},Game_Player.prototype.isTransferring=function(){return this._transferring},Game_Player.prototype.newMapId=function(){return this._newMapId},Game_Player.prototype.fadeType=function(){return this._fadeType},Game_Player.prototype.performTransfer=function(){this.isTransferring()&&(this.setDirection(this._newDirection),(this._newMapId!==$gameMap.mapId()||this._needsMapReload)&&($gameMap.setup(this._newMapId),this._needsMapReload=!1),this.locate(this._newX,this._newY),this.refresh(),DataManager.autoSaveGame(),this.clearTransferInfo())},Game_Player.prototype.isMapPassable=function(x,y,d){const vehicle=this.vehicle()
return vehicle?vehicle.isMapPassable(x,y,d):Game_Character.prototype.isMapPassable.call(this,x,y,d)},Game_Player.prototype.vehicle=function(){return $gameMap.vehicle(this._vehicleType)},Game_Player.prototype.isInBoat=function(){return"boat"===this._vehicleType},Game_Player.prototype.isInShip=function(){return"ship"===this._vehicleType},Game_Player.prototype.isInAirship=function(){return"airship"===this._vehicleType},Game_Player.prototype.isInVehicle=function(){return this.isInBoat()||this.isInShip()||this.isInAirship()},Game_Player.prototype.isNormal=function(){return"walk"===this._vehicleType&&!this.isMoveRouteForcing()},Game_Player.prototype.isDashing=function(){return this._dashing},Game_Player.prototype.isDebugThrough=function(){return Input.isPressed("control")&&$gameTemp.isPlaytest()},Game_Player.prototype.isCollided=function(x,y){return!this.isThrough()&&(this.pos(x,y)||this._followers.isSomeoneCollided(x,y))},Game_Player.prototype.centerX=function(){return(Graphics.width/$gameMap.tileWidth()-1)/2},Game_Player.prototype.centerY=function(){return(Graphics.height/$gameMap.tileHeight()-1)/2},Game_Player.prototype.center=function(x,y){return $gameMap.setDisplayPos(x-this.centerX(),y-this.centerY())},Game_Player.prototype.locate=function(x,y){Game_Character.prototype.locate.call(this,x,y),this.center(x,y),this.makeEncounterCount(),this.isInVehicle()&&this.vehicle().refresh(),this._followers.synchronize(x,y,this.direction())},Game_Player.prototype.increaseSteps=function(){Game_Character.prototype.increaseSteps.call(this),this.isNormal()&&$gameParty.increaseSteps()},Game_Player.prototype.makeEncounterCount=function(){const n=$gameMap.encounterStep()
this._encounterCount=Math.randomInt(n)+Math.randomInt(n)+1},Game_Player.prototype.makeEncounterTroopId=function(){const encounterList=[]
let weightSum=0
if($gameMap.encounterList().forEach((function(encounter){this.meetsEncounterConditions(encounter)&&(encounterList.push(encounter),weightSum+=encounter.weight)}),this),weightSum>0){let value=Math.randomInt(weightSum)
for(let i=0;i<encounterList.length;i++)if(value-=encounterList[i].weight,value<0)return encounterList[i].troopId}return 0},Game_Player.prototype.meetsEncounterConditions=function(encounter){return 0===encounter.regionSet.length||encounter.regionSet.contains(this.regionId())},Game_Player.prototype.executeEncounter=function(){if(!$gameMap.isEventRunning()&&this._encounterCount<=0){this.makeEncounterCount()
const troopId=this.makeEncounterTroopId()
return!!$dataTroops[troopId]&&(BattleManager.setup(troopId,!0,!1),BattleManager.onEncounter(),!0)}return!1},Game_Player.prototype.startMapEvent=function(x,y,triggers,normal){$gameMap.isEventRunning()||$gameMap.eventsXy(x,y).forEach((function(event){event.isTriggerIn(triggers)&&event.isNormalPriority()===normal&&event.start()}))},Game_Player.prototype.moveByInput=function(){if(!this.isMoving()&&this.canMove()){let direction=this.getInputDirection()
if(direction>0)$gameTemp.clearDestination()
else if($gameTemp.isDestinationValid()){const x=$gameTemp.destinationX(),y=$gameTemp.destinationY()
direction=this.findDirectionTo(x,y)}direction>0&&this.executeMove(direction)}},Game_Player.prototype.canMove=function(){return!($gameMap.isEventRunning()||$gameMessage.isBusy()||this.isMoveRouteForcing()||this.areFollowersGathering()||this._vehicleGettingOn||this._vehicleGettingOff||this.isInVehicle()&&!this.vehicle().canMove())},Game_Player.prototype.getInputDirection=function(){return Input.dir4},Game_Player.prototype.executeMove=function(direction){this.moveStraight(direction)},Game_Player.prototype.update=function(sceneActive){const lastScrolledX=this.scrolledX(),lastScrolledY=this.scrolledY(),wasMoving=this.isMoving()
this.updateDashing(),sceneActive&&this.moveByInput(),Game_Character.prototype.update.call(this),this.updateScroll(lastScrolledX,lastScrolledY),this.updateVehicle(),this.isMoving()||this.updateNonmoving(wasMoving),this._followers.update()},Game_Player.prototype.updateDashing=function(){this.isMoving()||(!this.canMove()||this.isInVehicle()||$gameMap.isDashDisabled()?this._dashing=!1:this._dashing=this.isDashButtonPressed()||$gameTemp.isDestinationValid())},Game_Player.prototype.isDashButtonPressed=function(){const shift=Input.isPressed("shift")
return ConfigManager.alwaysDash?!shift:shift},Game_Player.prototype.updateScroll=function(lastScrolledX,lastScrolledY){const x1=lastScrolledX,y1=lastScrolledY,x2=this.scrolledX(),y2=this.scrolledY()
y2>y1&&y2>this.centerY()&&$gameMap.scrollDown(y2-y1),x2<x1&&x2<this.centerX()&&$gameMap.scrollLeft(x1-x2),x2>x1&&x2>this.centerX()&&$gameMap.scrollRight(x2-x1),y2<y1&&y2<this.centerY()&&$gameMap.scrollUp(y1-y2)},Game_Player.prototype.updateVehicle=function(){this.isInVehicle()&&!this.areFollowersGathering()&&(this._vehicleGettingOn?this.updateVehicleGetOn():this._vehicleGettingOff?this.updateVehicleGetOff():this.vehicle().syncWithPlayer())},Game_Player.prototype.updateVehicleGetOn=function(){this.areFollowersGathering()||this.isMoving()||(this.setDirection(this.vehicle().direction()),this.setMoveSpeed(this.vehicle().moveSpeed()),this._vehicleGettingOn=!1,this.setTransparent(!0),this.isInAirship()&&this.setThrough(!0),this.vehicle().getOn())},Game_Player.prototype.updateVehicleGetOff=function(){!this.areFollowersGathering()&&this.vehicle().isLowest()&&(this._vehicleGettingOff=!1,this._vehicleType="walk",this.setTransparent(!1))},Game_Player.prototype.updateNonmoving=function(wasMoving){if(!$gameMap.isEventRunning()){if(wasMoving&&($gameParty.onPlayerWalk(),this.checkEventTriggerHere([1,2]),$gameMap.setupStartingEvent()))return
if(this.triggerAction())return
wasMoving?this.updateEncounterCount():$gameTemp.clearDestination()}},Game_Player.prototype.triggerAction=function(){if(this.canMove()){if(this.triggerButtonAction())return!0
if(this.triggerTouchAction())return!0}return!1},Game_Player.prototype.triggerButtonAction=function(){if(Input.isTriggered("ok")){if(this.getOnOffVehicle())return!0
if(this.checkEventTriggerHere([0]),$gameMap.setupStartingEvent())return!0
if(this.checkEventTriggerThere([0,1,2]),$gameMap.setupStartingEvent())return!0}return!1},Game_Player.prototype.triggerTouchAction=function(){if($gameTemp.isDestinationValid()){const direction=this.direction(),x1=this.x,y1=this.y,x2=$gameMap.roundXWithDirection(x1,direction),y2=$gameMap.roundYWithDirection(y1,direction),x3=$gameMap.roundXWithDirection(x2,direction),y3=$gameMap.roundYWithDirection(y2,direction),destX=$gameTemp.destinationX(),destY=$gameTemp.destinationY()
if(destX===x1&&destY===y1)return this.triggerTouchActionD1(x1,y1)
if(destX===x2&&destY===y2)return this.triggerTouchActionD2(x2,y2)
if(destX===x3&&destY===y3)return this.triggerTouchActionD3(x2,y2)}return!1},Game_Player.prototype.triggerTouchActionD1=function(x1,y1){return!!($gameMap.airship().pos(x1,y1)&&TouchInput.isTriggered()&&this.getOnOffVehicle())||(this.checkEventTriggerHere([0]),$gameMap.setupStartingEvent())},Game_Player.prototype.triggerTouchActionD2=function(x2,y2){return!(!$gameMap.boat().pos(x2,y2)&&!$gameMap.ship().pos(x2,y2)||!TouchInput.isTriggered()||!this.getOnVehicle())||!(!this.isInBoat()&&!this.isInShip()||!TouchInput.isTriggered()||!this.getOffVehicle())||(this.checkEventTriggerThere([0,1,2]),$gameMap.setupStartingEvent())},Game_Player.prototype.triggerTouchActionD3=function(x2,y2){return $gameMap.isCounter(x2,y2)&&this.checkEventTriggerThere([0,1,2]),$gameMap.setupStartingEvent()},Game_Player.prototype.updateEncounterCount=function(){this.canEncounter()&&(this._encounterCount-=this.encounterProgressValue())},Game_Player.prototype.canEncounter=function(){return!$gameParty.hasEncounterNone()&&$gameSystem.isEncounterEnabled()&&!this.isInAirship()&&!this.isMoveRouteForcing()&&!this.isDebugThrough()},Game_Player.prototype.encounterProgressValue=function(){let value=$gameMap.isBush(this.x,this.y)?2:1
return $gameParty.hasEncounterHalf()&&(value*=.5),this.isInShip()&&(value*=.5),value},Game_Player.prototype.checkEventTriggerHere=function(triggers){this.canStartLocalEvents()&&this.startMapEvent(this.x,this.y,triggers,!1)},Game_Player.prototype.checkEventTriggerThere=function(triggers){if(this.canStartLocalEvents()){const direction=this.direction(),x1=this.x,y1=this.y,x2=$gameMap.roundXWithDirection(x1,direction),y2=$gameMap.roundYWithDirection(y1,direction)
if(this.startMapEvent(x2,y2,triggers,!0),!$gameMap.isAnyEventStarting()&&$gameMap.isCounter(x2,y2)){const x3=$gameMap.roundXWithDirection(x2,direction),y3=$gameMap.roundYWithDirection(y2,direction)
this.startMapEvent(x3,y3,triggers,!0)}}},Game_Player.prototype.checkEventTriggerTouch=function(x,y){this.canStartLocalEvents()&&this.startMapEvent(x,y,[1,2],!0)},Game_Player.prototype.canStartLocalEvents=function(){return!this.isInAirship()},Game_Player.prototype.getOnOffVehicle=function(){return this.isInVehicle()?this.getOffVehicle():this.getOnVehicle()},Game_Player.prototype.getOnVehicle=function(){const direction=this.direction(),x1=this.x,y1=this.y,x2=$gameMap.roundXWithDirection(x1,direction),y2=$gameMap.roundYWithDirection(y1,direction)
return $gameMap.airship().pos(x1,y1)?this._vehicleType="airship":$gameMap.ship().pos(x2,y2)?this._vehicleType="ship":$gameMap.boat().pos(x2,y2)&&(this._vehicleType="boat"),this.isInVehicle()&&(this._vehicleGettingOn=!0,this.isInAirship()||this.forceMoveForward(),this.gatherFollowers()),this._vehicleGettingOn},Game_Player.prototype.getOffVehicle=function(){return this.vehicle().isLandOk(this.x,this.y,this.direction())&&(this.isInAirship()&&this.setDirection(2),this._followers.synchronize(this.x,this.y,this.direction()),this.vehicle().getOff(),this.isInAirship()||(this.forceMoveForward(),this.setTransparent(!1)),this._vehicleGettingOff=!0,this.setMoveSpeed(4),this.setThrough(!1),this.makeEncounterCount(),this.gatherFollowers()),this._vehicleGettingOff},Game_Player.prototype.forceMoveForward=function(){this.setThrough(!0),this.moveForward(),this.setThrough(!1)},Game_Player.prototype.isOnDamageFloor=function(){return $gameMap.isDamageFloor(this.x,this.y)&&!this.isInAirship()},Game_Player.prototype.moveStraight=function(d){this.canPass(this.x,this.y,d)&&this._followers.updateMove(),Game_Character.prototype.moveStraight.call(this,d)},Game_Player.prototype.moveDiagonally=function(horz,vert){this.canPassDiagonally(this.x,this.y,horz,vert)&&this._followers.updateMove(),Game_Character.prototype.moveDiagonally.call(this,horz,vert)},Game_Player.prototype.jump=function(xPlus,yPlus){Game_Character.prototype.jump.call(this,xPlus,yPlus),this._followers.jumpAll()},Game_Player.prototype.showFollowers=function(){this._followers.show()},Game_Player.prototype.hideFollowers=function(){this._followers.hide()},Game_Player.prototype.gatherFollowers=function(){this._followers.gather()},Game_Player.prototype.areFollowersGathering=function(){return this._followers.areGathering()},Game_Player.prototype.areFollowersGathered=function(){return this._followers.areGathered()},Game_Follower.prototype=Object.create(Game_Character.prototype),Game_Follower.prototype.constructor=Game_Follower,Game_Follower.prototype.initialize=function(memberIndex){Game_Character.prototype.initialize.call(this),this._memberIndex=memberIndex,this.setTransparent($dataSystem.optTransparent),this.setThrough(!0)},Game_Follower.prototype.refresh=function(){const characterName=this.isVisible()?this.actor().characterName():"",characterIndex=this.isVisible()?this.actor().characterIndex():0
this.setImage(characterName,characterIndex)},Game_Follower.prototype.actor=function(){return $gameParty.battleMembers()[this._memberIndex]},Game_Follower.prototype.isVisible=function(){return this.actor()&&$gamePlayer.followers().isVisible()},Game_Follower.prototype.update=function(){Game_Character.prototype.update.call(this),this.setMoveSpeed($gamePlayer.realMoveSpeed()),this.setOpacity($gamePlayer.opacity()),this.setBlendMode($gamePlayer.blendMode()),this.setWalkAnime($gamePlayer.hasWalkAnime()),this.setStepAnime($gamePlayer.hasStepAnime()),this.setDirectionFix($gamePlayer.isDirectionFixed()),this.setTransparent($gamePlayer.isTransparent())},Game_Follower.prototype.chaseCharacter=function(character){const sx=this.deltaXFrom(character.x),sy=this.deltaYFrom(character.y)
0!==sx&&0!==sy?this.moveDiagonally(sx>0?4:6,sy>0?8:2):0!==sx?this.moveStraight(sx>0?4:6):0!==sy&&this.moveStraight(sy>0?8:2),this.setMoveSpeed($gamePlayer.realMoveSpeed())},Game_Followers.prototype.initialize=function(){this._visible=$dataSystem.optFollowers,this._gathering=!1,this._data=[]
for(let i=1;i<$gameParty.maxBattleMembers();i++)this._data.push(new Game_Follower(i))},Game_Followers.prototype.isVisible=function(){return this._visible},Game_Followers.prototype.show=function(){this._visible=!0},Game_Followers.prototype.hide=function(){this._visible=!1},Game_Followers.prototype.follower=function(index){return this._data[index]},Game_Followers.prototype.forEach=function(callback,thisObject){this._data.forEach(callback,thisObject)},Game_Followers.prototype.reverseEach=function(callback,thisObject){this._data.reverse(),this._data.forEach(callback,thisObject),this._data.reverse()},Game_Followers.prototype.refresh=function(){this.forEach((function(follower){return follower.refresh()}),this)},Game_Followers.prototype.update=function(){this.areGathering()&&(this.areMoving()||this.updateMove(),this.areGathered()&&(this._gathering=!1)),this.forEach((function(follower){follower.update()}),this)},Game_Followers.prototype.updateMove=function(){for(let i=this._data.length-1;i>=0;i--){const precedingCharacter=i>0?this._data[i-1]:$gamePlayer
this._data[i].chaseCharacter(precedingCharacter)}},Game_Followers.prototype.jumpAll=function(){if($gamePlayer.isJumping())for(let i=0;i<this._data.length;i++){const follower=this._data[i],sx=$gamePlayer.deltaXFrom(follower.x),sy=$gamePlayer.deltaYFrom(follower.y)
follower.jump(sx,sy)}},Game_Followers.prototype.synchronize=function(x,y,d){this.forEach((function(follower){follower.locate(x,y),follower.setDirection(d)}),this)},Game_Followers.prototype.gather=function(){this._gathering=!0},Game_Followers.prototype.areGathering=function(){return this._gathering},Game_Followers.prototype.visibleFollowers=function(){return this._data.filter((function(follower){return follower.isVisible()}),this)},Game_Followers.prototype.areMoving=function(){return this.visibleFollowers().some((function(follower){return follower.isMoving()}),this)},Game_Followers.prototype.areGathered=function(){return this.visibleFollowers().every((function(follower){return!follower.isMoving()&&follower.pos($gamePlayer.x,$gamePlayer.y)}),this)},Game_Followers.prototype.isSomeoneCollided=function(x,y){return this.visibleFollowers().some((function(follower){return follower.pos(x,y)}),this)},Game_Vehicle.prototype=Object.create(Game_Character.prototype),Game_Vehicle.prototype.constructor=Game_Vehicle,Game_Vehicle.prototype.initialize=function(type){Game_Character.prototype.initialize.call(this),this._type=type,this.resetDirection(),this.initMoveSpeed(),this.loadSystemSettings()},Game_Vehicle.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this),this._type="",this._mapId=0,this._altitude=0,this._driving=!1,this._bgm=null},Game_Vehicle.prototype.isBoat=function(){return"boat"===this._type},Game_Vehicle.prototype.isShip=function(){return"ship"===this._type},Game_Vehicle.prototype.isAirship=function(){return"airship"===this._type},Game_Vehicle.prototype.resetDirection=function(){this.setDirection(4)},Game_Vehicle.prototype.initMoveSpeed=function(){this.isBoat()?this.setMoveSpeed(4):this.isShip()?this.setMoveSpeed(5):this.isAirship()&&this.setMoveSpeed(6)},Game_Vehicle.prototype.vehicle=function(){return this.isBoat()?$dataSystem.boat:this.isShip()?$dataSystem.ship:this.isAirship()?$dataSystem.airship:null},Game_Vehicle.prototype.loadSystemSettings=function(){const vehicle=this.vehicle()
this._mapId=vehicle.startMapId,this.setPosition(vehicle.startX,vehicle.startY),this.setImage(vehicle.characterName,vehicle.characterIndex)},Game_Vehicle.prototype.refresh=function(){this._driving?(this._mapId=$gameMap.mapId(),this.syncWithPlayer()):this._mapId===$gameMap.mapId()&&this.locate(this.x,this.y),this.isAirship()?this.setPriorityType(this._driving?2:0):this.setPriorityType(1),this.setWalkAnime(this._driving),this.setStepAnime(this._driving),this.setTransparent(this._mapId!==$gameMap.mapId())},Game_Vehicle.prototype.setLocation=function(mapId,x,y){this._mapId=mapId,this.setPosition(x,y),this.refresh()},Game_Vehicle.prototype.pos=function(x,y){return this._mapId===$gameMap.mapId()&&Game_Character.prototype.pos.call(this,x,y)},Game_Vehicle.prototype.isMapPassable=function(x,y,d){const x2=$gameMap.roundXWithDirection(x,d),y2=$gameMap.roundYWithDirection(y,d)
return this.isBoat()?$gameMap.isBoatPassable(x2,y2):this.isShip()?$gameMap.isShipPassable(x2,y2):!!this.isAirship()},Game_Vehicle.prototype.getOn=function(){this._driving=!0,this.setWalkAnime(!0),this.setStepAnime(!0),$gameSystem.saveWalkingBgm(),this.playBgm()},Game_Vehicle.prototype.getOff=function(){this._driving=!1,this.setWalkAnime(!1),this.setStepAnime(!1),this.resetDirection(),$gameSystem.replayWalkingBgm()},Game_Vehicle.prototype.setBgm=function(bgm){this._bgm=bgm},Game_Vehicle.prototype.playBgm=function(){AudioManager.playBgm(this._bgm||this.vehicle().bgm)},Game_Vehicle.prototype.syncWithPlayer=function(){this.copyPosition($gamePlayer),this.refreshBushDepth()},Game_Vehicle.prototype.screenY=function(){return Game_Character.prototype.screenY.call(this)-this._altitude},Game_Vehicle.prototype.shadowX=function(){return this.screenX()},Game_Vehicle.prototype.shadowY=function(){return this.screenY()+this._altitude},Game_Vehicle.prototype.shadowOpacity=function(){return 255*this._altitude/this.maxAltitude()},Game_Vehicle.prototype.canMove=function(){return!this.isAirship()||this.isHighest()},Game_Vehicle.prototype.update=function(){Game_Character.prototype.update.call(this),this.isAirship()&&this.updateAirship()},Game_Vehicle.prototype.updateAirship=function(){this.updateAirshipAltitude(),this.setStepAnime(this.isHighest()),this.setPriorityType(this.isLowest()?0:2)},Game_Vehicle.prototype.updateAirshipAltitude=function(){this._driving&&!this.isHighest()&&this._altitude++,this._driving||this.isLowest()||this._altitude--},Game_Vehicle.prototype.maxAltitude=function(){return 48},Game_Vehicle.prototype.isLowest=function(){return this._altitude<=0},Game_Vehicle.prototype.isHighest=function(){return this._altitude>=this.maxAltitude()},Game_Vehicle.prototype.isTakeoffOk=function(){return $gamePlayer.areFollowersGathered()},Game_Vehicle.prototype.isLandOk=function(x,y,d){if(this.isAirship()){if(!$gameMap.isAirshipLandOk(x,y))return!1
if($gameMap.eventsXy(x,y).length>0)return!1}else{const x2=$gameMap.roundXWithDirection(x,d),y2=$gameMap.roundYWithDirection(y,d)
if(!$gameMap.isValid(x2,y2))return!1
if(!$gameMap.isPassable(x2,y2,this.reverseDir(d)))return!1
if(this.isCollidedWithCharacters(x2,y2))return!1}return!0},Game_Event.prototype=Object.create(Game_Character.prototype),Game_Event.prototype.constructor=Game_Event,Game_Event.prototype.initialize=function(mapId,eventId){Game_Character.prototype.initialize.call(this),this._mapId=mapId,this._eventId=eventId,this.locate(this.event().x,this.event().y),this.refresh()},Game_Event.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this),this._moveType=0,this._trigger=0,this._starting=!1,this._erased=!1,this._pageIndex=-2,this._originalPattern=1,this._originalDirection=2,this._prelockDirection=0,this._locked=!1},Game_Event.prototype.eventId=function(){return this._eventId},Game_Event.prototype.event=function(){return $dataMap.events[this._eventId]},Game_Event.prototype.page=function(){return this.event().pages[this._pageIndex]},Game_Event.prototype.list=function(){return this.page().list},Game_Event.prototype.isCollidedWithCharacters=function(x,y){return Game_Character.prototype.isCollidedWithCharacters.call(this,x,y)||this.isCollidedWithPlayerCharacters(x,y)},Game_Event.prototype.isCollidedWithEvents=function(x,y){const events=void 0
return $gameMap.eventsXyNt(x,y).length>0},Game_Event.prototype.isCollidedWithPlayerCharacters=function(x,y){return this.isNormalPriority()&&$gamePlayer.isCollided(x,y)},Game_Event.prototype.lock=function(){this._locked||(this._prelockDirection=this.direction(),this.turnTowardPlayer(),this._locked=!0)},Game_Event.prototype.unlock=function(){this._locked&&(this._locked=!1,this.setDirection(this._prelockDirection))},Game_Event.prototype.updateStop=function(){this._locked&&this.resetStopCount(),Game_Character.prototype.updateStop.call(this),this.isMoveRouteForcing()||this.updateSelfMovement()},Game_Event.prototype.updateSelfMovement=function(){if(!this._locked&&this.isNearTheScreen()&&this.checkStop(this.stopCountThreshold()))switch(this._moveType){case 1:this.moveTypeRandom()
break
case 2:this.moveTypeTowardPlayer()
break
case 3:this.moveTypeCustom()}},Game_Event.prototype.stopCountThreshold=function(){return 30*(5-this.moveFrequency())},Game_Event.prototype.moveTypeRandom=function(){switch(Math.randomInt(6)){case 0:case 1:this.moveRandom()
break
case 2:case 3:case 4:this.moveForward()
break
case 5:this.resetStopCount()}},Game_Event.prototype.moveTypeTowardPlayer=function(){if(this.isNearThePlayer())switch(Math.randomInt(6)){case 0:case 1:case 2:case 3:this.moveTowardPlayer()
break
case 4:this.moveRandom()
break
case 5:this.moveForward()}else this.moveRandom()},Game_Event.prototype.isNearThePlayer=function(){const sx=void 0,sy=void 0
return Math.abs(this.deltaXFrom($gamePlayer.x))+Math.abs(this.deltaYFrom($gamePlayer.y))<20},Game_Event.prototype.moveTypeCustom=function(){this.updateRoutineMove()},Game_Event.prototype.isStarting=function(){return this._starting},Game_Event.prototype.clearStartingFlag=function(){this._starting=!1},Game_Event.prototype.isTriggerIn=function(triggers){return triggers.contains(this._trigger)},Game_Event.prototype.start=function(){const list=this.list()
list&&list.length>1&&(this._starting=!0,this.isTriggerIn([0,1,2])&&this.lock())},Game_Event.prototype.erase=function(){this._erased=!0,this.refresh()},Game_Event.prototype.refresh=function(){const newPageIndex=this._erased?-1:this.findProperPageIndex()
this._pageIndex!==newPageIndex&&(this._pageIndex=newPageIndex,this.setupPage())},Game_Event.prototype.findProperPageIndex=function(){const pages=this.event().pages
for(let i=pages.length-1;i>=0;i--){const page=pages[i]
if(this.meetsConditions(page))return i}return-1},Game_Event.prototype.meetsConditions=function(page){const c=page.conditions
if(c.switch1Valid&&!$gameSwitches.value(c.switch1Id))return!1
if(c.switch2Valid&&!$gameSwitches.value(c.switch2Id))return!1
if(c.variableValid&&$gameVariables.value(c.variableId)<c.variableValue)return!1
if(c.selfSwitchValid){const key=[this._mapId,this._eventId,c.selfSwitchCh]
if(!0!==$gameSelfSwitches.value(key))return!1}if(c.itemValid){const item=$dataItems[c.itemId]
if(!$gameParty.hasItem(item))return!1}if(c.actorValid){const actor=$gameActors.actor(c.actorId)
if(!$gameParty.members().contains(actor))return!1}return!0},Game_Event.prototype.setupPage=function(){this._pageIndex>=0?this.setupPageSettings():this.clearPageSettings(),this.refreshBushDepth(),this.clearStartingFlag(),this.checkEventTriggerAuto()},Game_Event.prototype.clearPageSettings=function(){this.setImage("",0),this._moveType=0,this._trigger=null,this._interpreter=null,this.setThrough(!0)},Game_Event.prototype.setupPageSettings=function(){const page=this.page(),image=page.image
image.tileId>0?this.setTileImage(image.tileId):this.setImage(image.characterName,image.characterIndex),this._originalDirection!==image.direction&&(this._originalDirection=image.direction,this._prelockDirection=0,this.setDirectionFix(!1),this.setDirection(image.direction)),this._originalPattern!==image.pattern&&(this._originalPattern=image.pattern,this.setPattern(image.pattern)),this.setMoveSpeed(page.moveSpeed),this.setMoveFrequency(page.moveFrequency),this.setPriorityType(page.priorityType),this.setWalkAnime(page.walkAnime),this.setStepAnime(page.stepAnime),this.setDirectionFix(page.directionFix),this.setThrough(page.through),this.setMoveRoute(page.moveRoute),this._moveType=page.moveType,this._trigger=page.trigger,4===this._trigger?this._interpreter=new Game_Interpreter:this._interpreter=null},Game_Event.prototype.isOriginalPattern=function(){return this.pattern()===this._originalPattern},Game_Event.prototype.resetPattern=function(){this.setPattern(this._originalPattern)},Game_Event.prototype.checkEventTriggerTouch=function(x,y){$gameMap.isEventRunning()||2===this._trigger&&$gamePlayer.pos(x,y)&&!this.isJumping()&&this.isNormalPriority()&&this.start()},Game_Event.prototype.checkEventTriggerAuto=function(){3===this._trigger&&this.start()},Game_Event.prototype.update=function(){Game_Character.prototype.update.call(this),this.checkEventTriggerAuto(),this.updateParallel()},Game_Event.prototype.updateParallel=function(){this._interpreter&&(this._interpreter.isRunning()||(this._interpreter.setup(this.list(),this._eventId),this._interpreter.setEventInfo(this.getEventInfo())),this._interpreter.update())},Game_Event.prototype.locate=function(x,y){Game_Character.prototype.locate.call(this,x,y),this._prelockDirection=0},Game_Event.prototype.forceMoveRoute=function(moveRoute){Game_Character.prototype.forceMoveRoute.call(this,moveRoute),this._prelockDirection=0},Game_Event.prototype.getEventInfo=function(){return{eventType:"map_event",mapId:this._mapId,mapEventId:this._eventId,page:this._pageIndex+1}},Game_Interpreter.prototype.initialize=function(depth){this._depth=depth||0,this.checkOverflow(),this.clear(),this._branch={},this._params=[],this._indent=0,this._frameCount=0,this._freezeChecker=0},Game_Interpreter.prototype.checkOverflow=function(){if(this._depth>=100)throw new Error("Common event calls exceeded the limit")},Game_Interpreter.prototype.clear=function(){this._mapId=0,this._eventId=0,this._list=null,this._index=0,this._waitCount=0,this._waitMode="",this._comments="",this._eventInfo=null,this._character=null,this._childInterpreter=null},Game_Interpreter.prototype.setup=function(list,eventId){this.clear(),this._mapId=$gameMap.mapId(),this._eventId=eventId||0,this._list=list,Game_Interpreter.requestImages(list)},Game_Interpreter.prototype.eventId=function(){return this._eventId},Game_Interpreter.prototype.isOnCurrentMap=function(){return this._mapId===$gameMap.mapId()},Game_Interpreter.prototype.setEventInfo=function(eventInfo){this._eventInfo=eventInfo},Game_Interpreter.prototype.setupReservedCommonEvent=function(){return!!$gameTemp.isCommonEventReserved()&&(this.setup($gameTemp.reservedCommonEvent().list),this.setEventInfo({eventType:"common_event",commonEventId:$gameTemp.reservedCommonEventId()}),$gameTemp.clearCommonEvent(),!0)},Game_Interpreter.prototype.isRunning=function(){return!!this._list},Game_Interpreter.prototype.update=function(){for(;this.isRunning()&&!this.updateChild()&&!this.updateWait()&&!SceneManager.isSceneChanging()&&this.executeCommand()&&!this.checkFreeze(););},Game_Interpreter.prototype.updateChild=function(){if(this._childInterpreter){if(this._childInterpreter.update(),this._childInterpreter.isRunning())return!0
this._childInterpreter=null}return!1},Game_Interpreter.prototype.updateWait=function(){return this.updateWaitCount()||this.updateWaitMode()},Game_Interpreter.prototype.updateWaitCount=function(){return this._waitCount>0&&(this._waitCount--,!0)},Game_Interpreter.prototype.updateWaitMode=function(){let waiting=!1
switch(this._waitMode){case"message":waiting=$gameMessage.isBusy()
break
case"transfer":waiting=$gamePlayer.isTransferring()
break
case"scroll":waiting=$gameMap.isScrolling()
break
case"route":waiting=this._character.isMoveRouteForcing()
break
case"animation":waiting=this._character.isAnimationPlaying()
break
case"balloon":waiting=this._character.isBalloonPlaying()
break
case"gather":waiting=$gamePlayer.areFollowersGathering()
break
case"action":waiting=BattleManager.isActionForced()
break
case"video":waiting=Graphics.isVideoPlaying()
break
case"image":waiting=!ImageManager.isReady()}return waiting||(this._waitMode=""),waiting},Game_Interpreter.prototype.setWaitMode=function(waitMode){this._waitMode=waitMode},Game_Interpreter.prototype.wait=function(duration){this._waitCount=duration},Game_Interpreter.prototype.fadeSpeed=function(){return 24},Game_Interpreter.prototype.executeCommand=function(){const command=this.currentCommand()
if(command){this._params=command.parameters,this._indent=command.indent
const methodName="command"+command.code
if("function"==typeof this[methodName])try{if(!this[methodName]())return!1}catch(error){for(let key in this._eventInfo)error[key]=this._eventInfo[key]
throw error.eventCommand=error.eventCommand||"other",error.line=error.line||this._index+1,error}this._index++}else this.terminate()
return!0},Game_Interpreter.prototype.checkFreeze=function(){return this._frameCount!==Graphics.frameCount&&(this._frameCount=Graphics.frameCount,this._freezeChecker=0),this._freezeChecker++>=1e5},Game_Interpreter.prototype.terminate=function(){this._list=null,this._comments=""},Game_Interpreter.prototype.skipBranch=function(){for(;this._list[this._index+1].indent>this._indent;)this._index++},Game_Interpreter.prototype.currentCommand=function(){return this._list[this._index]},Game_Interpreter.prototype.nextEventCode=function(){const command=this._list[this._index+1]
return command?command.code:0},Game_Interpreter.prototype.iterateActorId=function(param,callback){if(0===param)$gameParty.members().forEach(callback)
else{const actor=$gameActors.actor(param)
actor&&callback(actor)}},Game_Interpreter.prototype.iterateActorEx=function(param1,param2,callback){0===param1?this.iterateActorId(param2,callback):this.iterateActorId($gameVariables.value(param2),callback)},Game_Interpreter.prototype.iterateActorIndex=function(param,callback){if(param<0)$gameParty.members().forEach(callback)
else{const actor=$gameParty.members()[param]
actor&&callback(actor)}},Game_Interpreter.prototype.iterateEnemyIndex=function(param,callback){if(param<0)$gameTroop.members().forEach(callback)
else{const enemy=$gameTroop.members()[param]
enemy&&callback(enemy)}},Game_Interpreter.prototype.iterateBattler=function(param1,param2,callback){$gameParty.inBattle()&&(0===param1?this.iterateEnemyIndex(param2,callback):this.iterateActorId(param2,callback))},Game_Interpreter.prototype.character=function(param){return $gameParty.inBattle()?null:param<0?$gamePlayer:this.isOnCurrentMap()?$gameMap.event(param>0?param:this._eventId):null},Game_Interpreter.prototype.operateValue=function(operation,operandType,operand){const value=0===operandType?operand:$gameVariables.value(operand)
return 0===operation?value:-value},Game_Interpreter.prototype.changeHp=function(target,value,allowDeath){target.isAlive()&&(!allowDeath&&target.hp<=-value&&(value=1-target.hp),target.gainHp(value),target.isDead()&&target.performCollapse())},Game_Interpreter.prototype.command101=function(){if(!$gameMessage.isBusy()){for($gameMessage.setFaceImage(this._params[0],this._params[1]),$gameMessage.setBackground(this._params[2]),$gameMessage.setPositionType(this._params[3]);401===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0])
switch(this.nextEventCode()){case 102:this._index++,this.setupChoices(this.currentCommand().parameters)
break
case 103:this._index++,this.setupNumInput(this.currentCommand().parameters)
break
case 104:this._index++,this.setupItemChoice(this.currentCommand().parameters)}this._index++,this.setWaitMode("message")}return!1},Game_Interpreter.prototype.command102=function(){return $gameMessage.isBusy()||(this.setupChoices(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupChoices=function(params){const choices=params[0].clone()
let cancelType=params[1]
const defaultType=params.length>2?params[2]:0,positionType=params.length>3?params[3]:2,background=params.length>4?params[4]:0
cancelType>=choices.length&&(cancelType=-2),$gameMessage.setChoices(choices,defaultType,cancelType),$gameMessage.setChoiceBackground(background),$gameMessage.setChoicePositionType(positionType),$gameMessage.setChoiceCallback(function(n){this._branch[this._indent]=n}.bind(this))},Game_Interpreter.prototype.command402=function(){return this._branch[this._indent]!==this._params[0]&&this.skipBranch(),!0},Game_Interpreter.prototype.command403=function(){return this._branch[this._indent]>=0&&this.skipBranch(),!0},Game_Interpreter.prototype.command103=function(){return $gameMessage.isBusy()||(this.setupNumInput(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupNumInput=function(params){$gameMessage.setNumberInput(params[0],params[1])},Game_Interpreter.prototype.command104=function(){return $gameMessage.isBusy()||(this.setupItemChoice(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupItemChoice=function(params){$gameMessage.setItemChoice(params[0],params[1]||2)},Game_Interpreter.prototype.command105=function(){if(!$gameMessage.isBusy()){for($gameMessage.setScroll(this._params[0],this._params[1]);405===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0])
this._index++,this.setWaitMode("message")}return!1},Game_Interpreter.prototype.command108=function(){for(this._comments=[this._params[0]];408===this.nextEventCode();)this._index++,this._comments.push(this.currentCommand().parameters[0])
return!0},Game_Interpreter.prototype.command111=function(){let result=!1
switch(this._params[0]){case 0:result=$gameSwitches.value(this._params[1])===(0===this._params[2])
break
case 1:const value1=$gameVariables.value(this._params[1])
let value2
switch(value2=0===this._params[2]?this._params[3]:$gameVariables.value(this._params[3]),this._params[4]){case 0:result=value1===value2
break
case 1:result=value1>=value2
break
case 2:result=value1<=value2
break
case 3:result=value1>value2
break
case 4:result=value1<value2
break
case 5:result=value1!==value2}break
case 2:if(this._eventId>0){const key=[this._mapId,this._eventId,this._params[1]]
result=$gameSelfSwitches.value(key)===(0===this._params[2])}break
case 3:$gameTimer.isWorking()&&(result=0===this._params[2]?$gameTimer.seconds()>=this._params[1]:$gameTimer.seconds()<=this._params[1])
break
case 4:const actor=$gameActors.actor(this._params[1])
if(actor){const n=this._params[3]
switch(this._params[2]){case 0:result=$gameParty.members().contains(actor)
break
case 1:result=actor.name()===n
break
case 2:result=actor.isClass($dataClasses[n])
break
case 3:result=actor.hasSkill(n)
break
case 4:result=actor.hasWeapon($dataWeapons[n])
break
case 5:result=actor.hasArmor($dataArmors[n])
break
case 6:result=actor.isStateAffected(n)}}break
case 5:const enemy=$gameTroop.members()[this._params[1]]
if(enemy)switch(this._params[2]){case 0:result=enemy.isAlive()
break
case 1:result=enemy.isStateAffected(this._params[3])}break
case 6:const character=this.character(this._params[1])
character&&(result=character.direction()===this._params[2])
break
case 7:switch(this._params[2]){case 0:result=$gameParty.gold()>=this._params[1]
break
case 1:result=$gameParty.gold()<=this._params[1]
break
case 2:result=$gameParty.gold()<this._params[1]}break
case 8:result=$gameParty.hasItem($dataItems[this._params[1]])
break
case 9:result=$gameParty.hasItem($dataWeapons[this._params[1]],this._params[2])
break
case 10:result=$gameParty.hasItem($dataArmors[this._params[1]],this._params[2])
break
case 11:result=Input.isPressed(this._params[1])
break
case 12:try{result=!!eval(this._params[1])}catch(error){throw error.eventCommand="conditional_branch_script",error.content=this._params[1],error}break
case 13:result=$gamePlayer.vehicle()===$gameMap.vehicle(this._params[1])}return this._branch[this._indent]=result,!1===this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command411=function(){return!1!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command112=function(){return!0},Game_Interpreter.prototype.command413=function(){do{this._index--}while(this.currentCommand().indent!==this._indent)
return!0},Game_Interpreter.prototype.command113=function(){let depth=0
for(;this._index<this._list.length-1;){this._index++
const command=this.currentCommand()
if(112===command.code&&depth++,413===command.code){if(!(depth>0))break
depth--}}return!0},Game_Interpreter.prototype.command115=function(){return this._index=this._list.length,!0},Game_Interpreter.prototype.command117=function(){const commonEvent=$dataCommonEvents[this._params[0]]
if(commonEvent){const eventId=this.isOnCurrentMap()?this._eventId:0
this.setupChild(commonEvent.list,eventId)}return!0},Game_Interpreter.prototype.setupChild=function(list,eventId){this._childInterpreter=new Game_Interpreter(this._depth+1),this._childInterpreter.setup(list,eventId),this._childInterpreter.setEventInfo({eventType:"common_event",commonEventId:this._params[0]})},Game_Interpreter.prototype.command118=function(){return!0},Game_Interpreter.prototype.command119=function(){const labelName=this._params[0]
for(let i=0;i<this._list.length;i++){const command=this._list[i]
if(118===command.code&&command.parameters[0]===labelName)return void this.jumpTo(i)}return!0},Game_Interpreter.prototype.jumpTo=function(index){const lastIndex=this._index,startIndex=Math.min(index,lastIndex),endIndex=Math.max(index,lastIndex)
let indent=this._indent
for(let i=startIndex;i<=endIndex;i++){const newIndent=this._list[i].indent
newIndent!==indent&&(this._branch[indent]=null,indent=newIndent)}this._index=index},Game_Interpreter.prototype.command121=function(){for(let i=this._params[0];i<=this._params[1];i++)$gameSwitches.setValue(i,0===this._params[2])
return!0},Game_Interpreter.prototype.command122=function(){let value=0
switch(this._params[3]){case 0:value=this._params[4]
break
case 1:value=$gameVariables.value(this._params[4])
break
case 2:value=this._params[5]-this._params[4]+1
for(let i=this._params[0];i<=this._params[1];i++)this.operateVariable(i,this._params[2],this._params[4]+Math.randomInt(value))
return!0
case 3:value=this.gameDataOperand(this._params[4],this._params[5],this._params[6])
break
case 4:try{value=eval(this._params[4])}catch(error){throw error.eventCommand="control_variables",error.content=this._params[4],error}}for(let i=this._params[0];i<=this._params[1];i++)this.operateVariable(i,this._params[2],value)
return!0},Game_Interpreter.prototype.gameDataOperand=function(type,param1,param2){switch(type){case 0:return $gameParty.numItems($dataItems[param1])
case 1:return $gameParty.numItems($dataWeapons[param1])
case 2:return $gameParty.numItems($dataArmors[param1])
case 3:const actor=$gameActors.actor(param1)
if(actor)switch(param2){case 0:return actor.level
case 1:return actor.currentExp()
case 2:return actor.hp
case 3:return actor.mp
default:if(param2>=4&&param2<=11)return actor.param(param2-4)}break
case 4:const enemy=$gameTroop.members()[param1]
if(enemy)switch(param2){case 0:return enemy.hp
case 1:return enemy.mp
default:if(param2>=2&&param2<=9)return enemy.param(param2-2)}break
case 5:const character=this.character(param1)
if(character)switch(param2){case 0:return character.x
case 1:return character.y
case 2:return character.direction()
case 3:return character.screenX()
case 4:return character.screenY()}break
case 6:const actor_party=$gameParty.members()[param1]
return actor_party?actor_party.actorId():0
case 7:switch(param1){case 0:return $gameMap.mapId()
case 1:return $gameParty.size()
case 2:return $gameParty.gold()
case 3:return $gameParty.steps()
case 4:return $gameSystem.playtime()
case 5:return $gameTimer.seconds()
case 6:return $gameSystem.saveCount()
case 7:return $gameSystem.battleCount()
case 8:return $gameSystem.winCount()
case 9:return $gameSystem.escapeCount()}}return 0},Game_Interpreter.prototype.operateVariable=function(variableId,operationType,value){try{let oldValue=$gameVariables.value(variableId)
switch(operationType){case 0:$gameVariables.setValue(variableId,oldValue=value)
break
case 1:$gameVariables.setValue(variableId,oldValue+value)
break
case 2:$gameVariables.setValue(variableId,oldValue-value)
break
case 3:$gameVariables.setValue(variableId,oldValue*value)
break
case 4:$gameVariables.setValue(variableId,oldValue/value)
break
case 5:$gameVariables.setValue(variableId,oldValue%value)}}catch(e){$gameVariables.setValue(variableId,0)}},Game_Interpreter.prototype.command123=function(){if(this._eventId>0){const key=[this._mapId,this._eventId,this._params[0]]
$gameSelfSwitches.setValue(key,0===this._params[1])}return!0},Game_Interpreter.prototype.command124=function(){return 0===this._params[0]?$gameTimer.start(60*this._params[1]):$gameTimer.stop(),!0},Game_Interpreter.prototype.command125=function(){const value=this.operateValue(this._params[0],this._params[1],this._params[2])
return $gameParty.gainGold(value),!0},Game_Interpreter.prototype.command126=function(){const value=this.operateValue(this._params[1],this._params[2],this._params[3])
return $gameParty.gainItem($dataItems[this._params[0]],value),!0},Game_Interpreter.prototype.command127=function(){const value=this.operateValue(this._params[1],this._params[2],this._params[3])
return $gameParty.gainItem($dataWeapons[this._params[0]],value,this._params[4]),!0},Game_Interpreter.prototype.command128=function(){const value=this.operateValue(this._params[1],this._params[2],this._params[3])
return $gameParty.gainItem($dataArmors[this._params[0]],value,this._params[4]),!0},Game_Interpreter.prototype.command129=function(){const actor=void 0
return $gameActors.actor(this._params[0])&&(0===this._params[1]?(this._params[2]&&$gameActors.actor(this._params[0]).setup(this._params[0]),$gameParty.addActor(this._params[0])):$gameParty.removeActor(this._params[0])),!0},Game_Interpreter.prototype.command132=function(){return $gameSystem.setBattleBgm(this._params[0]),!0},Game_Interpreter.prototype.command133=function(){return $gameSystem.setVictoryMe(this._params[0]),!0},Game_Interpreter.prototype.command134=function(){return 0===this._params[0]?$gameSystem.disableSave():$gameSystem.enableSave(),!0},Game_Interpreter.prototype.command135=function(){return 0===this._params[0]?$gameSystem.disableMenu():$gameSystem.enableMenu(),!0},Game_Interpreter.prototype.command136=function(){return 0===this._params[0]?$gameSystem.disableEncounter():$gameSystem.enableEncounter(),$gamePlayer.makeEncounterCount(),!0},Game_Interpreter.prototype.command137=function(){return 0===this._params[0]?$gameSystem.disableFormation():$gameSystem.enableFormation(),!0},Game_Interpreter.prototype.command138=function(){return $gameSystem.setWindowTone(this._params[0]),!0},Game_Interpreter.prototype.command139=function(){return $gameSystem.setDefeatMe(this._params[0]),!0},Game_Interpreter.prototype.command140=function(){const vehicle=$gameMap.vehicle(this._params[0])
return vehicle&&vehicle.setBgm(this._params[1]),!0},Game_Interpreter.prototype.command201=function(){if(!$gameParty.inBattle()&&!$gameMessage.isBusy()){let mapId,x,y
0===this._params[0]?(mapId=this._params[1],x=this._params[2],y=this._params[3]):(mapId=$gameVariables.value(this._params[1]),x=$gameVariables.value(this._params[2]),y=$gameVariables.value(this._params[3])),$gamePlayer.reserveTransfer(mapId,x,y,this._params[4],this._params[5]),this.setWaitMode("transfer"),this._index++}return!1},Game_Interpreter.prototype.command202=function(){let mapId,x,y
0===this._params[1]?(mapId=this._params[2],x=this._params[3],y=this._params[4]):(mapId=$gameVariables.value(this._params[2]),x=$gameVariables.value(this._params[3]),y=$gameVariables.value(this._params[4]))
const vehicle=$gameMap.vehicle(this._params[0])
return vehicle&&vehicle.setLocation(mapId,x,y),!0},Game_Interpreter.prototype.command203=function(){const character=this.character(this._params[0])
if(character){if(0===this._params[1])character.locate(this._params[2],this._params[3])
else if(1===this._params[1]){const x=$gameVariables.value(this._params[2]),y=$gameVariables.value(this._params[3])
character.locate(x,y)}else{const character2=this.character(this._params[2])
character2&&character.swap(character2)}this._params[4]>0&&character.setDirection(this._params[4])}return!0},Game_Interpreter.prototype.command204=function(){if(!$gameParty.inBattle()){if($gameMap.isScrolling())return this.setWaitMode("scroll"),!1
$gameMap.startScroll(this._params[0],this._params[1],this._params[2])}return!0},Game_Interpreter.prototype.command205=function(){if($gameMap.refreshIfNeeded(),this._character=this.character(this._params[0]),this._character){this._character.forceMoveRoute(this._params[1])
const eventInfo=JsonEx.makeDeepCopy(this._eventInfo)
eventInfo.line=this._index+1,this._character.setCallerEventInfo(eventInfo),this._params[1].wait&&this.setWaitMode("route")}return!0},Game_Interpreter.prototype.command206=function(){return $gamePlayer.getOnOffVehicle(),!0},Game_Interpreter.prototype.command211=function(){return $gamePlayer.setTransparent(0===this._params[0]),!0},Game_Interpreter.prototype.command212=function(){return this._character=this.character(this._params[0]),this._character&&(this._character.requestAnimation(this._params[1]),this._params[2]&&this.setWaitMode("animation")),!0},Game_Interpreter.prototype.command213=function(){return this._character=this.character(this._params[0]),this._character&&(this._character.requestBalloon(this._params[1]),this._params[2]&&this.setWaitMode("balloon")),!0},Game_Interpreter.prototype.command214=function(){return this.isOnCurrentMap()&&this._eventId>0&&$gameMap.eraseEvent(this._eventId),!0},Game_Interpreter.prototype.command216=function(){return 0===this._params[0]?$gamePlayer.showFollowers():$gamePlayer.hideFollowers(),$gamePlayer.refresh(),!0},Game_Interpreter.prototype.command217=function(){return $gameParty.inBattle()||($gamePlayer.gatherFollowers(),this.setWaitMode("gather")),!0},Game_Interpreter.prototype.command221=function(){return $gameMessage.isBusy()||($gameScreen.startFadeOut(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1},Game_Interpreter.prototype.command222=function(){return $gameMessage.isBusy()||($gameScreen.startFadeIn(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1},Game_Interpreter.prototype.command223=function(){return $gameScreen.startTint(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0},Game_Interpreter.prototype.command224=function(){return $gameScreen.startFlash(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0},Game_Interpreter.prototype.command225=function(){return $gameScreen.startShake(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0},Game_Interpreter.prototype.command230=function(){return this.wait(this._params[0]),!0},Game_Interpreter.prototype.command231=function(){let x,y
return 0===this._params[3]?(x=this._params[4],y=this._params[5]):(x=$gameVariables.value(this._params[4]),y=$gameVariables.value(this._params[5])),$gameScreen.showPicture(this._params[0],this._params[1],this._params[2],x,y,this._params[6],this._params[7],this._params[8],this._params[9]),!0},Game_Interpreter.prototype.command232=function(){let x,y
return 0===this._params[3]?(x=this._params[4],y=this._params[5]):(x=$gameVariables.value(this._params[4]),y=$gameVariables.value(this._params[5])),$gameScreen.movePicture(this._params[0],this._params[2],x,y,this._params[6],this._params[7],this._params[8],this._params[9],this._params[10]),this._params[11]&&this.wait(this._params[10]),!0},Game_Interpreter.prototype.command233=function(){return $gameScreen.rotatePicture(this._params[0],this._params[1]),!0},Game_Interpreter.prototype.command234=function(){return $gameScreen.tintPicture(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0},Game_Interpreter.prototype.command235=function(){return $gameScreen.erasePicture(this._params[0]),!0},Game_Interpreter.prototype.command236=function(){return $gameParty.inBattle()||($gameScreen.changeWeather(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2])),!0},Game_Interpreter.prototype.command241=function(){return AudioManager.playBgm(this._params[0]),!0},Game_Interpreter.prototype.command242=function(){return AudioManager.fadeOutBgm(this._params[0]),!0},Game_Interpreter.prototype.command243=function(){return $gameSystem.saveBgm(),!0},Game_Interpreter.prototype.command244=function(){return $gameSystem.replayBgm(),!0},Game_Interpreter.prototype.command245=function(){return AudioManager.playBgs(this._params[0]),!0},Game_Interpreter.prototype.command246=function(){return AudioManager.fadeOutBgs(this._params[0]),!0},Game_Interpreter.prototype.command249=function(){return AudioManager.playMe(this._params[0]),!0},Game_Interpreter.prototype.command250=function(){return AudioManager.playSe(this._params[0]),!0},Game_Interpreter.prototype.command251=function(){return AudioManager.stopSe(),!0},Game_Interpreter.prototype.command261=function(){if(!$gameMessage.isBusy()){const name=this._params[0]
if(name.length>0){const ext=this.videoFileExt()
Graphics.playVideo("movies/"+name+ext),this.setWaitMode("video")}this._index++}return!1},Game_Interpreter.prototype.videoFileExt=function(){return Graphics.canPlayVideoType("video/webm")&&!Utils.isMobileDevice()?".webm":".mp4"},Game_Interpreter.prototype.command281=function(){return 0===this._params[0]?$gameMap.enableNameDisplay():$gameMap.disableNameDisplay(),!0},Game_Interpreter.prototype.command282=function(){const tileset=$dataTilesets[this._params[0]]
this._imageReservationId||(this._imageReservationId=Utils.generateRuntimeId())
const allReady=void 0
return!!tileset.tilesetNames.map((function(tilesetName){return ImageManager.reserveTileset(tilesetName,0,this._imageReservationId)}),this).every((function(bitmap){return bitmap.isReady()}))&&($gameMap.changeTileset(this._params[0]),ImageManager.releaseReservation(this._imageReservationId),this._imageReservationId=null,!0)},Game_Interpreter.prototype.command283=function(){return $gameMap.changeBattleback(this._params[0],this._params[1]),!0},Game_Interpreter.prototype.command284=function(){return $gameMap.changeParallax(this._params[0],this._params[1],this._params[2],this._params[3],this._params[4]),!0},Game_Interpreter.prototype.command285=function(){let x,y,value
switch(0===this._params[2]?(x=this._params[3],y=this._params[4]):(x=$gameVariables.value(this._params[3]),y=$gameVariables.value(this._params[4])),this._params[1]){case 0:value=$gameMap.terrainTag(x,y)
break
case 1:value=$gameMap.eventIdXy(x,y)
break
case 2:case 3:case 4:case 5:value=$gameMap.tileId(x,y,this._params[1]-2)
break
default:value=$gameMap.regionId(x,y)}return $gameVariables.setValue(this._params[0],value),!0},Game_Interpreter.prototype.command301=function(){if(!$gameParty.inBattle()){let troopId
troopId=0===this._params[0]?this._params[1]:1===this._params[0]?$gameVariables.value(this._params[1]):$gamePlayer.makeEncounterTroopId(),$dataTroops[troopId]&&(BattleManager.setup(troopId,this._params[2],this._params[3]),BattleManager.setEventCallback(function(n){this._branch[this._indent]=n}.bind(this)),$gamePlayer.makeEncounterCount(),SceneManager.push(Scene_Battle))}return!0},Game_Interpreter.prototype.command601=function(){return 0!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command602=function(){return 1!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command603=function(){return 2!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command302=function(){if(!$gameParty.inBattle()){const goods=[this._params]
for(;605===this.nextEventCode();)this._index++,goods.push(this.currentCommand().parameters)
SceneManager.push(Scene_Shop),SceneManager.prepareNextScene(goods,this._params[4])}return!0},Game_Interpreter.prototype.command303=function(){return $gameParty.inBattle()||$dataActors[this._params[0]]&&(SceneManager.push(Scene_Name),SceneManager.prepareNextScene(this._params[0],this._params[1])),!0},Game_Interpreter.prototype.command311=function(){const value=this.operateValue(this._params[2],this._params[3],this._params[4])
return this.iterateActorEx(this._params[0],this._params[1],function(actor){this.changeHp(actor,value,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command312=function(){const value=this.operateValue(this._params[2],this._params[3],this._params[4])
return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.gainMp(value)}.bind(this)),!0},Game_Interpreter.prototype.command326=function(){const value=this.operateValue(this._params[2],this._params[3],this._params[4])
return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.gainTp(value)}.bind(this)),!0},Game_Interpreter.prototype.command313=function(){return this.iterateActorEx(this._params[0],this._params[1],function(actor){const alreadyDead=actor.isDead()
0===this._params[2]?actor.addState(this._params[3]):actor.removeState(this._params[3]),actor.isDead()&&!alreadyDead&&actor.performCollapse(),actor.clearResult()}.bind(this)),!0},Game_Interpreter.prototype.command314=function(){return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.recoverAll()}.bind(this)),!0},Game_Interpreter.prototype.command315=function(){const value=this.operateValue(this._params[2],this._params[3],this._params[4])
return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.changeExp(actor.currentExp()+value,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command316=function(){const value=this.operateValue(this._params[2],this._params[3],this._params[4])
return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.changeLevel(actor.level+value,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command317=function(){const value=this.operateValue(this._params[3],this._params[4],this._params[5])
return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.addParam(this._params[2],value)}.bind(this)),!0},Game_Interpreter.prototype.command318=function(){return this.iterateActorEx(this._params[0],this._params[1],function(actor){0===this._params[2]?actor.learnSkill(this._params[3]):actor.forgetSkill(this._params[3])}.bind(this)),!0},Game_Interpreter.prototype.command319=function(){const actor=$gameActors.actor(this._params[0])
return actor&&actor.changeEquipById(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command320=function(){const actor=$gameActors.actor(this._params[0])
return actor&&actor.setName(this._params[1]),!0},Game_Interpreter.prototype.command321=function(){const actor=$gameActors.actor(this._params[0])
return actor&&$dataClasses[this._params[1]]&&actor.changeClass(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command322=function(){const actor=$gameActors.actor(this._params[0])
return actor&&(actor.setCharacterImage(this._params[1],this._params[2]),actor.setFaceImage(this._params[3],this._params[4]),actor.setBattlerImage(this._params[5])),$gamePlayer.refresh(),!0},Game_Interpreter.prototype.command323=function(){const vehicle=$gameMap.vehicle(this._params[0])
return vehicle&&vehicle.setImage(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command324=function(){const actor=$gameActors.actor(this._params[0])
return actor&&actor.setNickname(this._params[1]),!0},Game_Interpreter.prototype.command325=function(){const actor=$gameActors.actor(this._params[0])
return actor&&actor.setProfile(this._params[1]),!0},Game_Interpreter.prototype.command331=function(){const value=this.operateValue(this._params[1],this._params[2],this._params[3])
return this.iterateEnemyIndex(this._params[0],function(enemy){this.changeHp(enemy,value,this._params[4])}.bind(this)),!0},Game_Interpreter.prototype.command332=function(){const value=this.operateValue(this._params[1],this._params[2],this._params[3])
return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.gainMp(value)}.bind(this)),!0},Game_Interpreter.prototype.command342=function(){const value=this.operateValue(this._params[1],this._params[2],this._params[3])
return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.gainTp(value)}.bind(this)),!0},Game_Interpreter.prototype.command333=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){const alreadyDead=enemy.isDead()
0===this._params[1]?enemy.addState(this._params[2]):enemy.removeState(this._params[2]),enemy.isDead()&&!alreadyDead&&enemy.performCollapse(),enemy.clearResult()}.bind(this)),!0},Game_Interpreter.prototype.command334=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.recoverAll()}.bind(this)),!0},Game_Interpreter.prototype.command335=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.appear(),$gameTroop.makeUniqueNames()}.bind(this)),!0},Game_Interpreter.prototype.command336=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.transform(this._params[1]),$gameTroop.makeUniqueNames()}.bind(this)),!0},Game_Interpreter.prototype.command337=function(){return 1==this._params[2]?this.iterateEnemyIndex(-1,function(enemy){enemy.isAlive()&&enemy.startAnimation(this._params[1],!1,0)}.bind(this)):this.iterateEnemyIndex(this._params[0],function(enemy){enemy.isAlive()&&enemy.startAnimation(this._params[1],!1,0)}.bind(this)),!0},Game_Interpreter.prototype.command339=function(){return this.iterateBattler(this._params[0],this._params[1],function(battler){battler.isDeathStateAffected()||(battler.forceAction(this._params[2],this._params[3]),BattleManager.forceAction(battler),this.setWaitMode("action"))}.bind(this)),!0},Game_Interpreter.prototype.command340=function(){return BattleManager.abort(),!0},Game_Interpreter.prototype.command351=function(){return $gameParty.inBattle()||(SceneManager.push(Scene_Menu),Window_MenuCommand.initCommandPosition()),!0},Game_Interpreter.prototype.command352=function(){return $gameParty.inBattle()||SceneManager.push(Scene_Save),!0},Game_Interpreter.prototype.command353=function(){return SceneManager.goto(Scene_Gameover),!0},Game_Interpreter.prototype.command354=function(){return SceneManager.goto(Scene_Title),!0},Game_Interpreter.prototype.command355=function(){const startLine=this._index+1
let script=this.currentCommand().parameters[0]+"\n"
for(;655===this.nextEventCode();)this._index++,script+=this.currentCommand().parameters[0]+"\n"
const endLine=this._index+1
try{eval(script)}catch(error){throw error.line=startLine+"-"+endLine,error.eventCommand="script",error.content=script,error}return!0},Game_Interpreter.prototype.command356=function(){const args=this._params[0].split(" "),command=args.shift()
try{this.pluginCommand(command,args)}catch(error){throw error.eventCommand="plugin_command",error.content=this._params[0],error}return!0},Game_Interpreter.prototype.pluginCommand=function(command,args){},Game_Interpreter.requestImagesByPluginCommand=function(command,args){},Game_Interpreter.requestImagesForCommand=function(command){const params=command.parameters
switch(command.code){case 101:ImageManager.requestFace(params[0])
break
case 129:const actor=$gameActors.actor(params[0])
if(actor&&0===params[1]){const name=actor.characterName()
ImageManager.requestCharacter(name)}break
case 205:params[1]&&params[1].list.forEach((function(command){const params=command.parameters
command.code===Game_Character.ROUTE_CHANGE_IMAGE&&ImageManager.requestCharacter(params[0])}))
break
case 212:case 337:if(params[1]){const animation=$dataAnimations[params[1]],name1=animation.animation1Name,name2=animation.animation2Name,hue1=animation.animation1Hue,hue2=animation.animation2Hue
ImageManager.requestAnimation(name1,hue1),ImageManager.requestAnimation(name2,hue2)}break
case 216:0===params[0]&&$gamePlayer.followers().forEach((function(follower){const name=follower.characterName()
ImageManager.requestCharacter(name)}))
break
case 231:ImageManager.requestPicture(params[1])
break
case 282:const tileset=void 0
$dataTilesets[params[0]].tilesetNames.forEach((function(tilesetName){ImageManager.requestTileset(tilesetName)}))
break
case 283:$gameParty.inBattle()&&(ImageManager.requestBattleback1(params[0]),ImageManager.requestBattleback2(params[1]))
break
case 284:$gameParty.inBattle()||ImageManager.requestParallax(params[0])
break
case 322:ImageManager.requestCharacter(params[1]),ImageManager.requestFace(params[3]),ImageManager.requestSvActor(params[5])
break
case 323:const vehicle=void 0
$gameMap.vehicle(params[0])&&ImageManager.requestCharacter(params[1])
break
case 336:const enemy=$dataEnemies[params[1]],name=enemy.battlerName,hue=enemy.battlerHue
$gameSystem.isSideView()?ImageManager.requestSvEnemy(name,hue):ImageManager.requestEnemy(name,hue)
break
case 356:const args=params[0].split(" "),commandName=args.shift()
Game_Interpreter.requestImagesByPluginCommand(commandName,args)}},Game_Interpreter.requestImagesByChildEvent=function(command,commonList){const params=command.parameters,commonEvent=$dataCommonEvents[params[0]]
commonEvent&&(commonList||(commonList=[]),commonList.contains(params[0])||(commonList.push(params[0]),Game_Interpreter.requestImages(commonEvent.list,commonList)))},Game_Interpreter.requestImages=function(list,commonList){if(!list)return
const len=list.length
for(let i=0;i<len;i+=1){const command=list[i]
117===command.code?Game_Interpreter.requestImagesByChildEvent(command,commonList):Game_Interpreter.requestImagesForCommand(command)}}
